import{r as oe,e as yt,a as Fe,j as ne,c as _e,S as Tt,f as xe,q as ze,o as We,p as Ge,v as ct,F as $t,w as Qt,h as _t,x as Zt,y as Jt,z as qt,D as St,n as xt,E as er,I as st,R as Ne,G as tr,H as rr,B as ir,C as nr,J as Lt,K as ar,M as Dt,N as At}from"./index-8cf50e72.js";function sr(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var or=sr();function lr(K,j){if(K!=null){if(typeof K=="function"){K(j);return}try{K.current=j}catch{throw new Error(`Cannot assign value '${j}' to ref '${K}'`)}}}function ur(...K){return j=>{K.forEach(X=>{lr(X,j)})}}function fr(...K){return oe.useMemo(()=>ur(...K),K)}function dr(K){return oe.Children.toArray(K).filter(j=>oe.isValidElement(j))}var[Ni,cr]=yt({strict:!1,name:"ButtonGroupContext"});function hr(K){const[j,X]=oe.useState(!K);return{ref:oe.useCallback(ie=>{ie&&X(ie.tagName==="BUTTON")},[]),type:j?"button":void 0}}function qe(K){const{children:j,className:X,...Z}=K,ee=oe.isValidElement(j)?oe.cloneElement(j,{"aria-hidden":!0,focusable:!1}):j,ie=Fe("chakra-button__icon",X);return ne(_e.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...Z,className:ie,children:ee})}qe.displayName="ButtonIcon";function et(K){const{label:j,placement:X,spacing:Z="0.5rem",children:ee=ne(Tt,{color:"currentColor",width:"1em",height:"1em"}),className:ie,__css:V,...U}=K,S=Fe("chakra-button__spinner",ie),F=X==="start"?"marginEnd":"marginStart",D=oe.useMemo(()=>({display:"flex",alignItems:"center",position:j?"relative":"absolute",[F]:j?Z:0,fontSize:"1em",lineHeight:"normal",...V}),[V,j,F,Z]);return ne(_e.div,{className:S,...U,__css:D,children:ee})}et.displayName="ButtonSpinner";var It=xe((K,j)=>{const X=cr(),Z=ze("Button",{...X,...K}),{isDisabled:ee=X==null?void 0:X.isDisabled,isLoading:ie,isActive:V,children:U,leftIcon:S,rightIcon:F,loadingText:D,iconSpacing:b="0.5rem",type:P,spinner:k,spinnerPlacement:A="start",className:L,as:x,..._}=We(K),T=oe.useMemo(()=>{const o={...Z==null?void 0:Z._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...Z,...!!X&&{_focus:o}}},[Z,X]),{ref:c,type:y}=hr(x),m={rightIcon:F,leftIcon:S,iconSpacing:b,children:U};return Ge(_e.button,{ref:fr(j,c),as:x,type:P??y,"data-active":ct(V),"data-loading":ct(ie),__css:T,className:Fe("chakra-button",L),..._,disabled:ee||ie,children:[ie&&A==="start"&&ne(et,{className:"chakra-button__spinner--start",label:D,placement:"start",spacing:b,children:k}),ie?D||ne(_e.span,{opacity:0,children:ne(ht,{...m})}):ne(ht,{...m}),ie&&A==="end"&&ne(et,{className:"chakra-button__spinner--end",label:D,placement:"end",spacing:b,children:k})]})});It.displayName="Button";function ht(K){const{leftIcon:j,rightIcon:X,children:Z,iconSpacing:ee}=K;return Ge($t,{children:[j&&ne(qe,{marginEnd:ee,children:j}),Z,X&&ne(qe,{marginStart:ee,children:X})]})}var Pt=xe((K,j)=>{const{icon:X,children:Z,isRound:ee,"aria-label":ie,...V}=K,U=X||Z,S=oe.isValidElement(U)?oe.cloneElement(U,{"aria-hidden":!0,focusable:!1}):null;return ne(It,{padding:"0",borderRadius:ee?"full":void 0,ref:j,"aria-label":ie,...V,children:S})});Pt.displayName="IconButton";var[vr,gr]=Qt("Card"),Ki=xe(function(j,X){const{className:Z,...ee}=j,ie=gr();return ne(_e.div,{ref:X,className:Fe("chakra-card__body",Z),__css:ie.body,...ee})}),Wi=xe(function(j,X){const{className:Z,children:ee,direction:ie="column",justify:V,align:U,...S}=We(j),F=_t("Card",j);return ne(_e.div,{ref:X,className:Fe("chakra-card",Z),__css:{display:"flex",flexDirection:ie,justifyContent:V,alignItems:U,position:"relative",minWidth:0,wordWrap:"break-word",...F.container},...S,children:ne(vr,{value:F,children:ee})})}),mr=or?oe.useLayoutEffect:oe.useEffect;function vt(K,j=[]){const X=oe.useRef(K);return mr(()=>{X.current=K}),oe.useCallback((...Z)=>{var ee;return(ee=X.current)==null?void 0:ee.call(X,...Z)},j)}function pr(K,j){const X=oe.useId();return oe.useMemo(()=>K||[j,X].filter(Boolean).join("-"),[K,j,X])}function Er(K,j){const X=K!==void 0;return[X,X&&typeof K<"u"?K:j]}function yr(K={}){const{onClose:j,onOpen:X,isOpen:Z,id:ee}=K,ie=vt(X),V=vt(j),[U,S]=oe.useState(K.defaultIsOpen||!1),[F,D]=Er(Z,U),b=pr(ee,"disclosure"),P=oe.useCallback(()=>{F||S(!1),V==null||V()},[F,V]),k=oe.useCallback(()=>{F||S(!0),ie==null||ie()},[F,ie]),A=oe.useCallback(()=>{(D?P:k)()},[D,k,P]);return{isOpen:!!D,onOpen:k,onClose:P,onToggle:A,isControlled:F,getButtonProps:(L={})=>({...L,"aria-expanded":D,"aria-controls":b,onClick:Zt(L.onClick,A)}),getDisclosureProps:(L={})=>({...L,hidden:!D,id:b})}}function Rt(K,j){return Array.isArray(K)?K.map(X=>X===null?null:j(X)):Jt(K)?Object.keys(K).reduce((X,Z)=>(X[Z]=j(K[Z]),X),{}):K!=null?j(K):null}var Ot=xe(function(j,X){const Z=ze("Text",j),{className:ee,align:ie,decoration:V,casing:U,...S}=We(j),F=qt({textAlign:j.align,textDecoration:j.decoration,textTransform:j.casing});return ne(_e.p,{ref:X,className:Fe("chakra-text",j.className),...F,...S,__css:Z})});Ot.displayName="Text";var Ct=K=>ne(_e.div,{className:"chakra-stack__item",...K,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...K.__css}});Ct.displayName="StackItem";var tt="& > *:not(style) ~ *:not(style)";function Tr(K){const{spacing:j,direction:X}=K,Z={column:{marginTop:j,marginEnd:0,marginBottom:0,marginStart:0},row:{marginTop:0,marginEnd:0,marginBottom:0,marginStart:j},"column-reverse":{marginTop:0,marginEnd:0,marginBottom:j,marginStart:0},"row-reverse":{marginTop:0,marginEnd:j,marginBottom:0,marginStart:0}};return{flexDirection:X,[tt]:Rt(X,ee=>Z[ee])}}function _r(K){const{spacing:j,direction:X}=K,Z={column:{my:j,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:j,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:j,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:j,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":Rt(X,ee=>Z[ee])}}var Mt=xe((K,j)=>{const{isInline:X,direction:Z,align:ee,justify:ie,spacing:V="0.5rem",wrap:U,children:S,divider:F,className:D,shouldWrapChildren:b,...P}=K,k=X?"row":Z??"column",A=oe.useMemo(()=>Tr({direction:k,spacing:V}),[k,V]),L=oe.useMemo(()=>_r({spacing:V,direction:k}),[V,k]),x=!!F,_=!b&&!x,T=oe.useMemo(()=>{const y=dr(S);return _?y:y.map((m,o)=>{const l=typeof m.key<"u"?m.key:o,s=o+1===y.length,g=b?ne(Ct,{children:m},l):m;if(!x)return g;const h=oe.cloneElement(F,{__css:L}),r=s?null:h;return Ge(oe.Fragment,{children:[g,r]},l)})},[F,L,x,_,b,S]),c=Fe("chakra-stack",D);return ne(_e.div,{ref:j,display:"flex",alignItems:ee,justifyContent:ie,flexDirection:A.flexDirection,flexWrap:U,className:c,__css:x?{}:{[tt]:A[tt]},...P,children:T})});Mt.displayName="Stack";var rt=xe((K,j)=>ne(Mt,{align:"center",...K,direction:"row",ref:j}));rt.displayName="HStack";var Sr=xe(function(j,X){const Z=ze("Heading",j),{className:ee,...ie}=We(j);return ne(_e.h2,{ref:X,className:Fe("chakra-heading",j.className),...ie,__css:Z})});Sr.displayName="Heading";var bt=xe(function(j,X){const{direction:Z,align:ee,justify:ie,wrap:V,basis:U,grow:S,shrink:F,...D}=j,b={display:"flex",flexDirection:Z,alignItems:ee,justifyContent:ie,flexWrap:V,flexBasis:U,flexGrow:S,flexShrink:F};return ne(_e.div,{ref:X,__css:b,...D})});bt.displayName="Flex";function xr(){const K=oe.useRef(!0);return oe.useEffect(()=>{K.current=!1},[]),K.current}function Lr(K){const j=oe.useRef();return oe.useEffect(()=>{j.current=K},[K]),j.current}var Dr=_e("div",{baseStyle:{boxShadow:"none",backgroundClip:"padding-box",cursor:"default",color:"transparent",pointerEvents:"none",userSelect:"none","&::before, &::after, *":{visibility:"hidden"}}}),it=St("skeleton-start-color"),nt=St("skeleton-end-color"),Ar=xt({from:{opacity:0},to:{opacity:1}}),Ir=xt({from:{borderColor:it.reference,background:it.reference},to:{borderColor:nt.reference,background:nt.reference}}),Pr=xe((K,j)=>{const X={...K,fadeDuration:typeof K.fadeDuration=="number"?K.fadeDuration:.4,speed:typeof K.speed=="number"?K.speed:.8},Z=ze("Skeleton",X),ee=xr(),{startColor:ie="",endColor:V="",isLoaded:U,fadeDuration:S,speed:F,className:D,fitContent:b,...P}=We(X),[k,A]=er("colors",[ie,V]),L=Lr(U),x=Fe("chakra-skeleton",D),_={...k&&{[it.variable]:k},...A&&{[nt.variable]:A}};if(U){const T=ee||L?"none":`${Ar} ${S}s`;return ne(_e.div,{ref:j,className:x,__css:{animation:T},...P})}return ne(Dr,{ref:j,className:x,...P,__css:{width:b?"fit-content":void 0,...Z,..._,_dark:{...Z._dark,..._},animation:`${F}s linear infinite alternate ${Ir}`}})});Pr.displayName="Skeleton";var[Rr,Ft]=yt({name:"TagStylesContext",errorMessage:`useTagStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tag />" `}),Or=xe((K,j)=>{const X=_t("Tag",K),Z=We(K),ee={display:"inline-flex",verticalAlign:"top",alignItems:"center",maxWidth:"100%",...X.container};return ne(Rr,{value:X,children:ne(_e.span,{ref:j,...Z,__css:ee})})});Or.displayName="Tag";var Cr=xe((K,j)=>{const X=Ft();return ne(_e.span,{ref:j,noOfLines:1,...K,__css:X.label})});Cr.displayName="TagLabel";var Mr=xe((K,j)=>ne(st,{ref:j,verticalAlign:"top",marginEnd:"0.5rem",...K}));Mr.displayName="TagLeftIcon";var br=xe((K,j)=>ne(st,{ref:j,verticalAlign:"top",marginStart:"0.5rem",...K}));br.displayName="TagRightIcon";var kt=K=>ne(st,{verticalAlign:"inherit",viewBox:"0 0 512 512",...K,children:ne("path",{fill:"currentColor",d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})});kt.displayName="TagCloseIcon";var Fr=xe((K,j)=>{const{isDisabled:X,children:Z,...ee}=K,V={display:"flex",alignItems:"center",justifyContent:"center",outline:"0",...Ft().closeButton};return ne(_e.button,{ref:j,"aria-label":"close",...ee,type:"button",disabled:X,__css:V,children:Z||ne(kt,{})})});Fr.displayName="TagCloseButton";var kr=typeof global=="object"&&global&&global.Object===Object&&global;const Br=kr;var Ur=typeof self=="object"&&self&&self.Object===Object&&self,wr=Br||Ur||Function("return this")();const Nr=wr;var Kr=Nr.Symbol;const Ye=Kr;var Bt=Object.prototype,Wr=Bt.hasOwnProperty,Gr=Bt.toString,He=Ye?Ye.toStringTag:void 0;function Hr(K){var j=Wr.call(K,He),X=K[He];try{K[He]=void 0;var Z=!0}catch{}var ee=Gr.call(K);return Z&&(j?K[He]=X:delete K[He]),ee}var jr=Object.prototype,Vr=jr.toString;function Yr(K){return Vr.call(K)}var Xr="[object Null]",zr="[object Undefined]",gt=Ye?Ye.toStringTag:void 0;function Ut(K){return K==null?K===void 0?zr:Xr:gt&&gt in Object(K)?Hr(K):Yr(K)}function $r(K){return K!=null&&typeof K=="object"}var Qr="[object Symbol]";function Zr(K){return typeof K=="symbol"||$r(K)&&Ut(K)==Qr}var Jr=/\s/;function qr(K){for(var j=K.length;j--&&Jr.test(K.charAt(j)););return j}var ei=/^\s+/;function ti(K){return K&&K.slice(0,qr(K)+1).replace(ei,"")}function Xe(K){var j=typeof K;return K!=null&&(j=="object"||j=="function")}var mt=0/0,ri=/^[-+]0x[0-9a-f]+$/i,ii=/^0b[01]+$/i,ni=/^0o[0-7]+$/i,ai=parseInt;function si(K){if(typeof K=="number")return K;if(Zr(K))return mt;if(Xe(K)){var j=typeof K.valueOf=="function"?K.valueOf():K;K=Xe(j)?j+"":j}if(typeof K!="string")return K===0?K:+K;K=ti(K);var X=ii.test(K);return X||ni.test(K)?ai(K.slice(2),X?2:8):ri.test(K)?mt:+K}var pt=1/0,oi=17976931348623157e292;function Je(K){if(!K)return K===0?K:0;if(K=si(K),K===pt||K===-pt){var j=K<0?-1:1;return j*oi}return K===K?K:0}var li="[object AsyncFunction]",ui="[object Function]",fi="[object GeneratorFunction]",di="[object Proxy]";function ci(K){if(!Xe(K))return!1;var j=Ut(K);return j==ui||j==fi||j==li||j==di}var hi=9007199254740991,vi=/^(?:0|[1-9]\d*)$/;function gi(K,j){var X=typeof K;return j=j??hi,!!j&&(X=="number"||X!="symbol"&&vi.test(K))&&K>-1&&K%1==0&&K<j}function mi(K,j){return K===j||K!==K&&j!==j}var pi=9007199254740991;function Ei(K){return typeof K=="number"&&K>-1&&K%1==0&&K<=pi}function yi(K){return K!=null&&Ei(K.length)&&!ci(K)}function Ti(K,j,X){if(!Xe(X))return!1;var Z=typeof j;return(Z=="number"?yi(X)&&gi(j,X.length):Z=="string"&&j in X)?mi(X[j],K):!1}var _i=Math.ceil,Si=Math.max;function xi(K,j,X,Z){for(var ee=-1,ie=Si(_i((j-K)/(X||1)),0),V=Array(ie);ie--;)V[Z?ie:++ee]=K,K+=X;return V}function Li(K){return function(j,X,Z){return Z&&typeof Z!="number"&&Ti(j,X,Z)&&(X=Z=void 0),j=Je(j),X===void 0?(X=j,j=0):X=Je(X),Z=Z===void 0?j<X?1:-1:Je(Z),xi(j,X,Z,K)}}var Di=Li();const Ai=Di;var wt={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Et=Ne.createContext&&Ne.createContext(wt),Ue=globalThis&&globalThis.__assign||function(){return Ue=Object.assign||function(K){for(var j,X=1,Z=arguments.length;X<Z;X++){j=arguments[X];for(var ee in j)Object.prototype.hasOwnProperty.call(j,ee)&&(K[ee]=j[ee])}return K},Ue.apply(this,arguments)},Ii=globalThis&&globalThis.__rest||function(K,j){var X={};for(var Z in K)Object.prototype.hasOwnProperty.call(K,Z)&&j.indexOf(Z)<0&&(X[Z]=K[Z]);if(K!=null&&typeof Object.getOwnPropertySymbols=="function")for(var ee=0,Z=Object.getOwnPropertySymbols(K);ee<Z.length;ee++)j.indexOf(Z[ee])<0&&Object.prototype.propertyIsEnumerable.call(K,Z[ee])&&(X[Z[ee]]=K[Z[ee]]);return X};function Nt(K){return K&&K.map(function(j,X){return Ne.createElement(j.tag,Ue({key:X},j.attr),Nt(j.child))})}function ke(K){return function(j){return Ne.createElement(Pi,Ue({attr:Ue({},K.attr)},j),Nt(K.child))}}function Pi(K){var j=function(X){var Z=K.attr,ee=K.size,ie=K.title,V=Ii(K,["attr","size","title"]),U=ee||X.size||"1em",S;return X.className&&(S=X.className),K.className&&(S=(S?S+" ":"")+K.className),Ne.createElement("svg",Ue({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},X.attr,Z,V,{className:S,style:Ue(Ue({color:K.color||X.color},X.style),K.style),height:U,width:U,xmlns:"http://www.w3.org/2000/svg"}),ie&&Ne.createElement("title",null,ie),K.children)};return Et!==void 0?Ne.createElement(Et.Consumer,null,function(X){return j(X)}):j(wt)}function Gi(K){return ke({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"}}]})(K)}function Hi(K){return ke({tag:"svg",attr:{t:"1569683618210",viewBox:"0 0 1024 1024",version:"1.1"},child:[{tag:"defs",attr:{},child:[]},{tag:"path",attr:{d:"M945 412H689c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h256c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM811 548H689c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h122c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM477.3 322.5H434c-6.2 0-11.2 5-11.2 11.2v248c0 3.6 1.7 6.9 4.6 9l148.9 108.6c5 3.6 12 2.6 15.6-2.4l25.7-35.1v-0.1c3.6-5 2.5-12-2.5-15.6l-126.7-91.6V333.7c0.1-6.2-5-11.2-11.1-11.2z"}},{tag:"path",attr:{d:"M804.8 673.9H747c-5.6 0-10.9 2.9-13.9 7.7-12.7 20.1-27.5 38.7-44.5 55.7-29.3 29.3-63.4 52.3-101.3 68.3-39.3 16.6-81 25-124 25-43.1 0-84.8-8.4-124-25-37.9-16-72-39-101.3-68.3s-52.3-63.4-68.3-101.3c-16.6-39.2-25-80.9-25-124 0-43.1 8.4-84.7 25-124 16-37.9 39-72 68.3-101.3 29.3-29.3 63.4-52.3 101.3-68.3 39.2-16.6 81-25 124-25 43.1 0 84.8 8.4 124 25 37.9 16 72 39 101.3 68.3 17 17 31.8 35.6 44.5 55.7 3 4.8 8.3 7.7 13.9 7.7h57.8c6.9 0 11.3-7.2 8.2-13.3-65.2-129.7-197.4-214-345-215.7-216.1-2.7-395.6 174.2-396 390.1C71.6 727.5 246.9 903 463.2 903c149.5 0 283.9-84.6 349.8-215.8 3.1-6.1-1.4-13.3-8.2-13.3z"}}]})(K)}function ji(K){return ke({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-8 3a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"}}]})(K)}function Ri(K){return ke({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"}}]})(K)}function Oi(K){return ke({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M5.354 5.119 7.538.792A.516.516 0 0 1 8 .5c.183 0 .366.097.465.292l2.184 4.327 4.898.696A.537.537 0 0 1 16 6.32a.548.548 0 0 1-.17.445l-3.523 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256a.52.52 0 0 1-.146.05c-.342.06-.668-.254-.6-.642l.83-4.73L.173 6.765a.55.55 0 0 1-.172-.403.58.58 0 0 1 .085-.302.513.513 0 0 1 .37-.245l4.898-.696zM8 12.027a.5.5 0 0 1 .232.056l3.686 1.894-.694-3.957a.565.565 0 0 1 .162-.505l2.907-2.77-4.052-.576a.525.525 0 0 1-.393-.288L8.001 2.223 8 2.226v9.8z"}}]})(K)}function Ci(K){return ke({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"}}]})(K)}function Mi(K){return ke({tag:"svg",attr:{version:"1",viewBox:"0 0 48 48",enableBackground:"new 0 0 48 48"},child:[{tag:"circle",attr:{fill:"#FFF59D",cx:"24",cy:"22",r:"20"}},{tag:"path",attr:{fill:"#FBC02D",d:"M37,22c0-7.7-6.6-13.8-14.5-12.9c-6,0.7-10.8,5.5-11.4,11.5c-0.5,4.6,1.4,8.7,4.6,11.3 c1.4,1.2,2.3,2.9,2.3,4.8V37h12v-0.1c0-1.8,0.8-3.6,2.2-4.8C35.1,29.7,37,26.1,37,22z"}},{tag:"path",attr:{fill:"#FFF59D",d:"M30.6,20.2l-3-2c-0.3-0.2-0.8-0.2-1.1,0L24,19.8l-2.4-1.6c-0.3-0.2-0.8-0.2-1.1,0l-3,2 c-0.2,0.2-0.4,0.4-0.4,0.7s0,0.6,0.2,0.8l3.8,4.7V37h2V26c0-0.2-0.1-0.4-0.2-0.6l-3.3-4.1l1.5-1l2.4,1.6c0.3,0.2,0.8,0.2,1.1,0 l2.4-1.6l1.5,1l-3.3,4.1C25.1,25.6,25,25.8,25,26v11h2V26.4l3.8-4.7c0.2-0.2,0.3-0.5,0.2-0.8S30.8,20.3,30.6,20.2z"}},{tag:"circle",attr:{fill:"#5C6BC0",cx:"24",cy:"44",r:"3"}},{tag:"path",attr:{fill:"#9FA8DA",d:"M26,45h-4c-2.2,0-4-1.8-4-4v-5h12v5C30,43.2,28.2,45,26,45z"}},{tag:"g",attr:{fill:"#5C6BC0"},child:[{tag:"path",attr:{d:"M30,41l-11.6,1.6c0.3,0.7,0.9,1.4,1.6,1.8l9.4-1.3C29.8,42.5,30,41.8,30,41z"}},{tag:"polygon",attr:{points:"18,38.7 18,40.7 30,39 30,37"}}]}]})(K)}function bi(K){return ke({tag:"svg",attr:{version:"1",viewBox:"0 0 48 48",enableBackground:"new 0 0 48 48"},child:[{tag:"path",attr:{fill:"#FBC02D",d:"M37,22c0-7.7-6.6-13.8-14.5-12.9c-6,0.7-10.8,5.5-11.4,11.5c-0.5,4.6,1.4,8.7,4.6,11.3 c1.4,1.2,2.3,2.9,2.3,4.8V37h12v-0.1c0-1.8,0.8-3.6,2.2-4.8C35.1,29.7,37,26.1,37,22z"}},{tag:"path",attr:{fill:"#FFF59D",d:"M30.6,20.2l-3-2c-0.3-0.2-0.8-0.2-1.1,0L24,19.8l-2.4-1.6c-0.3-0.2-0.8-0.2-1.1,0l-3,2 c-0.2,0.2-0.4,0.4-0.4,0.7s0,0.6,0.2,0.8l3.8,4.7V37h2V26c0-0.2-0.1-0.4-0.2-0.6l-3.3-4.1l1.5-1l2.4,1.6c0.3,0.2,0.8,0.2,1.1,0 l2.4-1.6l1.5,1l-3.3,4.1C25.1,25.6,25,25.8,25,26v11h2V26.4l3.8-4.7c0.2-0.2,0.3-0.5,0.2-0.8S30.8,20.3,30.6,20.2z"}},{tag:"circle",attr:{fill:"#5C6BC0",cx:"24",cy:"44",r:"3"}},{tag:"path",attr:{fill:"#9FA8DA",d:"M26,45h-4c-2.2,0-4-1.8-4-4v-5h12v5C30,43.2,28.2,45,26,45z"}},{tag:"g",attr:{fill:"#5C6BC0"},child:[{tag:"path",attr:{d:"M30,41l-11.6,1.6c0.3,0.7,0.9,1.4,1.6,1.8l9.4-1.3C29.8,42.5,30,41.8,30,41z"}},{tag:"polygon",attr:{points:"18,38.7 18,40.7 30,39 30,37"}}]},{tag:"rect",attr:{x:"22",y:"-2.9",transform:"matrix(.707 -.707 .707 .707 -9.941 24)",fill:"#37474F",width:"4",height:"53.7"}}]})(K)}function Vi(K){return ke({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M12 4c1.654 0 3 1.346 3 3h2c0-2.757-2.243-5-5-5S7 4.243 7 7v2H6c-1.103 0-2 .897-2 2v9c0 1.103.897 2 2 2h12c1.103 0 2-.897 2-2v-9c0-1.103-.897-2-2-2H9V7c0-1.654 1.346-3 3-3zm6.002 16H13v-2.278c.595-.347 1-.985 1-1.722 0-1.103-.897-2-2-2s-2 .897-2 2c0 .736.405 1.375 1 1.722V20H6v-9h12l.002 9z"}}]})(K)}const Yi=({value:K=0,length:j=5,...X})=>{const Z=(K+1)%1===0;return Ge(rt,{spacing:3,...X,children:[ne(Ot,{fontWeight:"600",children:K}),ne(rt,{spacing:1,color:"yellow.500",children:Ai(j).map(ee=>{const ie=ee+1,V=ie<=K,U=!Z&&ie===Math.ceil(K);return ne(oe.Fragment,{children:V?ne(Ri,{}):U?ne(Oi,{}):ne(Ci,{})},ee)})})]})},Xi=K=>{const j=K/60,X=j%60;return`${(j-X)/60}h ${Math.round(X)}m`};var at={},Fi={get exports(){return at},set exports(K){at=K}};(function(K,j){typeof window<"u"&&function(Z,ee){K.exports=ee()}(tr,()=>(()=>{var X={"./src/config.ts":(V,U,S)=>{S.r(U),S.d(U,{enableStreamingMode:()=>f,hlsDefaultConfig:()=>i,mergeConfig:()=>t});var F=S("./src/controller/abr-controller.ts"),D=S("./src/controller/audio-stream-controller.ts"),b=S("./src/controller/audio-track-controller.ts"),P=S("./src/controller/subtitle-stream-controller.ts"),k=S("./src/controller/subtitle-track-controller.ts"),A=S("./src/controller/buffer-controller.ts"),L=S("./src/controller/timeline-controller.ts"),x=S("./src/controller/cap-level-controller.ts"),_=S("./src/controller/fps-controller.ts"),T=S("./src/controller/eme-controller.ts"),c=S("./src/controller/cmcd-controller.ts"),y=S("./src/utils/xhr-loader.ts"),m=S("./src/utils/fetch-loader.ts"),o=S("./src/utils/cues.ts"),l=S("./src/utils/mediakeys-helper.ts"),s=S("./src/utils/logger.ts");function n(){return n=Object.assign?Object.assign.bind():function(e){for(var d=1;d<arguments.length;d++){var E=arguments[d];for(var v in E)Object.prototype.hasOwnProperty.call(E,v)&&(e[v]=E[v])}return e},n.apply(this,arguments)}function g(e,d){var E=Object.keys(e);if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(e);d&&(v=v.filter(function(I){return Object.getOwnPropertyDescriptor(e,I).enumerable})),E.push.apply(E,v)}return E}function h(e){for(var d=1;d<arguments.length;d++){var E=arguments[d]!=null?arguments[d]:{};d%2?g(Object(E),!0).forEach(function(v){r(e,v,E[v])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(E)):g(Object(E)).forEach(function(v){Object.defineProperty(e,v,Object.getOwnPropertyDescriptor(E,v))})}return e}function r(e,d,E){return d=u(d),d in e?Object.defineProperty(e,d,{value:E,enumerable:!0,configurable:!0,writable:!0}):e[d]=E,e}function u(e){var d=p(e,"string");return typeof d=="symbol"?d:String(d)}function p(e,d){if(typeof e!="object"||e===null)return e;var E=e[Symbol.toPrimitive];if(E!==void 0){var v=E.call(e,d||"default");if(typeof v!="object")return v;throw new TypeError("@@toPrimitive must return a primitive value.")}return(d==="string"?String:Number)(e)}var i=h(h({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:y.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:F.default,bufferController:A.default,capLevelController:x.default,fpsController:_.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:l.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},a()),{},{subtitleStreamController:P.SubtitleStreamController,subtitleTrackController:k.default,timelineController:L.TimelineController,audioStreamController:D.default,audioTrackController:b.default,emeController:T.default,cmcdController:c.default});function a(){return{cueHandler:o.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function t(e,d){if((d.liveSyncDurationCount||d.liveMaxLatencyDurationCount)&&(d.liveSyncDuration||d.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(d.liveMaxLatencyDurationCount!==void 0&&(d.liveSyncDurationCount===void 0||d.liveMaxLatencyDurationCount<=d.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(d.liveMaxLatencyDuration!==void 0&&(d.liveSyncDuration===void 0||d.liveMaxLatencyDuration<=d.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return n({},e,d)}function f(e){var d=e.loader;if(d!==m.default&&d!==y.default)s.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{var E=(0,m.fetchSupported)();E&&(e.loader=m.default,e.progressive=!0,e.enableSoftwareAES=!0,s.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>y});var F=S("./src/polyfills/number.ts"),D=S("./src/utils/ewma-bandwidth-estimator.ts"),b=S("./src/events.ts"),P=S("./src/errors.ts"),k=S("./src/types/loader.ts"),A=S("./src/utils/logger.ts");function L(m,o){for(var l=0;l<o.length;l++){var s=o[l];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(m,_(s.key),s)}}function x(m,o,l){return o&&L(m.prototype,o),l&&L(m,l),Object.defineProperty(m,"prototype",{writable:!1}),m}function _(m){var o=T(m,"string");return typeof o=="symbol"?o:String(o)}function T(m,o){if(typeof m!="object"||m===null)return m;var l=m[Symbol.toPrimitive];if(l!==void 0){var s=l.call(m,o||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(m)}var c=function(){function m(l){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=l;var s=l.config;this.bwEstimator=new D.default(s.abrEwmaSlowVoD,s.abrEwmaFastVoD,s.abrEwmaDefaultEstimate),this.registerListeners()}var o=m.prototype;return o.registerListeners=function(){var s=this.hls;s.on(b.Events.FRAG_LOADING,this.onFragLoading,this),s.on(b.Events.FRAG_LOADED,this.onFragLoaded,this),s.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this),s.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(b.Events.ERROR,this.onError,this)},o.unregisterListeners=function(){var s=this.hls;s.off(b.Events.FRAG_LOADING,this.onFragLoading,this),s.off(b.Events.FRAG_LOADED,this.onFragLoaded,this),s.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this),s.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(b.Events.ERROR,this.onError,this)},o.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},o.onFragLoading=function(s,n){var g=n.frag;if(g.type===k.PlaylistLevelType.MAIN&&!this.timer){var h;this.fragCurrent=g,this.partCurrent=(h=n.part)!=null?h:null,this.timer=self.setInterval(this.onCheck,100)}},o.onLevelLoaded=function(s,n){var g=this.hls.config;n.details.live?this.bwEstimator.update(g.abrEwmaSlowLive,g.abrEwmaFastLive):this.bwEstimator.update(g.abrEwmaSlowVoD,g.abrEwmaFastVoD)},o._abandonRulesCheck=function(){var s=this.fragCurrent,n=this.partCurrent,g=this.hls,h=g.autoLevelEnabled,r=g.media;if(!(!s||!r)){var u=n?n.stats:s.stats,p=n?n.duration:s.duration;if(u.aborted||u.loaded&&u.loaded===u.total||s.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!h||r.paused||!r.playbackRate||!r.readyState)){var i=g.mainForwardBufferInfo;if(i!==null){var a=performance.now()-u.loading.start,t=Math.abs(r.playbackRate);if(!(a<=500*p/t)){var f=u.loaded&&u.loading.first,e=this.bwEstimator.getEstimate(),d=g.levels,E=g.minAutoLevel,v=d[s.level],I=u.total||Math.max(u.loaded,Math.round(p*v.maxBitrate/8)),R=f?u.loaded*1e3/a:0,O=R?(I-u.loaded)/R:I*8/e,C=i.len/t;if(!(O<=C)){var M=Number.POSITIVE_INFINITY,B;for(B=s.level-1;B>E;B--){var w=d[B].maxBitrate;if(M=R?p*w/(8*.8*R):p*w/e,M<C)break}M>=O||(A.logger.warn("Fragment "+s.sn+(n?" part "+n.index:"")+" of level "+s.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+B+`
      Current BW estimate: `+((0,F.isFiniteNumber)(e)?(e/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+O.toFixed(3)+` s
      Estimated load time for the next fragment: `+M.toFixed(3)+` s
      Time to underbuffer: `+C.toFixed(3)+" s"),g.nextLoadLevel=B,f&&this.bwEstimator.sample(a,u.loaded),this.clearTimer(),(s.loader||s.keyLoader)&&(this.fragCurrent=this.partCurrent=null,s.abortRequests()),g.trigger(b.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:n,stats:u}))}}}}}},o.onFragLoaded=function(s,n){var g=n.frag,h=n.part;if(g.type===k.PlaylistLevelType.MAIN&&(0,F.isFiniteNumber)(g.sn)){var r=h?h.stats:g.stats,u=h?h.duration:g.duration;if(this.clearTimer(),this.lastLoadedFragLevel=g.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var p=this.hls.levels[g.level],i=(p.loaded?p.loaded.bytes:0)+r.loaded,a=(p.loaded?p.loaded.duration:0)+u;p.loaded={bytes:i,duration:a},p.realBitrate=Math.round(8*i/a)}if(g.bitrateTest){var t={stats:r,frag:g,part:h,id:g.type};this.onFragBuffered(b.Events.FRAG_BUFFERED,t)}}},o.onFragBuffered=function(s,n){var g=n.frag,h=n.part,r=h?h.stats:g.stats;if(!r.aborted&&!(g.type!==k.PlaylistLevelType.MAIN||g.sn==="initSegment")){var u=r.parsing.end-r.loading.start;this.bwEstimator.sample(u,r.loaded),r.bwEstimate=this.bwEstimator.getEstimate(),g.bitrateTest?this.bitrateTestDelay=u/1e3:this.bitrateTestDelay=0}},o.onError=function(s,n){var g;if(((g=n.frag)===null||g===void 0?void 0:g.type)===k.PlaylistLevelType.MAIN){if(n.type===P.ErrorTypes.KEY_SYSTEM_ERROR){this.clearTimer();return}switch(n.details){case P.ErrorDetails.FRAG_LOAD_ERROR:case P.ErrorDetails.FRAG_LOAD_TIMEOUT:case P.ErrorDetails.KEY_LOAD_ERROR:case P.ErrorDetails.KEY_LOAD_TIMEOUT:this.clearTimer();break}}},o.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},o.getNextABRAutoLevel=function(){var s=this.fragCurrent,n=this.partCurrent,g=this.hls,h=g.maxAutoLevel,r=g.config,u=g.minAutoLevel,p=g.media,i=n?n.duration:s?s.duration:0,a=p&&p.playbackRate!==0?Math.abs(p.playbackRate):1,t=this.bwEstimator?this.bwEstimator.getEstimate():r.abrEwmaDefaultEstimate,f=g.mainForwardBufferInfo,e=(f?f.len:0)/a,d=this.findBestLevel(t,u,h,e,r.abrBandWidthFactor,r.abrBandWidthUpFactor);if(d>=0)return d;A.logger.trace((e?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var E=i?Math.min(i,r.maxStarvationDelay):r.maxStarvationDelay,v=r.abrBandWidthFactor,I=r.abrBandWidthUpFactor;if(!e){var R=this.bitrateTestDelay;if(R){var O=i?Math.min(i,r.maxLoadingDelay):r.maxLoadingDelay;E=O-R,A.logger.trace("bitrate test took "+Math.round(1e3*R)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*E)+" ms"),v=I=1}}return d=this.findBestLevel(t,u,h,e+E,v,I),Math.max(d,0)},o.findBestLevel=function(s,n,g,h,r,u){for(var p,i=this.fragCurrent,a=this.partCurrent,t=this.lastLoadedFragLevel,f=this.hls.levels,e=f[t],d=!!(e!=null&&(p=e.details)!==null&&p!==void 0&&p.live),E=e==null?void 0:e.codecSet,v=a?a.duration:i?i.duration:0,I=g;I>=n;I--){var R=f[I];if(!(!R||E&&R.codecSet!==E)){var O=R.details,C=(a?O==null?void 0:O.partTarget:O==null?void 0:O.averagetargetduration)||v,M=void 0;I<=t?M=r*s:M=u*s;var B=f[I].maxBitrate,w=B*C/M;if(A.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+I+"/"+Math.round(M)+"/"+B+"/"+C+"/"+h+"/"+w),M>B&&(w===0||!(0,F.isFiniteNumber)(w)||d&&!this.bitrateTestDelay||w<h))return I}}return-1},x(m,[{key:"nextAutoLevel",get:function(){var s=this._nextAutoLevel,n=this.bwEstimator;if(s!==-1&&!n.canEstimate())return s;var g=this.getNextABRAutoLevel();return s!==-1&&this.hls.levels[g].loadError?s:(s!==-1&&(g=Math.min(s,g)),g)},set:function(s){this._nextAutoLevel=s}}]),m}();const y=c},"./src/controller/audio-stream-controller.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>r});var F=S("./src/polyfills/number.ts"),D=S("./src/controller/base-stream-controller.ts"),b=S("./src/events.ts"),P=S("./src/utils/buffer-helper.ts"),k=S("./src/controller/fragment-tracker.ts"),A=S("./src/types/level.ts"),L=S("./src/types/loader.ts"),x=S("./src/loader/fragment.ts"),_=S("./src/demux/chunk-cache.ts"),T=S("./src/demux/transmuxer-interface.ts"),c=S("./src/types/transmuxer.ts"),y=S("./src/controller/fragment-finders.ts"),m=S("./src/utils/discontinuities.ts"),o=S("./src/errors.ts");function l(){return l=Object.assign?Object.assign.bind():function(u){for(var p=1;p<arguments.length;p++){var i=arguments[p];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(u[a]=i[a])}return u},l.apply(this,arguments)}function s(u,p){u.prototype=Object.create(p.prototype),u.prototype.constructor=u,n(u,p)}function n(u,p){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,t){return a.__proto__=t,a},n(u,p)}var g=100,h=function(u){s(p,u);function p(a,t,f){var e;return e=u.call(this,a,t,f,"[audio-stream-controller]")||this,e.videoBuffer=null,e.videoTrackCC=-1,e.waitingVideoCC=-1,e.audioSwitch=!1,e.trackId=-1,e.waitingData=null,e.mainDetails=null,e.bufferFlushed=!1,e.cachedTrackLoadedData=null,e._registerListeners(),e}var i=p.prototype;return i.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},i._registerListeners=function(){var t=this.hls;t.on(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(b.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(b.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(b.Events.ERROR,this.onError,this),t.on(b.Events.BUFFER_RESET,this.onBufferReset,this),t.on(b.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(b.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i._unregisterListeners=function(){var t=this.hls;t.off(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(b.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(b.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(b.Events.ERROR,this.onError,this),t.off(b.Events.BUFFER_RESET,this.onBufferReset,this),t.off(b.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(b.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i.onInitPtsFound=function(t,f){var e=f.frag,d=f.id,E=f.initPTS;if(d==="main"){var v=e.cc;this.initPTS[e.cc]=E,this.log("InitPTS for cc: "+v+" found from main: "+E),this.videoTrackCC=v,this.state===D.State.WAITING_INIT_PTS&&this.tick()}},i.startLoad=function(t){if(!this.levels){this.startPosition=t,this.state=D.State.STOPPED;return}var f=this.lastCurrentTime;this.stopLoad(),this.setInterval(g),this.fragLoadError=0,f>0&&t===-1?(this.log("Override startPosition with lastCurrentTime @"+f.toFixed(3)),t=f,this.state=D.State.IDLE):(this.loadedmetadata=!1,this.state=D.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},i.doTick=function(){switch(this.state){case D.State.IDLE:this.doTickIdle();break;case D.State.WAITING_TRACK:{var t,f=this.levels,e=this.trackId,d=f==null||(t=f[e])===null||t===void 0?void 0:t.details;if(d){if(this.waitForCdnTuneIn(d))break;this.state=D.State.WAITING_INIT_PTS}break}case D.State.FRAG_LOADING_WAITING_RETRY:{var E,v=performance.now(),I=this.retryDate;(!I||v>=I||(E=this.media)!==null&&E!==void 0&&E.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=D.State.IDLE);break}case D.State.WAITING_INIT_PTS:{var R=this.waitingData;if(R){var O=R.frag,C=R.part,M=R.cache,B=R.complete;if(this.initPTS[O.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=D.State.FRAG_LOADING;var w=M.flush(),N={frag:O,part:C,payload:w,networkDetails:null};this._handleFragmentLoadProgress(N),B&&u.prototype._handleFragmentLoadComplete.call(this,N)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+O.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var W=this.getLoadPosition(),G=P.BufferHelper.bufferInfo(this.mediaBuffer,W,this.config.maxBufferHole),H=(0,y.fragmentWithinToleranceTest)(G.end,this.config.maxFragLookUpTolerance,O);H<0&&(this.log("Waiting fragment cc ("+O.cc+") @ "+O.start+" cancelled because another fragment at "+G.end+" is needed"),this.clearWaitingFragment())}}else this.state=D.State.IDLE}}this.onTickEnd()},i.clearWaitingFragment=function(){var t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=D.State.IDLE)},i.resetLoadingState=function(){this.clearWaitingFragment(),u.prototype.resetLoadingState.call(this)},i.onTickEnd=function(){var t=this.media;!t||!t.readyState||(this.lastCurrentTime=t.currentTime)},i.doTickIdle=function(){var t=this.hls,f=this.levels,e=this.media,d=this.trackId,E=t.config;if(!(!f||!f[d])&&!(!e&&(this.startFragRequested||!E.startFragPrefetch))){var v=f[d],I=v.details;if(!I||I.live&&this.levelLastLoaded!==d||this.waitForCdnTuneIn(I)){this.state=D.State.WAITING_TRACK;return}var R=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&R&&(this.bufferFlushed=!1,this.afterBufferFlushed(R,x.ElementaryStreamTypes.AUDIO,L.PlaylistLevelType.AUDIO));var O=this.getFwdBufferInfo(R,L.PlaylistLevelType.AUDIO);if(O!==null){var C=this.audioSwitch;if(!C&&this._streamEnded(O,I)){t.trigger(b.Events.BUFFER_EOS,{type:"audio"}),this.state=D.State.ENDED;return}var M=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,L.PlaylistLevelType.MAIN),B=O.len,w=this.getMaxBufferLength(M==null?void 0:M.len);if(!(B>=w&&!C)){var N=I.fragments,W=N[0].start,G=O.end;if(C&&e){var H=this.getLoadPosition();G=H,I.PTSKnown&&H<W&&(O.end>W||O.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),e.currentTime=W+.05)}if(!(M&&G>M.end+I.targetduration)&&!((!M||!M.len)&&O.len)){var $=this.getNextFragment(G,I);if(!$){this.bufferFlushed=!0;return}this.loadFragment($,I,G)}}}}},i.getMaxBufferLength=function(t){var f=u.prototype.getMaxBufferLength.call(this);return t?Math.max(f,t):f},i.onMediaDetaching=function(){this.videoBuffer=null,u.prototype.onMediaDetaching.call(this)},i.onAudioTracksUpdated=function(t,f){var e=f.audioTracks;this.resetTransmuxer(),this.levels=e.map(function(d){return new A.Level(d)})},i.onAudioTrackSwitching=function(t,f){var e=!!f.url;this.trackId=f.id;var d=this.fragCurrent;d&&d.abortRequests(),this.fragCurrent=null,this.clearWaitingFragment(),e?this.setInterval(g):this.resetTransmuxer(),e?(this.audioSwitch=!0,this.state=D.State.IDLE):this.state=D.State.STOPPED,this.tick()},i.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},i.onLevelLoaded=function(t,f){this.mainDetails=f.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(b.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},i.onAudioTrackLoaded=function(t,f){var e;if(this.mainDetails==null){this.cachedTrackLoadedData=f;return}var d=this.levels,E=f.details,v=f.id;if(!d){this.warn("Audio tracks were reset while loading level "+v);return}this.log("Track "+v+" loaded ["+E.startSN+","+E.endSN+"],duration:"+E.totalduration);var I=d[v],R=0;if(E.live||(e=I.details)!==null&&e!==void 0&&e.live){var O=this.mainDetails;if(E.fragments[0]||(E.deltaUpdateFailed=!0),E.deltaUpdateFailed||!O)return;!I.details&&E.hasProgramDateTime&&O.hasProgramDateTime?((0,m.alignMediaPlaylistByPDT)(E,O),R=E.fragments[0].start):R=this.alignPlaylists(E,I.details)}I.details=E,this.levelLastLoaded=v,!this.startFragRequested&&(this.mainDetails||!E.live)&&this.setStartPosition(I.details,R),this.state===D.State.WAITING_TRACK&&!this.waitForCdnTuneIn(E)&&(this.state=D.State.IDLE),this.tick()},i._handleFragmentLoadProgress=function(t){var f,e=t.frag,d=t.part,E=t.payload,v=this.config,I=this.trackId,R=this.levels;if(!R){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+e.sn+" of level "+e.level+" will not be buffered");return}var O=R[I];console.assert(O,"Audio track is defined on fragment load progress");var C=O.details;console.assert(C,"Audio track details are defined on fragment load progress");var M=v.defaultAudioCodec||O.audioCodec||"mp4a.40.2",B=this.transmuxer;B||(B=this.transmuxer=new T.default(this.hls,L.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var w=this.initPTS[e.cc],N=(f=e.initSegment)===null||f===void 0?void 0:f.data;if(w!==void 0){var W=!1,G=d?d.index:-1,H=G!==-1,$=new c.ChunkMetadata(e.level,e.sn,e.stats.chunkCount,E.byteLength,G,H);B.push(E,N,M,"",e,d,C.totalduration,W,$,w)}else{this.log("Unknown video PTS for cc "+e.cc+", waiting for video PTS before demuxing audio frag "+e.sn+" of ["+C.startSN+" ,"+C.endSN+"],track "+I);var Y=this.waitingData=this.waitingData||{frag:e,part:d,cache:new _.default,complete:!1},z=Y.cache;z.push(new Uint8Array(E)),this.waitingVideoCC=this.videoTrackCC,this.state=D.State.WAITING_INIT_PTS}},i._handleFragmentLoadComplete=function(t){if(this.waitingData){this.waitingData.complete=!0;return}u.prototype._handleFragmentLoadComplete.call(this,t)},i.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},i.onBufferCreated=function(t,f){var e=f.tracks.audio;e&&(this.mediaBuffer=e.buffer||null),f.tracks.video&&(this.videoBuffer=f.tracks.video.buffer||null)},i.onFragBuffered=function(t,f){var e=f.frag,d=f.part;if(e.type!==L.PlaylistLevelType.AUDIO){if(!this.loadedmetadata&&e.type===L.PlaylistLevelType.MAIN){var E;(E=this.videoBuffer||this.media)!==null&&E!==void 0&&E.buffered.length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(e)){this.warn("Fragment "+e.sn+(d?" p: "+d.index:"")+" of level "+e.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}e.sn!=="initSegment"&&(this.fragPrevious=e,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(b.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(e,d)},i.onError=function(t,f){if(f.type===o.ErrorTypes.KEY_SYSTEM_ERROR){this.onFragmentOrKeyLoadError(L.PlaylistLevelType.AUDIO,f);return}switch(f.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:case o.ErrorDetails.FRAG_PARSING_ERROR:case o.ErrorDetails.KEY_LOAD_ERROR:case o.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(L.PlaylistLevelType.AUDIO,f);break;case o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case o.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==D.State.ERROR&&this.state!==D.State.STOPPED&&(this.state=f.fatal?D.State.ERROR:D.State.IDLE,this.warn(f.details+" while loading frag, switching to "+this.state+" state"));break;case o.ErrorDetails.BUFFER_FULL_ERROR:if(f.parent==="audio"&&(this.state===D.State.PARSING||this.state===D.State.PARSED)){var e=!0,d=this.getFwdBufferInfo(this.mediaBuffer,L.PlaylistLevelType.AUDIO);d&&d.len>.5&&(e=!this.reduceMaxBufferLength(d.len)),e&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,u.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},i.onBufferFlushed=function(t,f){var e=f.type;e===x.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0,this.state===D.State.ENDED&&(this.state=D.State.IDLE))},i._handleTransmuxComplete=function(t){var f,e="audio",d=this.hls,E=t.remuxResult,v=t.chunkMeta,I=this.getCurrentContext(v);if(!I){this.warn("The loading context changed while buffering fragment "+v.sn+" of level "+v.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(v.level);return}var R=I.frag,O=I.part,C=I.level.details,M=E.audio,B=E.text,w=E.id3,N=E.initSegment;if(!(this.fragContextChanged(R)||!C)){if(this.state=D.State.PARSING,this.audioSwitch&&M&&this.completeAudioSwitch(),N!=null&&N.tracks&&(this._bufferInitSegment(N.tracks,R,v),d.trigger(b.Events.FRAG_PARSING_INIT_SEGMENT,{frag:R,id:e,tracks:N.tracks})),M){var W=M.startPTS,G=M.endPTS,H=M.startDTS,$=M.endDTS;O&&(O.elementaryStreams[x.ElementaryStreamTypes.AUDIO]={startPTS:W,endPTS:G,startDTS:H,endDTS:$}),R.setElementaryStreamInfo(x.ElementaryStreamTypes.AUDIO,W,G,H,$),this.bufferFragmentData(M,R,O,v)}if(w!=null&&(f=w.samples)!==null&&f!==void 0&&f.length){var Y=l({id:e,frag:R,details:C},w);d.trigger(b.Events.FRAG_PARSING_METADATA,Y)}if(B){var z=l({id:e,frag:R,details:C},B);d.trigger(b.Events.FRAG_PARSING_USERDATA,z)}}},i._bufferInitSegment=function(t,f,e){if(this.state===D.State.PARSING){t.video&&delete t.video;var d=t.audio;if(d){d.levelCodec=d.codec,d.id="audio",this.log("Init audio buffer, container:"+d.container+", codecs[parsed]=["+d.codec+"]"),this.hls.trigger(b.Events.BUFFER_CODECS,t);var E=d.initSegment;if(E!=null&&E.byteLength){var v={type:"audio",frag:f,part:null,chunkMeta:e,parent:f.type,data:E};this.hls.trigger(b.Events.BUFFER_APPENDING,v)}this.tick()}}},i.loadFragment=function(t,f,e){var d=this.fragmentTracker.getState(t);this.fragCurrent=t,(this.audioSwitch||d===k.FragmentState.NOT_LOADED||d===k.FragmentState.PARTIAL)&&(t.sn==="initSegment"?this._loadInitSegment(t,f):f.live&&!(0,F.isFiniteNumber)(this.initPTS[t.cc])?(this.log("Waiting for video PTS in continuity counter "+t.cc+" of live stream before loading audio fragment "+t.sn+" of level "+this.trackId),this.state=D.State.WAITING_INIT_PTS):(this.startFragRequested=!0,u.prototype.loadFragment.call(this,t,f,e)))},i.completeAudioSwitch=function(){var t=this.hls,f=this.media,e=this.trackId;f&&(this.log("Switching audio track : flushing all audio"),u.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,t.trigger(b.Events.AUDIO_TRACK_SWITCHED,{id:e})},p}(D.default);const r=h},"./src/controller/audio-track-controller.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>y});var F=S("./src/events.ts"),D=S("./src/errors.ts"),b=S("./src/controller/base-playlist-controller.ts"),P=S("./src/types/loader.ts");function k(m,o){for(var l=0;l<o.length;l++){var s=o[l];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(m,L(s.key),s)}}function A(m,o,l){return o&&k(m.prototype,o),l&&k(m,l),Object.defineProperty(m,"prototype",{writable:!1}),m}function L(m){var o=x(m,"string");return typeof o=="symbol"?o:String(o)}function x(m,o){if(typeof m!="object"||m===null)return m;var l=m[Symbol.toPrimitive];if(l!==void 0){var s=l.call(m,o||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(m)}function _(m,o){m.prototype=Object.create(o.prototype),m.prototype.constructor=m,T(m,o)}function T(m,o){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,n){return s.__proto__=n,s},T(m,o)}var c=function(m){_(o,m);function o(s){var n;return n=m.call(this,s,"[audio-track-controller]")||this,n.tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.trackName="",n.selectDefaultTrack=!0,n.registerListeners(),n}var l=o.prototype;return l.registerListeners=function(){var n=this.hls;n.on(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.on(F.Events.LEVEL_LOADING,this.onLevelLoading,this),n.on(F.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.on(F.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.on(F.Events.ERROR,this.onError,this)},l.unregisterListeners=function(){var n=this.hls;n.off(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.off(F.Events.LEVEL_LOADING,this.onLevelLoading,this),n.off(F.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.off(F.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.off(F.Events.ERROR,this.onError,this)},l.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,m.prototype.destroy.call(this)},l.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},l.onManifestParsed=function(n,g){this.tracks=g.audioTracks||[]},l.onAudioTrackLoaded=function(n,g){var h=g.id,r=g.details,u=this.tracksInGroup[h];if(!u){this.warn("Invalid audio track id "+h);return}var p=u.details;u.details=g.details,this.log("audioTrack "+h+" loaded ["+r.startSN+"-"+r.endSN+"]"),h===this.trackId&&(this.retryCount=0,this.playlistLoaded(h,g,p))},l.onLevelLoading=function(n,g){this.switchLevel(g.level)},l.onLevelSwitching=function(n,g){this.switchLevel(g.level)},l.switchLevel=function(n){var g=this.hls.levels[n];if(g!=null&&g.audioGroupIds){var h=g.audioGroupIds[g.urlId];if(this.groupId!==h){this.groupId=h;var r=this.tracks.filter(function(p){return!h||p.groupId===h});this.selectDefaultTrack&&!r.some(function(p){return p.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=r;var u={audioTracks:r};this.log("Updating audio tracks, "+r.length+' track(s) found in "'+h+'" group-id'),this.hls.trigger(F.Events.AUDIO_TRACKS_UPDATED,u),this.selectInitialTrack()}}},l.onError=function(n,g){m.prototype.onError.call(this,n,g),!(g.fatal||!g.context)&&g.context.type===P.PlaylistContextType.AUDIO_TRACK&&g.context.id===this.trackId&&g.context.groupId===this.groupId&&this.retryLoadingOrFail(g)},l.setAudioTrack=function(n){var g=this.tracksInGroup;if(n<0||n>=g.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var h=g[this.trackId];this.log("Now switching to audio-track index "+n);var r=g[n],u=r.id,p=r.groupId,i=p===void 0?"":p,a=r.name,t=r.type,f=r.url;if(this.trackId=n,this.trackName=a,this.selectDefaultTrack=!1,this.hls.trigger(F.Events.AUDIO_TRACK_SWITCHING,{id:u,groupId:i,name:a,type:t,url:f}),!(r.details&&!r.details.live)){var e=this.switchParams(r.url,h==null?void 0:h.details);this.loadPlaylist(e)}},l.selectInitialTrack=function(){var n=this.tracksInGroup;console.assert(n.length,"Initial audio track should be selected when tracks are known");var g=this.trackName,h=this.findTrackId(g)||this.findTrackId();h!==-1?this.setAudioTrack(h):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(F.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},l.findTrackId=function(n){for(var g=this.tracksInGroup,h=0;h<g.length;h++){var r=g[h];if((!this.selectDefaultTrack||r.default)&&(!n||n===r.name))return r.id}return-1},l.loadPlaylist=function(n){m.prototype.loadPlaylist.call(this);var g=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(g)){var h=g.id,r=g.groupId,u=g.url;if(n)try{u=n.addDirectives(u)}catch(p){this.warn("Could not construct new URL with HLS Delivery Directives: "+p)}this.log("loading audio-track playlist for id: "+h),this.clearTimer(),this.hls.trigger(F.Events.AUDIO_TRACK_LOADING,{url:u,id:h,groupId:r,deliveryDirectives:n||null})}},A(o,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(n){this.selectDefaultTrack=!1,this.setAudioTrack(n)}}]),o}(b.default);const y=c},"./src/controller/base-playlist-controller.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>k});var F=S("./src/types/level.ts"),D=S("./src/controller/level-helper.ts"),b=S("./src/utils/logger.ts"),P=S("./src/errors.ts"),k=function(){function A(x,_){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=b.logger.log.bind(b.logger,_+":"),this.warn=b.logger.warn.bind(b.logger,_+":"),this.hls=x}var L=A.prototype;return L.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},L.onError=function(_,T){T.fatal&&(T.type===P.ErrorTypes.NETWORK_ERROR||T.type===P.ErrorTypes.KEY_SYSTEM_ERROR)&&this.stopLoad()},L.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},L.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.requestScheduled=-1,this.loadPlaylist()},L.stopLoad=function(){this.canLoad=!1,this.clearTimer()},L.switchParams=function(_,T){var c=T==null?void 0:T.renditionReports;if(c)for(var y=0;y<c.length;y++){var m=c[y],o=void 0;try{o=new self.URL(m.URI,T.url).href}catch(g){b.logger.warn("Could not construct new URL for Rendition Report: "+g),o=m.URI||""}if(o===_.slice(-o.length)){var l=parseInt(m["LAST-MSN"])||(T==null?void 0:T.lastPartSn),s=parseInt(m["LAST-PART"])||(T==null?void 0:T.lastPartIndex);if(this.hls.config.lowLatencyMode){var n=Math.min(T.age-T.partTarget,T.targetduration);s>=0&&n>T.partTarget&&(s+=1)}return new F.HlsUrlParameters(l,s>=0?s:void 0,F.HlsSkip.No)}}},L.loadPlaylist=function(_){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())},L.shouldLoadTrack=function(_){return this.canLoad&&_&&!!_.url&&(!_.details||_.details.live)},L.playlistLoaded=function(_,T,c){var y=this,m=T.details,o=T.stats,l=self.performance.now(),s=o.loading.first?Math.max(0,l-o.loading.first):0;if(m.advancedDateTime=Date.now()-s,m.live||c!=null&&c.live){if(m.reloaded(c),c&&this.log("live playlist "+_+" "+(m.advanced?"REFRESHED "+m.lastPartSn+"-"+m.lastPartIndex:"MISSED")),c&&m.fragments.length>0&&(0,D.mergeDetails)(c,m),!this.canLoad||!m.live)return;var n,g=void 0,h=void 0;if(m.canBlockReload&&m.endSN&&m.advanced){var r=this.hls.config.lowLatencyMode,u=m.lastPartSn,p=m.endSN,i=m.lastPartIndex,a=i!==-1,t=u===p,f=r?0:i;a?(g=t?p+1:u,h=t?f:i+1):g=p+1;var e=m.age,d=e+m.ageHeader,E=Math.min(d-m.partTarget,m.targetduration*1.5);if(E>0){if(c&&E>c.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+c.tuneInGoal+" to: "+E+" with playlist age: "+m.age),E=0;else{var v=Math.floor(E/m.targetduration);if(g+=v,h!==void 0){var I=Math.round(E%m.targetduration/m.partTarget);h+=I}this.log("CDN Tune-in age: "+m.ageHeader+"s last advanced "+e.toFixed(2)+"s goal: "+E+" skip sn "+v+" to part "+h)}m.tuneInGoal=E}if(n=this.getDeliveryDirectives(m,T.deliveryDirectives,g,h),r||!t){this.loadPlaylist(n);return}}else n=this.getDeliveryDirectives(m,T.deliveryDirectives,g,h);var R=this.hls.mainForwardBufferInfo,O=R?R.end-R.len:0,C=(m.edge-O)*1e3,M=(0,D.computeReloadInterval)(m,C);m.updated?l>this.requestScheduled+M&&(this.requestScheduled=o.loading.start):this.requestScheduled=-1,g!==void 0&&m.canBlockReload?this.requestScheduled=o.loading.first+M-(m.partTarget*1e3||1e3):this.requestScheduled=(this.requestScheduled===-1?l:this.requestScheduled)+M;var B=this.requestScheduled-l;B=Math.max(0,B),this.log("reload live playlist "+_+" in "+Math.round(B)+" ms"),this.timer=self.setTimeout(function(){return y.loadPlaylist(n)},B)}else this.clearTimer()},L.getDeliveryDirectives=function(_,T,c,y){var m=(0,F.getSkipValue)(_,c);return T!=null&&T.skip&&_.deltaUpdateFailed&&(c=T.msn,y=T.part,m=F.HlsSkip.No),new F.HlsUrlParameters(c,y,m)},L.retryLoadingOrFail=function(_){var T=this,c=this.hls.config,y=this.retryCount<c.levelLoadingMaxRetry;if(y){var m;if(this.requestScheduled=-1,this.retryCount++,_.details.indexOf("LoadTimeOut")>-1&&(m=_.context)!==null&&m!==void 0&&m.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+_.details+'"'),this.loadPlaylist();else{var o=Math.min(Math.pow(2,this.retryCount)*c.levelLoadingRetryDelay,c.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return T.loadPlaylist()},o),this.warn("retry playlist loading #"+this.retryCount+" in "+o+' ms after "'+_.details+'"')}}else this.warn('cannot recover from error "'+_.details+'"'),this.clearTimer(),_.fatal=!0;return y},A}()},"./src/controller/base-stream-controller.ts":(V,U,S)=>{S.r(U),S.d(U,{State:()=>a,default:()=>t});var F=S("./src/polyfills/number.ts"),D=S("./src/task-loop.ts"),b=S("./src/controller/fragment-tracker.ts"),P=S("./src/utils/buffer-helper.ts"),k=S("./src/utils/logger.ts"),A=S("./src/events.ts"),L=S("./src/errors.ts"),x=S("./src/types/transmuxer.ts"),_=S("./src/utils/mp4-tools.ts"),T=S("./src/utils/discontinuities.ts"),c=S("./src/controller/fragment-finders.ts"),y=S("./src/controller/level-helper.ts"),m=S("./src/loader/fragment-loader.ts"),o=S("./src/crypt/decrypter.ts"),l=S("./src/utils/time-ranges.ts"),s=S("./src/types/loader.ts");function n(f,e){for(var d=0;d<e.length;d++){var E=e[d];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(f,h(E.key),E)}}function g(f,e,d){return e&&n(f.prototype,e),d&&n(f,d),Object.defineProperty(f,"prototype",{writable:!1}),f}function h(f){var e=r(f,"string");return typeof e=="symbol"?e:String(e)}function r(f,e){if(typeof f!="object"||f===null)return f;var d=f[Symbol.toPrimitive];if(d!==void 0){var E=d.call(f,e||"default");if(typeof E!="object")return E;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(f)}function u(f){if(f===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return f}function p(f,e){f.prototype=Object.create(e.prototype),f.prototype.constructor=f,i(f,e)}function i(f,e){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(E,v){return E.__proto__=v,E},i(f,e)}var a={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},t=function(f){p(e,f);function e(E,v,I,R){var O;return O=f.call(this)||this,O.hls=void 0,O.fragPrevious=null,O.fragCurrent=null,O.fragmentTracker=void 0,O.transmuxer=null,O._state=a.STOPPED,O.media=null,O.mediaBuffer=null,O.config=void 0,O.bitrateTest=!1,O.lastCurrentTime=0,O.nextLoadPosition=0,O.startPosition=0,O.loadedmetadata=!1,O.fragLoadError=0,O.retryDate=0,O.levels=null,O.fragmentLoader=void 0,O.keyLoader=void 0,O.levelLastLoaded=null,O.startFragRequested=!1,O.decrypter=void 0,O.initPTS=[],O.onvseeking=null,O.onvended=null,O.logPrefix="",O.log=void 0,O.warn=void 0,O.logPrefix=R,O.log=k.logger.log.bind(k.logger,R+":"),O.warn=k.logger.warn.bind(k.logger,R+":"),O.hls=E,O.fragmentLoader=new m.default(E.config),O.keyLoader=I,O.fragmentTracker=v,O.config=E.config,O.decrypter=new o.default(E.config),E.on(A.Events.LEVEL_SWITCHING,O.onLevelSwitching,u(O)),O}var d=e.prototype;return d.doTick=function(){this.onTickEnd()},d.onTickEnd=function(){},d.startLoad=function(v){},d.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort();var v=this.fragCurrent;v&&(v.abortRequests(),this.fragmentTracker.removeFragment(v)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=a.STOPPED},d._streamEnded=function(v,I){if(I.live||v.nextStart||!v.end||!this.media)return!1;var R=I.partList;if(R!=null&&R.length){var O=R[R.length-1],C=P.BufferHelper.isBuffered(this.media,O.start+O.duration/2);return C}var M=I.fragments[I.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(M)},d.getLevelDetails=function(){if(this.levels&&this.levelLastLoaded!==null){var v;return(v=this.levels[this.levelLastLoaded])===null||v===void 0?void 0:v.details}},d.onMediaAttached=function(v,I){var R=this.media=this.mediaBuffer=I.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),R.addEventListener("seeking",this.onvseeking),R.addEventListener("ended",this.onvended);var O=this.config;this.levels&&O.autoStartLoad&&this.state===a.STOPPED&&this.startLoad(O.startPosition)},d.onMediaDetaching=function(){var v=this.media;v!=null&&v.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),v&&this.onvseeking&&this.onvended&&(v.removeEventListener("seeking",this.onvseeking),v.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},d.onMediaSeeking=function(){var v=this.config,I=this.fragCurrent,R=this.media,O=this.mediaBuffer,C=this.state,M=R?R.currentTime:0,B=P.BufferHelper.bufferInfo(O||R,M,v.maxBufferHole);if(this.log("media seeking to "+((0,F.isFiniteNumber)(M)?M.toFixed(3):M)+", state: "+C),this.state===a.ENDED)this.resetLoadingState();else if(I){var w=v.maxFragLookUpTolerance,N=I.start-w,W=I.start+I.duration+w;if(!B.len||W<B.start||N>B.end){var G=M>W;(M<N||G)&&(G&&I.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),I.abortRequests()),this.resetLoadingState())}}R&&(this.lastCurrentTime=M),!this.loadedmetadata&&!B.len&&(this.nextLoadPosition=this.startPosition=M),this.tickImmediate()},d.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},d.onLevelSwitching=function(v,I){this.fragLoadError=0},d.onHandlerDestroying=function(){this.stopLoad(),f.prototype.onHandlerDestroying.call(this)},d.onHandlerDestroyed=function(){this.state=a.STOPPED,this.hls.off(A.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,f.prototype.onHandlerDestroyed.call(this)},d.loadFragment=function(v,I,R){this._loadFragForPlayback(v,I,R)},d._loadFragForPlayback=function(v,I,R){var O=this,C=function(B){if(O.fragContextChanged(v)){O.warn("Fragment "+v.sn+(B.part?" p: "+B.part.index:"")+" of level "+v.level+" was dropped during download."),O.fragmentTracker.removeFragment(v);return}v.stats.chunkCount++,O._handleFragmentLoadProgress(B)};this._doFragLoad(v,I,R,C).then(function(M){if(M){O.fragLoadError=0;var B=O.state;if(O.fragContextChanged(v)){(B===a.FRAG_LOADING||!O.fragCurrent&&B===a.PARSING)&&(O.fragmentTracker.removeFragment(v),O.state=a.IDLE);return}"payload"in M&&(O.log("Loaded fragment "+v.sn+" of level "+v.level),O.hls.trigger(A.Events.FRAG_LOADED,M)),O._handleFragmentLoadComplete(M)}}).catch(function(M){O.state===a.STOPPED||O.state===a.ERROR||(O.warn(M),O.resetFragmentLoading(v))})},d.flushMainBuffer=function(v,I,R){if(R===void 0&&(R=null),!!(v-I)){var O={startOffset:v,endOffset:I,type:R};this.fragLoadError=0,this.hls.trigger(A.Events.BUFFER_FLUSHING,O)}},d._loadInitSegment=function(v,I){var R=this;this._doFragLoad(v,I).then(function(O){if(!O||R.fragContextChanged(v)||!R.levels)throw new Error("init load aborted");return O}).then(function(O){var C=R.hls,M=O.payload,B=v.decryptdata;if(M&&M.byteLength>0&&B&&B.key&&B.iv&&B.method==="AES-128"){var w=self.performance.now();return R.decrypter.decrypt(new Uint8Array(M),B.key.buffer,B.iv.buffer).then(function(N){var W=self.performance.now();return C.trigger(A.Events.FRAG_DECRYPTED,{frag:v,payload:N,stats:{tstart:w,tdecrypt:W}}),O.payload=N,O})}return O}).then(function(O){var C=R.fragCurrent,M=R.hls,B=R.levels;if(!B)throw new Error("init load aborted, missing levels");var w=B[v.level].details;console.assert(w,"Level details are defined when init segment is loaded");var N=v.stats;R.state=a.IDLE,R.fragLoadError=0,v.data=new Uint8Array(O.payload),N.parsing.start=N.buffering.start=self.performance.now(),N.parsing.end=N.buffering.end=self.performance.now(),O.frag===C&&M.trigger(A.Events.FRAG_BUFFERED,{stats:N,frag:C,part:null,id:v.type}),R.tick()}).catch(function(O){R.state===a.STOPPED||R.state===a.ERROR||(R.warn(O),R.resetFragmentLoading(v))})},d.fragContextChanged=function(v){var I=this.fragCurrent;return!v||!I||v.level!==I.level||v.sn!==I.sn||v.urlId!==I.urlId},d.fragBufferedComplete=function(v,I){var R,O,C,M,B=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+v.type+" sn: "+v.sn+(I?" part: "+I.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+v.level+" (frag:["+((R=v.startPTS)!=null?R:NaN).toFixed(3)+"-"+((O=v.endPTS)!=null?O:NaN).toFixed(3)+"] > buffer:"+(B?l.default.toString(P.BufferHelper.getBuffered(B)):"(detached)")+")"),this.state=a.IDLE,B&&(!this.loadedmetadata&&v.type==s.PlaylistLevelType.MAIN&&B.buffered.length&&((C=this.fragCurrent)===null||C===void 0?void 0:C.sn)===((M=this.fragPrevious)===null||M===void 0?void 0:M.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},d.seekToStartPos=function(){},d._handleFragmentLoadComplete=function(v){var I=this.transmuxer;if(I){var R=v.frag,O=v.part,C=v.partsLoaded,M=!C||C.length===0||C.some(function(w){return!w}),B=new x.ChunkMetadata(R.level,R.sn,R.stats.chunkCount+1,0,O?O.index:-1,!M);I.flush(B)}},d._handleFragmentLoadProgress=function(v){},d._doFragLoad=function(v,I,R,O){var C,M=this;if(R===void 0&&(R=null),!this.levels)throw new Error("frag load aborted, missing levels");var B=null;if(v.encrypted&&!((C=v.decryptdata)!==null&&C!==void 0&&C.key)?(this.log("Loading key for "+v.sn+" of ["+I.startSN+"-"+I.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+v.level),this.state=a.KEY_LOADING,this.fragCurrent=v,B=this.keyLoader.load(v).then(function(H){if(!M.fragContextChanged(H.frag))return M.hls.trigger(A.Events.KEY_LOADED,H),M.state===a.KEY_LOADING&&(M.state=a.IDLE),H}),this.hls.trigger(A.Events.KEY_LOADING,{frag:v}),this.throwIfFragContextChanged("KEY_LOADING")):!v.encrypted&&I.encryptedFragments.length&&this.keyLoader.loadClear(v,I.encryptedFragments),R=Math.max(v.start,R||0),this.config.lowLatencyMode&&I){var w=I.partList;if(w&&O){R>v.end&&I.fragmentHint&&(v=I.fragmentHint);var N=this.getNextPart(w,v,R);if(N>-1){var W=w[N];return this.log("Loading part sn: "+v.sn+" p: "+W.index+" cc: "+v.cc+" of playlist ["+I.startSN+"-"+I.endSN+"] parts [0-"+N+"-"+(w.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+v.level+", target: "+parseFloat(R.toFixed(3))),this.nextLoadPosition=W.start+W.duration,this.state=a.FRAG_LOADING,this.hls.trigger(A.Events.FRAG_LOADING,{frag:v,part:w[N],targetBufferTime:R}),this.throwIfFragContextChanged("FRAG_LOADING parts"),B?B.then(function(H){return!H||M.fragContextChanged(H.frag)?null:M.doFragPartsLoad(v,w,N,O)}).catch(function(H){return M.handleFragLoadError(H)}):this.doFragPartsLoad(v,w,N,O).catch(function(H){return M.handleFragLoadError(H)})}else if(!v.url||this.loadedEndOfParts(w,R))return Promise.resolve(null)}}this.log("Loading fragment "+v.sn+" cc: "+v.cc+" "+(I?"of ["+I.startSN+"-"+I.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+v.level+", target: "+parseFloat(R.toFixed(3))),(0,F.isFiniteNumber)(v.sn)&&!this.bitrateTest&&(this.nextLoadPosition=v.start+v.duration),this.state=a.FRAG_LOADING,this.hls.trigger(A.Events.FRAG_LOADING,{frag:v,targetBufferTime:R}),this.throwIfFragContextChanged("FRAG_LOADING");var G=this.config.progressive;return G&&B?B.then(function(H){return!H||M.fragContextChanged(H==null?void 0:H.frag)?null:M.fragmentLoader.load(v,O)}).catch(function(H){return M.handleFragLoadError(H)}):Promise.all([this.fragmentLoader.load(v,G?O:void 0),B]).then(function(H){var $=H[0];return!G&&$&&O&&O($),$}).catch(function(H){return M.handleFragLoadError(H)})},d.throwIfFragContextChanged=function(v){if(this.fragCurrent===null)throw new Error("frag load aborted, context changed in "+v)},d.doFragPartsLoad=function(v,I,R,O){var C=this;return new Promise(function(M,B){var w=[],N=function W(G){var H=I[G];C.fragmentLoader.loadPart(v,H,O).then(function($){w[H.index]=$;var Y=$.part;C.hls.trigger(A.Events.FRAG_LOADED,$);var z=I[G+1];if(z&&z.fragment===v)W(G+1);else return M({frag:v,part:Y,partsLoaded:w})}).catch(B)};N(R)})},d.handleFragLoadError=function(v){if("data"in v){var I=v.data;v.data&&I.details===L.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(I.frag,I.part):this.hls.trigger(A.Events.ERROR,I)}else this.hls.trigger(A.Events.ERROR,{type:L.ErrorTypes.OTHER_ERROR,details:L.ErrorDetails.INTERNAL_EXCEPTION,err:v,fatal:!0});return null},d._handleTransmuxerFlush=function(v){var I=this.getCurrentContext(v);if(!I||this.state!==a.PARSING){!this.fragCurrent&&this.state!==a.STOPPED&&this.state!==a.ERROR&&(this.state=a.IDLE);return}var R=I.frag,O=I.part,C=I.level,M=self.performance.now();R.stats.parsing.end=M,O&&(O.stats.parsing.end=M),this.updateLevelTiming(R,O,C,v.partial)},d.getCurrentContext=function(v){var I=this.levels,R=v.level,O=v.sn,C=v.part;if(!I||!I[R])return this.warn("Levels object was unset while buffering fragment "+O+" of level "+R+". The current chunk will not be buffered."),null;var M=I[R],B=C>-1?(0,y.getPartWith)(M,O,C):null,w=B?B.fragment:(0,y.getFragmentWithSN)(M,O,this.fragCurrent);return w?{frag:w,part:B,level:M}:null},d.bufferFragmentData=function(v,I,R,O){if(!(!v||this.state!==a.PARSING)){var C=v.data1,M=v.data2,B=C;if(C&&M&&(B=(0,_.appendUint8Array)(C,M)),!(!B||!B.length)){var w={type:v.type,frag:I,part:R,chunkMeta:O,parent:I.type,data:B};this.hls.trigger(A.Events.BUFFER_APPENDING,w),v.dropped&&v.independent&&!R&&this.flushBufferGap(I)}}},d.flushBufferGap=function(v){var I=this.media;if(I){if(!P.BufferHelper.isBuffered(I,I.currentTime)){this.flushMainBuffer(0,v.start);return}var R=I.currentTime,O=P.BufferHelper.bufferInfo(I,R,0),C=v.duration,M=Math.min(this.config.maxFragLookUpTolerance*2,C*.25),B=Math.max(Math.min(v.start-M,O.end-M),R+M);v.start-B>M&&this.flushMainBuffer(B,v.start)}},d.getFwdBufferInfo=function(v,I){var R=this.config,O=this.getLoadPosition();if(!(0,F.isFiniteNumber)(O))return null;var C=P.BufferHelper.bufferInfo(v,O,R.maxBufferHole);if(C.len===0&&C.nextStart!==void 0){var M=this.fragmentTracker.getBufferedFrag(O,I);if(M&&C.nextStart<M.end)return P.BufferHelper.bufferInfo(v,O,Math.max(C.nextStart,R.maxBufferHole))}return C},d.getMaxBufferLength=function(v){var I=this.config,R;return v?R=Math.max(8*I.maxBufferSize/v,I.maxBufferLength):R=I.maxBufferLength,Math.min(R,I.maxMaxBufferLength)},d.reduceMaxBufferLength=function(v){var I=this.config,R=v||I.maxBufferLength;return I.maxMaxBufferLength>=R?(I.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+I.maxMaxBufferLength+"s"),!0):!1},d.getNextFragment=function(v,I){var R=I.fragments,O=R.length;if(!O)return null;var C=this.config,M=R[0].start,B;if(I.live){var w=C.initialLiveManifestSize;if(O<w)return this.warn("Not enough fragments to start playback (have: "+O+", need: "+w+")"),null;!I.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(B=this.getInitialLiveFragment(I,R),this.startPosition=B?this.hls.liveSyncPosition||B.start:v)}else v<=M&&(B=R[0]);if(!B){var N=C.lowLatencyMode?I.partEnd:I.fragmentEnd;B=this.getFragmentAtPosition(v,N,I)}return this.mapToInitFragWhenRequired(B)},d.mapToInitFragWhenRequired=function(v){return v!=null&&v.initSegment&&!(v!=null&&v.initSegment.data)&&!this.bitrateTest?v.initSegment:v},d.getNextPart=function(v,I,R){for(var O=-1,C=!1,M=!0,B=0,w=v.length;B<w;B++){var N=v[B];if(M=M&&!N.independent,O>-1&&R<N.start)break;var W=N.loaded;W?O=-1:(C||N.independent||M)&&N.fragment===I&&(O=B),C=W}return O},d.loadedEndOfParts=function(v,I){var R=v[v.length-1];return R&&I>R.start&&R.loaded},d.getInitialLiveFragment=function(v,I){var R=this.fragPrevious,O=null;if(R){if(v.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+R.programDateTime),O=(0,c.findFragmentByPDT)(I,R.endProgramDateTime,this.config.maxFragLookUpTolerance)),!O){var C=R.sn+1;if(C>=v.startSN&&C<=v.endSN){var M=I[C-v.startSN];R.cc===M.cc&&(O=M,this.log("Live playlist, switching playlist, load frag with next SN: "+O.sn))}O||(O=(0,c.findFragWithCC)(I,R.cc),O&&this.log("Live playlist, switching playlist, load frag with same CC: "+O.sn))}}else{var B=this.hls.liveSyncPosition;B!==null&&(O=this.getFragmentAtPosition(B,this.bitrateTest?v.fragmentEnd:v.edge,v))}return O},d.getFragmentAtPosition=function(v,I,R){var O=this.config,C=this.fragPrevious,M=R.fragments,B=R.endSN,w=R.fragmentHint,N=O.maxFragLookUpTolerance,W=!!(O.lowLatencyMode&&R.partList&&w);W&&w&&!this.bitrateTest&&(M=M.concat(w),B=w.sn);var G;if(v<I){var H=v>I-N?0:N;G=(0,c.findFragmentByPTS)(C,M,v,H)}else G=M[M.length-1];if(G){var $=G.sn-R.startSN;if(this.fragmentTracker.getState(G)===b.FragmentState.OK&&(C=G),C&&G.sn===C.sn&&!W){var Y=C&&G.level===C.level;if(Y){var z=M[$+1];G.sn<B&&this.fragmentTracker.getState(z)!==b.FragmentState.OK?(this.log("SN "+G.sn+" just loaded, load next one: "+z.sn),G=z):G=null}}}return G},d.synchronizeToLiveEdge=function(v){var I=this.config,R=this.media;if(R){var O=this.hls.liveSyncPosition,C=R.currentTime,M=v.fragments[0].start,B=v.edge,w=C>=M-I.maxFragLookUpTolerance&&C<=B;if(O!==null&&R.duration>O&&(C<O||!w)){var N=I.liveMaxLatencyDuration!==void 0?I.liveMaxLatencyDuration:I.liveMaxLatencyDurationCount*v.targetduration;(!w&&R.readyState<4||C<B-N)&&(this.loadedmetadata||(this.nextLoadPosition=O),R.readyState&&(this.warn("Playback: "+C.toFixed(3)+" is located too far from the end of live sliding playlist: "+B+", reset currentTime to : "+O.toFixed(3)),R.currentTime=O))}}},d.alignPlaylists=function(v,I){var R=this.levels,O=this.levelLastLoaded,C=this.fragPrevious,M=O!==null?R[O]:null,B=v.fragments.length;if(!B)return this.warn("No fragments in live playlist"),0;var w=v.fragments[0].start,N=!I,W=v.alignedSliding&&(0,F.isFiniteNumber)(w);if(N||!W&&!w){(0,T.alignStream)(C,M,v);var G=v.fragments[0].start;return this.log("Live playlist sliding: "+G.toFixed(2)+" start-sn: "+(I?I.startSN:"na")+"->"+v.startSN+" prev-sn: "+(C?C.sn:"na")+" fragments: "+B),G}return w},d.waitForCdnTuneIn=function(v){var I=3;return v.live&&v.canBlockReload&&v.partTarget&&v.tuneInGoal>Math.max(v.partHoldBack,v.partTarget*I)},d.setStartPosition=function(v,I){var R=this.startPosition;if(R<I&&(R=-1),R===-1||this.lastCurrentTime===-1){var O=v.startTimeOffset;(0,F.isFiniteNumber)(O)?(R=I+O,O<0&&(R+=v.totalduration),R=Math.min(Math.max(I,R),I+v.totalduration),this.log("Start time offset "+O+" found in playlist, adjust startPosition to "+R),this.startPosition=R):v.live?R=this.hls.liveSyncPosition||I:this.startPosition=R=0,this.lastCurrentTime=R}this.nextLoadPosition=R},d.getLoadPosition=function(){var v=this.media,I=0;return this.loadedmetadata&&v?I=v.currentTime:this.nextLoadPosition&&(I=this.nextLoadPosition),I},d.handleFragLoadAborted=function(v,I){this.transmuxer&&v.sn!=="initSegment"&&v.stats.aborted&&(this.warn("Fragment "+v.sn+(I?" part"+I.index:"")+" of level "+v.level+" was aborted"),this.resetFragmentLoading(v))},d.resetFragmentLoading=function(v){(!this.fragCurrent||!this.fragContextChanged(v)&&this.state!==a.FRAG_LOADING_WAITING_RETRY)&&(this.state=a.IDLE)},d.onFragmentOrKeyLoadError=function(v,I){if(I.fatal){this.stopLoad(),this.state=a.ERROR;return}var R=this.config;if(I.chunkMeta){var O=this.getCurrentContext(I.chunkMeta);O&&(I.frag=O.frag,I.levelRetry=!0,this.fragLoadError=R.fragLoadingMaxRetry)}var C=I.frag;if(!(!C||C.type!==v)){var M=this.fragCurrent;if(console.assert(M&&C.sn===M.sn&&C.level===M.level&&C.urlId===M.urlId,"Frag load error must match current frag to retry"),this.fragLoadError+1<=R.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var B=Math.min(Math.pow(2,this.fragLoadError)*R.fragLoadingRetryDelay,R.fragLoadingMaxRetryTimeout);this.warn("Fragment "+C.sn+" of "+v+" "+C.level+" failed to load, retrying in "+B+"ms"),this.retryDate=self.performance.now()+B,this.fragLoadError++,this.state=a.FRAG_LOADING_WAITING_RETRY}else I.levelRetry?(v===s.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=a.IDLE):(k.logger.error(I.details+" reaches max retry, redispatch as fatal ..."),I.fatal=!0,this.hls.stopLoad(),this.state=a.ERROR)}},d.afterBufferFlushed=function(v,I,R){if(v){var O=P.BufferHelper.getBuffered(v);this.fragmentTracker.detectEvictedFragments(I,O,R),this.state===a.ENDED&&this.resetLoadingState()}},d.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=a.IDLE},d.resetStartWhenNotLoaded=function(v){if(!this.loadedmetadata){this.startFragRequested=!1;var I=this.levels?this.levels[v].details:null;I!=null&&I.live?(this.startPosition=-1,this.setStartPosition(I,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},d.updateLevelTiming=function(v,I,R,O){var C=this,M=R.details;console.assert(!!M,"level.details must be defined");var B=Object.keys(v.elementaryStreams).reduce(function(w,N){var W=v.elementaryStreams[N];if(W){var G=W.endPTS-W.startPTS;if(G<=0)return C.warn("Could not parse fragment "+v.sn+" "+N+" duration reliably ("+G+")"),w||!1;var H=O?0:(0,y.updateFragPTSDTS)(M,v,W.startPTS,W.endPTS,W.startDTS,W.endDTS);return C.hls.trigger(A.Events.LEVEL_PTS_UPDATED,{details:M,level:R,drift:H,type:N,frag:v,start:W.startPTS,end:W.endPTS}),!0}return w},!1);B||(this.warn("Found no media in fragment "+v.sn+" of level "+R.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=a.PARSED,this.hls.trigger(A.Events.FRAG_PARSED,{frag:v,part:I})},d.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},g(e,[{key:"state",get:function(){return this._state},set:function(v){var I=this._state;I!==v&&(this._state=v,this.log(I+"->"+v))}}]),e}(D.default)},"./src/controller/buffer-controller.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>c});var F=S("./src/polyfills/number.ts"),D=S("./src/events.ts"),b=S("./src/utils/logger.ts"),P=S("./src/errors.ts"),k=S("./src/utils/buffer-helper.ts"),A=S("./src/utils/mediasource-helper.ts"),L=S("./src/loader/fragment.ts"),x=S("./src/controller/buffer-operation-queue.ts"),_=(0,A.getMediaSource)(),T=/([ha]vc.)(?:\.[^.,]+)+/,c=function(){function y(o){var l=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var s=l.media,n=l.mediaSource;b.logger.log("[buffer-controller]: Media source opened"),s&&(s.removeEventListener("emptied",l._onMediaEmptied),l.updateMediaElementDuration(),l.hls.trigger(D.Events.MEDIA_ATTACHED,{media:s})),n&&n.removeEventListener("sourceopen",l._onMediaSourceOpen),l.checkPendingTracks()},this._onMediaSourceClose=function(){b.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){b.logger.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=function(){var s=l.media,n=l._objectUrl;s&&s.src!==n&&b.logger.error("Media element src was set while attaching MediaSource ("+n+" > "+s.src+")")},this.hls=o,this._initSourceBuffer(),this.registerListeners()}var m=y.prototype;return m.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},m.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null},m.registerListeners=function(){var l=this.hls;l.on(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),l.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),l.on(D.Events.BUFFER_RESET,this.onBufferReset,this),l.on(D.Events.BUFFER_APPENDING,this.onBufferAppending,this),l.on(D.Events.BUFFER_CODECS,this.onBufferCodecs,this),l.on(D.Events.BUFFER_EOS,this.onBufferEos,this),l.on(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),l.on(D.Events.LEVEL_UPDATED,this.onLevelUpdated,this),l.on(D.Events.FRAG_PARSED,this.onFragParsed,this),l.on(D.Events.FRAG_CHANGED,this.onFragChanged,this)},m.unregisterListeners=function(){var l=this.hls;l.off(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),l.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),l.off(D.Events.BUFFER_RESET,this.onBufferReset,this),l.off(D.Events.BUFFER_APPENDING,this.onBufferAppending,this),l.off(D.Events.BUFFER_CODECS,this.onBufferCodecs,this),l.off(D.Events.BUFFER_EOS,this.onBufferEos,this),l.off(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),l.off(D.Events.LEVEL_UPDATED,this.onLevelUpdated,this),l.off(D.Events.FRAG_PARSED,this.onFragParsed,this),l.off(D.Events.FRAG_CHANGED,this.onFragChanged,this)},m._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new x.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null},m.onManifestParsed=function(l,s){var n=2;(s.audio&&!s.video||!s.altAudio)&&(n=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=n,this.details=null,b.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},m.onMediaAttaching=function(l,s){var n=this.media=s.media;if(n&&_){var g=this.mediaSource=new _;g.addEventListener("sourceopen",this._onMediaSourceOpen),g.addEventListener("sourceended",this._onMediaSourceEnded),g.addEventListener("sourceclose",this._onMediaSourceClose),n.src=self.URL.createObjectURL(g),this._objectUrl=n.src,n.addEventListener("emptied",this._onMediaEmptied)}},m.onMediaDetaching=function(){var l=this.media,s=this.mediaSource,n=this._objectUrl;if(s){if(b.logger.log("[buffer-controller]: media source detaching"),s.readyState==="open")try{s.endOfStream()}catch(g){b.logger.warn("[buffer-controller]: onMediaDetaching: "+g.message+" while calling endOfStream")}this.onBufferReset(),s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),l&&(l.removeEventListener("emptied",this._onMediaEmptied),n&&self.URL.revokeObjectURL(n),l.src===n?(l.removeAttribute("src"),l.load()):b.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(D.Events.MEDIA_DETACHED,void 0)},m.onBufferReset=function(){var l=this;this.getSourceBufferTypes().forEach(function(s){var n=l.sourceBuffer[s];try{n&&(l.removeBufferListeners(s),l.mediaSource&&l.mediaSource.removeSourceBuffer(n),l.sourceBuffer[s]=void 0)}catch(g){b.logger.warn("[buffer-controller]: Failed to reset the "+s+" buffer",g)}}),this._initSourceBuffer()},m.onBufferCodecs=function(l,s){var n=this,g=this.getSourceBufferTypes().length;Object.keys(s).forEach(function(h){if(g){var r=n.tracks[h];if(r&&typeof r.buffer.changeType=="function"){var u=s[h],p=u.id,i=u.codec,a=u.levelCodec,t=u.container,f=u.metadata,e=(r.levelCodec||r.codec).replace(T,"$1"),d=(a||i).replace(T,"$1");if(e!==d){var E=t+";codecs="+(a||i);n.appendChangeType(h,E),b.logger.log("[buffer-controller]: switching codec "+e+" to "+d),n.tracks[h]={buffer:r.buffer,codec:i,container:t,levelCodec:a,metadata:f,id:p}}}}else n.pendingTracks[h]=s[h]}),!g&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},m.appendChangeType=function(l,s){var n=this,g=this.operationQueue,h={execute:function(){var u=n.sourceBuffer[l];u&&(b.logger.log("[buffer-controller]: changing "+l+" sourceBuffer type to "+s),u.changeType(s)),g.shiftAndExecuteNext(l)},onStart:function(){},onComplete:function(){},onError:function(u){b.logger.warn("[buffer-controller]: Failed to change "+l+" SourceBuffer type",u)}};g.append(h,l)},m.onBufferAppending=function(l,s){var n=this,g=this.hls,h=this.operationQueue,r=this.tracks,u=s.data,p=s.type,i=s.frag,a=s.part,t=s.chunkMeta,f=t.buffering[p],e=self.performance.now();f.start=e;var d=i.stats.buffering,E=a?a.stats.buffering:null;d.start===0&&(d.start=e),E&&E.start===0&&(E.start=e);var v=r.audio,I=!1;p==="audio"&&(v==null?void 0:v.container)==="audio/mpeg"&&(I=!this.lastMpegAudioChunk||t.id===1||this.lastMpegAudioChunk.sn!==t.sn,this.lastMpegAudioChunk=t);var R=i.start,O={execute:function(){if(f.executeStart=self.performance.now(),I){var M=n.sourceBuffer[p];if(M){var B=R-M.timestampOffset;Math.abs(B)>=.1&&(b.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+R+" (delta: "+B+") sn: "+i.sn+")"),M.timestampOffset=R)}}n.appendExecutor(u,p)},onStart:function(){},onComplete:function(){var M=self.performance.now();f.executeEnd=f.end=M,d.first===0&&(d.first=M),E&&E.first===0&&(E.first=M);var B=n.sourceBuffer,w={};for(var N in B)w[N]=k.BufferHelper.getBuffered(B[N]);n.appendError=0,n.hls.trigger(D.Events.BUFFER_APPENDED,{type:p,frag:i,part:a,chunkMeta:t,parent:i.type,timeRanges:w})},onError:function(M){b.logger.error("[buffer-controller]: Error encountered while trying to append to the "+p+" SourceBuffer",M);var B={type:P.ErrorTypes.MEDIA_ERROR,parent:i.type,details:P.ErrorDetails.BUFFER_APPEND_ERROR,err:M,fatal:!1};M.code===DOMException.QUOTA_EXCEEDED_ERR?B.details=P.ErrorDetails.BUFFER_FULL_ERROR:(n.appendError++,B.details=P.ErrorDetails.BUFFER_APPEND_ERROR,n.appendError>g.config.appendErrorMaxRetry&&(b.logger.error("[buffer-controller]: Failed "+g.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),B.fatal=!0,g.stopLoad())),g.trigger(D.Events.ERROR,B)}};h.append(O,p)},m.onBufferFlushing=function(l,s){var n=this,g=this.operationQueue,h=function(u){return{execute:n.removeExecutor.bind(n,u,s.startOffset,s.endOffset),onStart:function(){},onComplete:function(){n.hls.trigger(D.Events.BUFFER_FLUSHED,{type:u})},onError:function(i){b.logger.warn("[buffer-controller]: Failed to remove from "+u+" SourceBuffer",i)}}};s.type?g.append(h(s.type),s.type):this.getSourceBufferTypes().forEach(function(r){g.append(h(r),r)})},m.onFragParsed=function(l,s){var n=this,g=s.frag,h=s.part,r=[],u=h?h.elementaryStreams:g.elementaryStreams;u[L.ElementaryStreamTypes.AUDIOVIDEO]?r.push("audiovideo"):(u[L.ElementaryStreamTypes.AUDIO]&&r.push("audio"),u[L.ElementaryStreamTypes.VIDEO]&&r.push("video"));var p=function(){var a=self.performance.now();g.stats.buffering.end=a,h&&(h.stats.buffering.end=a);var t=h?h.stats:g.stats;n.hls.trigger(D.Events.FRAG_BUFFERED,{frag:g,part:h,stats:t,id:g.type})};r.length===0&&b.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+g.type+" level: "+g.level+" sn: "+g.sn),this.blockBuffers(p,r)},m.onFragChanged=function(l,s){this.flushBackBuffer()},m.onBufferEos=function(l,s){var n=this,g=this.getSourceBufferTypes().reduce(function(h,r){var u=n.sourceBuffer[r];return u&&(!s.type||s.type===r)&&(u.ending=!0,u.ended||(u.ended=!0,b.logger.log("[buffer-controller]: "+r+" sourceBuffer now EOS"))),h&&!!(!u||u.ended)},!0);g&&(b.logger.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(function(){n.getSourceBufferTypes().forEach(function(r){var u=n.sourceBuffer[r];u&&(u.ending=!1)});var h=n.mediaSource;if(!h||h.readyState!=="open"){h&&b.logger.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+h.readyState);return}b.logger.log("[buffer-controller]: Calling mediaSource.endOfStream()"),h.endOfStream()}))},m.onLevelUpdated=function(l,s){var n=s.details;n.fragments.length&&(this.details=n,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},m.flushBackBuffer=function(){var l=this.hls,s=this.details,n=this.media,g=this.sourceBuffer;if(!(!n||s===null)){var h=this.getSourceBufferTypes();if(h.length){var r=s.live&&l.config.liveBackBufferLength!==null?l.config.liveBackBufferLength:l.config.backBufferLength;if(!(!(0,F.isFiniteNumber)(r)||r<0)){var u=n.currentTime,p=s.levelTargetDuration,i=Math.max(r,p),a=Math.floor(u/p)*p-i;h.forEach(function(t){var f=g[t];if(f){var e=k.BufferHelper.getBuffered(f);if(e.length>0&&a>e.start(0)){if(l.trigger(D.Events.BACK_BUFFER_REACHED,{bufferEnd:a}),s.live)l.trigger(D.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:a});else if(f.ended&&e.end(e.length-1)-u<p*2){b.logger.info("[buffer-controller]: Cannot flush "+t+" back buffer while SourceBuffer is in ended state");return}l.trigger(D.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:a,type:t})}}})}}}},m.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var l=this.details,s=this.hls,n=this.media,g=this.mediaSource,h=l.fragments[0].start+l.totalduration,r=n.duration,u=(0,F.isFiniteNumber)(g.duration)?g.duration:0;l.live&&s.config.liveDurationInfinity?(b.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),g.duration=1/0,this.updateSeekableRange(l)):(h>u&&h>r||!(0,F.isFiniteNumber)(r))&&(b.logger.log("[buffer-controller]: Updating Media Source duration to "+h.toFixed(3)),g.duration=h)}},m.updateSeekableRange=function(l){var s=this.mediaSource,n=l.fragments,g=n.length;if(g&&l.live&&s!==null&&s!==void 0&&s.setLiveSeekableRange){var h=Math.max(0,n[0].start),r=Math.max(h,h+l.totalduration);s.setLiveSeekableRange(h,r)}},m.checkPendingTracks=function(){var l=this.bufferCodecEventsExpected,s=this.operationQueue,n=this.pendingTracks,g=Object.keys(n).length;if(g&&!l||g===2){this.createSourceBuffers(n),this.pendingTracks={};var h=this.getSourceBufferTypes();if(h.length===0){this.hls.trigger(D.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}h.forEach(function(r){s.executeNext(r)})}},m.createSourceBuffers=function(l){var s=this.sourceBuffer,n=this.mediaSource;if(!n)throw Error("createSourceBuffers called when mediaSource was null");var g=0;for(var h in l)if(!s[h]){var r=l[h];if(!r)throw Error("source buffer exists for track "+h+", however track does not");var u=r.levelCodec||r.codec,p=r.container+";codecs="+u;b.logger.log("[buffer-controller]: creating sourceBuffer("+p+")");try{var i=s[h]=n.addSourceBuffer(p),a=h;this.addBufferListener(a,"updatestart",this._onSBUpdateStart),this.addBufferListener(a,"updateend",this._onSBUpdateEnd),this.addBufferListener(a,"error",this._onSBUpdateError),this.tracks[h]={buffer:i,codec:u,container:r.container,levelCodec:r.levelCodec,metadata:r.metadata,id:r.id},g++}catch(t){b.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+t.message),this.hls.trigger(D.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:t,mimeType:p})}}g&&this.hls.trigger(D.Events.BUFFER_CREATED,{tracks:this.tracks})},m._onSBUpdateStart=function(l){var s=this.operationQueue,n=s.current(l);n.onStart()},m._onSBUpdateEnd=function(l){var s=this.operationQueue,n=s.current(l);n.onComplete(),s.shiftAndExecuteNext(l)},m._onSBUpdateError=function(l,s){b.logger.error("[buffer-controller]: "+l+" SourceBuffer error",s),this.hls.trigger(D.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var n=this.operationQueue.current(l);n&&n.onError(s)},m.removeExecutor=function(l,s,n){var g=this.media,h=this.mediaSource,r=this.operationQueue,u=this.sourceBuffer,p=u[l];if(!g||!h||!p){b.logger.warn("[buffer-controller]: Attempting to remove from the "+l+" SourceBuffer, but it does not exist"),r.shiftAndExecuteNext(l);return}var i=(0,F.isFiniteNumber)(g.duration)?g.duration:1/0,a=(0,F.isFiniteNumber)(h.duration)?h.duration:1/0,t=Math.max(0,s),f=Math.min(n,i,a);f>t&&!p.ending?(p.ended=!1,b.logger.log("[buffer-controller]: Removing ["+t+","+f+"] from the "+l+" SourceBuffer"),console.assert(!p.updating,l+" sourceBuffer must not be updating"),p.remove(t,f)):r.shiftAndExecuteNext(l)},m.appendExecutor=function(l,s){var n=this.operationQueue,g=this.sourceBuffer,h=g[s];if(!h){b.logger.warn("[buffer-controller]: Attempting to append to the "+s+" SourceBuffer, but it does not exist"),n.shiftAndExecuteNext(s);return}h.ended=!1,console.assert(!h.updating,s+" sourceBuffer must not be updating"),h.appendBuffer(l)},m.blockBuffers=function(l,s){var n=this;if(s===void 0&&(s=this.getSourceBufferTypes()),!s.length){b.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(l);return}var g=this.operationQueue,h=s.map(function(r){return g.appendBlocker(r)});Promise.all(h).then(function(){l(),s.forEach(function(r){var u=n.sourceBuffer[r];(!u||!u.updating)&&g.shiftAndExecuteNext(r)})})},m.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},m.addBufferListener=function(l,s,n){var g=this.sourceBuffer[l];if(g){var h=n.bind(this,l);this.listeners[l].push({event:s,listener:h}),g.addEventListener(s,h)}},m.removeBufferListeners=function(l){var s=this.sourceBuffer[l];s&&this.listeners[l].forEach(function(n){s.removeEventListener(n.event,n.listener)})},y}()},"./src/controller/buffer-operation-queue.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>D});var F=S("./src/utils/logger.ts"),D=function(){function b(k){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=k}var P=b.prototype;return P.append=function(A,L){var x=this.queues[L];x.push(A),x.length===1&&this.buffers[L]&&this.executeNext(L)},P.insertAbort=function(A,L){var x=this.queues[L];x.unshift(A),this.executeNext(L)},P.appendBlocker=function(A){var L,x=new Promise(function(T){L=T}),_={execute:L,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(_,A),x},P.executeNext=function(A){var L=this.buffers,x=this.queues,_=L[A],T=x[A];if(T.length){var c=T[0];try{c.execute()}catch(y){F.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),c.onError(y),(!_||!_.updating)&&(T.shift(),this.executeNext(A))}}},P.shiftAndExecuteNext=function(A){this.queues[A].shift(),this.executeNext(A)},P.current=function(A){return this.queues[A][0]},b}()},"./src/controller/cap-level-controller.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>L});var F=S("./src/events.ts");function D(x,_){for(var T=0;T<_.length;T++){var c=_[T];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(x,P(c.key),c)}}function b(x,_,T){return _&&D(x.prototype,_),T&&D(x,T),Object.defineProperty(x,"prototype",{writable:!1}),x}function P(x){var _=k(x,"string");return typeof _=="symbol"?_:String(_)}function k(x,_){if(typeof x!="object"||x===null)return x;var T=x[Symbol.toPrimitive];if(T!==void 0){var c=T.call(x,_||"default");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(_==="string"?String:Number)(x)}var A=function(){function x(T){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=T,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var _=x.prototype;return _.setStreamController=function(c){this.streamController=c},_.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},_.registerListeners=function(){var c=this.hls;c.on(F.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),c.on(F.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),c.on(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),c.on(F.Events.BUFFER_CODECS,this.onBufferCodecs,this),c.on(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},_.unregisterListener=function(){var c=this.hls;c.off(F.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),c.off(F.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),c.off(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),c.off(F.Events.BUFFER_CODECS,this.onBufferCodecs,this),c.off(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},_.onFpsDropLevelCapping=function(c,y){x.isLevelAllowed(y.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(y.droppedLevel)},_.onMediaAttaching=function(c,y){this.media=y.media instanceof HTMLVideoElement?y.media:null,this.clientRect=null},_.onManifestParsed=function(c,y){var m=this.hls;this.restrictedLevels=[],this.firstLevel=y.firstLevel,m.config.capLevelToPlayerSize&&y.video&&this.startCapping()},_.onBufferCodecs=function(c,y){var m=this.hls;m.config.capLevelToPlayerSize&&y.video&&this.startCapping()},_.onMediaDetaching=function(){this.stopCapping()},_.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var c=this.hls.levels;if(c.length){var y=this.hls;y.autoLevelCapping=this.getMaxLevel(c.length-1),y.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=y.autoLevelCapping}}},_.getMaxLevel=function(c){var y=this,m=this.hls.levels;if(!m.length)return-1;var o=m.filter(function(l,s){return x.isLevelAllowed(s,y.restrictedLevels)&&s<=c});return this.clientRect=null,x.getMaxLevelByMediaSize(o,this.mediaWidth,this.mediaHeight)},_.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},_.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},_.getDimensions=function(){if(this.clientRect)return this.clientRect;var c=this.media,y={width:0,height:0};if(c){var m=c.getBoundingClientRect();y.width=m.width,y.height=m.height,!y.width&&!y.height&&(y.width=m.right-m.left||c.width||0,y.height=m.bottom-m.top||c.height||0)}return this.clientRect=y,y},x.isLevelAllowed=function(c,y){return y===void 0&&(y=[]),y.indexOf(c)===-1},x.getMaxLevelByMediaSize=function(c,y,m){if(!c||!c.length)return-1;for(var o=function(h,r){return r?h.width!==r.width||h.height!==r.height:!0},l=c.length-1,s=0;s<c.length;s+=1){var n=c[s];if((n.width>=y||n.height>=m)&&o(n,c[s+1])){l=s;break}}return l},b(x,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var c=1;if(!this.hls.config.ignoreDevicePixelRatio)try{c=self.devicePixelRatio}catch{}return c}}]),x}();const L=A},"./src/controller/cmcd-controller.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>m});var F=S("./src/events.ts"),D=S("./src/types/cmcd.ts"),b=S("./src/utils/buffer-helper.ts"),P=S("./src/utils/logger.ts");function k(o,l){for(var s=0;s<l.length;s++){var n=l[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(o,L(n.key),n)}}function A(o,l,s){return l&&k(o.prototype,l),s&&k(o,s),Object.defineProperty(o,"prototype",{writable:!1}),o}function L(o){var l=x(o,"string");return typeof l=="symbol"?l:String(l)}function x(o,l){if(typeof o!="object"||o===null)return o;var s=o[Symbol.toPrimitive];if(s!==void 0){var n=s.call(o,l||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(l==="string"?String:Number)(o)}function _(o,l){var s=typeof Symbol<"u"&&o[Symbol.iterator]||o["@@iterator"];if(s)return(s=s.call(o)).next.bind(s);if(Array.isArray(o)||(s=T(o))||l&&o&&typeof o.length=="number"){s&&(o=s);var n=0;return function(){return n>=o.length?{done:!0}:{done:!1,value:o[n++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function T(o,l){if(o){if(typeof o=="string")return c(o,l);var s=Object.prototype.toString.call(o).slice(8,-1);if(s==="Object"&&o.constructor&&(s=o.constructor.name),s==="Map"||s==="Set")return Array.from(o);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return c(o,l)}}function c(o,l){(l==null||l>o.length)&&(l=o.length);for(var s=0,n=new Array(l);s<l;s++)n[s]=o[s];return n}function y(){return y=Object.assign?Object.assign.bind():function(o){for(var l=1;l<arguments.length;l++){var s=arguments[l];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(o[n]=s[n])}return o},y.apply(this,arguments)}var m=function(){function o(s){var n=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){n.initialized&&(n.starved=!0),n.buffering=!0},this.onPlaying=function(){n.initialized||(n.initialized=!0),n.buffering=!1},this.applyPlaylistData=function(r){try{n.apply(r,{ot:D.CMCDObjectType.MANIFEST,su:!n.initialized})}catch(u){P.logger.warn("Could not generate manifest CMCD data.",u)}},this.applyFragmentData=function(r){try{var u=r.frag,p=n.hls.levels[u.level],i=n.getObjectType(u),a={d:u.duration*1e3,ot:i};(i===D.CMCDObjectType.VIDEO||i===D.CMCDObjectType.AUDIO||i==D.CMCDObjectType.MUXED)&&(a.br=p.bitrate/1e3,a.tb=n.getTopBandwidth(i)/1e3,a.bl=n.getBufferLength(i)),n.apply(r,a)}catch(t){P.logger.warn("Could not generate segment CMCD data.",t)}},this.hls=s;var g=this.config=s.config,h=g.cmcd;h!=null&&(g.pLoader=this.createPlaylistLoader(),g.fLoader=this.createFragmentLoader(),this.sid=h.sessionId||o.uuid(),this.cid=h.contentId,this.useHeaders=h.useHeaders===!0,this.registerListeners())}var l=o.prototype;return l.registerListeners=function(){var n=this.hls;n.on(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.on(F.Events.MEDIA_DETACHED,this.onMediaDetached,this),n.on(F.Events.BUFFER_CREATED,this.onBufferCreated,this)},l.unregisterListeners=function(){var n=this.hls;n.off(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.off(F.Events.MEDIA_DETACHED,this.onMediaDetached,this),n.off(F.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},l.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},l.onMediaAttached=function(n,g){this.media=g.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},l.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},l.onBufferCreated=function(n,g){var h,r;this.audioBuffer=(h=g.tracks.audio)===null||h===void 0?void 0:h.buffer,this.videoBuffer=(r=g.tracks.video)===null||r===void 0?void 0:r.buffer},l.createData=function(){var n;return{v:D.CMCDVersion,sf:D.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(n=this.media)===null||n===void 0?void 0:n.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},l.apply=function(n,g){g===void 0&&(g={}),y(g,this.createData());var h=g.ot===D.CMCDObjectType.INIT||g.ot===D.CMCDObjectType.VIDEO||g.ot===D.CMCDObjectType.MUXED;if(this.starved&&h&&(g.bs=!0,g.su=!0,this.starved=!1),g.su==null&&(g.su=this.buffering),this.useHeaders){var r=o.toHeaders(g);if(!Object.keys(r).length)return;n.headers||(n.headers={}),y(n.headers,r)}else{var u=o.toQuery(g);if(!u)return;n.url=o.appendQueryToUri(n.url,u)}},l.getObjectType=function(n){var g=n.type;if(g==="subtitle")return D.CMCDObjectType.TIMED_TEXT;if(n.sn==="initSegment")return D.CMCDObjectType.INIT;if(g==="audio")return D.CMCDObjectType.AUDIO;if(g==="main")return this.hls.audioTracks.length?D.CMCDObjectType.VIDEO:D.CMCDObjectType.MUXED},l.getTopBandwidth=function(n){var g=0,h,r=this.hls;if(n===D.CMCDObjectType.AUDIO)h=r.audioTracks;else{var u=r.maxAutoLevel,p=u>-1?u+1:r.levels.length;h=r.levels.slice(0,p)}for(var i=_(h),a;!(a=i()).done;){var t=a.value;t.bitrate>g&&(g=t.bitrate)}return g>0?g:NaN},l.getBufferLength=function(n){var g=this.hls.media,h=n===D.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!h||!g)return NaN;var r=b.BufferHelper.bufferInfo(h,g.currentTime,this.config.maxBufferHole);return r.len*1e3},l.createPlaylistLoader=function(){var n=this.config.pLoader,g=this.applyPlaylistData,h=n||this.config.loader;return function(){function r(p){this.loader=void 0,this.loader=new h(p)}var u=r.prototype;return u.destroy=function(){this.loader.destroy()},u.abort=function(){this.loader.abort()},u.load=function(i,a,t){g(i),this.loader.load(i,a,t)},A(r,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),r}()},l.createFragmentLoader=function(){var n=this.config.fLoader,g=this.applyFragmentData,h=n||this.config.loader;return function(){function r(p){this.loader=void 0,this.loader=new h(p)}var u=r.prototype;return u.destroy=function(){this.loader.destroy()},u.abort=function(){this.loader.abort()},u.load=function(i,a,t){g(i),this.loader.load(i,a,t)},A(r,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),r}()},o.uuid=function(){var n=URL.createObjectURL(new Blob),g=n.toString();return URL.revokeObjectURL(n),g.slice(g.lastIndexOf("/")+1)},o.serialize=function(n){for(var g=[],h=function(O){return!Number.isNaN(O)&&O!=null&&O!==""&&O!==!1},r=function(O){return Math.round(O)},u=function(O){return r(O/100)*100},p=function(O){return encodeURIComponent(O)},i={br:r,d:r,bl:u,dl:u,mtp:u,nor:p,rtp:u,tb:r},a=Object.keys(n||{}).sort(),t=_(a),f;!(f=t()).done;){var e=f.value,d=n[e];if(h(d)&&!(e==="v"&&d===1)&&!(e=="pr"&&d===1)){var E=i[e];E&&(d=E(d));var v=typeof d,I=void 0;e==="ot"||e==="sf"||e==="st"?I=e+"="+d:v==="boolean"?I=e:v==="number"?I=e+"="+d:I=e+"="+JSON.stringify(d),g.push(I)}}return g.join(",")},o.toHeaders=function(n){for(var g=Object.keys(n),h={},r=["Object","Request","Session","Status"],u=[{},{},{},{}],p={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},i=0,a=g;i<a.length;i++){var t=a[i],f=p[t]!=null?p[t]:1;u[f][t]=n[t]}for(var e=0;e<u.length;e++){var d=o.serialize(u[e]);d&&(h["CMCD-"+r[e]]=d)}return h},o.toQuery=function(n){return"CMCD="+encodeURIComponent(o.serialize(n))},o.appendQueryToUri=function(n,g){if(!g)return n;var h=n.includes("?")?"&":"?";return""+n+h+g},o}()},"./src/controller/eme-controller.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>i});var F=S("./src/events.ts"),D=S("./src/errors.ts"),b=S("./src/utils/logger.ts"),P=S("./src/utils/mediakeys-helper.ts"),k=S("./src/utils/keysystem-util.ts"),A=S("./src/utils/numeric-encoding-utils.ts"),L=S("./src/loader/level-key.ts"),x=S("./src/utils/hex.ts"),_=S("./src/utils/mp4-tools.ts"),T=S("./node_modules/eventemitter3/index.js"),c=S.n(T);function y(a,t){a.prototype=Object.create(t.prototype),a.prototype.constructor=a,n(a,t)}function m(a){var t=typeof Map=="function"?new Map:void 0;return m=function(e){if(e===null||!s(e))return e;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(e))return t.get(e);t.set(e,d)}function d(){return o(e,arguments,g(this).constructor)}return d.prototype=Object.create(e.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),n(d,e)},m(a)}function o(a,t,f){return l()?o=Reflect.construct.bind():o=function(d,E,v){var I=[null];I.push.apply(I,E);var R=Function.bind.apply(d,I),O=new R;return v&&n(O,v.prototype),O},o.apply(null,arguments)}function l(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function s(a){return Function.toString.call(a).indexOf("[native code]")!==-1}function n(a,t){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,d){return e.__proto__=d,e},n(a,t)}function g(a){return g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(f){return f.__proto__||Object.getPrototypeOf(f)},g(a)}var h=3,r="[eme]",u=function(){function a(f){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=a.CDMCleanupPromise?[a.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=b.logger.debug.bind(b.logger,r),this.log=b.logger.log.bind(b.logger,r),this.warn=b.logger.warn.bind(b.logger,r),this.error=b.logger.error.bind(b.logger,r),this.hls=f,this.config=f.config,this.registerListeners()}var t=a.prototype;return t.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null},t.registerListeners=function(){this.hls.on(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(F.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(F.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},t.unregisterListeners=function(){this.hls.off(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(F.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(F.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},t.getLicenseServerUrl=function(e){var d=this.config,E=d.drmSystems,v=d.widevineLicenseUrl,I=E[e];if(I)return I.licenseUrl;if(e===P.KeySystems.WIDEVINE&&v)return v;throw new Error('no license server URL configured for key-system "'+e+'"')},t.getServerCertificateUrl=function(e){var d=this.config.drmSystems,E=d[e];if(E)return E.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+e+'"]')},t.attemptKeySystemAccess=function(e){var d=this,E=this.hls.levels,v=function(C,M,B){return!!C&&B.indexOf(C)===M},I=E.map(function(O){return O.audioCodec}).filter(v),R=E.map(function(O){return O.videoCodec}).filter(v);return I.length+R.length===0&&R.push("avc1.42e01e"),new Promise(function(O,C){var M=function B(w){var N=w.shift();d.getMediaKeysPromise(N,I,R).then(function(W){return O({keySystem:N,mediaKeys:W})}).catch(function(W){w.length?B(w):W instanceof p?C(W):C(new p({type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:W,fatal:!0},W.message))})};M(e)})},t.requestMediaKeySystemAccess=function(e,d){var E=this.config.requestMediaKeySystemAccessFunc;if(typeof E!="function"){var v="Configured requestMediaKeySystemAccess is not a function "+E;return P.requestMediaKeySystemAccess===null&&self.location.protocol==="http:"&&(v="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(v))}return E(e,d)},t.getMediaKeysPromise=function(e,d,E){var v=this,I=(0,P.getSupportedMediaKeySystemConfigurations)(e,d,E,this.config.drmSystemOptions),R=this.keySystemAccessPromises[e],O=R==null?void 0:R.keySystemAccess;if(!O){this.log('Requesting encrypted media "'+e+'" key-system access with config: '+JSON.stringify(I)),O=this.requestMediaKeySystemAccess(e,I);var C=this.keySystemAccessPromises[e]={keySystemAccess:O};return O.catch(function(M){v.log('Failed to obtain access to key-system "'+e+'": '+M)}),O.then(function(M){v.log('Access for key-system "'+M.keySystem+'" obtained');var B=v.fetchServerCertificate(e);return v.log('Create media-keys for "'+e+'"'),C.mediaKeys=M.createMediaKeys().then(function(w){return v.log('Media-keys created for "'+e+'"'),B.then(function(N){return N?v.setMediaKeysServerCertificate(w,e,N):w})}),C.mediaKeys.catch(function(w){v.error('Failed to create media-keys for "'+e+'"}: '+w)}),C.mediaKeys})}return O.then(function(){return R.mediaKeys})},t.createMediaKeySessionContext=function(e){var d=e.decryptdata,E=e.keySystem,v=e.mediaKeys;console.assert(!!v,"mediaKeys is defined"),this.log('Creating key-system session "'+E+'" keyId: '+x.default.hexDump(d.keyId||[]));var I=v.createSession(),R={decryptdata:d,keySystem:E,mediaKeys:v,mediaKeysSession:I,keyStatus:"status-pending"};return this.mediaKeySessions.push(R),R},t.renewKeySession=function(e){var d=e.decryptdata;if(d.pssh){var E=this.createMediaKeySessionContext(e),v=this.getKeyIdString(d),I="cenc";this.keyIdToKeySessionPromise[v]=this.generateRequestWithPreferredKeySession(E,I,d.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)},t.getKeyIdString=function(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return x.default.hexDump(e.keyId)},t.updateKeySession=function(e,d){var E,v=e.mediaKeysSession;return this.log('Updating key-session "'+v.sessionId+'" for keyID '+x.default.hexDump(((E=e.decryptdata)===null||E===void 0?void 0:E.keyId)||[])+`
      } (data length: `+(d&&d.byteLength)+")"),v.update(d)},t.selectKeySystemFormat=function(e){var d=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+e.sn+" "+e.type+": "+e.level+") key formats "+d.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(d)),this.keyFormatPromise},t.getKeyFormatPromise=function(e){var d=this;return new Promise(function(E,v){var I=(0,P.getKeySystemsForConfig)(d.config),R=e.map(P.keySystemFormatToKeySystemDomain).filter(function(O){return!!O&&I.indexOf(O)!==-1});return d.getKeySystemSelectionPromise(R).then(function(O){var C=O.keySystem,M=(0,P.keySystemDomainToKeySystemFormat)(C);M?E(M):v(new Error('Unable to find format for key-system "'+C+'"'))}).catch(v)})},t.loadKey=function(e){var d=this,E=e.keyInfo.decryptdata,v=this.getKeyIdString(E),I="(keyId: "+v+' format: "'+E.keyFormat+'" method: '+E.method+" uri: "+E.uri+")";this.log("Starting session for key "+I);var R=this.keyIdToKeySessionPromise[v];return R||(R=this.keyIdToKeySessionPromise[v]=this.getKeySystemForKeyPromise(E).then(function(O){var C=O.keySystem,M=O.mediaKeys;return d.throwIfDestroyed(),d.log("Handle encrypted media sn: "+e.frag.sn+" "+e.frag.type+": "+e.frag.level+" using key "+I),d.attemptSetMediaKeys(C,M).then(function(){d.throwIfDestroyed();var B=d.createMediaKeySessionContext({keySystem:C,mediaKeys:M,decryptdata:E}),w="cenc";return d.generateRequestWithPreferredKeySession(B,w,E.pssh,"playlist-key")})}),R.catch(function(O){return d.handleError(O)})),R},t.throwIfDestroyed=function(e){if(!this.hls)throw new Error("invalid state")},t.handleError=function(e){this.hls&&(this.error(e.message),e instanceof p?this.hls.trigger(F.Events.ERROR,e.data):this.hls.trigger(F.Events.ERROR,{type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))},t.getKeySystemForKeyPromise=function(e){var d=this.getKeyIdString(e),E=this.keyIdToKeySessionPromise[d];if(!E){var v=(0,P.keySystemFormatToKeySystemDomain)(e.keyFormat),I=v?[v]:(0,P.getKeySystemsForConfig)(this.config);return this.attemptKeySystemAccess(I)}return E},t.getKeySystemSelectionPromise=function(e){if(e.length||(e=(0,P.getKeySystemsForConfig)(this.config)),e.length===0)throw new p({type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(e)},t._onMediaEncrypted=function(e){var d=this,E=e.initDataType,v=e.initData;if(this.debug('"'+e.type+'" event: init data type: "'+E+'"'),v!==null){var I,R;if(E==="sinf"&&this.config.drmSystems[P.KeySystems.FAIRPLAY]){var O=(0,_.bin2str)(new Uint8Array(v));try{var C=(0,A.base64Decode)(JSON.parse(O).sinf),M=(0,_.parseSinf)(new Uint8Array(C));if(!M)return;I=M.subarray(8,24),R=P.KeySystems.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{var B=(0,_.parsePssh)(v);if(B===null)return;B.version===0&&B.systemId===P.KeySystemIds.WIDEVINE&&B.data&&(I=B.data.subarray(8,24)),R=(0,P.keySystemIdToKeySystemDomain)(B.systemId)}if(!(!R||!I)){for(var w=x.default.hexDump(I),N=this.keyIdToKeySessionPromise,W=this.mediaKeySessions,G=N[w],H=function(J){var te=W[J],q=te.decryptdata;if(q.pssh||!q.keyId)return"continue";var Q=x.default.hexDump(q.keyId);if(w===Q||q.uri.replace(/-/g,"").indexOf(w)!==-1)return G=N[Q],delete N[Q],q.pssh=new Uint8Array(v),q.keyId=I,G=N[w]=G.then(function(){return d.generateRequestWithPreferredKeySession(te,E,v,"encrypted-event-key-match")}),"break"},$=0;$<W.length;$++){var Y=H($);if(Y!=="continue"&&Y==="break")break}G||(G=N[w]=this.getKeySystemSelectionPromise([R]).then(function(z){var J,te=z.keySystem,q=z.mediaKeys;d.throwIfDestroyed();var Q=new L.LevelKey("ISO-23001-7",w,(J=(0,P.keySystemDomainToKeySystemFormat)(te))!=null?J:"");return Q.pssh=new Uint8Array(v),Q.keyId=I,d.attemptSetMediaKeys(te,q).then(function(){d.throwIfDestroyed();var re=d.createMediaKeySessionContext({decryptdata:Q,keySystem:te,mediaKeys:q});return d.generateRequestWithPreferredKeySession(re,E,v,"encrypted-event-no-match")})})),G.catch(function(z){return d.handleError(z)})}}},t._onWaitingForKey=function(e){this.log('"'+e.type+'" event')},t.attemptSetMediaKeys=function(e,d){var E=this,v=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+e+'"');var I=Promise.all(v).then(function(){if(!E.media)throw new Error("Attempted to set mediaKeys without media element attached");return E.media.setMediaKeys(d)});return this.setMediaKeysQueue.push(I),I.then(function(){E.log('Media-keys set for "'+e+'"'),v.push(I),E.setMediaKeysQueue=E.setMediaKeysQueue.filter(function(R){return v.indexOf(R)===-1})})},t.generateRequestWithPreferredKeySession=function(e,d,E,v){var I,R,O=this,C=(I=this.config.drmSystems)===null||I===void 0||(R=I[e.keySystem])===null||R===void 0?void 0:R.generateRequest;if(C)try{var M=C.call(this.hls,d,E,e);if(!M)throw new Error("Invalid response from configured generateRequest filter");d=M.initDataType,E=e.decryptdata.pssh=M.initData?new Uint8Array(M.initData):null}catch(G){var B;if(this.warn(G.message),(B=this.hls)!==null&&B!==void 0&&B.config.debug)throw G}if(E===null)return this.log('Skipping key-session request for "'+v+'" (no initData)'),Promise.resolve(e);var w=this.getKeyIdString(e.decryptdata);this.log('Generating key-session request for "'+v+'": '+w+" (init data type: "+d+" length: "+(E?E.byteLength:null)+")");var N=new(c());e.mediaKeysSession.onmessage=function(G){var H=e.mediaKeysSession;if(!H){N.emit("error",new Error("invalid state"));return}var $=G.messageType,Y=G.message;O.log('"'+$+'" message event for session "'+H.sessionId+'" message size: '+Y.byteLength),$==="license-request"||$==="license-renewal"?O.renewLicense(e,Y).catch(function(z){O.handleError(z),N.emit("error",z)}):$==="license-release"?e.keySystem===P.KeySystems.FAIRPLAY&&(O.updateKeySession(e,(0,k.strToUtf8array)("acknowledged")),O.removeSession(e)):O.warn('unhandled media key message type "'+$+'"')},e.mediaKeysSession.onkeystatuseschange=function(G){var H=e.mediaKeysSession;if(!H){N.emit("error",new Error("invalid state"));return}O.onKeyStatusChange(e);var $=e.keyStatus;N.emit("keyStatus",$),$==="expired"&&(O.warn(e.keySystem+" expired for key "+w),O.renewKeySession(e))};var W=new Promise(function(G,H){N.on("error",H),N.on("keyStatus",function($){$.startsWith("usable")?G():$==="output-restricted"?H(new p({type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):$==="internal-error"?H(new p({type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+$+'"')):$==="expired"?H(new Error("key expired while generating request")):O.warn('unhandled key status change "'+$+'"')})});return e.mediaKeysSession.generateRequest(d,E).then(function(){var G;O.log('Request generated for key-session "'+((G=e.mediaKeysSession)===null||G===void 0?void 0:G.sessionId)+'" keyId: '+w)}).catch(function(G){throw new p({type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_NO_SESSION,error:G,fatal:!1},"Error generating key-session request: "+G)}).then(function(){return W}).catch(function(G){throw N.removeAllListeners(),O.removeSession(e),G}).then(function(){return N.removeAllListeners(),e})},t.onKeyStatusChange=function(e){var d=this;e.mediaKeysSession.keyStatuses.forEach(function(E,v){d.log('key status change "'+E+'" for keyStatuses keyId: '+x.default.hexDump("buffer"in v?new Uint8Array(v.buffer,v.byteOffset,v.byteLength):new Uint8Array(v))+" session keyId: "+x.default.hexDump(new Uint8Array(e.decryptdata.keyId||[]))+" uri: "+e.decryptdata.uri),e.keyStatus=E})},t.fetchServerCertificate=function(e){var d=this;return new Promise(function(E,v){var I=d.getServerCertificateUrl(e);if(!I)return E();d.log('Fetching serverCertificate for "'+e+'"');var R=new XMLHttpRequest;R.open("GET",I,!0),R.responseType="arraybuffer",R.onreadystatechange=function(){R.readyState===XMLHttpRequest.DONE&&(R.status===200?E(R.response):v(new p({type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:R},'"'+e+'" certificate request XHR failed ('+I+"). Status: "+R.status+" ("+R.statusText+")")))},R.send()})},t.setMediaKeysServerCertificate=function(e,d,E){var v=this;return new Promise(function(I,R){e.setServerCertificate(E).then(function(O){v.log("setServerCertificate "+(O?"success":"not supported by CDM")+" ("+(E==null?void 0:E.byteLength)+') on "'+d+'"'),I(e)}).catch(function(O){R(new p({type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:O,fatal:!0},O.message))})})},t.renewLicense=function(e,d){var E=this;return this.requestLicense(e,new Uint8Array(d)).then(function(v){return E.updateKeySession(e,new Uint8Array(v)).catch(function(I){throw new p({type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:I,fatal:!0},I.message)})})},t.setupLicenseXHR=function(e,d,E,v){var I=this,R=this.config.licenseXhrSetup;return R?Promise.resolve().then(function(){if(!E.decryptdata)throw new Error("Key removed");return R.call(I.hls,e,d,E,v)}).catch(function(O){if(!E.decryptdata)throw O;return e.open("POST",d,!0),R.call(I.hls,e,d,E,v)}).then(function(O){e.readyState||e.open("POST",d,!0);var C=O||v;return{xhr:e,licenseChallenge:C}}):(e.open("POST",d,!0),Promise.resolve({xhr:e,licenseChallenge:v}))},t.requestLicense=function(e,d){var E=this;return new Promise(function(v,I){var R=E.getLicenseServerUrl(e.keySystem);E.log("Sending license request to URL: "+R);var O=new XMLHttpRequest;O.responseType="arraybuffer",O.onreadystatechange=function(){if(!E.hls||!e.mediaKeysSession)return I(new Error("invalid state"));if(O.readyState===4)if(O.status===200){E._requestLicenseFailureCount=0;var C=O.response;E.log("License received "+(C instanceof ArrayBuffer?C.byteLength:C));var M=E.config.licenseResponseCallback;if(M)try{C=M.call(E.hls,O,R,e)}catch(w){E.error(w)}v(C)}else if(E._requestLicenseFailureCount++,E._requestLicenseFailureCount>h||O.status>=400&&O.status<500)I(new p({type:D.ErrorTypes.KEY_SYSTEM_ERROR,details:D.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:O},"License Request XHR failed ("+R+"). Status: "+O.status+" ("+O.statusText+")"));else{var B=h-E._requestLicenseFailureCount+1;E.warn("Retrying license request, "+B+" attempts left"),E.requestLicense(e,d).then(v,I)}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=O,E.setupLicenseXHR(O,R,e,d).then(function(C){var M=C.xhr,B=C.licenseChallenge;M.send(B)})})},t.onMediaAttached=function(e,d){if(this.config.emeEnabled){var E=d.media;this.media=E,E.addEventListener("encrypted",this.onMediaEncrypted),E.addEventListener("waitingforkey",this.onWaitingForKey)}},t.onMediaDetached=function(){var e=this,d=this.media,E=this.mediaKeySessions;d&&(d.removeEventListener("encrypted",this.onMediaEncrypted),d.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},L.LevelKey.clearKeyUriToKeyIdMap();var v=E.length;a.CDMCleanupPromise=Promise.all(E.map(function(I){return e.removeSession(I)}).concat(d==null?void 0:d.setMediaKeys(null).catch(function(I){e.log("Could not clear media keys: "+I+". media.src: "+(d==null?void 0:d.src))}))).then(function(){v&&(e.log("finished closing key sessions and clearing media keys"),E.length=0)}).catch(function(I){e.log("Could not close sessions and clear media keys: "+I+". media.src: "+(d==null?void 0:d.src))})},t.onManifestLoaded=function(e,d){var E=d.sessionKeys;if(!(!E||!this.config.emeEnabled)&&!this.keyFormatPromise){var v=E.reduce(function(I,R){return I.indexOf(R.keyFormat)===-1&&I.push(R.keyFormat),I},[]);this.log("Selecting key-system from session-keys "+v.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(v)}},t.removeSession=function(e){var d=this,E=e.mediaKeysSession,v=e.licenseXhr;if(E){this.log("Remove licenses and keys and close session "+E.sessionId),E.onmessage=null,E.onkeystatuseschange=null,v&&v.readyState!==XMLHttpRequest.DONE&&v.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;var I=this.mediaKeySessions.indexOf(e);return I>-1&&this.mediaKeySessions.splice(I,1),E.remove().catch(function(R){d.log("Could not remove session: "+R)}).then(function(){return E.close()}).catch(function(R){d.log("Could not close session: "+R)})}},a}();u.CDMCleanupPromise=void 0;var p=function(a){y(t,a);function t(f,e){var d;return d=a.call(this,e)||this,d.data=void 0,d.data=f,f.err=f.error,d}return t}(m(Error));const i=u},"./src/controller/fps-controller.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>P});var F=S("./src/events.ts"),D=S("./src/utils/logger.ts"),b=function(){function k(L){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=L,this.registerListeners()}var A=k.prototype;return A.setStreamController=function(x){this.streamController=x},A.registerListeners=function(){this.hls.on(F.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},A.unregisterListeners=function(){this.hls.off(F.Events.MEDIA_ATTACHING,this.onMediaAttaching)},A.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},A.onMediaAttaching=function(x,_){var T=this.hls.config;if(T.capLevelOnFPSDrop){var c=_.media instanceof self.HTMLVideoElement?_.media:null;this.media=c,c&&typeof c.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),T.fpsDroppedMonitoringPeriod)}},A.checkFPS=function(x,_,T){var c=performance.now();if(_){if(this.lastTime){var y=c-this.lastTime,m=T-this.lastDroppedFrames,o=_-this.lastDecodedFrames,l=1e3*m/y,s=this.hls;if(s.trigger(F.Events.FPS_DROP,{currentDropped:m,currentDecoded:o,totalDroppedFrames:T}),l>0&&m>s.config.fpsDroppedMonitoringThreshold*o){var n=s.currentLevel;D.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+n),n>0&&(s.autoLevelCapping===-1||s.autoLevelCapping>=n)&&(n=n-1,s.trigger(F.Events.FPS_DROP_LEVEL_CAPPING,{level:n,droppedLevel:s.currentLevel}),s.autoLevelCapping=n,this.streamController.nextLevelSwitch())}}this.lastTime=c,this.lastDroppedFrames=T,this.lastDecodedFrames=_}},A.checkFPSInterval=function(){var x=this.media;if(x)if(this.isVideoPlaybackQualityAvailable){var _=x.getVideoPlaybackQuality();this.checkFPS(x,_.totalVideoFrames,_.droppedVideoFrames)}else this.checkFPS(x,x.webkitDecodedFrameCount,x.webkitDroppedFrameCount)},k}();const P=b},"./src/controller/fragment-finders.ts":(V,U,S)=>{S.r(U),S.d(U,{findFragWithCC:()=>L,findFragmentByPDT:()=>b,findFragmentByPTS:()=>P,fragmentWithinToleranceTest:()=>k,pdtWithinToleranceTest:()=>A});var F=S("./src/polyfills/number.ts"),D=S("./src/utils/binary-search.ts");function b(x,_,T){if(_===null||!Array.isArray(x)||!x.length||!(0,F.isFiniteNumber)(_))return null;var c=x[0].programDateTime;if(_<(c||0))return null;var y=x[x.length-1].endProgramDateTime;if(_>=(y||0))return null;T=T||0;for(var m=0;m<x.length;++m){var o=x[m];if(A(_,T,o))return o}return null}function P(x,_,T,c){T===void 0&&(T=0),c===void 0&&(c=0);var y=null;if(x?y=_[x.sn-_[0].sn+1]||null:T===0&&_[0].start===0&&(y=_[0]),y&&k(T,c,y)===0)return y;var m=D.default.search(_,k.bind(null,T,c));return m&&(m!==x||!y)?m:y}function k(x,_,T){if(x===void 0&&(x=0),_===void 0&&(_=0),T.start<=x&&T.start+T.duration>x)return 0;var c=Math.min(_,T.duration+(T.deltaPTS?T.deltaPTS:0));return T.start+T.duration-c<=x?1:T.start-c>x&&T.start?-1:0}function A(x,_,T){var c=Math.min(_,T.duration+(T.deltaPTS?T.deltaPTS:0))*1e3,y=T.endProgramDateTime||0;return y-c>x}function L(x,_){return D.default.search(x,function(T){return T.cc<_?1:T.cc>_?-1:0})}},"./src/controller/fragment-tracker.ts":(V,U,S)=>{S.r(U),S.d(U,{FragmentState:()=>b,FragmentTracker:()=>P});var F=S("./src/events.ts"),D=S("./src/types/loader.ts"),b;(function(L){L.NOT_LOADED="NOT_LOADED",L.APPENDING="APPENDING",L.PARTIAL="PARTIAL",L.OK="OK"})(b||(b={}));var P=function(){function L(_){this.activeFragment=null,this.activeParts=null,this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=_,this._registerListeners()}var x=L.prototype;return x._registerListeners=function(){var T=this.hls;T.on(F.Events.BUFFER_APPENDED,this.onBufferAppended,this),T.on(F.Events.FRAG_BUFFERED,this.onFragBuffered,this),T.on(F.Events.FRAG_LOADED,this.onFragLoaded,this)},x._unregisterListeners=function(){var T=this.hls;T.off(F.Events.BUFFER_APPENDED,this.onBufferAppended,this),T.off(F.Events.FRAG_BUFFERED,this.onFragBuffered,this),T.off(F.Events.FRAG_LOADED,this.onFragLoaded,this)},x.destroy=function(){this._unregisterListeners(),this.fragments=this.endListFragments=this.timeRanges=this.activeFragment=this.activeParts=null},x.getAppendedFrag=function(T,c){if(c===D.PlaylistLevelType.MAIN){var y=this.activeFragment,m=this.activeParts;if(!y)return null;if(m)for(var o=m.length;o--;){var l=m[o],s=l?l.end:y.appendedPTS;if(l.start<=T&&s!==void 0&&T<=s)return o>9&&(this.activeParts=m.slice(o-9)),l}else if(y.start<=T&&y.appendedPTS!==void 0&&T<=y.appendedPTS)return y}return this.getBufferedFrag(T,c)},x.getBufferedFrag=function(T,c){for(var y=this.fragments,m=Object.keys(y),o=m.length;o--;){var l=y[m[o]];if((l==null?void 0:l.body.type)===c&&l.buffered){var s=l.body;if(s.start<=T&&T<=s.end)return s}}return null},x.detectEvictedFragments=function(T,c,y){var m=this;this.timeRanges&&(this.timeRanges[T]=c),Object.keys(this.fragments).forEach(function(o){var l=m.fragments[o];if(l){if(!l.buffered&&!l.loaded){l.body.type===y&&m.removeFragment(l.body);return}var s=l.range[T];s&&s.time.some(function(n){var g=!m.isTimeBuffered(n.startPTS,n.endPTS,c);return g&&m.removeFragment(l.body),g})}})},x.detectPartialFragments=function(T){var c=this,y=this.timeRanges,m=T.frag,o=T.part;if(!(!y||m.sn==="initSegment")){var l=A(m),s=this.fragments[l];s&&(Object.keys(y).forEach(function(n){var g=m.elementaryStreams[n];if(g){var h=y[n],r=o!==null||g.partial===!0;s.range[n]=c.getBufferedTimes(m,o,r,h)}}),s.loaded=null,Object.keys(s.range).length?(s.buffered=!0,s.body.endList&&(this.endListFragments[s.body.type]=s)):this.removeFragment(s.body))}},x.fragBuffered=function(T){var c=A(T),y=this.fragments[c];y&&(y.loaded=null,y.buffered=!0)},x.getBufferedTimes=function(T,c,y,m){for(var o={time:[],partial:y},l=c?c.start:T.start,s=c?c.end:T.end,n=T.minEndPTS||s,g=T.maxStartPTS||l,h=0;h<m.length;h++){var r=m.start(h)-this.bufferPadding,u=m.end(h)+this.bufferPadding;if(g>=r&&n<=u){o.time.push({startPTS:Math.max(l,m.start(h)),endPTS:Math.min(s,m.end(h))});break}else if(l<u&&s>r)o.partial=!0,o.time.push({startPTS:Math.max(l,m.start(h)),endPTS:Math.min(s,m.end(h))});else if(s<=r)break}return o},x.getPartialFragment=function(T){var c=null,y,m,o,l=0,s=this.bufferPadding,n=this.fragments;return Object.keys(n).forEach(function(g){var h=n[g];h&&k(h)&&(m=h.body.start-s,o=h.body.end+s,T>=m&&T<=o&&(y=Math.min(T-m,o-T),l<=y&&(c=h.body,l=y)))}),c},x.isEndListAppended=function(T){var c=this.endListFragments[T];return c!==void 0&&(c.buffered||k(c))},x.getState=function(T){var c=A(T),y=this.fragments[c];return y?y.buffered?k(y)?b.PARTIAL:b.OK:b.APPENDING:b.NOT_LOADED},x.isTimeBuffered=function(T,c,y){for(var m,o,l=0;l<y.length;l++){if(m=y.start(l)-this.bufferPadding,o=y.end(l)+this.bufferPadding,T>=m&&c<=o)return!0;if(c<=m)return!1}return!1},x.onFragLoaded=function(T,c){var y=c.frag,m=c.part;if(!(y.sn==="initSegment"||y.bitrateTest||m)){var o=A(y);this.fragments[o]={body:y,loaded:c,buffered:!1,range:Object.create(null)}}},x.onBufferAppended=function(T,c){var y=this,m=c.frag,o=c.part,l=c.timeRanges;if(m.type===D.PlaylistLevelType.MAIN)if(this.activeFragment!==m&&(this.activeFragment=m,m.appendedPTS=void 0),o){var s=this.activeParts;s||(this.activeParts=s=[]),s.push(o)}else this.activeParts=null;this.timeRanges=l,Object.keys(l).forEach(function(n){var g=l[n];if(y.detectEvictedFragments(n,g),!o&&m.type===D.PlaylistLevelType.MAIN){var h=m.elementaryStreams[n];if(!h)return;for(var r=0;r<g.length;r++){var u=g.end(r);u<=h.endPTS&&u>h.startPTS?m.appendedPTS=Math.max(u,m.appendedPTS||0):m.appendedPTS=h.endPTS}}})},x.onFragBuffered=function(T,c){this.detectPartialFragments(c)},x.hasFragment=function(T){var c=A(T);return!!this.fragments[c]},x.removeFragmentsInRange=function(T,c,y){var m=this;Object.keys(this.fragments).forEach(function(o){var l=m.fragments[o];if(l&&l.buffered){var s=l.body;s.type===y&&s.start<c&&s.end>T&&m.removeFragment(s)}})},x.removeFragment=function(T){var c=A(T);T.stats.loaded=0,T.clearElementaryStreamInfo(),T.appendedPTS=void 0,delete this.fragments[c],T.endList&&delete this.endListFragments[T.type]},x.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activeFragment=null,this.activeParts=null},L}();function k(L){var x,_;return L.buffered&&(((x=L.range.video)===null||x===void 0?void 0:x.partial)||((_=L.range.audio)===null||_===void 0?void 0:_.partial))}function A(L){return L.type+"_"+L.level+"_"+L.urlId+"_"+L.sn}},"./src/controller/gap-controller.ts":(V,U,S)=>{S.r(U),S.d(U,{MAX_START_GAP_JUMP:()=>A,SKIP_BUFFER_HOLE_STEP_SECONDS:()=>L,SKIP_BUFFER_RANGE_START:()=>x,STALL_MINIMUM_DURATION_MS:()=>k,default:()=>_});var F=S("./src/utils/buffer-helper.ts"),D=S("./src/errors.ts"),b=S("./src/events.ts"),P=S("./src/utils/logger.ts"),k=250,A=2,L=.1,x=.05,_=function(){function T(y,m,o,l){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=y,this.media=m,this.fragmentTracker=o,this.hls=l}var c=T.prototype;return c.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},c.poll=function(m,o){var l=this.config,s=this.media,n=this.stalled;if(s!==null){var g=s.currentTime,h=s.seeking,r=this.seeking&&!h,u=!this.seeking&&h;if(this.seeking=h,g!==m){if(this.moved=!0,n!==null){if(this.stallReported){var p=self.performance.now()-n;P.logger.warn("playback not stuck anymore @"+g+", after "+Math.round(p)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((u||r)&&(this.stalled=null),!(s.paused&&!h||s.ended||s.playbackRate===0||!F.BufferHelper.getBuffered(s).length)){var i=F.BufferHelper.bufferInfo(s,g,0),a=i.len>0,t=i.nextStart||0;if(!(!a&&!t)){if(h){var f=i.len>A,e=!t||o&&o.start<=g||t-g>A&&!this.fragmentTracker.getPartialFragment(g);if(f||e)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var d,E=Math.max(t,i.start||0)-g,v=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,I=v==null||(d=v.details)===null||d===void 0?void 0:d.live,R=I?v.details.targetduration*2:A;if(E>0&&E<=R){this._trySkipBufferHole(null);return}}var O=self.performance.now();if(n===null){this.stalled=O;return}var C=O-n;if(!(!h&&C>=k&&(this._reportStall(i),!this.media))){var M=F.BufferHelper.bufferInfo(s,g,l.maxBufferHole);this._tryFixBufferStall(M,C)}}}}},c._tryFixBufferStall=function(m,o){var l=this.config,s=this.fragmentTracker,n=this.media;if(n!==null){var g=n.currentTime,h=s.getPartialFragment(g);if(h){var r=this._trySkipBufferHole(h);if(r||!this.media)return}m.len>l.maxBufferHole&&o>l.highBufferWatchdogPeriod*1e3&&(P.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},c._reportStall=function(m){var o=this.hls,l=this.media,s=this.stallReported;!s&&l&&(this.stallReported=!0,P.logger.warn("Playback stalling at @"+l.currentTime+" due to low buffer ("+JSON.stringify(m)+")"),o.trigger(b.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:m.len}))},c._trySkipBufferHole=function(m){var o=this.config,l=this.hls,s=this.media;if(s===null)return 0;for(var n=s.currentTime,g=0,h=F.BufferHelper.getBuffered(s),r=0;r<h.length;r++){var u=h.start(r);if(n+o.maxBufferHole>=g&&n<u){var p=Math.max(u+x,s.currentTime+L);return P.logger.warn("skipping hole, adjusting currentTime from "+n+" to "+p),this.moved=!0,this.stalled=null,s.currentTime=p,m&&l.trigger(b.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+n+" to "+p,frag:m}),p}g=h.end(r)}return 0},c._tryNudgeBuffer=function(){var m=this.config,o=this.hls,l=this.media,s=this.nudgeRetry;if(l!==null){var n=l.currentTime;if(this.nudgeRetry++,s<m.nudgeMaxRetry){var g=n+(s+1)*m.nudgeOffset;P.logger.warn("Nudging 'currentTime' from "+n+" to "+g),l.currentTime=g,o.trigger(b.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else P.logger.error("Playhead still not moving while enough data buffered @"+n+" after "+m.nudgeMaxRetry+" nudges"),o.trigger(b.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},T}()},"./src/controller/id3-track-controller.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>m});var F=S("./src/polyfills/number.ts"),D=S("./src/events.ts"),b=S("./src/utils/texttrack-utils.ts"),P=S("./src/demux/id3.ts"),k=S("./src/loader/date-range.ts"),A=S("./src/types/demuxer.ts"),L=.25;function x(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var _=function(){var o=x();try{new o(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function T(o,l){return o.getTime()/1e3-l}function c(o){return Uint8Array.from(o.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var y=function(){function o(s){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=s,this._registerListeners()}var l=o.prototype;return l.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},l._registerListeners=function(){var n=this.hls;n.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(D.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),n.on(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),n.on(D.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},l._unregisterListeners=function(){var n=this.hls;n.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(D.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),n.off(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),n.off(D.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},l.onMediaAttached=function(n,g){this.media=g.media},l.onMediaDetaching=function(){this.id3Track&&((0,b.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},l.onManifestLoading=function(){this.dateRangeCuesAppended={}},l.createTrack=function(n){var g=this.getID3Track(n.textTracks);return g.mode="hidden",g},l.getID3Track=function(n){if(this.media){for(var g=0;g<n.length;g++){var h=n[g];if(h.kind==="metadata"&&h.label==="id3")return(0,b.sendAddTrackEvent)(h,this.media),h}return this.media.addTextTrack("metadata","id3")}},l.onFragParsingMetadata=function(n,g){if(this.media){var h=this.hls.config,r=h.enableEmsgMetadataCues,u=h.enableID3MetadataCues;if(!(!r&&!u)){var p=g.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var i=x(),a=0;a<p.length;a++){var t=p[a].type;if(!(t===A.MetadataSchema.emsg&&!r||!u)){var f=P.getID3Frames(p[a].data);if(f){var e=p[a].pts,d=e+p[a].duration;d>_&&(d=_);var E=d-e;E<=0&&(d=e+L);for(var v=0;v<f.length;v++){var I=f[v];if(!P.isTimeStampFrame(I)){this.updateId3CueEnds(e);var R=new i(e,d,"");R.value=I,t&&(R.type=t),this.id3Track.addCue(R)}}}}}}}},l.updateId3CueEnds=function(n){var g,h=(g=this.id3Track)===null||g===void 0?void 0:g.cues;if(h)for(var r=h.length;r--;){var u=h[r];u.startTime<n&&u.endTime===_&&(u.endTime=n)}},l.onBufferFlushing=function(n,g){var h=g.startOffset,r=g.endOffset,u=g.type,p=this.id3Track,i=this.hls;if(i){var a=i.config,t=a.enableEmsgMetadataCues,f=a.enableID3MetadataCues;if(p&&(t||f)){var e;u==="audio"?e=function(E){return E.type===A.MetadataSchema.audioId3&&f}:u==="video"?e=function(E){return E.type===A.MetadataSchema.emsg&&t}:e=function(E){return E.type===A.MetadataSchema.audioId3&&f||E.type===A.MetadataSchema.emsg&&t},(0,b.removeCuesInRange)(p,h,r,e)}}},l.onLevelUpdated=function(n,g){var h=this,r=g.details;if(!(!this.media||!r.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var u=this.dateRangeCuesAppended,p=this.id3Track,i=r.dateRanges,a=Object.keys(i);if(p)for(var t=Object.keys(u).filter(function(O){return!a.includes(O)}),f=function(C){var M=t[C];Object.keys(u[M].cues).forEach(function(B){p.removeCue(u[M].cues[B])}),delete u[M]},e=t.length;e--;)f(e);var d=r.fragments[r.fragments.length-1];if(!(a.length===0||!(0,F.isFiniteNumber)(d==null?void 0:d.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var E=d.programDateTime/1e3-d.start,v=x(),I=function(C){var M=a[C],B=i[M],w=u[M],N=(w==null?void 0:w.cues)||{},W=(w==null?void 0:w.durationKnown)||!1,G=T(B.startDate,E),H=_,$=B.endDate;if($)H=T($,E),W=!0;else if(B.endOnNext&&!W){var Y=a.reduce(function(re,ae){var se=i[ae];return se.class===B.class&&se.id!==ae&&se.startDate>B.startDate&&re.push(se),re},[]).sort(function(re,ae){return re.startDate.getTime()-ae.startDate.getTime()})[0];Y&&(H=T(Y.startDate,E),W=!0)}for(var z=Object.keys(B.attr),J=0;J<z.length;J++){var te=z[J];if(!(te===k.DateRangeAttribute.ID||te===k.DateRangeAttribute.CLASS||te===k.DateRangeAttribute.START_DATE||te===k.DateRangeAttribute.DURATION||te===k.DateRangeAttribute.END_DATE||te===k.DateRangeAttribute.END_ON_NEXT)){var q=N[te];if(q)W&&!w.durationKnown&&(q.endTime=H);else{var Q=B.attr[te];q=new v(G,H,""),(te===k.DateRangeAttribute.SCTE35_OUT||te===k.DateRangeAttribute.SCTE35_IN)&&(Q=c(Q)),q.value={key:te,data:Q},q.type=A.MetadataSchema.dateRange,h.id3Track.addCue(q),N[te]=q}}}u[M]={cues:N,dateRange:B,durationKnown:W}},R=0;R<a.length;R++)I(R)}}},o}();const m=y},"./src/controller/latency-controller.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>x});var F=S("./src/errors.ts"),D=S("./src/events.ts"),b=S("./src/utils/logger.ts");function P(_,T){for(var c=0;c<T.length;c++){var y=T[c];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(_,A(y.key),y)}}function k(_,T,c){return T&&P(_.prototype,T),c&&P(_,c),Object.defineProperty(_,"prototype",{writable:!1}),_}function A(_){var T=L(_,"string");return typeof T=="symbol"?T:String(T)}function L(_,T){if(typeof _!="object"||_===null)return _;var c=_[Symbol.toPrimitive];if(c!==void 0){var y=c.call(_,T||"default");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return(T==="string"?String:Number)(_)}var x=function(){function _(c){var y=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return y.timeupdate()},this.hls=c,this.config=c.config,this.registerListeners()}var T=_.prototype;return T.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},T.registerListeners=function(){this.hls.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(D.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(D.Events.ERROR,this.onError,this)},T.unregisterListeners=function(){this.hls.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(D.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(D.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(D.Events.ERROR,this.onError)},T.onMediaAttached=function(y,m){this.media=m.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},T.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},T.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},T.onLevelUpdated=function(y,m){var o=m.details;this.levelDetails=o,o.advanced&&this.timeupdate(),!o.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},T.onError=function(y,m){m.details===F.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,b.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},T.timeupdate=function(){var y=this.media,m=this.levelDetails;if(!(!y||!m)){this.currentTime=y.currentTime;var o=this.computeLatency();if(o!==null){this._latency=o;var l=this.config,s=l.lowLatencyMode,n=l.maxLiveSyncPlaybackRate;if(!(!s||n===1)){var g=this.targetLatency;if(g!==null){var h=o-g,r=Math.min(this.maxLatency,g+m.targetduration),u=h<r;if(m.live&&u&&h>.05&&this.forwardBufferLength>1){var p=Math.min(2,Math.max(1,n)),i=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20;y.playbackRate=Math.min(p,Math.max(1,i))}else y.playbackRate!==1&&y.playbackRate!==0&&(y.playbackRate=1)}}}}},T.estimateLiveEdge=function(){var y=this.levelDetails;return y===null?null:y.edge+y.age},T.computeLatency=function(){var y=this.estimateLiveEdge();return y===null?null:y-this.currentTime},k(_,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var y=this.config,m=this.levelDetails;return y.liveMaxLatencyDuration!==void 0?y.liveMaxLatencyDuration:m?y.liveMaxLatencyDurationCount*m.targetduration:0}},{key:"targetLatency",get:function(){var y=this.levelDetails;if(y===null)return null;var m=y.holdBack,o=y.partHoldBack,l=y.targetduration,s=this.config,n=s.liveSyncDuration,g=s.liveSyncDurationCount,h=s.lowLatencyMode,r=this.hls.userConfig,u=h&&o||m;(r.liveSyncDuration||r.liveSyncDurationCount||u===0)&&(u=n!==void 0?n:g*l);var p=l,i=1;return u+Math.min(this.stallCount*i,p)}},{key:"liveSyncPosition",get:function(){var y=this.estimateLiveEdge(),m=this.targetLatency,o=this.levelDetails;if(y===null||m===null||o===null)return null;var l=o.edge,s=y-m-this.edgeStalled,n=l-o.totalduration,g=l-(this.config.lowLatencyMode&&o.partTarget||o.targetduration);return Math.min(Math.max(n,s),g)}},{key:"drift",get:function(){var y=this.levelDetails;return y===null?1:y.drift}},{key:"edgeStalled",get:function(){var y=this.levelDetails;if(y===null)return 0;var m=(this.config.lowLatencyMode&&y.partTarget||y.targetduration)*3;return Math.max(y.age-m,0)}},{key:"forwardBufferLength",get:function(){var y=this.media,m=this.levelDetails;if(!y||!m)return 0;var o=y.buffered.length;return(o?y.buffered.end(o-1):m.edge)-this.currentTime}}]),_}()},"./src/controller/level-controller.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>s});var F=S("./src/types/level.ts"),D=S("./src/events.ts"),b=S("./src/errors.ts"),P=S("./src/utils/codecs.ts"),k=S("./src/controller/level-helper.ts"),A=S("./src/controller/base-playlist-controller.ts"),L=S("./src/types/loader.ts");function x(){return x=Object.assign?Object.assign.bind():function(n){for(var g=1;g<arguments.length;g++){var h=arguments[g];for(var r in h)Object.prototype.hasOwnProperty.call(h,r)&&(n[r]=h[r])}return n},x.apply(this,arguments)}function _(n,g){for(var h=0;h<g.length;h++){var r=g[h];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,c(r.key),r)}}function T(n,g,h){return g&&_(n.prototype,g),h&&_(n,h),Object.defineProperty(n,"prototype",{writable:!1}),n}function c(n){var g=y(n,"string");return typeof g=="symbol"?g:String(g)}function y(n,g){if(typeof n!="object"||n===null)return n;var h=n[Symbol.toPrimitive];if(h!==void 0){var r=h.call(n,g||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(g==="string"?String:Number)(n)}function m(n,g){n.prototype=Object.create(g.prototype),n.prototype.constructor=n,o(n,g)}function o(n,g){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,u){return r.__proto__=u,r},o(n,g)}var l=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),s=function(n){m(g,n);function g(r){var u;return u=n.call(this,r,"[level-controller]")||this,u._levels=[],u._firstLevel=-1,u._startLevel=void 0,u.currentLevelIndex=-1,u.manualLevelIndex=-1,u.onParsedComplete=void 0,u._registerListeners(),u}var h=g.prototype;return h._registerListeners=function(){var u=this.hls;u.on(D.Events.MANIFEST_LOADED,this.onManifestLoaded,this),u.on(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.on(D.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),u.on(D.Events.FRAG_LOADED,this.onFragLoaded,this),u.on(D.Events.ERROR,this.onError,this)},h._unregisterListeners=function(){var u=this.hls;u.off(D.Events.MANIFEST_LOADED,this.onManifestLoaded,this),u.off(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.off(D.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),u.off(D.Events.FRAG_LOADED,this.onFragLoaded,this),u.off(D.Events.ERROR,this.onError,this)},h.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,n.prototype.destroy.call(this)},h.startLoad=function(){var u=this._levels;u.forEach(function(p){p.loadError=0}),n.prototype.startLoad.call(this)},h.onManifestLoaded=function(u,p){var i=[],a=[],t=[],f,e={},d,E=!1,v=!1,I=!1;if(p.levels.forEach(function(M){var B=M.attrs;E=E||!!(M.width&&M.height),v=v||!!M.videoCodec,I=I||!!M.audioCodec,l&&M.audioCodec&&M.audioCodec.indexOf("mp4a.40.34")!==-1&&(M.audioCodec=void 0);var w=M.bitrate+"-"+M.attrs.RESOLUTION+"-"+M.attrs.CODECS;d=e[w],d?d.url.push(M.url):(d=new F.Level(M),e[w]=d,i.push(d)),B&&(B.AUDIO&&(0,k.addGroupId)(d,"audio",B.AUDIO),B.SUBTITLES&&(0,k.addGroupId)(d,"text",B.SUBTITLES))}),(E||v)&&I&&(i=i.filter(function(M){var B=M.videoCodec,w=M.width,N=M.height;return!!B||!!(w&&N)})),i=i.filter(function(M){var B=M.audioCodec,w=M.videoCodec;return(!B||(0,P.isCodecSupportedInMp4)(B,"audio"))&&(!w||(0,P.isCodecSupportedInMp4)(w,"video"))}),p.audioTracks&&(a=p.audioTracks.filter(function(M){return!M.audioCodec||(0,P.isCodecSupportedInMp4)(M.audioCodec,"audio")}),(0,k.assignTrackIdsByGroup)(a)),p.subtitles&&(t=p.subtitles,(0,k.assignTrackIdsByGroup)(t)),i.length>0){f=i[0].bitrate,i.sort(function(M,B){return M.attrs["HDCP-LEVEL"]!==B.attrs["HDCP-LEVEL"]?(M.attrs["HDCP-LEVEL"]||"")>(B.attrs["HDCP-LEVEL"]||"")?1:-1:M.bitrate!==B.bitrate?M.bitrate-B.bitrate:M.attrs.SCORE!==B.attrs.SCORE?M.attrs.decimalFloatingPoint("SCORE")-B.attrs.decimalFloatingPoint("SCORE"):E&&M.height!==B.height?M.height-B.height:0}),this._levels=i;for(var R=0;R<i.length;R++)if(i[R].bitrate===f){this._firstLevel=R,this.log("manifest loaded, "+i.length+" level(s) found, first bitrate: "+f);break}var O=I&&!v,C={levels:i,audioTracks:a,subtitleTracks:t,sessionData:p.sessionData,sessionKeys:p.sessionKeys,firstLevel:this._firstLevel,stats:p.stats,audio:I,video:v,altAudio:!O&&a.some(function(M){return!!M.url})};this.hls.trigger(D.Events.MANIFEST_PARSED,C),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(D.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:p.url,reason:"no level with compatible codecs found in manifest"})},h.onError=function(u,p){var i,a;if(n.prototype.onError.call(this,u,p),!p.fatal){var t=p.context,f=this._levels[this.currentLevelIndex];if(t&&(t.type===L.PlaylistContextType.AUDIO_TRACK&&f.audioGroupIds&&t.groupId===f.audioGroupIds[f.urlId]||t.type===L.PlaylistContextType.SUBTITLE_TRACK&&f.textGroupIds&&t.groupId===f.textGroupIds[f.urlId])){this.redundantFailover(this.currentLevelIndex);return}var e=!1,d=!0,E;switch(p.details){case b.ErrorDetails.FRAG_LOAD_ERROR:case b.ErrorDetails.FRAG_LOAD_TIMEOUT:case b.ErrorDetails.KEY_LOAD_ERROR:case b.ErrorDetails.KEY_LOAD_TIMEOUT:if(p.frag){var v=p.frag.type===L.PlaylistLevelType.MAIN?p.frag.level:this.currentLevelIndex,I=this._levels[v];I?(I.fragmentError++,I.fragmentError>this.hls.config.fragLoadingMaxRetry&&(E=v)):E=v}break;case b.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{var R=f.attrs["HDCP-LEVEL"];R&&(this.hls.maxHdcpLevel=F.HdcpLevels[F.HdcpLevels.indexOf(R)-1],this.warn('Restricting playback to HDCP-LEVEL of "'+this.hls.maxHdcpLevel+'" or lower'))}case b.ErrorDetails.FRAG_PARSING_ERROR:case b.ErrorDetails.KEY_SYSTEM_NO_SESSION:E=((i=p.frag)===null||i===void 0?void 0:i.type)===L.PlaylistLevelType.MAIN?p.frag.level:this.currentLevelIndex,p.levelRetry=!1;break;case b.ErrorDetails.LEVEL_LOAD_ERROR:case b.ErrorDetails.LEVEL_LOAD_TIMEOUT:t&&(t.deliveryDirectives&&(d=!1),E=t.level),e=!0;break;case b.ErrorDetails.REMUX_ALLOC_ERROR:E=(a=p.level)!=null?a:this.currentLevelIndex,e=!0;break}E!==void 0&&this.recoverLevel(p,E,e,d)}},h.recoverLevel=function(u,p,i,a){var t=u.details,f=this._levels[p];if(f.loadError++,i){var e=this.retryLoadingOrFail(u);if(e)u.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(a){var d=f.url.length;if(d>1&&f.loadError<d)u.levelRetry=!0,this.redundantFailover(p);else if(this.manualLevelIndex===-1){for(var E=-1,v=this._levels,I=v.length;I--;){var R=(I+this.currentLevelIndex)%v.length;if(R!==this.currentLevelIndex&&v[R].loadError===0){E=R;break}}E>-1&&this.currentLevelIndex!==E?(this.warn(t+": switch to "+E),u.levelRetry=!0,this.hls.nextAutoLevel=E):u.levelRetry===!1&&(u.fatal=!0)}}},h.redundantFailover=function(u){var p=this._levels[u],i=p.url.length;if(i>1){var a=(p.urlId+1)%i;this.warn("Switching to redundant URL-id "+a),this._levels.forEach(function(t){t.urlId=a}),this.level=u}},h.onFragLoaded=function(u,p){var i=p.frag;if(i!==void 0&&i.type===L.PlaylistLevelType.MAIN){var a=this._levels[i.level];a!==void 0&&(a.fragmentError=0,a.loadError=0)}},h.onLevelLoaded=function(u,p){var i,a=p.level,t=p.details,f=this._levels[a];if(!f){var e;this.warn("Invalid level index "+a),(e=p.deliveryDirectives)!==null&&e!==void 0&&e.skip&&(t.deltaUpdateFailed=!0);return}a===this.currentLevelIndex?(f.fragmentError===0&&(f.loadError=0,this.retryCount=0),this.playlistLoaded(a,p,f.details)):(i=p.deliveryDirectives)!==null&&i!==void 0&&i.skip&&(t.deltaUpdateFailed=!0)},h.onAudioTrackSwitched=function(u,p){var i=this.hls.levels[this.currentLevelIndex];if(i&&i.audioGroupIds){for(var a=-1,t=this.hls.audioTracks[p.id].groupId,f=0;f<i.audioGroupIds.length;f++)if(i.audioGroupIds[f]===t){a=f;break}a!==i.urlId&&(i.urlId=a,this.startLoad())}},h.loadPlaylist=function(u){n.prototype.loadPlaylist.call(this);var p=this.currentLevelIndex,i=this._levels[p];if(this.canLoad&&i&&i.url.length>0){var a=i.urlId,t=i.url[a];if(u)try{t=u.addDirectives(t)}catch(f){this.warn("Could not construct new URL with HLS Delivery Directives: "+f)}this.log("Attempt loading level index "+p+((u==null?void 0:u.msn)!==void 0?" at sn "+u.msn+" part "+u.part:"")+" with URL-id "+a+" "+t),this.clearTimer(),this.hls.trigger(D.Events.LEVEL_LOADING,{url:t,level:p,id:a,deliveryDirectives:u||null})}},h.removeLevel=function(u,p){var i=function(f,e){return e!==p},a=this._levels.filter(function(t,f){return f!==u?!0:t.url.length>1&&p!==void 0?(t.url=t.url.filter(i),t.audioGroupIds&&(t.audioGroupIds=t.audioGroupIds.filter(i)),t.textGroupIds&&(t.textGroupIds=t.textGroupIds.filter(i)),t.urlId=0,!0):!1}).map(function(t,f){var e=t.details;return e!=null&&e.fragments&&e.fragments.forEach(function(d){d.level=f}),t});this._levels=a,this.hls.trigger(D.Events.LEVELS_UPDATED,{levels:a})},T(g,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(u){var p,i=this._levels;if(i.length!==0&&!(this.currentLevelIndex===u&&(p=i[u])!==null&&p!==void 0&&p.details)){if(u<0||u>=i.length){var a=u<0;if(this.hls.trigger(D.Events.ERROR,{type:b.ErrorTypes.OTHER_ERROR,details:b.ErrorDetails.LEVEL_SWITCH_ERROR,level:u,fatal:a,reason:"invalid level idx"}),a)return;u=Math.min(u,i.length-1)}this.clearTimer();var t=this.currentLevelIndex,f=i[t],e=i[u];this.log("switching to level "+u+" from "+t),this.currentLevelIndex=u;var d=x({},e,{level:u,maxBitrate:e.maxBitrate,uri:e.uri,urlId:e.urlId});delete d._urlId,this.hls.trigger(D.Events.LEVEL_SWITCHING,d);var E=e.details;if(!E||E.live){var v=this.switchParams(e.uri,f==null?void 0:f.details);this.loadPlaylist(v)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(u){this.manualLevelIndex=u,this._startLevel===void 0&&(this._startLevel=u),u!==-1&&(this.level=u)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(u){this._firstLevel=u}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var u=this.hls.config.startLevel;return u!==void 0?u:this._firstLevel}else return this._startLevel},set:function(u){this._startLevel=u}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(u){this.level=u,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=u)}}]),g}(A.default)},"./src/controller/level-helper.ts":(V,U,S)=>{S.r(U),S.d(U,{addGroupId:()=>k,addSliding:()=>l,adjustSliding:()=>o,assignTrackIdsByGroup:()=>A,computeReloadInterval:()=>s,getFragmentWithSN:()=>n,getPartWith:()=>g,mapFragmentIntersection:()=>m,mapPartIntersection:()=>y,mergeDetails:()=>T,updateFragPTSDTS:()=>_,updatePTS:()=>L});var F=S("./src/polyfills/number.ts"),D=S("./src/utils/logger.ts"),b=S("./src/loader/date-range.ts");function P(){return P=Object.assign?Object.assign.bind():function(h){for(var r=1;r<arguments.length;r++){var u=arguments[r];for(var p in u)Object.prototype.hasOwnProperty.call(u,p)&&(h[p]=u[p])}return h},P.apply(this,arguments)}function k(h,r,u){switch(r){case"audio":h.audioGroupIds||(h.audioGroupIds=[]),h.audioGroupIds.push(u);break;case"text":h.textGroupIds||(h.textGroupIds=[]),h.textGroupIds.push(u);break}}function A(h){var r={};h.forEach(function(u){var p=u.groupId||"";u.id=r[p]=r[p]||0,r[p]++})}function L(h,r,u){var p=h[r],i=h[u];x(p,i)}function x(h,r){var u=r.startPTS;if((0,F.isFiniteNumber)(u)){var p=0,i;r.sn>h.sn?(p=u-h.start,i=h):(p=h.start-u,i=r),i.duration!==p&&(i.duration=p)}else if(r.sn>h.sn){var a=h.cc===r.cc;a&&h.minEndPTS?r.start=h.start+(h.minEndPTS-h.start):r.start=h.start+h.duration}else r.start=Math.max(h.start-r.duration,0)}function _(h,r,u,p,i,a){var t=p-u;t<=0&&(D.logger.warn("Fragment should have a positive duration",r),p=u+r.duration,a=i+r.duration);var f=u,e=p,d=r.startPTS,E=r.endPTS;if((0,F.isFiniteNumber)(d)){var v=Math.abs(d-u);(0,F.isFiniteNumber)(r.deltaPTS)?r.deltaPTS=Math.max(v,r.deltaPTS):r.deltaPTS=v,f=Math.max(u,d),u=Math.min(u,d),i=Math.min(i,r.startDTS),e=Math.min(p,E),p=Math.max(p,E),a=Math.max(a,r.endDTS)}r.duration=p-u;var I=u-r.start;r.start=r.startPTS=u,r.maxStartPTS=f,r.startDTS=i,r.endPTS=p,r.minEndPTS=e,r.endDTS=a;var R=r.sn;if(!h||R<h.startSN||R>h.endSN)return 0;var O,C=R-h.startSN,M=h.fragments;for(M[C]=r,O=C;O>0;O--)x(M[O],M[O-1]);for(O=C;O<M.length-1;O++)x(M[O],M[O+1]);return h.fragmentHint&&x(M[M.length-1],h.fragmentHint),h.PTSKnown=h.alignedSliding=!0,I}function T(h,r){for(var u=null,p=h.fragments,i=p.length-1;i>=0;i--){var a=p[i].initSegment;if(a){u=a;break}}h.fragmentHint&&delete h.fragmentHint.endPTS;var t=0,f;if(m(h,r,function(O,C){O.relurl&&(t=O.cc-C.cc),(0,F.isFiniteNumber)(O.startPTS)&&(0,F.isFiniteNumber)(O.endPTS)&&(C.start=C.startPTS=O.startPTS,C.startDTS=O.startDTS,C.appendedPTS=O.appendedPTS,C.maxStartPTS=O.maxStartPTS,C.endPTS=O.endPTS,C.endDTS=O.endDTS,C.minEndPTS=O.minEndPTS,C.duration=O.endPTS-O.startPTS,C.duration&&(f=C),r.PTSKnown=r.alignedSliding=!0),C.elementaryStreams=O.elementaryStreams,C.loader=O.loader,C.stats=O.stats,C.urlId=O.urlId,O.initSegment&&(C.initSegment=O.initSegment,u=O.initSegment)}),u){var e=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments;e.forEach(function(O){var C;(!O.initSegment||O.initSegment.relurl===((C=u)===null||C===void 0?void 0:C.relurl))&&(O.initSegment=u)})}if(r.skippedSegments)if(r.deltaUpdateFailed=r.fragments.some(function(O){return!O}),r.deltaUpdateFailed){D.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var d=r.skippedSegments;d--;)r.fragments.shift();r.startSN=r.fragments[0].sn,r.startCC=r.fragments[0].cc}else r.canSkipDateRanges&&(r.dateRanges=c(h.dateRanges,r.dateRanges,r.recentlyRemovedDateranges));var E=r.fragments;if(t){D.logger.warn("discontinuity sliding from playlist, take drift into account");for(var v=0;v<E.length;v++)E[v].cc+=t}r.skippedSegments&&(r.startCC=r.fragments[0].cc),y(h.partList,r.partList,function(O,C){C.elementaryStreams=O.elementaryStreams,C.stats=O.stats}),f?_(r,f,f.startPTS,f.endPTS,f.startDTS,f.endDTS):o(h,r),E.length&&(r.totalduration=r.edge-E[0].start),r.driftStartTime=h.driftStartTime,r.driftStart=h.driftStart;var I=r.advancedDateTime;if(r.advanced&&I){var R=r.edge;r.driftStart||(r.driftStartTime=I,r.driftStart=R),r.driftEndTime=I,r.driftEnd=R}else r.driftEndTime=h.driftEndTime,r.driftEnd=h.driftEnd,r.advancedDateTime=h.advancedDateTime}function c(h,r,u){var p=P({},h);return u&&u.forEach(function(i){delete p[i]}),Object.keys(r).forEach(function(i){var a=new b.DateRange(r[i].attr,p[i]);a.isValid?p[i]=a:D.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(r[i].attr)+'"')}),p}function y(h,r,u){if(h&&r)for(var p=0,i=0,a=h.length;i<=a;i++){var t=h[i],f=r[i+p];t&&f&&t.index===f.index&&t.fragment.sn===f.fragment.sn?u(t,f):p--}}function m(h,r,u){for(var p=r.skippedSegments,i=Math.max(h.startSN,r.startSN)-r.startSN,a=(h.fragmentHint?1:0)+(p?r.endSN:Math.min(h.endSN,r.endSN))-r.startSN,t=r.startSN-h.startSN,f=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments,e=h.fragmentHint?h.fragments.concat(h.fragmentHint):h.fragments,d=i;d<=a;d++){var E=e[t+d],v=f[d];p&&!v&&d<p&&(v=r.fragments[d]=E),E&&v&&u(E,v)}}function o(h,r){var u=r.startSN+r.skippedSegments-h.startSN,p=h.fragments;u<0||u>=p.length||l(r,p[u].start)}function l(h,r){if(r){for(var u=h.fragments,p=h.skippedSegments;p<u.length;p++)u[p].start+=r;h.fragmentHint&&(h.fragmentHint.start+=r)}}function s(h,r){r===void 0&&(r=1/0);var u=1e3*h.targetduration;if(h.updated){var p=h.fragments,i=4;if(p.length&&u*i>r){var a=p[p.length-1].duration*1e3;a<u&&(u=a)}}else u/=2;return Math.round(u)}function n(h,r,u){if(!h||!h.details)return null;var p=h.details,i=p.fragments[r-p.startSN];return i||(i=p.fragmentHint,i&&i.sn===r)?i:r<p.startSN&&u&&u.sn===r?u:null}function g(h,r,u){if(!h||!h.details)return null;var p=h.details.partList;if(p)for(var i=p.length;i--;){var a=p[i];if(a.index===u&&a.fragment.sn===r)return a}return null}},"./src/controller/stream-controller.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>r});var F=S("./src/polyfills/number.ts"),D=S("./src/controller/base-stream-controller.ts"),b=S("./src/is-supported.ts"),P=S("./src/events.ts"),k=S("./src/utils/buffer-helper.ts"),A=S("./src/controller/fragment-tracker.ts"),L=S("./src/types/loader.ts"),x=S("./src/loader/fragment.ts"),_=S("./src/demux/transmuxer-interface.ts"),T=S("./src/types/transmuxer.ts"),c=S("./src/controller/gap-controller.ts"),y=S("./src/errors.ts");function m(u,p){for(var i=0;i<p.length;i++){var a=p[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(u,l(a.key),a)}}function o(u,p,i){return p&&m(u.prototype,p),i&&m(u,i),Object.defineProperty(u,"prototype",{writable:!1}),u}function l(u){var p=s(u,"string");return typeof p=="symbol"?p:String(p)}function s(u,p){if(typeof u!="object"||u===null)return u;var i=u[Symbol.toPrimitive];if(i!==void 0){var a=i.call(u,p||"default");if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(p==="string"?String:Number)(u)}function n(u,p){u.prototype=Object.create(p.prototype),u.prototype.constructor=u,g(u,p)}function g(u,p){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,t){return a.__proto__=t,a},g(u,p)}var h=100,r=function(u){n(p,u);function p(a,t,f){var e;return e=u.call(this,a,t,f,"[stream-controller]")||this,e.audioCodecSwap=!1,e.gapController=null,e.level=-1,e._forceStartLoad=!1,e.altAudio=!1,e.audioOnly=!1,e.fragPlaying=null,e.onvplaying=null,e.onvseeked=null,e.fragLastKbps=0,e.couldBacktrack=!1,e.backtrackFragment=null,e.audioCodecSwitch=!1,e.videoBuffer=null,e._registerListeners(),e}var i=p.prototype;return i._registerListeners=function(){var t=this.hls;t.on(P.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(P.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(P.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(P.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(P.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(P.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(P.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(P.Events.ERROR,this.onError,this),t.on(P.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(P.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(P.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(P.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(P.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(P.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i._unregisterListeners=function(){var t=this.hls;t.off(P.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(P.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(P.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(P.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(P.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(P.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(P.Events.ERROR,this.onError,this),t.off(P.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(P.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(P.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(P.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(P.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(P.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},i.startLoad=function(t){if(this.levels){var f=this.lastCurrentTime,e=this.hls;if(this.stopLoad(),this.setInterval(h),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var d=e.startLevel;d===-1&&(e.config.testBandwidth&&this.levels.length>1?(d=0,this.bitrateTest=!0):d=e.nextAutoLevel),this.level=e.nextLoadLevel=d,this.loadedmetadata=!1}f>0&&t===-1&&(this.log("Override startPosition with lastCurrentTime @"+f.toFixed(3)),t=f),this.state=D.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this._forceStartLoad=!0,this.state=D.State.STOPPED},i.stopLoad=function(){this._forceStartLoad=!1,u.prototype.stopLoad.call(this)},i.doTick=function(){switch(this.state){case D.State.IDLE:this.doTickIdle();break;case D.State.WAITING_LEVEL:{var t,f=this.levels,e=this.level,d=f==null||(t=f[e])===null||t===void 0?void 0:t.details;if(d&&(!d.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(d))break;this.state=D.State.IDLE;break}break}case D.State.FRAG_LOADING_WAITING_RETRY:{var E,v=self.performance.now(),I=this.retryDate;(!I||v>=I||(E=this.media)!==null&&E!==void 0&&E.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=D.State.IDLE)}break}this.onTickEnd()},i.onTickEnd=function(){u.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},i.doTickIdle=function(){var t=this.hls,f=this.levelLastLoaded,e=this.levels,d=this.media,E=t.config,v=t.nextLoadLevel;if(!(f===null||!d&&(this.startFragRequested||!E.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!e||!e[v])){var I=e[v],R=this.getMainFwdBufferInfo();if(R!==null){var O=this.getLevelDetails();if(O&&this._streamEnded(R,O)){var C={};this.altAudio&&(C.type="video"),this.hls.trigger(P.Events.BUFFER_EOS,C),this.state=D.State.ENDED;return}this.level=t.nextLoadLevel=v;var M=I.details;if(!M||this.state===D.State.WAITING_LEVEL||M.live&&this.levelLastLoaded!==v){this.level=v,this.state=D.State.WAITING_LEVEL;return}var B=R.len,w=this.getMaxBufferLength(I.maxBitrate);if(!(B>=w)){this.backtrackFragment&&this.backtrackFragment.start>R.end&&(this.backtrackFragment=null);var N=this.backtrackFragment?this.backtrackFragment.start:R.end,W=this.getNextFragment(N,M);if(this.couldBacktrack&&!this.fragPrevious&&W&&W.sn!=="initSegment"&&this.fragmentTracker.getState(W)!==A.FragmentState.OK){var G,H=((G=this.backtrackFragment)!=null?G:W).sn,$=H-M.startSN,Y=M.fragments[$-1];Y&&W.cc===Y.cc&&(W=Y,this.fragmentTracker.removeFragment(Y))}else this.backtrackFragment&&R.len&&(this.backtrackFragment=null);if(W&&this.fragmentTracker.getState(W)===A.FragmentState.OK&&this.nextLoadPosition>N){var z=this.audioOnly&&!this.altAudio?x.ElementaryStreamTypes.AUDIO:x.ElementaryStreamTypes.VIDEO,J=(z===x.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;J&&this.afterBufferFlushed(J,z,L.PlaylistLevelType.MAIN),W=this.getNextFragment(this.nextLoadPosition,M)}W&&(W.initSegment&&!W.initSegment.data&&!this.bitrateTest&&(W=W.initSegment),this.loadFragment(W,M,N))}}}},i.loadFragment=function(t,f,e){var d,E=this.fragmentTracker.getState(t);this.fragCurrent=t,E===A.FragmentState.NOT_LOADED?t.sn==="initSegment"?this._loadInitSegment(t,f):this.bitrateTest?(this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t,f)):(this.startFragRequested=!0,u.prototype.loadFragment.call(this,t,f,e)):E===A.FragmentState.APPENDING?this.reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t):((d=this.media)===null||d===void 0?void 0:d.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},i.getAppendedFrag=function(t){var f=this.fragmentTracker.getAppendedFrag(t,L.PlaylistLevelType.MAIN);return f&&"fragment"in f?f.fragment:f},i.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,L.PlaylistLevelType.MAIN)},i.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},i.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},i.nextLevelSwitch=function(){var t=this.levels,f=this.media;if(f!=null&&f.readyState){var e,d=this.getAppendedFrag(f.currentTime);if(d&&d.start>1&&this.flushMainBuffer(0,d.start-1),!f.paused&&t){var E=this.hls.nextLoadLevel,v=t[E],I=this.fragLastKbps;I&&this.fragCurrent?e=this.fragCurrent.duration*v.maxBitrate/(1e3*I)+1:e=0}else e=0;var R=this.getBufferedFrag(f.currentTime+e);if(R){var O=this.followingBufferedFrag(R);if(O){this.abortCurrentFrag();var C=O.maxStartPTS?O.maxStartPTS:O.start,M=O.duration,B=Math.max(R.end,C+Math.min(Math.max(M-this.config.maxFragLookUpTolerance,M*.5),M*.75));this.flushMainBuffer(B,Number.POSITIVE_INFINITY)}}}},i.abortCurrentFrag=function(){var t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&t.abortRequests(),this.state){case D.State.KEY_LOADING:case D.State.FRAG_LOADING:case D.State.FRAG_LOADING_WAITING_RETRY:case D.State.PARSING:case D.State.PARSED:this.state=D.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},i.flushMainBuffer=function(t,f){u.prototype.flushMainBuffer.call(this,t,f,this.altAudio?"video":null)},i.onMediaAttached=function(t,f){u.prototype.onMediaAttached.call(this,t,f);var e=f.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),e.addEventListener("playing",this.onvplaying),e.addEventListener("seeked",this.onvseeked),this.gapController=new c.default(this.config,e,this.fragmentTracker,this.hls)},i.onMediaDetaching=function(){var t=this.media;t&&this.onvplaying&&this.onvseeked&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),u.prototype.onMediaDetaching.call(this)},i.onMediaPlaying=function(){this.tick()},i.onMediaSeeked=function(){var t=this.media,f=t?t.currentTime:null;(0,F.isFiniteNumber)(f)&&this.log("Media seeked to "+f.toFixed(3)),this.tick()},i.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(P.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},i.onManifestParsed=function(t,f){var e=!1,d=!1,E;f.levels.forEach(function(v){E=v.audioCodec,E&&(E.indexOf("mp4a.40.2")!==-1&&(e=!0),E.indexOf("mp4a.40.5")!==-1&&(d=!0))}),this.audioCodecSwitch=e&&d&&!(0,b.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=f.levels,this.startFragRequested=!1},i.onLevelLoading=function(t,f){var e=this.levels;if(!(!e||this.state!==D.State.IDLE)){var d=e[f.level];(!d.details||d.details.live&&this.levelLastLoaded!==f.level||this.waitForCdnTuneIn(d.details))&&(this.state=D.State.WAITING_LEVEL)}},i.onLevelLoaded=function(t,f){var e,d=this.levels,E=f.level,v=f.details,I=v.totalduration;if(!d){this.warn("Levels were reset while loading level "+E);return}this.log("Level "+E+" loaded ["+v.startSN+","+v.endSN+"], cc ["+v.startCC+", "+v.endCC+"] duration:"+I);var R=this.fragCurrent;R&&(this.state===D.State.FRAG_LOADING||this.state===D.State.FRAG_LOADING_WAITING_RETRY)&&R.level!==f.level&&R.loader&&(this.state=D.State.IDLE,this.backtrackFragment=null,R.abortRequests());var O=d[E],C=0;if(v.live||(e=O.details)!==null&&e!==void 0&&e.live){if(v.fragments[0]||(v.deltaUpdateFailed=!0),v.deltaUpdateFailed)return;C=this.alignPlaylists(v,O.details)}if(O.details=v,this.levelLastLoaded=E,this.hls.trigger(P.Events.LEVEL_UPDATED,{details:v,level:E}),this.state===D.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(v))return;this.state=D.State.IDLE}this.startFragRequested?v.live&&this.synchronizeToLiveEdge(v):this.setStartPosition(v,C),this.tick()},i._handleFragmentLoadProgress=function(t){var f,e=t.frag,d=t.part,E=t.payload,v=this.levels;if(!v){this.warn("Levels were reset while fragment load was in progress. Fragment "+e.sn+" of level "+e.level+" will not be buffered");return}var I=v[e.level],R=I.details;if(!R){this.warn("Dropping fragment "+e.sn+" of level "+e.level+" after level details were reset");return}var O=I.videoCodec,C=R.PTSKnown||!R.live,M=(f=e.initSegment)===null||f===void 0?void 0:f.data,B=this._getAudioCodec(I),w=this.transmuxer=this.transmuxer||new _.default(this.hls,L.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),N=d?d.index:-1,W=N!==-1,G=new T.ChunkMetadata(e.level,e.sn,e.stats.chunkCount,E.byteLength,N,W),H=this.initPTS[e.cc];w.push(E,M,B,O,e,d,R.totalduration,C,G,H)},i.onAudioTrackSwitching=function(t,f){var e=this.altAudio,d=!!f.url,E=f.id;if(!d){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var v=this.fragCurrent;v&&(this.log("Switching to main audio track, cancel main fragment load"),v.abortRequests()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var I=this.hls;e&&I.trigger(P.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),I.trigger(P.Events.AUDIO_TRACK_SWITCHED,{id:E})}},i.onAudioTrackSwitched=function(t,f){var e=f.id,d=!!this.hls.audioTracks[e].url;if(d){var E=this.videoBuffer;E&&this.mediaBuffer!==E&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=E)}this.altAudio=d,this.tick()},i.onBufferCreated=function(t,f){var e=f.tracks,d,E,v=!1;for(var I in e){var R=e[I];if(R.id==="main"){if(E=I,d=R,I==="video"){var O=e[I];O&&(this.videoBuffer=O.buffer)}}else v=!0}v&&d?(this.log("Alternate track found, use "+E+".buffered to schedule main fragment loading"),this.mediaBuffer=d.buffer):this.mediaBuffer=this.media},i.onFragBuffered=function(t,f){var e=f.frag,d=f.part;if(!(e&&e.type!==L.PlaylistLevelType.MAIN)){if(this.fragContextChanged(e)){this.warn("Fragment "+e.sn+(d?" p: "+d.index:"")+" of level "+e.level+" finished buffering, but was aborted. state: "+this.state),this.state===D.State.PARSED&&(this.state=D.State.IDLE);return}var E=d?d.stats:e.stats;this.fragLastKbps=Math.round(8*E.total/(E.buffering.end-E.loading.first)),e.sn!=="initSegment"&&(this.fragPrevious=e),this.fragBufferedComplete(e,d)}},i.onError=function(t,f){if(f.type===y.ErrorTypes.KEY_SYSTEM_ERROR){this.onFragmentOrKeyLoadError(L.PlaylistLevelType.MAIN,f);return}switch(f.details){case y.ErrorDetails.FRAG_LOAD_ERROR:case y.ErrorDetails.FRAG_LOAD_TIMEOUT:case y.ErrorDetails.FRAG_PARSING_ERROR:case y.ErrorDetails.KEY_LOAD_ERROR:case y.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(L.PlaylistLevelType.MAIN,f);break;case y.ErrorDetails.LEVEL_LOAD_ERROR:case y.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==D.State.ERROR&&(f.fatal?(this.warn(""+f.details),this.state=D.State.ERROR):!f.levelRetry&&this.state===D.State.WAITING_LEVEL&&(this.state=D.State.IDLE));break;case y.ErrorDetails.BUFFER_FULL_ERROR:if(f.parent==="main"&&(this.state===D.State.PARSING||this.state===D.State.PARSED)){var e=!0,d=this.getFwdBufferInfo(this.media,L.PlaylistLevelType.MAIN);d&&d.len>.5&&(e=!this.reduceMaxBufferLength(d.len)),e&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},i.checkBuffer=function(){var t=this.media,f=this.gapController;if(!(!t||!f||!t.readyState)){if(this.loadedmetadata||!k.BufferHelper.getBuffered(t).length){var e=this.state!==D.State.IDLE?this.fragCurrent:null;f.poll(this.lastCurrentTime,e)}this.lastCurrentTime=t.currentTime}},i.onFragLoadEmergencyAborted=function(){this.state=D.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},i.onBufferFlushed=function(t,f){var e=f.type;if(e!==x.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var d=(e===x.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(d,e,L.PlaylistLevelType.MAIN)}},i.onLevelsUpdated=function(t,f){this.levels=f.levels},i.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},i.seekToStartPos=function(){var t=this.media;if(t){var f=t.currentTime,e=this.startPosition;if(e>=0&&f<e){if(t.seeking){this.log("could not seek to "+e+", already seeking at "+f);return}var d=k.BufferHelper.getBuffered(t),E=d.length?d.start(0):0,v=E-e;v>0&&(v<this.config.maxBufferHole||v<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+v+" to match buffer start"),e+=v,this.startPosition=e),this.log("seek to target start position "+e+" from current time "+f),t.currentTime=e}}},i._getAudioCodec=function(t){var f=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&f&&(this.log("Swapping audio codec"),f.indexOf("mp4a.40.5")!==-1?f="mp4a.40.2":f="mp4a.40.5"),f},i._loadBitrateTestFrag=function(t,f){var e=this;t.bitrateTest=!0,this._doFragLoad(t,f).then(function(d){var E=e.hls;if(!(!d||e.fragContextChanged(t))){e.fragLoadError=0,e.state=D.State.IDLE,e.startFragRequested=!1,e.bitrateTest=!1;var v=t.stats;v.parsing.start=v.parsing.end=v.buffering.start=v.buffering.end=self.performance.now(),E.trigger(P.Events.FRAG_LOADED,d),t.bitrateTest=!1}})},i._handleTransmuxComplete=function(t){var f,e="main",d=this.hls,E=t.remuxResult,v=t.chunkMeta,I=this.getCurrentContext(v);if(!I){this.warn("The loading context changed while buffering fragment "+v.sn+" of level "+v.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(v.level);return}var R=I.frag,O=I.part,C=I.level,M=E.video,B=E.text,w=E.id3,N=E.initSegment,W=C.details,G=this.altAudio?void 0:E.audio;if(!this.fragContextChanged(R)){if(this.state=D.State.PARSING,N){N.tracks&&(this._bufferInitSegment(C,N.tracks,R,v),d.trigger(P.Events.FRAG_PARSING_INIT_SEGMENT,{frag:R,id:e,tracks:N.tracks}));var H=N.initPTS,$=N.timescale;(0,F.isFiniteNumber)(H)&&(this.initPTS[R.cc]=H,d.trigger(P.Events.INIT_PTS_FOUND,{frag:R,id:e,initPTS:H,timescale:$}))}if(M&&E.independent!==!1){if(W){var Y=M.startPTS,z=M.endPTS,J=M.startDTS,te=M.endDTS;if(O)O.elementaryStreams[M.type]={startPTS:Y,endPTS:z,startDTS:J,endDTS:te};else if(M.firstKeyFrame&&M.independent&&v.id===1&&(this.couldBacktrack=!0),M.dropped&&M.independent){var q=this.getMainFwdBufferInfo(),Q=(q?q.end:this.getLoadPosition())+this.config.maxBufferHole,re=M.firstKeyFramePTS?M.firstKeyFramePTS:Y;if(Q<re-this.config.maxBufferHole){this.backtrack(R);return}R.setElementaryStreamInfo(M.type,R.start,z,R.start,te,!0)}R.setElementaryStreamInfo(M.type,Y,z,J,te),this.backtrackFragment&&(this.backtrackFragment=R),this.bufferFragmentData(M,R,O,v)}}else if(E.independent===!1){this.backtrack(R);return}if(G){var ae=G.startPTS,se=G.endPTS,he=G.startDTS,ue=G.endDTS;O&&(O.elementaryStreams[x.ElementaryStreamTypes.AUDIO]={startPTS:ae,endPTS:se,startDTS:he,endDTS:ue}),R.setElementaryStreamInfo(x.ElementaryStreamTypes.AUDIO,ae,se,he,ue),this.bufferFragmentData(G,R,O,v)}if(W&&w!==null&&w!==void 0&&(f=w.samples)!==null&&f!==void 0&&f.length){var ce={id:e,frag:R,details:W,samples:w.samples};d.trigger(P.Events.FRAG_PARSING_METADATA,ce)}if(W&&B){var le={id:e,frag:R,details:W,samples:B.samples};d.trigger(P.Events.FRAG_PARSING_USERDATA,le)}}},i._bufferInitSegment=function(t,f,e,d){var E=this;if(this.state===D.State.PARSING){this.audioOnly=!!f.audio&&!f.video,this.altAudio&&!this.audioOnly&&delete f.audio;var v=f.audio,I=f.video,R=f.audiovideo;if(v){var O=t.audioCodec,C=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(O&&(O.indexOf("mp4a.40.5")!==-1?O="mp4a.40.2":O="mp4a.40.5"),v.metadata.channelCount!==1&&C.indexOf("firefox")===-1&&(O="mp4a.40.5")),C.indexOf("android")!==-1&&v.container!=="audio/mpeg"&&(O="mp4a.40.2",this.log("Android: force audio codec to "+O)),t.audioCodec&&t.audioCodec!==O&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+O+'"'),v.levelCodec=O,v.id="main",this.log("Init audio buffer, container:"+v.container+", codecs[selected/level/parsed]=["+(O||"")+"/"+(t.audioCodec||"")+"/"+v.codec+"]")}I&&(I.levelCodec=t.videoCodec,I.id="main",this.log("Init video buffer, container:"+I.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+I.codec+"]")),R&&this.log("Init audiovideo buffer, container:"+R.container+", codecs[level/parsed]=["+(t.attrs.CODECS||"")+"/"+R.codec+"]"),this.hls.trigger(P.Events.BUFFER_CODECS,f),Object.keys(f).forEach(function(M){var B=f[M],w=B.initSegment;w!=null&&w.byteLength&&E.hls.trigger(P.Events.BUFFER_APPENDING,{type:M,data:w,frag:e,part:null,chunkMeta:d,parent:e.type})}),this.tick()}},i.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,L.PlaylistLevelType.MAIN)},i.backtrack=function(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=D.State.IDLE},i.checkFragmentChanged=function(){var t=this.media,f=null;if(t&&t.readyState>1&&t.seeking===!1){var e=t.currentTime;if(k.BufferHelper.isBuffered(t,e)?f=this.getAppendedFrag(e):k.BufferHelper.isBuffered(t,e+.1)&&(f=this.getAppendedFrag(e+.1)),f){this.backtrackFragment=null;var d=this.fragPlaying,E=f.level;(!d||f.sn!==d.sn||d.level!==E||f.urlId!==d.urlId)&&(this.fragPlaying=f,this.hls.trigger(P.Events.FRAG_CHANGED,{frag:f}),(!d||d.level!==E)&&this.hls.trigger(P.Events.LEVEL_SWITCHED,{level:E}))}}},o(p,[{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentFrag",get:function(){var t=this.media;return t?this.fragPlaying||this.getAppendedFrag(t.currentTime):null}},{key:"currentProgramDateTime",get:function(){var t=this.media;if(t){var f=t.currentTime,e=this.currentFrag;if(e&&(0,F.isFiniteNumber)(f)&&(0,F.isFiniteNumber)(e.programDateTime)){var d=e.programDateTime+(f-e.start)*1e3;return new Date(d)}}return null}},{key:"currentLevel",get:function(){var t=this.currentFrag;return t?t.level:-1}},{key:"nextBufferedFrag",get:function(){var t=this.currentFrag;return t?this.followingBufferedFrag(t):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),p}(D.default)},"./src/controller/subtitle-stream-controller.ts":(V,U,S)=>{S.r(U),S.d(U,{SubtitleStreamController:()=>n});var F=S("./src/events.ts"),D=S("./src/utils/buffer-helper.ts"),b=S("./src/controller/fragment-finders.ts"),P=S("./src/utils/discontinuities.ts"),k=S("./src/controller/level-helper.ts"),A=S("./src/controller/fragment-tracker.ts"),L=S("./src/controller/base-stream-controller.ts"),x=S("./src/types/loader.ts"),_=S("./src/types/level.ts");function T(h,r){for(var u=0;u<r.length;u++){var p=r[u];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(h,y(p.key),p)}}function c(h,r,u){return r&&T(h.prototype,r),u&&T(h,u),Object.defineProperty(h,"prototype",{writable:!1}),h}function y(h){var r=m(h,"string");return typeof r=="symbol"?r:String(r)}function m(h,r){if(typeof h!="object"||h===null)return h;var u=h[Symbol.toPrimitive];if(u!==void 0){var p=u.call(h,r||"default");if(typeof p!="object")return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(h)}function o(h,r){h.prototype=Object.create(r.prototype),h.prototype.constructor=h,l(h,r)}function l(h,r){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(p,i){return p.__proto__=i,p},l(h,r)}var s=500,n=function(h){o(r,h);function r(p,i,a){var t;return t=h.call(this,p,i,a,"[subtitle-stream-controller]")||this,t.levels=[],t.currentTrackId=-1,t.tracksBuffered=[],t.mainDetails=null,t._registerListeners(),t}var u=r.prototype;return u.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},u._registerListeners=function(){var i=this.hls;i.on(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(F.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(F.Events.ERROR,this.onError,this),i.on(F.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.on(F.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),i.on(F.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.on(F.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),i.on(F.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),i.on(F.Events.FRAG_BUFFERED,this.onFragBuffered,this)},u._unregisterListeners=function(){var i=this.hls;i.off(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(F.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(F.Events.ERROR,this.onError,this),i.off(F.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.off(F.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),i.off(F.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.off(F.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),i.off(F.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),i.off(F.Events.FRAG_BUFFERED,this.onFragBuffered,this)},u.startLoad=function(i){this.stopLoad(),this.state=L.State.IDLE,this.setInterval(s),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=i,this.tick()},u.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},u.onLevelLoaded=function(i,a){this.mainDetails=a.details},u.onSubtitleFragProcessed=function(i,a){var t=a.frag,f=a.success;if(this.fragPrevious=t,this.state=L.State.IDLE,!!f){var e=this.tracksBuffered[this.currentTrackId];if(e){for(var d,E=t.start,v=0;v<e.length;v++)if(E>=e[v].start&&E<=e[v].end){d=e[v];break}var I=t.start+t.duration;d?d.end=I:(d={start:E,end:I},e.push(d)),this.fragmentTracker.fragBuffered(t)}}},u.onBufferFlushing=function(i,a){var t=a.startOffset,f=a.endOffset;if(t===0&&f!==Number.POSITIVE_INFINITY){var e=this.currentTrackId,d=this.levels;if(!d.length||!d[e]||!d[e].details)return;var E=d[e].details,v=E.targetduration,I=f-v;if(I<=0)return;a.endOffsetSubtitles=Math.max(0,I),this.tracksBuffered.forEach(function(R){for(var O=0;O<R.length;){if(R[O].end<=I){R.shift();continue}else if(R[O].start<I)R[O].start=I;else break;O++}}),this.fragmentTracker.removeFragmentsInRange(t,I,x.PlaylistLevelType.SUBTITLE)}},u.onFragBuffered=function(i,a){if(!this.loadedmetadata&&a.frag.type===x.PlaylistLevelType.MAIN){var t;(t=this.media)!==null&&t!==void 0&&t.buffered.length&&(this.loadedmetadata=!0)}},u.onError=function(i,a){var t=a.frag;!t||t.type!==x.PlaylistLevelType.SUBTITLE||(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state=L.State.IDLE)},u.onSubtitleTracksUpdated=function(i,a){var t=this,f=a.subtitleTracks;this.tracksBuffered=[],this.levels=f.map(function(e){return new _.Level(e)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(e){t.tracksBuffered[e.id]=[]}),this.mediaBuffer=null},u.onSubtitleTrackSwitch=function(i,a){if(this.currentTrackId=a.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var t=this.levels[this.currentTrackId];t!=null&&t.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,t&&this.setInterval(s)},u.onSubtitleTrackLoaded=function(i,a){var t,f=a.details,e=a.id,d=this.currentTrackId,E=this.levels;if(E.length){var v=E[d];if(!(e>=E.length||e!==d||!v)){this.mediaBuffer=this.mediaBufferTimeRanges;var I=0;if(f.live||(t=v.details)!==null&&t!==void 0&&t.live){var R=this.mainDetails;if(f.deltaUpdateFailed||!R)return;var O=R.fragments[0];v.details?(I=this.alignPlaylists(f,v.details),I===0&&O&&(I=O.start,(0,k.addSliding)(f,I))):f.hasProgramDateTime&&R.hasProgramDateTime?((0,P.alignMediaPlaylistByPDT)(f,R),I=f.fragments[0].start):O&&(I=O.start,(0,k.addSliding)(f,I))}if(v.details=f,this.levelLastLoaded=e,!this.startFragRequested&&(this.mainDetails||!f.live)&&this.setStartPosition(v.details,I),this.tick(),f.live&&!this.fragCurrent&&this.media&&this.state===L.State.IDLE){var C=(0,b.findFragmentByPTS)(null,f.fragments,this.media.currentTime,0);C||(this.warn("Subtitle playlist not aligned with playback"),v.details=void 0)}}}},u._handleFragmentLoadComplete=function(i){var a=this,t=i.frag,f=i.payload,e=t.decryptdata,d=this.hls;if(!this.fragContextChanged(t)&&f&&f.byteLength>0&&e&&e.key&&e.iv&&e.method==="AES-128"){var E=performance.now();this.decrypter.decrypt(new Uint8Array(f),e.key.buffer,e.iv.buffer).then(function(v){var I=performance.now();d.trigger(F.Events.FRAG_DECRYPTED,{frag:t,payload:v,stats:{tstart:E,tdecrypt:I}})}).catch(function(v){a.warn(v.name+": "+v.message),a.state=L.State.IDLE})}},u.doTick=function(){if(!this.media){this.state=L.State.IDLE;return}if(this.state===L.State.IDLE){var i=this.currentTrackId,a=this.levels;if(!a.length||!a[i]||!a[i].details)return;var t=a[i].details,f=t.targetduration,e=this.config,d=this.getLoadPosition(),E=D.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],d-f,e.maxBufferHole),v=E.end,I=E.len,R=this.getFwdBufferInfo(this.media,x.PlaylistLevelType.MAIN),O=this.getMaxBufferLength(R==null?void 0:R.len)+f;if(I>O)return;console.assert(t,"Subtitle track details are defined on idle subtitle stream controller tick");var C=t.fragments,M=C.length,B=t.edge,w=null,N=this.fragPrevious;if(v<B){var W=e.maxFragLookUpTolerance;w=(0,b.findFragmentByPTS)(N,C,Math.max(C[0].start,v),W),!w&&N&&N.start<C[0].start&&(w=C[0])}else w=C[M-1];if(!w)return;w=this.mapToInitFragWhenRequired(w),this.fragmentTracker.getState(w)===A.FragmentState.NOT_LOADED&&this.loadFragment(w,t,v)}},u.getMaxBufferLength=function(i){var a=h.prototype.getMaxBufferLength.call(this);return i?Math.max(a,i):a},u.loadFragment=function(i,a,t){this.fragCurrent=i,i.sn==="initSegment"?this._loadInitSegment(i,a):(this.startFragRequested=!0,h.prototype.loadFragment.call(this,i,a,t))},c(r,[{key:"mediaBufferTimeRanges",get:function(){return new g(this.tracksBuffered[this.currentTrackId]||[])}}]),r}(L.default),g=function(r){this.buffered=void 0;var u=function(i,a,t){if(a=a>>>0,a>t-1)throw new DOMException("Failed to execute '"+i+"' on 'TimeRanges': The index provided ("+a+") is greater than the maximum bound ("+t+")");return r[a][i]};this.buffered={get length(){return r.length},end:function(i){return u("end",i,r.length)},start:function(i){return u("start",i,r.length)}}}},"./src/controller/subtitle-track-controller.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>m});var F=S("./src/events.ts"),D=S("./src/utils/texttrack-utils.ts"),b=S("./src/controller/base-playlist-controller.ts"),P=S("./src/types/loader.ts");function k(o,l){for(var s=0;s<l.length;s++){var n=l[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(o,L(n.key),n)}}function A(o,l,s){return l&&k(o.prototype,l),s&&k(o,s),Object.defineProperty(o,"prototype",{writable:!1}),o}function L(o){var l=x(o,"string");return typeof l=="symbol"?l:String(l)}function x(o,l){if(typeof o!="object"||o===null)return o;var s=o[Symbol.toPrimitive];if(s!==void 0){var n=s.call(o,l||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(l==="string"?String:Number)(o)}function _(o,l){o.prototype=Object.create(l.prototype),o.prototype.constructor=o,T(o,l)}function T(o,l){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,g){return n.__proto__=g,n},T(o,l)}var c=function(o){_(l,o);function l(n){var g;return g=o.call(this,n,"[subtitle-track-controller]")||this,g.media=null,g.tracks=[],g.groupId=null,g.tracksInGroup=[],g.trackId=-1,g.selectDefaultTrack=!0,g.queuedDefaultTrack=-1,g.trackChangeListener=function(){return g.onTextTracksChanged()},g.asyncPollTrackChange=function(){return g.pollTrackChange(0)},g.useTextTrackPolling=!1,g.subtitlePollingInterval=-1,g._subtitleDisplay=!0,g.registerListeners(),g}var s=l.prototype;return s.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,o.prototype.destroy.call(this)},s.registerListeners=function(){var g=this.hls;g.on(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),g.on(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this),g.on(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),g.on(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),g.on(F.Events.LEVEL_LOADING,this.onLevelLoading,this),g.on(F.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),g.on(F.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),g.on(F.Events.ERROR,this.onError,this)},s.unregisterListeners=function(){var g=this.hls;g.off(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),g.off(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this),g.off(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),g.off(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),g.off(F.Events.LEVEL_LOADING,this.onLevelLoading,this),g.off(F.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),g.off(F.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),g.off(F.Events.ERROR,this.onError,this)},s.onMediaAttached=function(g,h){this.media=h.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},s.pollTrackChange=function(g){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,g)},s.onMediaDetaching=function(){if(this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var g=y(this.media.textTracks);g.forEach(function(h){(0,D.clearCurrentCues)(h)}),this.subtitleTrack=-1,this.media=null}},s.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},s.onManifestParsed=function(g,h){this.tracks=h.subtitleTracks},s.onSubtitleTrackLoaded=function(g,h){var r=h.id,u=h.details,p=this.trackId,i=this.tracksInGroup[p];if(!i){this.warn("Invalid subtitle track id "+r);return}var a=i.details;i.details=h.details,this.log("subtitle track "+r+" loaded ["+u.startSN+"-"+u.endSN+"]"),r===this.trackId&&(this.retryCount=0,this.playlistLoaded(r,h,a))},s.onLevelLoading=function(g,h){this.switchLevel(h.level)},s.onLevelSwitching=function(g,h){this.switchLevel(h.level)},s.switchLevel=function(g){var h=this.hls.levels[g];if(h!=null&&h.textGroupIds){var r=h.textGroupIds[h.urlId];if(this.groupId!==r){var u=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,p=this.tracks.filter(function(t){return!r||t.groupId===r});this.tracksInGroup=p;var i=this.findTrackId(u==null?void 0:u.name)||this.findTrackId();this.groupId=r;var a={subtitleTracks:p};this.log("Updating subtitle tracks, "+p.length+' track(s) found in "'+r+'" group-id'),this.hls.trigger(F.Events.SUBTITLE_TRACKS_UPDATED,a),i!==-1&&this.setSubtitleTrack(i,u)}}},s.findTrackId=function(g){for(var h=this.tracksInGroup,r=0;r<h.length;r++){var u=h[r];if((!this.selectDefaultTrack||u.default)&&(!g||g===u.name))return u.id}return-1},s.onError=function(g,h){o.prototype.onError.call(this,g,h),!(h.fatal||!h.context)&&h.context.type===P.PlaylistContextType.SUBTITLE_TRACK&&h.context.id===this.trackId&&h.context.groupId===this.groupId&&this.retryLoadingOrFail(h)},s.loadPlaylist=function(g){o.prototype.loadPlaylist.call(this);var h=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(h)){var r=h.id,u=h.groupId,p=h.url;if(g)try{p=g.addDirectives(p)}catch(i){this.warn("Could not construct new URL with HLS Delivery Directives: "+i)}this.log("Loading subtitle playlist for id "+r),this.hls.trigger(F.Events.SUBTITLE_TRACK_LOADING,{url:p,id:r,groupId:u,deliveryDirectives:g||null})}},s.toggleTrackModes=function(g){var h=this,r=this.media,u=this.trackId;if(r){var p=y(r.textTracks),i=p.filter(function(f){return f.groupId===h.groupId});if(g===-1)[].slice.call(p).forEach(function(f){f.mode="disabled"});else{var a=i[u];a&&(a.mode="disabled")}var t=i[g];t&&(t.mode=this.subtitleDisplay?"showing":"hidden")}},s.setSubtitleTrack=function(g,h){var r,u=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=g;return}if(this.trackId!==g&&this.toggleTrackModes(g),!(this.trackId===g&&(g===-1||(r=u[g])!==null&&r!==void 0&&r.details)||g<-1||g>=u.length)){this.clearTimer();var p=u[g];if(this.log("Switching to subtitle track "+g),this.trackId=g,p){var i=p.id,a=p.groupId,t=a===void 0?"":a,f=p.name,e=p.type,d=p.url;this.hls.trigger(F.Events.SUBTITLE_TRACK_SWITCH,{id:i,groupId:t,name:f,type:e,url:d});var E=this.switchParams(p.url,h==null?void 0:h.details);this.loadPlaylist(E)}else this.hls.trigger(F.Events.SUBTITLE_TRACK_SWITCH,{id:g})}},s.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var g=-1,h=y(this.media.textTracks),r=0;r<h.length;r++)if(h[r].mode==="hidden")g=r;else if(h[r].mode==="showing"){g=r;break}this.subtitleTrack!==g&&(this.subtitleTrack=g)}},A(l,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(g){this._subtitleDisplay=g,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(g){this.selectDefaultTrack=!1;var h=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(g,h)}}]),l}(b.default);function y(o){for(var l=[],s=0;s<o.length;s++){var n=o[s];n.kind==="subtitles"&&n.label&&l.push(o[s])}return l}const m=c},"./src/controller/timeline-controller.ts":(V,U,S)=>{S.r(U),S.d(U,{TimelineController:()=>c});var F=S("./src/polyfills/number.ts"),D=S("./src/events.ts"),b=S("./src/utils/cea-608-parser.ts"),P=S("./src/utils/output-filter.ts"),k=S("./src/utils/webvtt-parser.ts"),A=S("./src/utils/texttrack-utils.ts"),L=S("./src/utils/imsc1-ttml-parser.ts"),x=S("./src/utils/mp4-tools.ts"),_=S("./src/types/loader.ts"),T=S("./src/utils/logger.ts"),c=function(){function l(n){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=o(),this.captionsProperties=void 0,this.hls=n,this.config=n.config,this.Cues=n.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var g=new P.default(this,"textTrack1"),h=new P.default(this,"textTrack2"),r=new P.default(this,"textTrack3"),u=new P.default(this,"textTrack4");this.cea608Parser1=new b.default(1,g,h),this.cea608Parser2=new b.default(3,r,u)}n.on(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),n.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(D.Events.MANIFEST_LOADED,this.onManifestLoaded,this),n.on(D.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),n.on(D.Events.FRAG_LOADING,this.onFragLoading,this),n.on(D.Events.FRAG_LOADED,this.onFragLoaded,this),n.on(D.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),n.on(D.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),n.on(D.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),n.on(D.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),n.on(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var s=l.prototype;return s.destroy=function(){var g=this.hls;g.off(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),g.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),g.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),g.off(D.Events.MANIFEST_LOADED,this.onManifestLoaded,this),g.off(D.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),g.off(D.Events.FRAG_LOADING,this.onFragLoading,this),g.off(D.Events.FRAG_LOADED,this.onFragLoaded,this),g.off(D.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),g.off(D.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),g.off(D.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),g.off(D.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),g.off(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},s.addCues=function(g,h,r,u,p){for(var i=!1,a=p.length;a--;){var t=p[a],f=m(t[0],t[1],h,r);if(f>=0&&(t[0]=Math.min(t[0],h),t[1]=Math.max(t[1],r),i=!0,f/(r-h)>.5))return}if(i||p.push([h,r]),this.config.renderTextTracksNatively){var e=this.captionsTracks[g];this.Cues.newCue(e,h,r,u)}else{var d=this.Cues.newCue(null,h,r,u);this.hls.trigger(D.Events.CUES_PARSED,{type:"captions",cues:d,track:g})}},s.onInitPtsFound=function(g,h){var r=this,u=h.frag,p=h.id,i=h.initPTS,a=h.timescale,t=this.unparsedVttFrags;p==="main"&&(this.initPTS[u.cc]=i,this.timescale[u.cc]=a),t.length&&(this.unparsedVttFrags=[],t.forEach(function(f){r.onFragLoaded(D.Events.FRAG_LOADED,f)}))},s.getExistingTrack=function(g){var h=this.media;if(h)for(var r=0;r<h.textTracks.length;r++){var u=h.textTracks[r];if(u[g])return u}return null},s.createCaptionsTrack=function(g){this.config.renderTextTracksNatively?this.createNativeTrack(g):this.createNonNativeTrack(g)},s.createNativeTrack=function(g){if(!this.captionsTracks[g]){var h=this.captionsProperties,r=this.captionsTracks,u=this.media,p=h[g],i=p.label,a=p.languageCode,t=this.getExistingTrack(g);if(t)r[g]=t,(0,A.clearCurrentCues)(r[g]),(0,A.sendAddTrackEvent)(r[g],u);else{var f=this.createTextTrack("captions",i,a);f&&(f[g]=!0,r[g]=f)}}},s.createNonNativeTrack=function(g){if(!this.nonNativeCaptionsTracks[g]){var h=this.captionsProperties[g];if(h){var r=h.label,u={_id:g,label:r,kind:"captions",default:h.media?!!h.media.default:!1,closedCaptions:h.media};this.nonNativeCaptionsTracks[g]=u,this.hls.trigger(D.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[u]})}}},s.createTextTrack=function(g,h,r){var u=this.media;if(u)return u.addTextTrack(g,h,r)},s.onMediaAttaching=function(g,h){this.media=h.media,this._cleanTracks()},s.onMediaDetaching=function(){var g=this.captionsTracks;Object.keys(g).forEach(function(h){(0,A.clearCurrentCues)(g[h]),delete g[h]}),this.nonNativeCaptionsTracks={}},s.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=o(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},s._cleanTracks=function(){var g=this.media;if(g){var h=g.textTracks;if(h)for(var r=0;r<h.length;r++)(0,A.clearCurrentCues)(h[r])}},s.onSubtitleTracksUpdated=function(g,h){var r=this;this.textTracks=[];var u=h.subtitleTracks||[],p=u.some(function(f){return f.textCodec===L.IMSC1_CODEC});if(this.config.enableWebVTT||p&&this.config.enableIMSC1){var i=this.tracks&&u&&this.tracks.length===u.length;if(this.tracks=u||[],this.config.renderTextTracksNatively){var a=this.media?this.media.textTracks:[];this.tracks.forEach(function(f,e){var d;if(e<a.length){for(var E=null,v=0;v<a.length;v++)if(y(a[v],f)){E=a[v];break}E&&(d=E)}if(d)(0,A.clearCurrentCues)(d);else{var I=r._captionsOrSubtitlesFromCharacteristics(f);d=r.createTextTrack(I,f.name,f.lang),d&&(d.mode="disabled")}d&&(d.groupId=f.groupId,r.textTracks.push(d))})}else if(!i&&this.tracks&&this.tracks.length){var t=this.tracks.map(function(f){return{label:f.name,kind:f.type.toLowerCase(),default:f.default,subtitleTrack:f}});this.hls.trigger(D.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:t})}}},s._captionsOrSubtitlesFromCharacteristics=function(g){var h;if((h=g.attrs)!==null&&h!==void 0&&h.CHARACTERISTICS){var r=/transcribes-spoken-dialog/gi.test(g.attrs.CHARACTERISTICS),u=/describes-music-and-sound/gi.test(g.attrs.CHARACTERISTICS);if(r&&u)return"captions"}return"subtitles"},s.onManifestLoaded=function(g,h){var r=this;this.config.enableCEA708Captions&&h.captions&&h.captions.forEach(function(u){var p=/(?:CC|SERVICE)([1-4])/.exec(u.instreamId);if(p){var i="textTrack"+p[1],a=r.captionsProperties[i];a&&(a.label=u.name,u.lang&&(a.languageCode=u.lang),a.media=u)}})},s.closedCaptionsForLevel=function(g){var h=this.hls.levels[g.level];return h==null?void 0:h.attrs["CLOSED-CAPTIONS"]},s.onFragLoading=function(g,h){var r=this.cea608Parser1,u=this.cea608Parser2,p=this.lastSn,i=this.lastPartIndex;if(!(!this.enabled||!(r&&u))&&h.frag.type===_.PlaylistLevelType.MAIN){var a,t,f=h.frag.sn,e=(a=h==null||(t=h.part)===null||t===void 0?void 0:t.index)!=null?a:-1;f===p+1||f===p&&e===i+1||(r.reset(),u.reset()),this.lastSn=f,this.lastPartIndex=e}},s.onFragLoaded=function(g,h){var r=h.frag,u=h.payload,p=this.initPTS,i=this.unparsedVttFrags;if(r.type===_.PlaylistLevelType.SUBTITLE)if(u.byteLength){if(!(0,F.isFiniteNumber)(p[r.cc])){i.push(h),p.length&&this.hls.trigger(D.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Missing initial subtitle PTS")});return}var a=r.decryptdata,t="stats"in h;if(a==null||!a.encrypted||t){var f=this.tracks[r.level],e=this.vttCCs;e[r.cc]||(e[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),f&&f.textCodec===L.IMSC1_CODEC?this._parseIMSC1(r,u):this._parseVTTs(r,u,e)}}else this.hls.trigger(D.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})},s._parseIMSC1=function(g,h){var r=this,u=this.hls;(0,L.parseIMSC1)(h,this.initPTS[g.cc],this.timescale[g.cc],function(p){r._appendCues(p,g.level),u.trigger(D.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:g})},function(p){T.logger.log("Failed to parse IMSC1: "+p),u.trigger(D.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:g,error:p})})},s._parseVTTs=function(g,h,r){var u,p=this,i=this.hls,a=(u=g.initSegment)!==null&&u!==void 0&&u.data?(0,x.appendUint8Array)(g.initSegment.data,new Uint8Array(h)):h;(0,k.parseWebVTT)(a,this.initPTS[g.cc],this.timescale[g.cc],r,g.cc,g.start,function(t){p._appendCues(t,g.level),i.trigger(D.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:g})},function(t){p._fallbackToIMSC1(g,h),T.logger.log("Failed to parse VTT cue: "+t),i.trigger(D.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:g,error:t})})},s._fallbackToIMSC1=function(g,h){var r=this,u=this.tracks[g.level];u.textCodec||(0,L.parseIMSC1)(h,this.initPTS[g.cc],this.timescale[g.cc],function(){u.textCodec=L.IMSC1_CODEC,r._parseIMSC1(g,h)},function(){u.textCodec="wvtt"})},s._appendCues=function(g,h){var r=this.hls;if(this.config.renderTextTracksNatively){var u=this.textTracks[h];if(!u||u.mode==="disabled")return;g.forEach(function(a){return(0,A.addCueToTrack)(u,a)})}else{var p=this.tracks[h];if(!p)return;var i=p.default?"default":"subtitles"+h;r.trigger(D.Events.CUES_PARSED,{type:"subtitles",cues:g,track:i})}},s.onFragDecrypted=function(g,h){var r=h.frag;if(r.type===_.PlaylistLevelType.SUBTITLE){if(!(0,F.isFiniteNumber)(this.initPTS[r.cc])){this.unparsedVttFrags.push(h);return}this.onFragLoaded(D.Events.FRAG_LOADED,h)}},s.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},s.onFragParsingUserdata=function(g,h){var r=this.cea608Parser1,u=this.cea608Parser2;if(!(!this.enabled||!(r&&u))){var p=h.frag,i=h.samples;if(!(p.type===_.PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(p)==="NONE"))for(var a=0;a<i.length;a++){var t=i[a].bytes;if(t){var f=this.extractCea608Data(t);r.addData(i[a].pts,f[0]),u.addData(i[a].pts,f[1])}}}},s.onBufferFlushing=function(g,h){var r=h.startOffset,u=h.endOffset,p=h.endOffsetSubtitles,i=h.type,a=this.media;if(!(!a||a.currentTime<u)){if(!i||i==="video"){var t=this.captionsTracks;Object.keys(t).forEach(function(e){return(0,A.removeCuesInRange)(t[e],r,u)})}if(this.config.renderTextTracksNatively&&r===0&&p!==void 0){var f=this.textTracks;Object.keys(f).forEach(function(e){return(0,A.removeCuesInRange)(f[e],r,p)})}}},s.extractCea608Data=function(g){for(var h=[[],[]],r=g[0]&31,u=2,p=0;p<r;p++){var i=g[u++],a=127&g[u++],t=127&g[u++];if(!(a===0&&t===0)){var f=(4&i)!==0;if(f){var e=3&i;(e===0||e===1)&&(h[e].push(a),h[e].push(t))}}}return h},l}();function y(l,s){return l&&l.label===s.name&&!(l.textTrack1||l.textTrack2)}function m(l,s,n,g){return Math.min(s,g)-Math.max(l,n)}function o(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}},"./src/crypt/aes-crypto.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>F});var F=function(){function D(P,k){this.subtle=void 0,this.aesIV=void 0,this.subtle=P,this.aesIV=k}var b=D.prototype;return b.decrypt=function(k,A){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},A,k)},D}()},"./src/crypt/aes-decryptor.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>b,removePadding:()=>D});var F=S("./src/utils/typed-array.ts");function D(P){var k=P.byteLength,A=k&&new DataView(P.buffer).getUint8(k-1);return A?(0,F.sliceUint8)(P,0,k-A):P}var b=function(){function P(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var k=P.prototype;return k.uint8ArrayToUint32Array_=function(L){for(var x=new DataView(L),_=new Uint32Array(4),T=0;T<4;T++)_[T]=x.getUint32(T*4);return _},k.initTable=function(){var L=this.sBox,x=this.invSBox,_=this.subMix,T=_[0],c=_[1],y=_[2],m=_[3],o=this.invSubMix,l=o[0],s=o[1],n=o[2],g=o[3],h=new Uint32Array(256),r=0,u=0,p=0;for(p=0;p<256;p++)p<128?h[p]=p<<1:h[p]=p<<1^283;for(p=0;p<256;p++){var i=u^u<<1^u<<2^u<<3^u<<4;i=i>>>8^i&255^99,L[r]=i,x[i]=r;var a=h[r],t=h[a],f=h[t],e=h[i]*257^i*16843008;T[r]=e<<24|e>>>8,c[r]=e<<16|e>>>16,y[r]=e<<8|e>>>24,m[r]=e,e=f*16843009^t*65537^a*257^r*16843008,l[i]=e<<24|e>>>8,s[i]=e<<16|e>>>16,n[i]=e<<8|e>>>24,g[i]=e,r?(r=a^h[h[h[f^a]]],u^=h[h[u]]):r=u=1}},k.expandKey=function(L){for(var x=this.uint8ArrayToUint32Array_(L),_=!0,T=0;T<x.length&&_;)_=x[T]===this.key[T],T++;if(!_){this.key=x;var c=this.keySize=x.length;if(c!==4&&c!==6&&c!==8)throw new Error("Invalid aes key size="+c);var y=this.ksRows=(c+6+1)*4,m,o,l=this.keySchedule=new Uint32Array(y),s=this.invKeySchedule=new Uint32Array(y),n=this.sBox,g=this.rcon,h=this.invSubMix,r=h[0],u=h[1],p=h[2],i=h[3],a,t;for(m=0;m<y;m++){if(m<c){a=l[m]=x[m];continue}t=a,m%c===0?(t=t<<8|t>>>24,t=n[t>>>24]<<24|n[t>>>16&255]<<16|n[t>>>8&255]<<8|n[t&255],t^=g[m/c|0]<<24):c>6&&m%c===4&&(t=n[t>>>24]<<24|n[t>>>16&255]<<16|n[t>>>8&255]<<8|n[t&255]),l[m]=a=(l[m-c]^t)>>>0}for(o=0;o<y;o++)m=y-o,o&3?t=l[m]:t=l[m-4],o<4||m<=4?s[o]=t:s[o]=r[n[t>>>24]]^u[n[t>>>16&255]]^p[n[t>>>8&255]]^i[n[t&255]],s[o]=s[o]>>>0}},k.networkToHostOrderSwap=function(L){return L<<24|(L&65280)<<8|(L&16711680)>>8|L>>>24},k.decrypt=function(L,x,_){for(var T=this.keySize+6,c=this.invKeySchedule,y=this.invSBox,m=this.invSubMix,o=m[0],l=m[1],s=m[2],n=m[3],g=this.uint8ArrayToUint32Array_(_),h=g[0],r=g[1],u=g[2],p=g[3],i=new Int32Array(L),a=new Int32Array(i.length),t,f,e,d,E,v,I,R,O,C,M,B,w,N,W=this.networkToHostOrderSwap;x<i.length;){for(O=W(i[x]),C=W(i[x+1]),M=W(i[x+2]),B=W(i[x+3]),E=O^c[0],v=B^c[1],I=M^c[2],R=C^c[3],w=4,N=1;N<T;N++)t=o[E>>>24]^l[v>>16&255]^s[I>>8&255]^n[R&255]^c[w],f=o[v>>>24]^l[I>>16&255]^s[R>>8&255]^n[E&255]^c[w+1],e=o[I>>>24]^l[R>>16&255]^s[E>>8&255]^n[v&255]^c[w+2],d=o[R>>>24]^l[E>>16&255]^s[v>>8&255]^n[I&255]^c[w+3],E=t,v=f,I=e,R=d,w=w+4;t=y[E>>>24]<<24^y[v>>16&255]<<16^y[I>>8&255]<<8^y[R&255]^c[w],f=y[v>>>24]<<24^y[I>>16&255]<<16^y[R>>8&255]<<8^y[E&255]^c[w+1],e=y[I>>>24]<<24^y[R>>16&255]<<16^y[E>>8&255]<<8^y[v&255]^c[w+2],d=y[R>>>24]<<24^y[E>>16&255]<<16^y[v>>8&255]<<8^y[I&255]^c[w+3],a[x]=W(t^h),a[x+1]=W(d^r),a[x+2]=W(e^u),a[x+3]=W(f^p),h=O,r=C,u=M,p=B,x=x+4}return a.buffer},P}()},"./src/crypt/decrypter.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>x});var F=S("./src/crypt/aes-crypto.ts"),D=S("./src/crypt/fast-aes-key.ts"),b=S("./src/crypt/aes-decryptor.ts"),P=S("./src/utils/logger.ts"),k=S("./src/utils/mp4-tools.ts"),A=S("./src/utils/typed-array.ts"),L=16,x=function(){function _(c,y){var m=y===void 0?{}:y,o=m.removePKCS7Padding,l=o===void 0?!0:o;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=c.enableSoftwareAES,this.removePKCS7Padding=l,l)try{var s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}var T=_.prototype;return T.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},T.isSync=function(){return this.useSoftware},T.flush=function(){var y=this.currentResult,m=this.remainderData;if(!y||m)return this.reset(),null;var o=new Uint8Array(y);return this.reset(),this.removePKCS7Padding?(0,b.removePadding)(o):o},T.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},T.decrypt=function(y,m,o){var l=this;return this.useSoftware?new Promise(function(s,n){l.softwareDecrypt(new Uint8Array(y),m,o);var g=l.flush();g?s(g.buffer):n(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(y),m,o)},T.softwareDecrypt=function(y,m,o){var l=this.currentIV,s=this.currentResult,n=this.remainderData;this.logOnce("JS AES decrypt"),n&&(y=(0,k.appendUint8Array)(n,y),this.remainderData=null);var g=this.getValidChunk(y);if(!g.length)return null;l&&(o=l);var h=this.softwareDecrypter;h||(h=this.softwareDecrypter=new b.default),h.expandKey(m);var r=s;return this.currentResult=h.decrypt(g.buffer,0,o),this.currentIV=(0,A.sliceUint8)(g,-16).buffer,r||null},T.webCryptoDecrypt=function(y,m,o){var l=this,s=this.subtle;return(this.key!==m||!this.fastAesKey)&&(this.key=m,this.fastAesKey=new D.default(s,m)),this.fastAesKey.expandKey().then(function(n){if(!s)return Promise.reject(new Error("web crypto not initialized"));l.logOnce("WebCrypto AES decrypt");var g=new F.default(s,new Uint8Array(o));return g.decrypt(y.buffer,n)}).catch(function(n){return P.logger.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+n.name+": "+n.message),l.onWebCryptoError(y,m,o)})},T.onWebCryptoError=function(y,m,o){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(y,m,o);var l=this.flush();if(l)return l.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},T.getValidChunk=function(y){var m=y,o=y.length-y.length%L;return o!==y.length&&(m=(0,A.sliceUint8)(y,0,o),this.remainderData=(0,A.sliceUint8)(y,o)),m},T.logOnce=function(y){this.logEnabled&&(P.logger.log("[decrypter]: "+y),this.logEnabled=!1)},_}()},"./src/crypt/fast-aes-key.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>F});var F=function(){function D(P,k){this.subtle=void 0,this.key=void 0,this.subtle=P,this.key=k}var b=D.prototype;return b.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},D}()},"./src/demux/aacdemuxer.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>x});var F=S("./src/demux/base-audio-demuxer.ts"),D=S("./src/demux/adts.ts"),b=S("./src/utils/logger.ts"),P=S("./src/demux/id3.ts");function k(_,T){_.prototype=Object.create(T.prototype),_.prototype.constructor=_,A(_,T)}function A(_,T){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(y,m){return y.__proto__=m,y},A(_,T)}var L=function(_){k(T,_);function T(y,m){var o;return o=_.call(this)||this,o.observer=void 0,o.config=void 0,o.observer=y,o.config=m,o}var c=T.prototype;return c.resetInitSegment=function(m,o,l,s){_.prototype.resetInitSegment.call(this,m,o,l,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:o,duration:s,inputTimeScale:9e4,dropped:0}},T.probe=function(m){if(!m)return!1;for(var o=P.getID3Data(m,0)||[],l=o.length,s=m.length;l<s;l++)if(D.probe(m,l))return b.logger.log("ADTS sync word found !"),!0;return!1},c.canParse=function(m,o){return D.canParse(m,o)},c.appendFrame=function(m,o,l){D.initTrackConfig(m,this.observer,o,l,m.manifestCodec);var s=D.appendFrame(m,o,l,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s},T}(F.default);const x=L},"./src/demux/adts.ts":(V,U,S)=>{S.r(U),S.d(U,{appendFrame:()=>l,canGetFrameLength:()=>x,canParse:()=>T,getAudioConfig:()=>P,getFrameDuration:()=>m,getFullFrameLength:()=>L,getHeaderLength:()=>A,initTrackConfig:()=>y,isHeader:()=>_,isHeaderPattern:()=>k,parseFrameHeader:()=>o,probe:()=>c});var F=S("./src/utils/logger.ts"),D=S("./src/errors.ts"),b=S("./src/events.ts");function P(s,n,g,h){var r,u,p,i,a=navigator.userAgent.toLowerCase(),t=h,f=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];r=((n[g+2]&192)>>>6)+1;var e=(n[g+2]&60)>>>2;if(e>f.length-1){s.trigger(b.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+e});return}return p=(n[g+2]&1)<<2,p|=(n[g+3]&192)>>>6,F.logger.log("manifest codec:"+h+", ADTS type:"+r+", samplingIndex:"+e),/firefox/i.test(a)?e>=6?(r=5,i=new Array(4),u=e-3):(r=2,i=new Array(2),u=e):a.indexOf("android")!==-1?(r=2,i=new Array(2),u=e):(r=5,i=new Array(4),h&&(h.indexOf("mp4a.40.29")!==-1||h.indexOf("mp4a.40.5")!==-1)||!h&&e>=6?u=e-3:((h&&h.indexOf("mp4a.40.2")!==-1&&(e>=6&&p===1||/vivaldi/i.test(a))||!h&&p===1)&&(r=2,i=new Array(2)),u=e)),i[0]=r<<3,i[0]|=(e&14)>>1,i[1]|=(e&1)<<7,i[1]|=p<<3,r===5&&(i[1]|=(u&14)>>1,i[2]=(u&1)<<7,i[2]|=8,i[3]=0),{config:i,samplerate:f[e],channelCount:p,codec:"mp4a.40."+r,manifestCodec:t}}function k(s,n){return s[n]===255&&(s[n+1]&246)===240}function A(s,n){return s[n+1]&1?7:9}function L(s,n){return(s[n+3]&3)<<11|s[n+4]<<3|(s[n+5]&224)>>>5}function x(s,n){return n+5<s.length}function _(s,n){return n+1<s.length&&k(s,n)}function T(s,n){return x(s,n)&&k(s,n)&&L(s,n)<=s.length-n}function c(s,n){if(_(s,n)){var g=A(s,n);if(n+g>=s.length)return!1;var h=L(s,n);if(h<=g)return!1;var r=n+h;return r===s.length||_(s,r)}return!1}function y(s,n,g,h,r){if(!s.samplerate){var u=P(n,g,h,r);if(!u)return;s.config=u.config,s.samplerate=u.samplerate,s.channelCount=u.channelCount,s.codec=u.codec,s.manifestCodec=u.manifestCodec,F.logger.log("parsed codec:"+s.codec+", rate:"+u.samplerate+", channels:"+u.channelCount)}}function m(s){return 9216e4/s}function o(s,n){var g=A(s,n);if(n+g<=s.length){var h=L(s,n)-g;if(h>0)return{headerLength:g,frameLength:h}}}function l(s,n,g,h,r){var u=m(s.samplerate),p=h+r*u,i=o(n,g),a;if(i){var t=i.frameLength,f=i.headerLength,e=f+t,d=Math.max(0,g+e-n.length);d?(a=new Uint8Array(e-f),a.set(n.subarray(g+f,n.length),0)):a=n.subarray(g+f,g+e);var E={unit:a,pts:p};return d||s.samples.push(E),{sample:E,length:e,missing:d}}var v=n.length-g;a=new Uint8Array(v),a.set(n.subarray(g,n.length),0);var I={unit:a,pts:p};return{sample:I,length:v,missing:-1}}},"./src/demux/base-audio-demuxer.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>_,initPTSFn:()=>x});var F=S("./src/polyfills/number.ts"),D=S("./src/demux/id3.ts"),b=S("./src/types/demuxer.ts"),P=S("./src/demux/dummy-demuxed-track.ts"),k=S("./src/utils/mp4-tools.ts"),A=S("./src/utils/typed-array.ts"),L=function(){function T(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var c=T.prototype;return c.resetInitSegment=function(m,o,l,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},c.resetTimeStamp=function(m){this.initPTS=m,this.resetContiguity()},c.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},c.canParse=function(m,o){return!1},c.appendFrame=function(m,o,l){},c.demux=function(m,o){this.cachedData&&(m=(0,k.appendUint8Array)(this.cachedData,m),this.cachedData=null);var l=D.getID3Data(m,0),s=l?l.length:0,n,g=this._audioTrack,h=this._id3Track,r=l?D.getTimeStamp(l):void 0,u=m.length;for((this.basePTS===null||this.frameIndex===0&&(0,F.isFiniteNumber)(r))&&(this.basePTS=x(r,o,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),l&&l.length>0&&h.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:l,type:b.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});s<u;){if(this.canParse(m,s)){var p=this.appendFrame(g,m,s);p?(this.frameIndex++,this.lastPTS=p.sample.pts,s+=p.length,n=s):s=u}else D.canParse(m,s)?(l=D.getID3Data(m,s),h.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:l,type:b.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),s+=l.length,n=s):s++;if(s===u&&n!==u){var i=(0,A.sliceUint8)(m,n);this.cachedData?this.cachedData=(0,k.appendUint8Array)(this.cachedData,i):this.cachedData=i}}return{audioTrack:g,videoTrack:(0,P.dummyTrack)(),id3Track:h,textTrack:(0,P.dummyTrack)()}},c.demuxSampleAes=function(m,o,l){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},c.flush=function(m){var o=this.cachedData;return o&&(this.cachedData=null,this.demux(o,0)),{audioTrack:this._audioTrack,videoTrack:(0,P.dummyTrack)(),id3Track:this._id3Track,textTrack:(0,P.dummyTrack)()}},c.destroy=function(){},T}(),x=function(c,y,m){return(0,F.isFiniteNumber)(c)?c*90:y*9e4+(m||0)};const _=L},"./src/demux/chunk-cache.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>F});var F=function(){function b(){this.chunks=[],this.dataLength=0}var P=b.prototype;return P.push=function(A){this.chunks.push(A),this.dataLength+=A.length},P.flush=function(){var A=this.chunks,L=this.dataLength,x;if(A.length)A.length===1?x=A[0]:x=D(A,L);else return new Uint8Array(0);return this.reset(),x},P.reset=function(){this.chunks.length=0,this.dataLength=0},b}();function D(b,P){for(var k=new Uint8Array(P),A=0,L=0;L<b.length;L++){var x=b[L];k.set(x,A),A+=x.length}return k}},"./src/demux/dummy-demuxed-track.ts":(V,U,S)=>{S.r(U),S.d(U,{dummyTrack:()=>F});function F(D,b){return D===void 0&&(D=""),b===void 0&&(b=9e4),{type:D,id:-1,pid:-1,inputTimeScale:b,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>b});var F=S("./src/utils/logger.ts"),D=function(){function P(A){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=A,this.bytesAvailable=A.byteLength,this.word=0,this.bitsAvailable=0}var k=P.prototype;return k.loadWord=function(){var L=this.data,x=this.bytesAvailable,_=L.byteLength-x,T=new Uint8Array(4),c=Math.min(4,x);if(c===0)throw new Error("no bytes available");T.set(L.subarray(_,_+c)),this.word=new DataView(T.buffer).getUint32(0),this.bitsAvailable=c*8,this.bytesAvailable-=c},k.skipBits=function(L){var x;L=Math.min(L,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>L?(this.word<<=L,this.bitsAvailable-=L):(L-=this.bitsAvailable,x=L>>3,L-=x<<3,this.bytesAvailable-=x,this.loadWord(),this.word<<=L,this.bitsAvailable-=L)},k.readBits=function(L){var x=Math.min(this.bitsAvailable,L),_=this.word>>>32-x;if(L>32&&F.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=x,this.bitsAvailable>0)this.word<<=x;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return x=L-x,x>0&&this.bitsAvailable?_<<x|this.readBits(x):_},k.skipLZ=function(){var L;for(L=0;L<this.bitsAvailable;++L)if(this.word&2147483648>>>L)return this.word<<=L,this.bitsAvailable-=L,L;return this.loadWord(),L+this.skipLZ()},k.skipUEG=function(){this.skipBits(1+this.skipLZ())},k.skipEG=function(){this.skipBits(1+this.skipLZ())},k.readUEG=function(){var L=this.skipLZ();return this.readBits(L+1)-1},k.readEG=function(){var L=this.readUEG();return 1&L?1+L>>>1:-1*(L>>>1)},k.readBoolean=function(){return this.readBits(1)===1},k.readUByte=function(){return this.readBits(8)},k.readUShort=function(){return this.readBits(16)},k.readUInt=function(){return this.readBits(32)},k.skipScalingList=function(L){for(var x=8,_=8,T,c=0;c<L;c++)_!==0&&(T=this.readEG(),_=(x+T+256)%256),x=_===0?x:_},k.readSPS=function(){var L=0,x=0,_=0,T=0,c,y,m,o=this.readUByte.bind(this),l=this.readBits.bind(this),s=this.readUEG.bind(this),n=this.readBoolean.bind(this),g=this.skipBits.bind(this),h=this.skipEG.bind(this),r=this.skipUEG.bind(this),u=this.skipScalingList.bind(this);o();var p=o();if(l(5),g(3),o(),r(),p===100||p===110||p===122||p===244||p===44||p===83||p===86||p===118||p===128){var i=s();if(i===3&&g(1),r(),r(),g(1),n())for(y=i!==3?8:12,m=0;m<y;m++)n()&&(m<6?u(16):u(64))}r();var a=s();if(a===0)s();else if(a===1)for(g(1),h(),h(),c=s(),m=0;m<c;m++)h();r(),g(1);var t=s(),f=s(),e=l(1);e===0&&g(1),g(1),n()&&(L=s(),x=s(),_=s(),T=s());var d=[1,1];if(n()&&n()){var E=o();switch(E){case 1:d=[1,1];break;case 2:d=[12,11];break;case 3:d=[10,11];break;case 4:d=[16,11];break;case 5:d=[40,33];break;case 6:d=[24,11];break;case 7:d=[20,11];break;case 8:d=[32,11];break;case 9:d=[80,33];break;case 10:d=[18,11];break;case 11:d=[15,11];break;case 12:d=[64,33];break;case 13:d=[160,99];break;case 14:d=[4,3];break;case 15:d=[3,2];break;case 16:d=[2,1];break;case 255:{d=[o()<<8|o(),o()<<8|o()];break}}}return{width:Math.ceil((t+1)*16-L*2-x*2),height:(2-e)*(f+1)*16-(e?2:4)*(_+T),pixelRatio:d}},k.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},P}();const b=D},"./src/demux/id3.ts":(V,U,S)=>{S.r(U),S.d(U,{canParse:()=>k,decodeFrame:()=>T,getID3Data:()=>b,getID3Frames:()=>_,getTimeStamp:()=>A,isFooter:()=>D,isHeader:()=>F,isTimeStampFrame:()=>L,testables:()=>s,utf8ArrayToStr:()=>l});var F=function(r,u){return u+10<=r.length&&r[u]===73&&r[u+1]===68&&r[u+2]===51&&r[u+3]<255&&r[u+4]<255&&r[u+6]<128&&r[u+7]<128&&r[u+8]<128&&r[u+9]<128},D=function(r,u){return u+10<=r.length&&r[u]===51&&r[u+1]===68&&r[u+2]===73&&r[u+3]<255&&r[u+4]<255&&r[u+6]<128&&r[u+7]<128&&r[u+8]<128&&r[u+9]<128},b=function(r,u){for(var p=u,i=0;F(r,u);){i+=10;var a=P(r,u+6);i+=a,D(r,u+10)&&(i+=10),u+=i}if(i>0)return r.subarray(p,p+i)},P=function(r,u){var p=0;return p=(r[u]&127)<<21,p|=(r[u+1]&127)<<14,p|=(r[u+2]&127)<<7,p|=r[u+3]&127,p},k=function(r,u){return F(r,u)&&P(r,u+6)+10<=r.length-u},A=function(r){for(var u=_(r),p=0;p<u.length;p++){var i=u[p];if(L(i))return o(i)}},L=function(r){return r&&r.key==="PRIV"&&r.info==="com.apple.streaming.transportStreamTimestamp"},x=function(r){var u=String.fromCharCode(r[0],r[1],r[2],r[3]),p=P(r,4),i=10;return{type:u,size:p,data:r.subarray(i,i+p)}},_=function(r){for(var u=0,p=[];F(r,u);){var i=P(r,u+6);u+=10;for(var a=u+i;u+8<a;){var t=x(r.subarray(u)),f=T(t);f&&p.push(f),u+=t.size+10}D(r,u)&&(u+=10)}return p},T=function(r){return r.type==="PRIV"?c(r):r.type[0]==="W"?m(r):y(r)},c=function(r){if(!(r.size<2)){var u=l(r.data,!0),p=new Uint8Array(r.data.subarray(u.length+1));return{key:r.type,info:u,data:p.buffer}}},y=function(r){if(!(r.size<2)){if(r.type==="TXXX"){var u=1,p=l(r.data.subarray(u),!0);u+=p.length+1;var i=l(r.data.subarray(u));return{key:r.type,info:p,data:i}}var a=l(r.data.subarray(1));return{key:r.type,data:a}}},m=function(r){if(r.type==="WXXX"){if(r.size<2)return;var u=1,p=l(r.data.subarray(u),!0);u+=p.length+1;var i=l(r.data.subarray(u));return{key:r.type,info:p,data:i}}var a=l(r.data);return{key:r.type,data:a}},o=function(r){if(r.data.byteLength===8){var u=new Uint8Array(r.data),p=u[3]&1,i=(u[4]<<23)+(u[5]<<15)+(u[6]<<7)+u[7];return i/=45,p&&(i+=4772185884e-2),Math.round(i)}},l=function(r,u){u===void 0&&(u=!1);var p=g();if(p){var i=p.decode(r);if(u){var a=i.indexOf("\0");return a!==-1?i.substring(0,a):i}return i.replace(/\0/g,"")}for(var t=r.length,f,e,d,E="",v=0;v<t;){if(f=r[v++],f===0&&u)return E;if(f===0||f===3)continue;switch(f>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:E+=String.fromCharCode(f);break;case 12:case 13:e=r[v++],E+=String.fromCharCode((f&31)<<6|e&63);break;case 14:e=r[v++],d=r[v++],E+=String.fromCharCode((f&15)<<12|(e&63)<<6|(d&63)<<0);break}}return E},s={decodeTextFrame:y},n;function g(){return!n&&typeof self.TextDecoder<"u"&&(n=new self.TextDecoder("utf-8")),n}},"./src/demux/mp3demuxer.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>x});var F=S("./src/demux/base-audio-demuxer.ts"),D=S("./src/demux/id3.ts"),b=S("./src/utils/logger.ts"),P=S("./src/demux/mpegaudio.ts");function k(_,T){_.prototype=Object.create(T.prototype),_.prototype.constructor=_,A(_,T)}function A(_,T){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(y,m){return y.__proto__=m,y},A(_,T)}var L=function(_){k(T,_);function T(){return _.apply(this,arguments)||this}var c=T.prototype;return c.resetInitSegment=function(m,o,l,s){_.prototype.resetInitSegment.call(this,m,o,l,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:o,duration:s,inputTimeScale:9e4,dropped:0}},T.probe=function(m){if(!m)return!1;for(var o=D.getID3Data(m,0)||[],l=o.length,s=m.length;l<s;l++)if(P.probe(m,l))return b.logger.log("MPEG Audio sync word found !"),!0;return!1},c.canParse=function(m,o){return P.canParse(m,o)},c.appendFrame=function(m,o,l){if(this.basePTS!==null)return P.appendFrame(m,o,l,this.basePTS,this.frameIndex)},T}(F.default);const x=L},"./src/demux/mp4demuxer.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>L});var F=S("./src/polyfills/number.ts"),D=S("./src/types/demuxer.ts"),b=S("./src/utils/mp4-tools.ts"),P=S("./src/demux/dummy-demuxed-track.ts"),k=/\/emsg[-/]ID3/i,A=function(){function x(T,c){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=c}var _=x.prototype;return _.resetTimeStamp=function(){},_.resetInitSegment=function(c,y,m,o){var l=this.videoTrack=(0,P.dummyTrack)("video",1),s=this.audioTrack=(0,P.dummyTrack)("audio",1),n=this.txtTrack=(0,P.dummyTrack)("text",1);if(this.id3Track=(0,P.dummyTrack)("id3",1),this.timeOffset=0,!(!c||!c.byteLength)){var g=(0,b.parseInitSegment)(c);if(g.video){var h=g.video,r=h.id,u=h.timescale,p=h.codec;l.id=r,l.timescale=n.timescale=u,l.codec=p}if(g.audio){var i=g.audio,a=i.id,t=i.timescale,f=i.codec;s.id=a,s.timescale=t,s.codec=f}n.id=b.RemuxerTrackIdConfig.text,l.sampleDuration=0,l.duration=s.duration=o}},_.resetContiguity=function(){},x.probe=function(c){return c=c.length>16384?c.subarray(0,16384):c,(0,b.findBox)(c,["moof"]).length>0},_.demux=function(c,y){this.timeOffset=y;var m=c,o=this.videoTrack,l=this.txtTrack;if(this.config.progressive){this.remainderData&&(m=(0,b.appendUint8Array)(this.remainderData,c));var s=(0,b.segmentValidRange)(m);this.remainderData=s.remainder,o.samples=s.valid||new Uint8Array}else o.samples=m;var n=this.extractID3Track(o,y);return l.samples=(0,b.parseSamples)(y,o),{videoTrack:o,audioTrack:this.audioTrack,id3Track:n,textTrack:this.txtTrack}},_.flush=function(){var c=this.timeOffset,y=this.videoTrack,m=this.txtTrack;y.samples=this.remainderData||new Uint8Array,this.remainderData=null;var o=this.extractID3Track(y,this.timeOffset);return m.samples=(0,b.parseSamples)(c,y),{videoTrack:y,audioTrack:(0,P.dummyTrack)(),id3Track:o,textTrack:(0,P.dummyTrack)()}},_.extractID3Track=function(c,y){var m=this.id3Track;if(c.samples.length){var o=(0,b.findBox)(c.samples,["emsg"]);o&&o.forEach(function(l){var s=(0,b.parseEmsg)(l);if(k.test(s.schemeIdUri)){var n=(0,F.isFiniteNumber)(s.presentationTime)?s.presentationTime/s.timeScale:y+s.presentationTimeDelta/s.timeScale,g=s.eventDuration===4294967295?Number.POSITIVE_INFINITY:s.eventDuration/s.timeScale;g<=.001&&(g=Number.POSITIVE_INFINITY);var h=s.payload;m.samples.push({data:h,len:h.byteLength,dts:n,pts:n,type:D.MetadataSchema.emsg,duration:g})}})}return m},_.demuxSampleAes=function(c,y,m){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},_.destroy=function(){},x}();const L=A},"./src/demux/mpegaudio.ts":(V,U,S)=>{S.r(U),S.d(U,{appendFrame:()=>A,canParse:()=>T,isHeader:()=>_,isHeaderPattern:()=>x,parseHeader:()=>L,probe:()=>c});var F=null,D=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],b=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],P=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],k=[0,1,1,4];function A(y,m,o,l,s){if(!(o+24>m.length)){var n=L(m,o);if(n&&o+n.frameLength<=m.length){var g=n.samplesPerFrame*9e4/n.sampleRate,h=l+s*g,r={unit:m.subarray(o,o+n.frameLength),pts:h,dts:h};return y.config=[],y.channelCount=n.channelCount,y.samplerate=n.sampleRate,y.samples.push(r),{sample:r,length:n.frameLength,missing:0}}}}function L(y,m){var o=y[m+1]>>3&3,l=y[m+1]>>1&3,s=y[m+2]>>4&15,n=y[m+2]>>2&3;if(o!==1&&s!==0&&s!==15&&n!==3){var g=y[m+2]>>1&1,h=y[m+3]>>6,r=o===3?3-l:l===3?3:4,u=D[r*14+s-1]*1e3,p=o===3?0:o===2?1:2,i=b[p*3+n],a=h===3?1:2,t=P[o][l],f=k[l],e=t*8*f,d=Math.floor(t*u/i+g)*f;if(F===null){var E=navigator.userAgent||"",v=E.match(/Chrome\/(\d+)/i);F=v?parseInt(v[1]):0}var I=!!F&&F<=87;return I&&l===2&&u>=224e3&&h===0&&(y[m+3]=y[m+3]|128),{sampleRate:i,channelCount:a,frameLength:d,samplesPerFrame:e}}}function x(y,m){return y[m]===255&&(y[m+1]&224)===224&&(y[m+1]&6)!==0}function _(y,m){return m+1<y.length&&x(y,m)}function T(y,m){var o=4;return x(y,m)&&o<=y.length-m}function c(y,m){if(m+1<y.length&&x(y,m)){var o=4,l=L(y,m),s=o;l!=null&&l.frameLength&&(s=l.frameLength);var n=m+s;return n===y.length||_(y,n)}return!1}},"./src/demux/sample-aes.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>P});var F=S("./src/crypt/decrypter.ts"),D=S("./src/utils/mp4-tools.ts"),b=function(){function k(L,x,_){this.keyData=void 0,this.decrypter=void 0,this.keyData=_,this.decrypter=new F.default(x,{removePKCS7Padding:!1})}var A=k.prototype;return A.decryptBuffer=function(x){return this.decrypter.decrypt(x,this.keyData.key.buffer,this.keyData.iv.buffer)},A.decryptAacSample=function(x,_,T){var c=this,y=x[_].unit;if(!(y.length<=16)){var m=y.subarray(16,y.length-y.length%16),o=m.buffer.slice(m.byteOffset,m.byteOffset+m.length);this.decryptBuffer(o).then(function(l){var s=new Uint8Array(l);y.set(s,16),c.decrypter.isSync()||c.decryptAacSamples(x,_+1,T)})}},A.decryptAacSamples=function(x,_,T){for(;;_++){if(_>=x.length){T();return}if(!(x[_].unit.length<32)&&(this.decryptAacSample(x,_,T),!this.decrypter.isSync()))return}},A.getAvcEncryptedData=function(x){for(var _=Math.floor((x.length-48)/160)*16+16,T=new Int8Array(_),c=0,y=32;y<x.length-16;y+=160,c+=16)T.set(x.subarray(y,y+16),c);return T},A.getAvcDecryptedUnit=function(x,_){for(var T=new Uint8Array(_),c=0,y=32;y<x.length-16;y+=160,c+=16)x.set(T.subarray(c,c+16),y);return x},A.decryptAvcSample=function(x,_,T,c,y){var m=this,o=(0,D.discardEPB)(y.data),l=this.getAvcEncryptedData(o);this.decryptBuffer(l.buffer).then(function(s){y.data=m.getAvcDecryptedUnit(o,s),m.decrypter.isSync()||m.decryptAvcSamples(x,_,T+1,c)})},A.decryptAvcSamples=function(x,_,T,c){if(x instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;_++,T=0){if(_>=x.length){c();return}for(var y=x[_].units;!(T>=y.length);T++){var m=y[T];if(!(m.data.length<=48||m.type!==1&&m.type!==5)&&(this.decryptAvcSample(x,_,T,c,m),!this.decrypter.isSync()))return}}},k}();const P=b},"./src/demux/transmuxer-interface.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>_});var F=S("./src/demux/webworkify-webpack.js"),D=S("./src/events.ts"),b=S("./src/demux/transmuxer.ts"),P=S("./src/utils/logger.ts"),k=S("./src/errors.ts"),A=S("./src/utils/mediasource-helper.ts"),L=S("./node_modules/eventemitter3/index.js"),x=(0,A.getMediaSource)()||{isTypeSupported:function(){return!1}},_=function(){function T(y,m,o,l){var s=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var n=y.config;this.hls=y,this.id=m,this.useWorker=!!n.enableWorker,this.onTransmuxComplete=o,this.onFlush=l;var g=function(i,a){a=a||{},a.frag=s.frag,a.id=s.id,s.hls.trigger(i,a)};this.observer=new L.EventEmitter,this.observer.on(D.Events.FRAG_DECRYPTED,g),this.observer.on(D.Events.ERROR,g);var h={mp4:x.isTypeSupported("video/mp4"),mpeg:x.isTypeSupported("audio/mpeg"),mp3:x.isTypeSupported('audio/mp4; codecs="mp3"')},r=navigator.vendor;if(this.useWorker&&typeof Worker<"u"){P.logger.log("demuxing in webworker");var u;try{u=this.worker=(0,F.default)("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),u.addEventListener("message",this.onwmsg),u.onerror=function(p){s.useWorker=!1,P.logger.warn("Exception in webworker, fallback to inline"),s.hls.trigger(D.Events.ERROR,{type:k.ErrorTypes.OTHER_ERROR,details:k.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(p.message+"  ("+p.filename+":"+p.lineno+")")})},u.postMessage({cmd:"init",typeSupported:h,vendor:r,id:m,config:JSON.stringify(n)})}catch(p){P.logger.warn("Error in worker:",p),P.logger.error("Error while initializing DemuxerWorker, fallback to inline"),u&&self.URL.revokeObjectURL(u.objectURL),this.transmuxer=new b.default(this.observer,h,n,r,m),this.worker=null}}else this.transmuxer=new b.default(this.observer,h,n,r,m)}var c=T.prototype;return c.destroy=function(){var m=this.worker;if(m)m.removeEventListener("message",this.onwmsg),m.terminate(),this.worker=null,this.onwmsg=void 0;else{var o=this.transmuxer;o&&(o.destroy(),this.transmuxer=null)}var l=this.observer;l&&l.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},c.push=function(m,o,l,s,n,g,h,r,u,p){var i,a,t=this;u.transmuxing.start=self.performance.now();var f=this.transmuxer,e=this.worker,d=g?g.start:n.start,E=n.decryptdata,v=this.frag,I=!(v&&n.cc===v.cc),R=!(v&&u.level===v.level),O=v?u.sn-v.sn:-1,C=this.part?u.part-this.part.index:-1,M=O===0&&u.id>1&&u.id===(v==null?void 0:v.stats.chunkCount),B=!R&&(O===1||O===0&&(C===1||M&&C<=0)),w=self.performance.now();(R||O||n.stats.parsing.start===0)&&(n.stats.parsing.start=w),g&&(C||!B)&&(g.stats.parsing.start=w);var N=!(v&&((i=n.initSegment)===null||i===void 0?void 0:i.url)===((a=v.initSegment)===null||a===void 0?void 0:a.url)),W=new b.TransmuxState(I,B,r,R,d,N);if(!B||I||N){P.logger.log("[transmuxer-interface, "+n.type+"]: Starting new transmux session for sn: "+u.sn+" p: "+u.part+" level: "+u.level+" id: "+u.id+`
        discontinuity: `+I+`
        trackSwitch: `+R+`
        contiguous: `+B+`
        accurateTimeOffset: `+r+`
        timeOffset: `+d+`
        initSegmentChange: `+N);var G=new b.TransmuxConfig(l,s,o,h,p);this.configureTransmuxer(G)}if(this.frag=n,this.part=g,e)e.postMessage({cmd:"demux",data:m,decryptdata:E,chunkMeta:u,state:W},m instanceof ArrayBuffer?[m]:[]);else if(f){var H=f.push(m,E,u,W);(0,b.isPromise)(H)?(f.async=!0,H.then(function($){t.handleTransmuxComplete($)}).catch(function($){t.transmuxerError($,u,"transmuxer-interface push error")})):(f.async=!1,this.handleTransmuxComplete(H))}},c.flush=function(m){var o=this;m.transmuxing.start=self.performance.now();var l=this.transmuxer,s=this.worker;if(s)s.postMessage({cmd:"flush",chunkMeta:m});else if(l){var n=l.flush(m),g=(0,b.isPromise)(n);g||l.async?((0,b.isPromise)(n)||(n=Promise.resolve(n)),n.then(function(h){o.handleFlushResult(h,m)}).catch(function(h){o.transmuxerError(h,m,"transmuxer-interface flush error")})):this.handleFlushResult(n,m)}},c.transmuxerError=function(m,o,l){this.hls&&this.hls.trigger(D.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:o,fatal:!1,error:m,err:m,reason:l})},c.handleFlushResult=function(m,o){var l=this;m.forEach(function(s){l.handleTransmuxComplete(s)}),this.onFlush(o)},c.onWorkerMessage=function(m){var o=m.data,l=this.hls;switch(o.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(o.data);break}case"flush":{this.onFlush(o.data);break}case"workerLog":P.logger[o.data.logType]&&P.logger[o.data.logType](o.data.message);break;default:{o.data=o.data||{},o.data.frag=this.frag,o.data.id=this.id,l.trigger(o.event,o.data);break}}},c.configureTransmuxer=function(m){var o=this.worker,l=this.transmuxer;o?o.postMessage({cmd:"configure",config:m}):l&&l.configure(m)},c.handleTransmuxComplete=function(m){m.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(m)},T}()},"./src/demux/transmuxer-worker.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>A});var F=S("./src/demux/transmuxer.ts"),D=S("./src/events.ts"),b=S("./src/utils/logger.ts"),P=S("./node_modules/eventemitter3/index.js"),k=S("./src/errors.ts");function A(c){var y=new P.EventEmitter,m=function(s,n){c.postMessage({event:s,data:n})};y.on(D.Events.FRAG_DECRYPTED,m),y.on(D.Events.ERROR,m);var o=function(){var s=function(h){var r=function(p){m("workerLog",{logType:h,message:p})};b.logger[h]=r};for(var n in b.logger)s(n)};c.addEventListener("message",function(l){var s=l.data;switch(s.cmd){case"init":{var n=JSON.parse(s.config);c.transmuxer=new F.default(y,s.typeSupported,n,s.vendor,s.id),(0,b.enableLogs)(n.debug,s.id),o(),m("init",null);break}case"configure":{c.transmuxer.configure(s.config);break}case"demux":{var g=c.transmuxer.push(s.data,s.decryptdata,s.chunkMeta,s.state);(0,F.isPromise)(g)?(c.transmuxer.async=!0,g.then(function(p){L(c,p)}).catch(function(p){m(D.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:s.chunkMeta,fatal:!1,error:p,err:p,reason:"transmuxer-worker push error"})})):(c.transmuxer.async=!1,L(c,g));break}case"flush":{var h=s.chunkMeta,r=c.transmuxer.flush(h),u=(0,F.isPromise)(r);u||c.transmuxer.async?((0,F.isPromise)(r)||(r=Promise.resolve(r)),r.then(function(p){_(c,p,h)}).catch(function(p){m(D.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:s.chunkMeta,fatal:!1,error:p,err:p,reason:"transmuxer-worker flush error"})})):_(c,r,h);break}}})}function L(c,y){if(T(y.remuxResult))return!1;var m=[],o=y.remuxResult,l=o.audio,s=o.video;return l&&x(m,l),s&&x(m,s),c.postMessage({event:"transmuxComplete",data:y},m),!0}function x(c,y){y.data1&&c.push(y.data1.buffer),y.data2&&c.push(y.data2.buffer)}function _(c,y,m){var o=y.reduce(function(l,s){return L(c,s)||l},!1);o||c.postMessage({event:"transmuxComplete",data:y[0]}),c.postMessage({event:"flush",data:m})}function T(c){return!c.audio&&!c.video&&!c.text&&!c.id3&&!c.initSegment}},"./src/demux/transmuxer.ts":(V,U,S)=>{S.r(U),S.d(U,{TransmuxConfig:()=>n,TransmuxState:()=>g,default:()=>m,isPromise:()=>s});var F=S("./src/events.ts"),D=S("./src/errors.ts"),b=S("./src/crypt/decrypter.ts"),P=S("./src/demux/aacdemuxer.ts"),k=S("./src/demux/mp4demuxer.ts"),A=S("./src/demux/tsdemuxer.ts"),L=S("./src/demux/mp3demuxer.ts"),x=S("./src/remux/mp4-remuxer.ts"),_=S("./src/remux/passthrough-remuxer.ts"),T=S("./src/utils/logger.ts"),c;try{c=self.performance.now.bind(self.performance)}catch{T.logger.debug("Unable to use Performance API on this environment"),c=self.Date.now}var y=[{demux:k.default,remux:_.default},{demux:A.default,remux:x.default},{demux:P.default,remux:x.default},{demux:L.default,remux:x.default}],m=function(){function h(u,p,i,a,t){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=u,this.typeSupported=p,this.config=i,this.vendor=a,this.id=t}var r=h.prototype;return r.configure=function(p){this.transmuxConfig=p,this.decrypter&&this.decrypter.reset()},r.push=function(p,i,a,t){var f=this,e=a.transmuxing;e.executeStart=c();var d=new Uint8Array(p),E=this.currentTransmuxState,v=this.transmuxConfig;t&&(this.currentTransmuxState=t);var I=t||E,R=I.contiguous,O=I.discontinuity,C=I.trackSwitch,M=I.accurateTimeOffset,B=I.timeOffset,w=I.initSegmentChange,N=v.audioCodec,W=v.videoCodec,G=v.defaultInitPts,H=v.duration,$=v.initSegmentData,Y=o(d,i);if(Y&&Y.method==="AES-128"){var z=this.getDecrypter();if(z.isSync()){var J=z.softwareDecrypt(d,Y.key.buffer,Y.iv.buffer),te=a.part>-1;if(te&&(J=z.flush()),!J)return e.executeEnd=c(),l(a);d=new Uint8Array(J)}else return this.decryptionPromise=z.webCryptoDecrypt(d,Y.key.buffer,Y.iv.buffer).then(function(ae){var se=f.push(ae,null,a);return f.decryptionPromise=null,se}),this.decryptionPromise}var q=this.needsProbing(O,C);q&&this.configureTransmuxer(d),(O||C||w||q)&&this.resetInitSegment($,N,W,H,i),(O||w||q)&&this.resetInitialTimestamp(G),R||this.resetContiguity();var Q=this.transmux(d,Y,B,M,a),re=this.currentTransmuxState;return re.contiguous=!0,re.discontinuity=!1,re.trackSwitch=!1,e.executeEnd=c(),Q},r.flush=function(p){var i=this,a=p.transmuxing;a.executeStart=c();var t=this.decrypter,f=this.currentTransmuxState,e=this.decryptionPromise;if(e)return e.then(function(){return i.flush(p)});var d=[],E=f.timeOffset;if(t){var v=t.flush();v&&d.push(this.push(v,null,p))}var I=this.demuxer,R=this.remuxer;if(!I||!R)return this.observer.emit(F.Events.ERROR,F.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),a.executeEnd=c(),[l(p)];var O=I.flush(E);return s(O)?O.then(function(C){return i.flushRemux(d,C,p),d}):(this.flushRemux(d,O,p),d)},r.flushRemux=function(p,i,a){var t=i.audioTrack,f=i.videoTrack,e=i.id3Track,d=i.textTrack,E=this.currentTransmuxState,v=E.accurateTimeOffset,I=E.timeOffset;T.logger.log("[transmuxer.ts]: Flushed fragment "+a.sn+(a.part>-1?" p: "+a.part:"")+" of level "+a.level);var R=this.remuxer.remux(t,f,e,d,I,v,!0,this.id);p.push({remuxResult:R,chunkMeta:a}),a.transmuxing.executeEnd=c()},r.resetInitialTimestamp=function(p){var i=this.demuxer,a=this.remuxer;!i||!a||(i.resetTimeStamp(p),a.resetTimeStamp(p))},r.resetContiguity=function(){var p=this.demuxer,i=this.remuxer;!p||!i||(p.resetContiguity(),i.resetNextTimestamp())},r.resetInitSegment=function(p,i,a,t,f){var e=this.demuxer,d=this.remuxer;!e||!d||(e.resetInitSegment(p,i,a,t),d.resetInitSegment(p,i,a,f))},r.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},r.transmux=function(p,i,a,t,f){var e;return i&&i.method==="SAMPLE-AES"?e=this.transmuxSampleAes(p,i,a,t,f):e=this.transmuxUnencrypted(p,a,t,f),e},r.transmuxUnencrypted=function(p,i,a,t){var f=this.demuxer.demux(p,i,!1,!this.config.progressive),e=f.audioTrack,d=f.videoTrack,E=f.id3Track,v=f.textTrack,I=this.remuxer.remux(e,d,E,v,i,a,!1,this.id);return{remuxResult:I,chunkMeta:t}},r.transmuxSampleAes=function(p,i,a,t,f){var e=this;return this.demuxer.demuxSampleAes(p,i,a).then(function(d){var E=e.remuxer.remux(d.audioTrack,d.videoTrack,d.id3Track,d.textTrack,a,t,!1,e.id);return{remuxResult:E,chunkMeta:f}})},r.configureTransmuxer=function(p){for(var i=this.config,a=this.observer,t=this.typeSupported,f=this.vendor,e,d=0,E=y.length;d<E;d++)if(y[d].demux.probe(p)){e=y[d];break}e||(T.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),e={demux:k.default,remux:_.default});var v=this.demuxer,I=this.remuxer,R=e.remux,O=e.demux;(!I||!(I instanceof R))&&(this.remuxer=new R(a,i,t,f)),(!v||!(v instanceof O))&&(this.demuxer=new O(a,i,t),this.probe=O.probe)},r.needsProbing=function(p,i){return!this.demuxer||!this.remuxer||p||i},r.getDecrypter=function(){var p=this.decrypter;return p||(p=this.decrypter=new b.default(this.config)),p},h}();function o(h,r){var u=null;return h.byteLength>0&&r!=null&&r.key!=null&&r.iv!==null&&r.method!=null&&(u=r),u}var l=function(r){return{remuxResult:{},chunkMeta:r}};function s(h){return"then"in h&&h.then instanceof Function}var n=function(r,u,p,i,a){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=r,this.videoCodec=u,this.initSegmentData=p,this.duration=i,this.defaultInitPts=a},g=function(r,u,p,i,a,t){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=r,this.contiguous=u,this.accurateTimeOffset=p,this.trackSwitch=i,this.timeOffset=a,this.initSegmentChange=t}},"./src/demux/tsdemuxer.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>h});var F=S("./src/demux/adts.ts"),D=S("./src/demux/mpegaudio.ts"),b=S("./src/demux/exp-golomb.ts"),P=S("./src/demux/sample-aes.ts"),k=S("./src/events.ts"),A=S("./src/utils/mp4-tools.ts"),L=S("./src/utils/logger.ts"),x=S("./src/errors.ts"),_=S("./src/types/demuxer.ts");function T(){return T=Object.assign?Object.assign.bind():function(r){for(var u=1;u<arguments.length;u++){var p=arguments[u];for(var i in p)Object.prototype.hasOwnProperty.call(p,i)&&(r[i]=p[i])}return r},T.apply(this,arguments)}var c=188,y=function(){function r(p,i,a){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=p,this.config=i,this.typeSupported=a}r.probe=function(i){var a=r.syncOffset(i);return a>0&&L.logger.warn("MPEG2-TS detected but first sync word found @ offset "+a),a!==-1},r.syncOffset=function(i){for(var a=i.length,t=Math.min(c*5,i.length-c)+1,f=0;f<t;){for(var e=!1,d=f;d<a&&i[d]===71;d+=c)if(!e&&o(i,d)===0&&(e=!0),e&&d+c>t)return f;f++}return-1},r.createTrack=function(i,a){return{container:i==="video"||i==="audio"?"video/mp2t":void 0,type:i,id:A.RemuxerTrackIdConfig[i],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:i==="audio"?a:void 0}};var u=r.prototype;return u.resetInitSegment=function(i,a,t,f){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=r.createTrack("video"),this._audioTrack=r.createTrack("audio",f),this._id3Track=r.createTrack("id3"),this._txtTrack=r.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=a,this.videoCodec=t,this._duration=f},u.resetTimeStamp=function(){},u.resetContiguity=function(){var i=this._audioTrack,a=this._avcTrack,t=this._id3Track;i&&(i.pesData=null),a&&(a.pesData=null),t&&(t.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},u.demux=function(i,a,t,f){t===void 0&&(t=!1),f===void 0&&(f=!1),t||(this.sampleAes=null);var e,d=this._avcTrack,E=this._audioTrack,v=this._id3Track,I=this._txtTrack,R=d.pid,O=d.pesData,C=E.pid,M=v.pid,B=E.pesData,w=v.pesData,N=null,W=this.pmtParsed,G=this._pmtId,H=i.length;if(this.remainderData&&(i=(0,A.appendUint8Array)(this.remainderData,i),H=i.length,this.remainderData=null),H<c&&!f)return this.remainderData=i,{audioTrack:E,videoTrack:d,id3Track:v,textTrack:I};var $=Math.max(0,r.syncOffset(i));H-=(H-$)%c,H<i.byteLength&&!f&&(this.remainderData=new Uint8Array(i.buffer,H,i.buffer.byteLength-H));for(var Y=0,z=$;z<H;z+=c)if(i[z]===71){var J=!!(i[z+1]&64),te=o(i,z),q=(i[z+3]&48)>>4,Q=void 0;if(q>1){if(Q=z+5+i[z+4],Q===z+c)continue}else Q=z+4;switch(te){case R:J&&(O&&(e=n(O))&&this.parseAVCPES(d,I,e,!1),O={data:[],size:0}),O&&(O.data.push(i.subarray(Q,z+c)),O.size+=z+c-Q);break;case C:if(J){if(B&&(e=n(B)))switch(E.segmentCodec){case"aac":this.parseAACPES(E,e);break;case"mp3":this.parseMPEGPES(E,e);break}B={data:[],size:0}}B&&(B.data.push(i.subarray(Q,z+c)),B.size+=z+c-Q);break;case M:J&&(w&&(e=n(w))&&this.parseID3PES(v,e),w={data:[],size:0}),w&&(w.data.push(i.subarray(Q,z+c)),w.size+=z+c-Q);break;case 0:J&&(Q+=i[Q]+1),G=this._pmtId=l(i,Q);break;case G:{J&&(Q+=i[Q]+1);var re=s(i,Q,this.typeSupported,t);R=re.avc,R>0&&(d.pid=R),C=re.audio,C>0&&(E.pid=C,E.segmentCodec=re.segmentCodec),M=re.id3,M>0&&(v.pid=M),N!==null&&!W&&(L.logger.warn("MPEG-TS PMT found at "+z+" after unknown PID '"+N+"'. Backtracking to sync byte @"+$+" to parse all TS packets."),N=null,z=$-188),W=this.pmtParsed=!0;break}case 17:case 8191:break;default:N=te;break}}else Y++;Y>0&&this.observer.emit(k.Events.ERROR,k.Events.ERROR,{type:x.ErrorTypes.MEDIA_ERROR,details:x.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+Y+" TS packet/s that do not start with 0x47"}),d.pesData=O,E.pesData=B,v.pesData=w;var ae={audioTrack:E,videoTrack:d,id3Track:v,textTrack:I};return f&&this.extractRemainingSamples(ae),ae},u.flush=function(){var i=this.remainderData;this.remainderData=null;var a;return i?a=this.demux(i,-1,!1,!0):a={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(a),this.sampleAes?this.decrypt(a,this.sampleAes):a},u.extractRemainingSamples=function(i){var a=i.audioTrack,t=i.videoTrack,f=i.id3Track,e=i.textTrack,d=t.pesData,E=a.pesData,v=f.pesData,I;if(d&&(I=n(d))?(this.parseAVCPES(t,e,I,!0),t.pesData=null):t.pesData=d,E&&(I=n(E))){switch(a.segmentCodec){case"aac":this.parseAACPES(a,I);break;case"mp3":this.parseMPEGPES(a,I);break}a.pesData=null}else E!=null&&E.size&&L.logger.log("last AAC PES packet truncated,might overlap between fragments"),a.pesData=E;v&&(I=n(v))?(this.parseID3PES(f,I),f.pesData=null):f.pesData=v},u.demuxSampleAes=function(i,a,t){var f=this.demux(i,t,!0,!this.config.progressive),e=this.sampleAes=new P.default(this.observer,this.config,a);return this.decrypt(f,e)},u.decrypt=function(i,a){return new Promise(function(t){var f=i.audioTrack,e=i.videoTrack;f.samples&&f.segmentCodec==="aac"?a.decryptAacSamples(f.samples,0,function(){e.samples?a.decryptAvcSamples(e.samples,0,0,function(){t(i)}):t(i)}):e.samples&&a.decryptAvcSamples(e.samples,0,0,function(){t(i)})})},u.destroy=function(){this._duration=0},u.parseAVCPES=function(i,a,t,f){var e=this,d=this.parseAVCNALu(i,t.data),E=this.avcSample,v,I=!1;t.data=null,E&&d.length&&!i.audFound&&(g(E,i),E=this.avcSample=m(!1,t.pts,t.dts,"")),d.forEach(function(R){switch(R.type){case 1:{v=!0,E||(E=e.avcSample=m(!0,t.pts,t.dts,"")),E.frame=!0;var O=R.data;if(I&&O.length>4){var C=new b.default(O).readSliceType();(C===2||C===4||C===7||C===9)&&(E.key=!0)}break}case 5:v=!0,E||(E=e.avcSample=m(!0,t.pts,t.dts,"")),E.key=!0,E.frame=!0;break;case 6:{v=!0,(0,A.parseSEIMessageFromNALu)(R.data,1,t.pts,a.samples);break}case 7:if(v=!0,I=!0,!i.sps){var M=new b.default(R.data),B=M.readSPS();i.width=B.width,i.height=B.height,i.pixelRatio=B.pixelRatio,i.sps=[R.data],i.duration=e._duration;for(var w=R.data.subarray(1,4),N="avc1.",W=0;W<3;W++){var G=w[W].toString(16);G.length<2&&(G="0"+G),N+=G}i.codec=N}break;case 8:v=!0,i.pps||(i.pps=[R.data]);break;case 9:v=!1,i.audFound=!0,E&&g(E,i),E=e.avcSample=m(!1,t.pts,t.dts,"");break;case 12:v=!0;break;default:v=!1,E&&(E.debug+="unknown NAL "+R.type+" ");break}if(E&&v){var H=E.units;H.push(R)}}),f&&E&&(g(E,i),this.avcSample=null)},u.getLastNalUnit=function(i){var a,t=this.avcSample,f;if((!t||t.units.length===0)&&(t=i[i.length-1]),(a=t)!==null&&a!==void 0&&a.units){var e=t.units;f=e[e.length-1]}return f},u.parseAVCNALu=function(i,a){var t=a.byteLength,f=i.naluState||0,e=f,d=[],E=0,v,I,R,O=-1,C=0;for(f===-1&&(O=0,C=a[0]&31,f=0,E=1);E<t;){if(v=a[E++],!f){f=v?0:1;continue}if(f===1){f=v?0:2;continue}if(!v)f=3;else if(v===1){if(O>=0){var M={data:a.subarray(O,E-f-1),type:C};d.push(M)}else{var B=this.getLastNalUnit(i.samples);if(B&&(e&&E<=4-e&&B.state&&(B.data=B.data.subarray(0,B.data.byteLength-e)),I=E-f-1,I>0)){var w=new Uint8Array(B.data.byteLength+I);w.set(B.data,0),w.set(a.subarray(0,I),B.data.byteLength),B.data=w,B.state=0}}E<t?(R=a[E]&31,O=E,C=R,f=0):f=-1}else f=0}if(O>=0&&f>=0){var N={data:a.subarray(O,t),type:C,state:f};d.push(N)}if(d.length===0){var W=this.getLastNalUnit(i.samples);if(W){var G=new Uint8Array(W.data.byteLength+a.byteLength);G.set(W.data,0),G.set(a,W.data.byteLength),W.data=G}}return i.naluState=f,d},u.parseAACPES=function(i,a){var t=0,f=this.aacOverFlow,e=a.data;if(f){this.aacOverFlow=null;var d=f.missing,E=f.sample.unit.byteLength;if(d===-1){var v=new Uint8Array(E+e.byteLength);v.set(f.sample.unit,0),v.set(e,E),e=v}else{var I=E-d;f.sample.unit.set(e.subarray(0,d),I),i.samples.push(f.sample),t=f.missing}}var R,O;for(R=t,O=e.length;R<O-1&&!F.isHeader(e,R);R++);if(R!==t){var C,M;if(R<O-1?(C="AAC PES did not start with ADTS header,offset:"+R,M=!1):(C="no ADTS header found in AAC PES",M=!0),L.logger.warn("parsing error:"+C),this.observer.emit(k.Events.ERROR,k.Events.ERROR,{type:x.ErrorTypes.MEDIA_ERROR,details:x.ErrorDetails.FRAG_PARSING_ERROR,fatal:M,reason:C}),M)return}F.initTrackConfig(i,this.observer,e,R,this.audioCodec);var B;if(a.pts!==void 0)B=a.pts;else if(f){var w=F.getFrameDuration(i.samplerate);B=f.sample.pts+w}else{L.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var N=0,W;R<O;)if(W=F.appendFrame(i,e,R,B,N),R+=W.length,W.missing){this.aacOverFlow=W;break}else for(N++;R<O-1&&!F.isHeader(e,R);R++);},u.parseMPEGPES=function(i,a){var t=a.data,f=t.length,e=0,d=0,E=a.pts;if(E===void 0){L.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;d<f;)if(D.isHeader(t,d)){var v=D.appendFrame(i,t,d,E,e);if(v)d+=v.length,e++;else break}else d++},u.parseID3PES=function(i,a){if(a.pts===void 0){L.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var t=T({},a,{type:this._avcTrack?_.MetadataSchema.emsg:_.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});i.samples.push(t)},r}();function m(r,u,p,i){return{key:r,frame:!1,pts:u,dts:p,units:[],debug:i,length:0}}function o(r,u){return((r[u+1]&31)<<8)+r[u+2]}function l(r,u){return(r[u+10]&31)<<8|r[u+11]}function s(r,u,p,i){var a={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},t=(r[u+1]&15)<<8|r[u+2],f=u+3+t-4,e=(r[u+10]&15)<<8|r[u+11];for(u+=12+e;u<f;){var d=o(r,u);switch(r[u]){case 207:if(!i){L.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:a.audio===-1&&(a.audio=d);break;case 21:a.id3===-1&&(a.id3=d);break;case 219:if(!i){L.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:a.avc===-1&&(a.avc=d);break;case 3:case 4:p.mpeg!==!0&&p.mp3!==!0?L.logger.log("MPEG audio found, not supported in this browser"):a.audio===-1&&(a.audio=d,a.segmentCodec="mp3");break;case 36:L.logger.warn("Unsupported HEVC stream type found");break}u+=((r[u+3]&15)<<8|r[u+4])+5}return a}function n(r){var u=0,p,i,a,t,f,e=r.data;if(!r||r.size===0)return null;for(;e[0].length<19&&e.length>1;){var d=new Uint8Array(e[0].length+e[1].length);d.set(e[0]),d.set(e[1],e[0].length),e[0]=d,e.splice(1,1)}p=e[0];var E=(p[0]<<16)+(p[1]<<8)+p[2];if(E===1){if(i=(p[4]<<8)+p[5],i&&i>r.size-6)return null;var v=p[7];v&192&&(t=(p[9]&14)*536870912+(p[10]&255)*4194304+(p[11]&254)*16384+(p[12]&255)*128+(p[13]&254)/2,v&64?(f=(p[14]&14)*536870912+(p[15]&255)*4194304+(p[16]&254)*16384+(p[17]&255)*128+(p[18]&254)/2,t-f>54e5&&(L.logger.warn(Math.round((t-f)/9e4)+"s delta between PTS and DTS, align them"),t=f)):f=t),a=p[8];var I=a+9;if(r.size<=I)return null;r.size-=I;for(var R=new Uint8Array(r.size),O=0,C=e.length;O<C;O++){p=e[O];var M=p.byteLength;if(I)if(I>M){I-=M;continue}else p=p.subarray(I),M-=I,I=0;R.set(p,u),u+=M}return i&&(i-=a+3),{data:R,pts:t,dts:f,len:i}}return null}function g(r,u){if(r.units.length&&r.frame){if(r.pts===void 0){var p=u.samples,i=p.length;if(i){var a=p[i-1];r.pts=a.pts,r.dts=a.dts}else{u.dropped++;return}}u.samples.push(r)}r.debug.length&&L.logger.log(r.pts+"/"+r.dts+":"+r.debug)}const h=y},"./src/demux/webworkify-webpack.js":(V,U,S)=>{S.r(U),S.d(U,{default:()=>c});var F=function(){var m=ENTRY_MODULE,o={},l=function n(g){var h=o[g];if(h!==void 0)return h.exports;var r=o[g]={exports:{}};return m[g].call(r.exports,r,r.exports,n),r.exports};l.m=m,function(){l.n=function(n){var g=n&&n.__esModule?function(){return n.default}:function(){return n};return l.d(g,{a:g}),g}}(),function(){l.d=function(n,g){for(var h in g)l.o(g,h)&&!l.o(n,h)&&Object.defineProperty(n,h,{enumerable:!0,get:g[h]})}}(),function(){l.o=function(n,g){return Object.prototype.hasOwnProperty.call(n,g)}}(),function(){l.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})}}();var s=l(ENTRY_MODULE);return s.default||s},D=F.toString().split("ENTRY_MODULE"),b="[\\.|\\-|\\+|\\w|/|@]+",P="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+b+").*?\\)";function k(y){return(y+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function A(y){return!isNaN(1*y)}function L(y,m,o){var l={};l[o]=[];var s=m.toString().replace(/^"[^"]+"/,"function"),n=s.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||s.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!n)return l;for(var g=n[1],h=new RegExp("(\\\\n|\\W)"+k(g)+P,"g"),r;r=h.exec(s);)r[3]!=="dll-reference"&&l[o].push(r[3]);for(h=new RegExp("\\("+k(g)+'\\("(dll-reference\\s('+b+'))"\\)\\)'+P,"g");r=h.exec(s);)y[r[2]]||(l[o].push(r[1]),y[r[2]]=S(r[1]).m),l[r[2]]=l[r[2]]||[],l[r[2]].push(r[4]);for(var u=Object.keys(l),p=0;p<u.length;p++)for(var i=0;i<l[u[p]].length;i++)A(l[u[p]][i])&&(l[u[p]][i]=1*l[u[p]][i]);return l}function x(y){var m=Object.keys(y);return m.reduce(function(o,l){return o||y[l].length>0},!1)}function _(y,m){for(var o={main:[m]},l={main:[]},s={main:{}};x(o);)for(var n=Object.keys(o),g=0;g<n.length;g++){var h=n[g],r=o[h],u=r.pop();if(s[h]=s[h]||{},!(s[h][u]||!y[h][u])){s[h][u]=!0,l[h]=l[h]||[],l[h].push(u);for(var p=L(y,y[h][u],h),i=Object.keys(p),a=0;a<i.length;a++)o[i[a]]=o[i[a]]||[],o[i[a]]=o[i[a]].concat(p[i[a]])}}return l}function T(y,m,o,l){var s=y[l].map(function(n){return'"'+n+'": '+m[l][n].toString().replace(/^"[^"]+"/,"function")}).join(",");return D[0]+"{"+s+"}"+D[1]+'"'+o+'"'+D[2]}function c(y,m){m=m||{};var o={main:S.m},l=m.all?{main:Object.keys(o.main)}:_(o,y),s="";Object.keys(l).filter(function(u){return u!=="main"}).forEach(function(u){for(var p=0;l[u][p];)p++;l[u].push(p),o[u][p]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",s=s+("var "+u+" = ("+T(l,o,p,modules)+`)();
`)}),s=s+("new (("+T(l,o,y,"main")+")())(self);");var n=new window.Blob([s],{type:"text/javascript"}),g=window.URL||window.webkitURL||window.mozURL||window.msURL,h=g.createObjectURL(n),r=new window.Worker(h);return r.objectURL=h,r}},"./src/errors.ts":(V,U,S)=>{S.r(U),S.d(U,{ErrorDetails:()=>D,ErrorTypes:()=>F});var F;(function(b){b.NETWORK_ERROR="networkError",b.MEDIA_ERROR="mediaError",b.KEY_SYSTEM_ERROR="keySystemError",b.MUX_ERROR="muxError",b.OTHER_ERROR="otherError"})(F||(F={}));var D;(function(b){b.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",b.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",b.KEY_SYSTEM_NO_SESSION="keySystemNoSession",b.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",b.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",b.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",b.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",b.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",b.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",b.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",b.MANIFEST_LOAD_ERROR="manifestLoadError",b.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",b.MANIFEST_PARSING_ERROR="manifestParsingError",b.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",b.LEVEL_EMPTY_ERROR="levelEmptyError",b.LEVEL_LOAD_ERROR="levelLoadError",b.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",b.LEVEL_SWITCH_ERROR="levelSwitchError",b.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",b.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",b.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",b.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",b.FRAG_LOAD_ERROR="fragLoadError",b.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",b.FRAG_DECRYPT_ERROR="fragDecryptError",b.FRAG_PARSING_ERROR="fragParsingError",b.REMUX_ALLOC_ERROR="remuxAllocError",b.KEY_LOAD_ERROR="keyLoadError",b.KEY_LOAD_TIMEOUT="keyLoadTimeOut",b.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",b.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",b.BUFFER_APPEND_ERROR="bufferAppendError",b.BUFFER_APPENDING_ERROR="bufferAppendingError",b.BUFFER_STALLED_ERROR="bufferStalledError",b.BUFFER_FULL_ERROR="bufferFullError",b.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",b.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",b.INTERNAL_EXCEPTION="internalException",b.INTERNAL_ABORTED="aborted",b.UNKNOWN="unknown"})(D||(D={}))},"./src/events.ts":(V,U,S)=>{S.r(U),S.d(U,{Events:()=>F});var F;(function(D){D.MEDIA_ATTACHING="hlsMediaAttaching",D.MEDIA_ATTACHED="hlsMediaAttached",D.MEDIA_DETACHING="hlsMediaDetaching",D.MEDIA_DETACHED="hlsMediaDetached",D.BUFFER_RESET="hlsBufferReset",D.BUFFER_CODECS="hlsBufferCodecs",D.BUFFER_CREATED="hlsBufferCreated",D.BUFFER_APPENDING="hlsBufferAppending",D.BUFFER_APPENDED="hlsBufferAppended",D.BUFFER_EOS="hlsBufferEos",D.BUFFER_FLUSHING="hlsBufferFlushing",D.BUFFER_FLUSHED="hlsBufferFlushed",D.MANIFEST_LOADING="hlsManifestLoading",D.MANIFEST_LOADED="hlsManifestLoaded",D.MANIFEST_PARSED="hlsManifestParsed",D.LEVEL_SWITCHING="hlsLevelSwitching",D.LEVEL_SWITCHED="hlsLevelSwitched",D.LEVEL_LOADING="hlsLevelLoading",D.LEVEL_LOADED="hlsLevelLoaded",D.LEVEL_UPDATED="hlsLevelUpdated",D.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",D.LEVELS_UPDATED="hlsLevelsUpdated",D.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",D.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",D.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",D.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",D.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",D.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",D.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",D.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",D.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",D.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",D.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",D.CUES_PARSED="hlsCuesParsed",D.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",D.INIT_PTS_FOUND="hlsInitPtsFound",D.FRAG_LOADING="hlsFragLoading",D.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",D.FRAG_LOADED="hlsFragLoaded",D.FRAG_DECRYPTED="hlsFragDecrypted",D.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",D.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",D.FRAG_PARSING_METADATA="hlsFragParsingMetadata",D.FRAG_PARSED="hlsFragParsed",D.FRAG_BUFFERED="hlsFragBuffered",D.FRAG_CHANGED="hlsFragChanged",D.FPS_DROP="hlsFpsDrop",D.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",D.ERROR="hlsError",D.DESTROYING="hlsDestroying",D.KEY_LOADING="hlsKeyLoading",D.KEY_LOADED="hlsKeyLoaded",D.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",D.BACK_BUFFER_REACHED="hlsBackBufferReached"})(F||(F={}))},"./src/hls.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>r});var F=S("./node_modules/url-toolkit/src/url-toolkit.js"),D=S("./src/loader/playlist-loader.ts"),b=S("./src/controller/id3-track-controller.ts"),P=S("./src/controller/latency-controller.ts"),k=S("./src/controller/level-controller.ts"),A=S("./src/controller/fragment-tracker.ts"),L=S("./src/loader/key-loader.ts"),x=S("./src/controller/stream-controller.ts"),_=S("./src/is-supported.ts"),T=S("./src/utils/logger.ts"),c=S("./src/config.ts"),y=S("./node_modules/eventemitter3/index.js"),m=S("./src/events.ts"),o=S("./src/errors.ts"),l=S("./src/types/level.ts");function s(u,p){for(var i=0;i<p.length;i++){var a=p[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(u,g(a.key),a)}}function n(u,p,i){return p&&s(u.prototype,p),i&&s(u,i),Object.defineProperty(u,"prototype",{writable:!1}),u}function g(u){var p=h(u,"string");return typeof p=="symbol"?p:String(p)}function h(u,p){if(typeof u!="object"||u===null)return u;var i=u[Symbol.toPrimitive];if(i!==void 0){var a=i.call(u,p||"default");if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(p==="string"?String:Number)(u)}var r=function(){u.isSupported=function(){return(0,_.isSupported)()};function u(i){i===void 0&&(i={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new y.EventEmitter,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var a=this.config=(0,c.mergeConfig)(u.DefaultConfig,i);this.userConfig=i,(0,T.enableLogs)(a.debug,"Hls instance"),this._autoLevelCapping=-1,a.progressive&&(0,c.enableStreamingMode)(a);var t=a.abrController,f=a.bufferController,e=a.capLevelController,d=a.fpsController,E=this.abrController=new t(this),v=this.bufferController=new f(this),I=this.capLevelController=new e(this),R=new d(this),O=new D.default(this),C=new b.default(this),M=this.levelController=new k.default(this),B=new A.FragmentTracker(this),w=new L.default(this.config),N=this.streamController=new x.default(this,B,w);I.setStreamController(N),R.setStreamController(N);var W=[O,M,N];this.networkControllers=W;var G=[E,v,I,R,C,B];this.audioTrackController=this.createController(a.audioTrackController,W);var H=a.audioStreamController;H&&W.push(new H(this,B,w)),this.subtitleTrackController=this.createController(a.subtitleTrackController,W);var $=a.subtitleStreamController;$&&W.push(new $(this,B,w)),this.createController(a.timelineController,G),w.emeController=this.emeController=this.createController(a.emeController,G),this.cmcdController=this.createController(a.cmcdController,G),this.latencyController=this.createController(P.default,G),this.coreComponents=G}var p=u.prototype;return p.createController=function(a,t){if(a){var f=new a(this);return t&&t.push(f),f}return null},p.on=function(a,t,f){f===void 0&&(f=this),this._emitter.on(a,t,f)},p.once=function(a,t,f){f===void 0&&(f=this),this._emitter.once(a,t,f)},p.removeAllListeners=function(a){this._emitter.removeAllListeners(a)},p.off=function(a,t,f,e){f===void 0&&(f=this),this._emitter.off(a,t,f,e)},p.listeners=function(a){return this._emitter.listeners(a)},p.emit=function(a,t,f){return this._emitter.emit(a,t,f)},p.trigger=function(a,t){if(this.config.debug)return this.emit(a,a,t);try{return this.emit(a,a,t)}catch(f){T.logger.error("An internal error happened while handling event "+a+'. Error message: "'+f.message+'". Here is a stacktrace:',f),this.trigger(m.Events.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:a,error:f})}return!1},p.listenerCount=function(a){return this._emitter.listenerCount(a)},p.destroy=function(){T.logger.log("destroy"),this.trigger(m.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(a){return a.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(a){return a.destroy()}),this.coreComponents.length=0},p.attachMedia=function(a){T.logger.log("attachMedia"),this._media=a,this.trigger(m.Events.MEDIA_ATTACHING,{media:a})},p.detachMedia=function(){T.logger.log("detachMedia"),this.trigger(m.Events.MEDIA_DETACHING,void 0),this._media=null},p.loadSource=function(a){this.stopLoad();var t=this.media,f=this.url,e=this.url=F.buildAbsoluteURL(self.location.href,a,{alwaysNormalize:!0});T.logger.log("loadSource:"+e),t&&f&&f!==e&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(t)),this.trigger(m.Events.MANIFEST_LOADING,{url:a})},p.startLoad=function(a){a===void 0&&(a=-1),T.logger.log("startLoad("+a+")"),this.networkControllers.forEach(function(t){t.startLoad(a)})},p.stopLoad=function(){T.logger.log("stopLoad"),this.networkControllers.forEach(function(a){a.stopLoad()})},p.swapAudioCodec=function(){T.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},p.recoverMediaError=function(){T.logger.log("recoverMediaError");var a=this._media;this.detachMedia(),a&&this.attachMedia(a)},p.removeLevel=function(a,t){t===void 0&&(t=0),this.levelController.removeLevel(a,t)},n(u,[{key:"levels",get:function(){var a=this.levelController.levels;return a||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(a){T.logger.log("set currentLevel:"+a),this.loadLevel=a,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(a){T.logger.log("set nextLevel:"+a),this.levelController.manualLevel=a,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(a){T.logger.log("set loadLevel:"+a),this.levelController.manualLevel=a}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(a){this.levelController.nextLoadLevel=a}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(a){T.logger.log("set firstLevel:"+a),this.levelController.firstLevel=a}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(a){T.logger.log("set startLevel:"+a),a!==-1&&(a=Math.max(a,this.minAutoLevel)),this.levelController.startLevel=a}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(a){var t=!!a;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(a){this._autoLevelCapping!==a&&(T.logger.log("set autoLevelCapping:"+a),this._autoLevelCapping=a)}},{key:"bandwidthEstimate",get:function(){var a=this.abrController.bwEstimator;return a?a.getEstimate():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(a){l.HdcpLevels.indexOf(a)>-1&&(this._maxHdcpLevel=a)}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var a=this.levels,t=this.config.minAutoBitrate;if(!a)return 0;for(var f=a.length,e=0;e<f;e++)if(a[e].maxBitrate>=t)return e;return 0}},{key:"maxAutoLevel",get:function(){var a=this.levels,t=this.autoLevelCapping,f=this.maxHdcpLevel,e;if(t===-1&&a&&a.length?e=a.length-1:e=t,f)for(var d=e;d--;){var E=a[d].attrs["HDCP-LEVEL"];if(E&&E<=f)return d}return e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(a){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,a)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var a=this.audioTrackController;return a?a.audioTracks:[]}},{key:"audioTrack",get:function(){var a=this.audioTrackController;return a?a.audioTrack:-1},set:function(a){var t=this.audioTrackController;t&&(t.audioTrack=a)}},{key:"subtitleTracks",get:function(){var a=this.subtitleTrackController;return a?a.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var a=this.subtitleTrackController;return a?a.subtitleTrack:-1},set:function(a){var t=this.subtitleTrackController;t&&(t.subtitleTrack=a)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var a=this.subtitleTrackController;return a?a.subtitleDisplay:!1},set:function(a){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=a)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(a){this.config.lowLatencyMode=a}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.3.4"}},{key:"Events",get:function(){return m.Events}},{key:"ErrorTypes",get:function(){return o.ErrorTypes}},{key:"ErrorDetails",get:function(){return o.ErrorDetails}},{key:"DefaultConfig",get:function(){return u.defaultConfig?u.defaultConfig:c.hlsDefaultConfig},set:function(a){u.defaultConfig=a}}]),u}();r.defaultConfig=void 0},"./src/is-supported.ts":(V,U,S)=>{S.r(U),S.d(U,{changeTypeSupported:()=>P,isSupported:()=>b});var F=S("./src/utils/mediasource-helper.ts");function D(){return self.SourceBuffer||self.WebKitSourceBuffer}function b(){var k=(0,F.getMediaSource)();if(!k)return!1;var A=D(),L=k&&typeof k.isTypeSupported=="function"&&k.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),x=!A||A.prototype&&typeof A.prototype.appendBuffer=="function"&&typeof A.prototype.remove=="function";return!!L&&!!x}function P(){var k,A=D();return typeof(A==null||(k=A.prototype)===null||k===void 0?void 0:k.changeType)=="function"}},"./src/loader/date-range.ts":(V,U,S)=>{S.r(U),S.d(U,{DateRange:()=>T,DateRangeAttribute:()=>_});var F=S("./src/polyfills/number.ts"),D=S("./src/utils/attr-list.ts"),b=S("./src/utils/logger.ts");function P(){return P=Object.assign?Object.assign.bind():function(c){for(var y=1;y<arguments.length;y++){var m=arguments[y];for(var o in m)Object.prototype.hasOwnProperty.call(m,o)&&(c[o]=m[o])}return c},P.apply(this,arguments)}function k(c,y){for(var m=0;m<y.length;m++){var o=y[m];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(c,L(o.key),o)}}function A(c,y,m){return y&&k(c.prototype,y),m&&k(c,m),Object.defineProperty(c,"prototype",{writable:!1}),c}function L(c){var y=x(c,"string");return typeof y=="symbol"?y:String(y)}function x(c,y){if(typeof c!="object"||c===null)return c;var m=c[Symbol.toPrimitive];if(m!==void 0){var o=m.call(c,y||"default");if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(y==="string"?String:Number)(c)}var _;(function(c){c.ID="ID",c.CLASS="CLASS",c.START_DATE="START-DATE",c.DURATION="DURATION",c.END_DATE="END-DATE",c.END_ON_NEXT="END-ON-NEXT",c.PLANNED_DURATION="PLANNED-DURATION",c.SCTE35_OUT="SCTE35-OUT",c.SCTE35_IN="SCTE35-IN"})(_||(_={}));var T=function(){function c(y,m){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,m){var o=m.attr;for(var l in o)if(Object.prototype.hasOwnProperty.call(y,l)&&y[l]!==o[l]){b.logger.warn('DATERANGE tag attribute: "'+l+'" does not match for tags with ID: "'+y.ID+'"'),this._badValueForSameId=l;break}y=P(new D.AttrList({}),o,y)}if(this.attr=y,this._startDate=new Date(y[_.START_DATE]),_.END_DATE in this.attr){var s=new Date(this.attr[_.END_DATE]);(0,F.isFiniteNumber)(s.getTime())&&(this._endDate=s)}}return A(c,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var m=this.duration;return m!==null?new Date(this._startDate.getTime()+m*1e3):null}},{key:"duration",get:function(){if(_.DURATION in this.attr){var m=this.attr.decimalFloatingPoint(_.DURATION);if((0,F.isFiniteNumber)(m))return m}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return _.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(_.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(_.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,F.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),c}()},"./src/loader/fragment-loader.ts":(V,U,S)=>{S.r(U),S.d(U,{LoadError:()=>m,default:()=>c});var F=S("./src/polyfills/number.ts"),D=S("./src/errors.ts");function b(o,l){o.prototype=Object.create(l.prototype),o.prototype.constructor=o,x(o,l)}function P(o){var l=typeof Map=="function"?new Map:void 0;return P=function(n){if(n===null||!L(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof l<"u"){if(l.has(n))return l.get(n);l.set(n,g)}function g(){return k(n,arguments,_(this).constructor)}return g.prototype=Object.create(n.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),x(g,n)},P(o)}function k(o,l,s){return A()?k=Reflect.construct.bind():k=function(g,h,r){var u=[null];u.push.apply(u,h);var p=Function.bind.apply(g,u),i=new p;return r&&x(i,r.prototype),i},k.apply(null,arguments)}function A(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function L(o){return Function.toString.call(o).indexOf("[native code]")!==-1}function x(o,l){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,g){return n.__proto__=g,n},x(o,l)}function _(o){return _=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},_(o)}var T=Math.pow(2,17),c=function(){function o(s){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=s}var l=o.prototype;return l.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},l.abort=function(){this.loader&&this.loader.abort()},l.load=function(n,g){var h=this,r=n.url;if(!r)return Promise.reject(new m({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:n,networkDetails:null},"Fragment does not have a "+(r?"part list":"url")));this.abort();var u=this.config,p=u.fLoader,i=u.loader;return new Promise(function(a,t){h.loader&&h.loader.destroy();var f=h.loader=n.loader=p?new p(u):new i(u),e=y(n),d={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:n.sn==="initSegment"?1/0:T};n.stats=f.stats,f.load(e,d,{onSuccess:function(v,I,R,O){h.resetLoader(n,f);var C=v.data;R.resetIV&&n.decryptdata&&(n.decryptdata.iv=new Uint8Array(C.slice(0,16)),C=C.slice(16)),a({frag:n,part:null,payload:C,networkDetails:O})},onError:function(v,I,R){h.resetLoader(n,f),t(new m({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:n,response:v,networkDetails:R}))},onAbort:function(v,I,R){h.resetLoader(n,f),t(new m({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:n,networkDetails:R}))},onTimeout:function(v,I,R){h.resetLoader(n,f),t(new m({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:n,networkDetails:R}))},onProgress:function(v,I,R,O){g&&g({frag:n,part:null,payload:R,networkDetails:O})}})})},l.loadPart=function(n,g,h){var r=this;this.abort();var u=this.config,p=u.fLoader,i=u.loader;return new Promise(function(a,t){r.loader&&r.loader.destroy();var f=r.loader=n.loader=p?new p(u):new i(u),e=y(n,g),d={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:T};g.stats=f.stats,f.load(e,d,{onSuccess:function(v,I,R,O){r.resetLoader(n,f),r.updateStatsFromPart(n,g);var C={frag:n,part:g,payload:v.data,networkDetails:O};h(C),a(C)},onError:function(v,I,R){r.resetLoader(n,f),t(new m({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:n,part:g,response:v,networkDetails:R}))},onAbort:function(v,I,R){n.stats.aborted=g.stats.aborted,r.resetLoader(n,f),t(new m({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:n,part:g,networkDetails:R}))},onTimeout:function(v,I,R){r.resetLoader(n,f),t(new m({type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:n,part:g,networkDetails:R}))}})})},l.updateStatsFromPart=function(n,g){var h=n.stats,r=g.stats,u=r.total;if(h.loaded+=r.loaded,u){var p=Math.round(n.duration/g.duration),i=Math.min(Math.round(h.loaded/u),p),a=p-i,t=a*Math.round(h.loaded/i);h.total=h.loaded+t}else h.total=Math.max(h.loaded,h.total);var f=h.loading,e=r.loading;f.start?f.first+=e.first-e.start:(f.start=e.start,f.first=e.first),f.end=e.end},l.resetLoader=function(n,g){n.loader=null,this.loader===g&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),g.destroy()},o}();function y(o,l){l===void 0&&(l=null);var s=l||o,n={frag:o,part:l,responseType:"arraybuffer",url:s.url,headers:{},rangeStart:0,rangeEnd:0},g=s.byteRangeStartOffset,h=s.byteRangeEndOffset;if((0,F.isFiniteNumber)(g)&&(0,F.isFiniteNumber)(h)){var r,u=g,p=h;if(o.sn==="initSegment"&&((r=o.decryptdata)===null||r===void 0?void 0:r.method)==="AES-128"){var i=h-g;i%16&&(p=h+(16-i%16)),g!==0&&(n.resetIV=!0,u=g-16)}n.rangeStart=u,n.rangeEnd=p}return n}var m=function(o){b(l,o);function l(s){for(var n,g=arguments.length,h=new Array(g>1?g-1:0),r=1;r<g;r++)h[r-1]=arguments[r];return n=o.call.apply(o,[this].concat(h))||this,n.data=void 0,n.data=s,n}return l}(P(Error))},"./src/loader/fragment.ts":(V,U,S)=>{S.r(U),S.d(U,{BaseSegment:()=>c,ElementaryStreamTypes:()=>T,Fragment:()=>y,Part:()=>m});var F=S("./src/polyfills/number.ts"),D=S("./node_modules/url-toolkit/src/url-toolkit.js"),b=S("./src/loader/load-stats.ts");function P(o,l){o.prototype=Object.create(l.prototype),o.prototype.constructor=o,k(o,l)}function k(o,l){return k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,g){return n.__proto__=g,n},k(o,l)}function A(o,l){for(var s=0;s<l.length;s++){var n=l[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(o,x(n.key),n)}}function L(o,l,s){return l&&A(o.prototype,l),s&&A(o,s),Object.defineProperty(o,"prototype",{writable:!1}),o}function x(o){var l=_(o,"string");return typeof l=="symbol"?l:String(l)}function _(o,l){if(typeof o!="object"||o===null)return o;var s=o[Symbol.toPrimitive];if(s!==void 0){var n=s.call(o,l||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(l==="string"?String:Number)(o)}var T;(function(o){o.AUDIO="audio",o.VIDEO="video",o.AUDIOVIDEO="audiovideo"})(T||(T={}));var c=function(){function o(s){var n;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(n={},n[T.AUDIO]=null,n[T.VIDEO]=null,n[T.AUDIOVIDEO]=null,n),this.baseurl=s}var l=o.prototype;return l.setByteRange=function(n,g){var h=n.split("@",2),r=[];h.length===1?r[0]=g?g.byteRangeEndOffset:0:r[0]=parseInt(h[1]),r[1]=parseInt(h[0])+r[0],this._byteRange=r},L(o,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,D.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(n){this._url=n}}]),o}(),y=function(o){P(l,o);function l(n,g){var h;return h=o.call(this,g)||this,h._decryptdata=null,h.rawProgramDateTime=null,h.programDateTime=null,h.tagList=[],h.duration=0,h.sn=0,h.levelkeys=void 0,h.type=void 0,h.loader=null,h.keyLoader=null,h.level=-1,h.cc=0,h.startPTS=void 0,h.endPTS=void 0,h.appendedPTS=void 0,h.startDTS=void 0,h.endDTS=void 0,h.start=0,h.deltaPTS=void 0,h.maxStartPTS=void 0,h.minEndPTS=void 0,h.stats=new b.LoadStats,h.urlId=0,h.data=void 0,h.bitrateTest=!1,h.title=null,h.initSegment=null,h.endList=void 0,h.type=n,h}var s=l.prototype;return s.setKeyFormat=function(g){if(this.levelkeys){var h=this.levelkeys[g];h&&!this._decryptdata&&(this._decryptdata=h.getDecryptData(this.sn))}},s.abortRequests=function(){var g,h;(g=this.loader)===null||g===void 0||g.abort(),(h=this.keyLoader)===null||h===void 0||h.abort()},s.setElementaryStreamInfo=function(g,h,r,u,p,i){i===void 0&&(i=!1);var a=this.elementaryStreams,t=a[g];if(!t){a[g]={startPTS:h,endPTS:r,startDTS:u,endDTS:p,partial:i};return}t.startPTS=Math.min(t.startPTS,h),t.endPTS=Math.max(t.endPTS,r),t.startDTS=Math.min(t.startDTS,u),t.endDTS=Math.max(t.endDTS,p)},s.clearElementaryStreamInfo=function(){var g=this.elementaryStreams;g[T.AUDIO]=null,g[T.VIDEO]=null,g[T.AUDIOVIDEO]=null},L(l,[{key:"decryptdata",get:function(){var g=this.levelkeys;if(!g&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var h=this.levelkeys.identity;if(h)this._decryptdata=h.getDecryptData(this.sn);else{var r=Object.keys(this.levelkeys);if(r.length===1)return this._decryptdata=this.levelkeys[r[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!(0,F.isFiniteNumber)(this.programDateTime))return null;var g=(0,F.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+g*1e3}},{key:"encrypted",get:function(){var g;if((g=this._decryptdata)!==null&&g!==void 0&&g.encrypted)return!0;if(this.levelkeys){var h=Object.keys(this.levelkeys),r=h.length;if(r>1||r===1&&this.levelkeys[h[0]].encrypted)return!0}return!1}}]),l}(c),m=function(o){P(l,o);function l(s,n,g,h,r){var u;u=o.call(this,g)||this,u.fragOffset=0,u.duration=0,u.gap=!1,u.independent=!1,u.relurl=void 0,u.fragment=void 0,u.index=void 0,u.stats=new b.LoadStats,u.duration=s.decimalFloatingPoint("DURATION"),u.gap=s.bool("GAP"),u.independent=s.bool("INDEPENDENT"),u.relurl=s.enumeratedString("URI"),u.fragment=n,u.index=h;var p=s.enumeratedString("BYTERANGE");return p&&u.setByteRange(p,r),r&&(u.fragOffset=r.fragOffset+r.duration),u}return L(l,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var n=this.elementaryStreams;return!!(n.audio||n.video||n.audiovideo)}}]),l}(c)},"./src/loader/key-loader.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>b});var F=S("./src/errors.ts"),D=S("./src/loader/fragment-loader.ts"),b=function(){function P(A){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=A}var k=P.prototype;return k.abort=function(){for(var L in this.keyUriToKeyInfo){var x=this.keyUriToKeyInfo[L].loader;x&&x.abort()}},k.detach=function(){for(var L in this.keyUriToKeyInfo){var x=this.keyUriToKeyInfo[L];(x.mediaKeySessionContext||x.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[L]}},k.destroy=function(){this.detach();for(var L in this.keyUriToKeyInfo){var x=this.keyUriToKeyInfo[L].loader;x&&x.destroy()}this.keyUriToKeyInfo={}},k.createKeyLoadError=function(L,x,_,T){return x===void 0&&(x=F.ErrorDetails.KEY_LOAD_ERROR),new D.LoadError({type:F.ErrorTypes.NETWORK_ERROR,details:x,fatal:!1,frag:L,networkDetails:_})},k.loadClear=function(L,x){var _=this;if(this.emeController&&this.config.emeEnabled)for(var T=L.sn,c=L.cc,y=function(s){var n=x[s];if(c<=n.cc&&(T==="initSegment"||T<n.sn))return _.emeController.selectKeySystemFormat(n).then(function(g){n.setKeyFormat(g)}),"break"},m=0;m<x.length;m++){var o=y(m);if(o==="break")break}},k.load=function(L){var x=this;return!L.decryptdata&&L.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(L).then(function(_){return x.loadInternal(L,_)}):this.loadInternal(L)},k.loadInternal=function(L,x){var _,T;x&&L.setKeyFormat(x);var c=L.decryptdata;if(!c){var y=x?"Expected frag.decryptdata to be defined after setting format "+x:"Missing decryption data on fragment in onKeyLoading";return Promise.reject(this.createKeyLoadError(L,F.ErrorDetails.KEY_LOAD_ERROR,null,y))}var m=c.uri;if(!m)return Promise.reject(this.createKeyLoadError(L,F.ErrorDetails.KEY_LOAD_ERROR,null,'Invalid key URI: "'+m+'"'));var o=this.keyUriToKeyInfo[m];if((_=o)!==null&&_!==void 0&&_.decryptdata.key)return c.key=o.decryptdata.key,Promise.resolve({frag:L,keyInfo:o});if((T=o)!==null&&T!==void 0&&T.keyLoadPromise){var l;switch((l=o.mediaKeySessionContext)===null||l===void 0?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return o.keyLoadPromise.then(function(s){return c.key=s.keyInfo.decryptdata.key,{frag:L,keyInfo:o}})}}switch(o=this.keyUriToKeyInfo[m]={decryptdata:c,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},c.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return c.keyFormat==="identity"?this.loadKeyHTTP(o,L):this.loadKeyEME(o,L);case"AES-128":return this.loadKeyHTTP(o,L);default:return Promise.reject(this.createKeyLoadError(L,F.ErrorDetails.KEY_LOAD_ERROR,null,'Key supplied with unsupported METHOD: "'+c.method+'"'))}},k.loadKeyEME=function(L,x){var _={frag:x,keyInfo:L};if(this.emeController&&this.config.emeEnabled){var T=this.emeController.loadKey(_);if(T)return(L.keyLoadPromise=T.then(function(c){return L.mediaKeySessionContext=c,_})).catch(function(c){throw L.keyLoadPromise=null,c})}return Promise.resolve(_)},k.loadKeyHTTP=function(L,x){var _=this,T=this.config,c=T.loader,y=new c(T);return x.keyLoader=L.loader=y,L.keyLoadPromise=new Promise(function(m,o){var l={keyInfo:L,frag:x,responseType:"arraybuffer",url:L.decryptdata.uri},s={timeout:T.fragLoadingTimeOut,maxRetry:0,retryDelay:T.fragLoadingRetryDelay,maxRetryDelay:T.fragLoadingMaxRetryTimeout,highWaterMark:0},n={onSuccess:function(h,r,u,p){var i=u.frag,a=u.keyInfo,t=u.url;if(!i.decryptdata||a!==_.keyUriToKeyInfo[t])return o(_.createKeyLoadError(i,F.ErrorDetails.KEY_LOAD_ERROR,p,"after key load, decryptdata unset or changed"));a.decryptdata.key=i.decryptdata.key=new Uint8Array(h.data),i.keyLoader=null,a.loader=null,m({frag:i,keyInfo:a})},onError:function(h,r,u){_.resetLoader(r),o(_.createKeyLoadError(x,F.ErrorDetails.KEY_LOAD_ERROR,u))},onTimeout:function(h,r,u){_.resetLoader(r),o(_.createKeyLoadError(x,F.ErrorDetails.KEY_LOAD_TIMEOUT,u))},onAbort:function(h,r,u){_.resetLoader(r),o(_.createKeyLoadError(x,F.ErrorDetails.INTERNAL_ABORTED,u))}};y.load(l,s,n)})},k.resetLoader=function(L){var x=L.frag,_=L.keyInfo,T=L.url,c=_.loader;x.keyLoader===c&&(x.keyLoader=null,_.loader=null),delete this.keyUriToKeyInfo[T],c&&c.destroy()},P}()},"./src/loader/level-details.ts":(V,U,S)=>{S.r(U),S.d(U,{LevelDetails:()=>L});var F=S("./src/polyfills/number.ts");function D(x,_){for(var T=0;T<_.length;T++){var c=_[T];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(x,P(c.key),c)}}function b(x,_,T){return _&&D(x.prototype,_),T&&D(x,T),Object.defineProperty(x,"prototype",{writable:!1}),x}function P(x){var _=k(x,"string");return typeof _=="symbol"?_:String(_)}function k(x,_){if(typeof x!="object"||x===null)return x;var T=x[Symbol.toPrimitive];if(T!==void 0){var c=T.call(x,_||"default");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(_==="string"?String:Number)(x)}var A=10,L=function(){function x(T){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=T}var _=x.prototype;return _.reloaded=function(c){if(!c){this.advanced=!0,this.updated=!0;return}var y=this.lastPartSn-c.lastPartSn,m=this.lastPartIndex-c.lastPartIndex;this.updated=this.endSN!==c.endSN||!!m||!!y,this.advanced=this.endSN>c.endSN||y>0||y===0&&m>0,this.updated||this.advanced?this.misses=Math.floor(c.misses*.6):this.misses=c.misses+1,this.availabilityDelay=c.availabilityDelay},b(x,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?(0,F.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||A}},{key:"drift",get:function(){var c=this.driftEndTime-this.driftStartTime;if(c>0){var y=this.driftEnd-this.driftStart;return y*1e3/c}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var c;return(c=this.partList)!==null&&c!==void 0&&c.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var c;return(c=this.fragments)!==null&&c!==void 0&&c.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var c;return(c=this.partList)!==null&&c!==void 0&&c.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var c;return(c=this.partList)!==null&&c!==void 0&&c.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),x}()},"./src/loader/level-key.ts":(V,U,S)=>{S.r(U),S.d(U,{LevelKey:()=>L});var F=S("./src/utils/keysystem-util.ts"),D=S("./src/utils/mediakeys-helper.ts"),b=S("./src/utils/mp4-tools.ts"),P=S("./src/utils/logger.ts"),k=S("./src/utils/numeric-encoding-utils.ts"),A={},L=function(){_.clearKeyUriToKeyIdMap=function(){A={}};function _(c,y,m,o,l){o===void 0&&(o=[1]),l===void 0&&(l=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=c,this.uri=y,this.keyFormat=m,this.keyFormatVersions=o,this.iv=l,this.encrypted=c?c!=="NONE":!1,this.isCommonEncryption=this.encrypted&&c!=="AES-128"}var T=_.prototype;return T.isSupported=function(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;switch(this.keyFormat){case"identity":return this.method==="SAMPLE-AES";case D.KeySystemFormats.FAIRPLAY:case D.KeySystemFormats.WIDEVINE:case D.KeySystemFormats.PLAYREADY:case D.KeySystemFormats.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1},T.getDecryptData=function(y){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof y!="number"&&(this.method==="AES-128"&&!this.iv&&P.logger.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),y=0);var m=x(y),o=new _(this.method,this.uri,"identity",this.keyFormatVersions,m);return o}var l=(0,F.convertDataUriToArrayBytes)(this.uri);if(l)switch(this.keyFormat){case D.KeySystemFormats.WIDEVINE:this.pssh=l,l.length>=22&&(this.keyId=l.subarray(l.length-22,l.length-6));break;case D.KeySystemFormats.PLAYREADY:{var s=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=(0,b.mp4pssh)(s,null,l);var n=new Uint16Array(l.buffer,l.byteOffset,l.byteLength/2),g=String.fromCharCode.apply(null,Array.from(n)),h=g.substring(g.indexOf("<"),g.length),r=new DOMParser,u=r.parseFromString(h,"text/xml"),p=u.getElementsByTagName("KID")[0];if(p){var i=p.childNodes[0]?p.childNodes[0].nodeValue:p.getAttribute("VALUE");if(i){var a=(0,k.base64Decode)(i).subarray(0,16);(0,F.changeEndianness)(a),this.keyId=a}}break}default:{var t=l.subarray(0,16);if(t.length!==16){var f=new Uint8Array(16);f.set(t,16-t.length),t=f}this.keyId=t;break}}if(!this.keyId||this.keyId.byteLength!==16){var e=A[this.uri];if(!e){var d=Object.keys(A).length%Number.MAX_SAFE_INTEGER;e=new Uint8Array(16);var E=new DataView(e.buffer,12,4);E.setUint32(0,d),A[this.uri]=e}this.keyId=e}return this},_}();function x(_){for(var T=new Uint8Array(16),c=12;c<16;c++)T[c]=_>>8*(15-c)&255;return T}},"./src/loader/load-stats.ts":(V,U,S)=>{S.r(U),S.d(U,{LoadStats:()=>F});var F=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>l});var F=S("./src/polyfills/number.ts"),D=S("./node_modules/url-toolkit/src/url-toolkit.js"),b=S("./src/loader/date-range.ts"),P=S("./src/loader/fragment.ts"),k=S("./src/loader/level-details.ts"),A=S("./src/loader/level-key.ts"),L=S("./src/utils/attr-list.ts"),x=S("./src/utils/logger.ts"),_=S("./src/utils/codecs.ts");function T(){return T=Object.assign?Object.assign.bind():function(i){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var f in t)Object.prototype.hasOwnProperty.call(t,f)&&(i[f]=t[f])}return i},T.apply(this,arguments)}var c=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+|#EXT-X-SESSION-KEY:([^\n\r]*)[\r\n]+/g,y=/#EXT-X-MEDIA:(.*)/g,m=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),o=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),l=function(){function i(){}return i.findGroup=function(t,f){for(var e=0;e<t.length;e++){var d=t[e];if(d.id===f)return d}},i.convertAVC1ToAVCOTI=function(t){var f=t.split(".");if(f.length>2){var e=f.shift()+".";return e+=parseInt(f.shift()).toString(16),e+=("000"+parseInt(f.shift()).toString(16)).slice(-4),e}return t},i.resolve=function(t,f){return(0,D.buildAbsoluteURL)(f,t,{alwaysNormalize:!0})},i.parseMasterPlaylist=function(t,f){var e=[],d=[],E={},v=[],I=!1;c.lastIndex=0;for(var R;(R=c.exec(t))!=null;)if(R[1]){var O,C=new L.AttrList(R[1]),M={attrs:C,bitrate:C.decimalInteger("AVERAGE-BANDWIDTH")||C.decimalInteger("BANDWIDTH"),name:C.NAME,url:i.resolve(R[2],f)},B=C.decimalResolution("RESOLUTION");B&&(M.width=B.width,M.height=B.height),n((C.CODECS||"").split(/[ ,]+/).filter(function(H){return H}),M),M.videoCodec&&M.videoCodec.indexOf("avc1")!==-1&&(M.videoCodec=i.convertAVC1ToAVCOTI(M.videoCodec)),(O=M.unknownCodecs)!==null&&O!==void 0&&O.length||d.push(M),e.push(M)}else if(R[3]){var w=new L.AttrList(R[3]);w["DATA-ID"]&&(I=!0,E[w["DATA-ID"]]=w)}else if(R[4]){var N=R[4],W=s(N,f);W.encrypted&&W.isSupported()?v.push(W):x.logger.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+N+'"')}var G=d.length>0&&d.length<e.length;return{levels:G?d:e,sessionData:I?E:null,sessionKeys:v.length?v:null}},i.parseMasterPlaylistMedia=function(t,f,e,d){d===void 0&&(d=[]);var E,v=[],I=0;for(y.lastIndex=0;(E=y.exec(t))!==null;){var R=new L.AttrList(E[1]);if(R.TYPE===e){var O={attrs:R,bitrate:0,id:I++,groupId:R["GROUP-ID"],instreamId:R["INSTREAM-ID"],name:R.NAME||R.LANGUAGE||"",type:e,default:R.bool("DEFAULT"),autoselect:R.bool("AUTOSELECT"),forced:R.bool("FORCED"),lang:R.LANGUAGE,url:R.URI?i.resolve(R.URI,f):""};if(d.length){var C=i.findGroup(d,O.groupId)||d[0];g(O,C,"audioCodec"),g(O,C,"textCodec")}v.push(O)}}return v},i.parseLevelPlaylist=function(t,f,e,d,E){var v=new k.LevelDetails(f),I=v.fragments,R=null,O=0,C=0,M=0,B=0,w=null,N=new P.Fragment(d,f),W,G,H,$=-1,Y=!1;for(m.lastIndex=0,v.m3u8=t;(W=m.exec(t))!==null;){Y&&(Y=!1,N=new P.Fragment(d,f),N.start=M,N.sn=O,N.cc=B,N.level=e,R&&(N.initSegment=R,N.rawProgramDateTime=R.rawProgramDateTime,R.rawProgramDateTime=null));var z=W[1];if(z){N.duration=parseFloat(z);var J=(" "+W[2]).slice(1);N.title=J||null,N.tagList.push(J?["INF",z,J]:["INF",z])}else if(W[3])(0,F.isFiniteNumber)(N.duration)&&(N.start=M,H&&p(N,H,v),N.sn=O,N.level=e,N.cc=B,N.urlId=E,I.push(N),N.relurl=(" "+W[3]).slice(1),r(N,w),w=N,M+=N.duration,O++,C=0,Y=!0);else if(W[4]){var te=(" "+W[4]).slice(1);w?N.setByteRange(te,w):N.setByteRange(te)}else if(W[5])N.rawProgramDateTime=(" "+W[5]).slice(1),N.tagList.push(["PROGRAM-DATE-TIME",N.rawProgramDateTime]),$===-1&&($=I.length);else{if(W=W[0].match(o),!W){x.logger.warn("No matches on slow regex match for level playlist!");continue}for(G=1;G<W.length&&!(typeof W[G]<"u");G++);var q=(" "+W[G]).slice(1),Q=(" "+W[G+1]).slice(1),re=W[G+2]?(" "+W[G+2]).slice(1):"";switch(q){case"PLAYLIST-TYPE":v.type=Q.toUpperCase();break;case"MEDIA-SEQUENCE":O=v.startSN=parseInt(Q);break;case"SKIP":{var ae=new L.AttrList(Q),se=ae.decimalInteger("SKIPPED-SEGMENTS");if((0,F.isFiniteNumber)(se)){v.skippedSegments=se;for(var he=se;he--;)I.unshift(null);O+=se}var ue=ae.enumeratedString("RECENTLY-REMOVED-DATERANGES");ue&&(v.recentlyRemovedDateranges=ue.split("	"));break}case"TARGETDURATION":v.targetduration=parseFloat(Q);break;case"VERSION":v.version=parseInt(Q);break;case"EXTM3U":break;case"ENDLIST":v.live=!1;break;case"#":(Q||re)&&N.tagList.push(re?[Q,re]:[Q]);break;case"DISCONTINUITY":B++,N.tagList.push(["DIS"]);break;case"GAP":N.tagList.push([q]);break;case"BITRATE":N.tagList.push([q,Q]);break;case"DATERANGE":{var ce=new L.AttrList(Q),le=new b.DateRange(ce,v.dateRanges[ce.ID]);le.isValid||v.skippedSegments?v.dateRanges[le.id]=le:x.logger.warn('Ignoring invalid DATERANGE tag: "'+Q+'"'),N.tagList.push(["EXT-X-DATERANGE",Q]);break}case"DISCONTINUITY-SEQUENCE":B=parseInt(Q);break;case"KEY":{var fe=s(Q,f);if(fe.isSupported()){if(fe.method==="NONE"){H=void 0;break}H||(H={}),H[fe.keyFormat]&&(H=T({},H)),H[fe.keyFormat]=fe}else x.logger.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+Q+'"');break}case"START":{var de=new L.AttrList(Q),ve=de.decimalFloatingPoint("TIME-OFFSET");(0,F.isFiniteNumber)(ve)&&(v.startTimeOffset=ve);break}case"MAP":{var pe=new L.AttrList(Q);if(N.duration){var ge=new P.Fragment(d,f);u(ge,pe,e,H),R=ge,N.initSegment=R,R.rawProgramDateTime&&!N.rawProgramDateTime&&(N.rawProgramDateTime=R.rawProgramDateTime)}else u(N,pe,e,H),R=N,Y=!0;break}case"SERVER-CONTROL":{var Ee=new L.AttrList(Q);v.canBlockReload=Ee.bool("CAN-BLOCK-RELOAD"),v.canSkipUntil=Ee.optionalFloat("CAN-SKIP-UNTIL",0),v.canSkipDateRanges=v.canSkipUntil>0&&Ee.bool("CAN-SKIP-DATERANGES"),v.partHoldBack=Ee.optionalFloat("PART-HOLD-BACK",0),v.holdBack=Ee.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Ce=new L.AttrList(Q);v.partTarget=Ce.decimalFloatingPoint("PART-TARGET");break}case"PART":{var Se=v.partList;Se||(Se=v.partList=[]);var be=C>0?Se[Se.length-1]:void 0,Ie=C++,Le=new P.Part(new L.AttrList(Q),N,f,Ie,be);Se.push(Le),N.duration+=Le.duration;break}case"PRELOAD-HINT":{var De=new L.AttrList(Q);v.preloadHint=De;break}case"RENDITION-REPORT":{var Te=new L.AttrList(Q);v.renditionReports=v.renditionReports||[],v.renditionReports.push(Te);break}default:x.logger.warn("line parsed but not handled: "+W);break}}}w&&!w.relurl?(I.pop(),M-=w.duration,v.partList&&(v.fragmentHint=w)):v.partList&&(r(N,w),N.cc=B,v.fragmentHint=N,H&&p(N,H,v));var ye=I.length,Ae=I[0],Pe=I[ye-1];if(M+=v.skippedSegments*v.targetduration,M>0&&ye&&Pe){v.averagetargetduration=M/ye;var me=Pe.sn;v.endSN=me!=="initSegment"?me:0,v.live||(Pe.endList=!0),Ae&&(v.startCC=Ae.cc)}else v.endSN=0,v.startCC=0;return v.fragmentHint&&(M+=v.fragmentHint.duration),v.totalduration=M,v.endCC=B,$>0&&h(I,$),v},i}();function s(i,a){var t,f,e=new L.AttrList(i),d=(t=e.enumeratedString("METHOD"))!=null?t:"",E=e.URI,v=e.hexadecimalInteger("IV"),I=e.enumeratedString("KEYFORMATVERSIONS"),R=(f=e.enumeratedString("KEYFORMAT"))!=null?f:"identity";E&&e.IV&&!v&&x.logger.error("Invalid IV: "+e.IV);var O=E?l.resolve(E,a):"",C=(I||"1").split("/").map(Number).filter(Number.isFinite);return new A.LevelKey(d,O,R,C,v)}function n(i,a){["video","audio","text"].forEach(function(t){var f=i.filter(function(d){return(0,_.isCodecType)(d,t)});if(f.length){var e=f.filter(function(d){return d.lastIndexOf("avc1",0)===0||d.lastIndexOf("mp4a",0)===0});a[t+"Codec"]=e.length>0?e[0]:f[0],i=i.filter(function(d){return f.indexOf(d)===-1})}}),a.unknownCodecs=i}function g(i,a,t){var f=a[t];f&&(i[t]=f)}function h(i,a){for(var t=i[a],f=a;f--;){var e=i[f];if(!e)return;e.programDateTime=t.programDateTime-e.duration*1e3,t=e}}function r(i,a){i.rawProgramDateTime?i.programDateTime=Date.parse(i.rawProgramDateTime):a!=null&&a.programDateTime&&(i.programDateTime=a.endProgramDateTime),(0,F.isFiniteNumber)(i.programDateTime)||(i.programDateTime=null,i.rawProgramDateTime=null)}function u(i,a,t,f){i.relurl=a.URI,a.BYTERANGE&&i.setByteRange(a.BYTERANGE),i.level=t,i.sn="initSegment",f&&(i.levelkeys=f),i.initSegment=null}function p(i,a,t){i.levelkeys=a;var f=t.encryptedFragments;(!f.length||f[f.length-1].levelkeys!==a)&&Object.keys(a).some(function(e){return a[e].isCommonEncryption})&&f.push(i)}},"./src/loader/playlist-loader.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>c});var F=S("./src/polyfills/number.ts"),D=S("./src/events.ts"),b=S("./src/errors.ts"),P=S("./src/utils/logger.ts"),k=S("./src/loader/m3u8-parser.ts"),A=S("./src/types/loader.ts"),L=S("./src/utils/attr-list.ts");function x(y){var m=y.type;switch(m){case A.PlaylistContextType.AUDIO_TRACK:return A.PlaylistLevelType.AUDIO;case A.PlaylistContextType.SUBTITLE_TRACK:return A.PlaylistLevelType.SUBTITLE;default:return A.PlaylistLevelType.MAIN}}function _(y,m){var o=y.url;return(o===void 0||o.indexOf("data:")===0)&&(o=m.url),o}var T=function(){function y(o){this.hls=void 0,this.loaders=Object.create(null),this.hls=o,this.registerListeners()}var m=y.prototype;return m.startLoad=function(l){},m.stopLoad=function(){this.destroyInternalLoaders()},m.registerListeners=function(){var l=this.hls;l.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.on(D.Events.LEVEL_LOADING,this.onLevelLoading,this),l.on(D.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),l.on(D.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},m.unregisterListeners=function(){var l=this.hls;l.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.off(D.Events.LEVEL_LOADING,this.onLevelLoading,this),l.off(D.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),l.off(D.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},m.createInternalLoader=function(l){var s=this.hls.config,n=s.pLoader,g=s.loader,h=n||g,r=new h(s);return l.loader=r,this.loaders[l.type]=r,r},m.getInternalLoader=function(l){return this.loaders[l.type]},m.resetInternalLoader=function(l){this.loaders[l]&&delete this.loaders[l]},m.destroyInternalLoaders=function(){for(var l in this.loaders){var s=this.loaders[l];s&&s.destroy(),this.resetInternalLoader(l)}},m.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},m.onManifestLoading=function(l,s){var n=s.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:A.PlaylistContextType.MANIFEST,url:n,deliveryDirectives:null})},m.onLevelLoading=function(l,s){var n=s.id,g=s.level,h=s.url,r=s.deliveryDirectives;this.load({id:n,groupId:null,level:g,responseType:"text",type:A.PlaylistContextType.LEVEL,url:h,deliveryDirectives:r})},m.onAudioTrackLoading=function(l,s){var n=s.id,g=s.groupId,h=s.url,r=s.deliveryDirectives;this.load({id:n,groupId:g,level:null,responseType:"text",type:A.PlaylistContextType.AUDIO_TRACK,url:h,deliveryDirectives:r})},m.onSubtitleTrackLoading=function(l,s){var n=s.id,g=s.groupId,h=s.url,r=s.deliveryDirectives;this.load({id:n,groupId:g,level:null,responseType:"text",type:A.PlaylistContextType.SUBTITLE_TRACK,url:h,deliveryDirectives:r})},m.load=function(l){var s,n=this.hls.config,g=this.getInternalLoader(l);if(g){var h=g.context;if(h&&h.url===l.url){P.logger.trace("[playlist-loader]: playlist request ongoing");return}P.logger.log("[playlist-loader]: aborting previous loader for type: "+l.type),g.abort()}var r,u,p,i;switch(l.type){case A.PlaylistContextType.MANIFEST:r=n.manifestLoadingMaxRetry,u=n.manifestLoadingTimeOut,p=n.manifestLoadingRetryDelay,i=n.manifestLoadingMaxRetryTimeout;break;case A.PlaylistContextType.LEVEL:case A.PlaylistContextType.AUDIO_TRACK:case A.PlaylistContextType.SUBTITLE_TRACK:r=0,u=n.levelLoadingTimeOut;break;default:r=n.levelLoadingMaxRetry,u=n.levelLoadingTimeOut,p=n.levelLoadingRetryDelay,i=n.levelLoadingMaxRetryTimeout;break}if(g=this.createInternalLoader(l),(s=l.deliveryDirectives)!==null&&s!==void 0&&s.part){var a;if(l.type===A.PlaylistContextType.LEVEL&&l.level!==null?a=this.hls.levels[l.level].details:l.type===A.PlaylistContextType.AUDIO_TRACK&&l.id!==null?a=this.hls.audioTracks[l.id].details:l.type===A.PlaylistContextType.SUBTITLE_TRACK&&l.id!==null&&(a=this.hls.subtitleTracks[l.id].details),a){var t=a.partTarget,f=a.targetduration;t&&f&&(u=Math.min(Math.max(t*3,f*.8)*1e3,u))}}var e={timeout:u,maxRetry:r,retryDelay:p,maxRetryDelay:i,highWaterMark:0},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};g.load(l,e,d)},m.loadsuccess=function(l,s,n,g){g===void 0&&(g=null),this.resetInternalLoader(n.type);var h=l.data;if(h.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(l,n,"no EXTM3U delimiter",g);return}s.parsing.start=performance.now(),h.indexOf("#EXTINF:")>0||h.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(l,s,n,g):this.handleMasterPlaylist(l,s,n,g)},m.loaderror=function(l,s,n){n===void 0&&(n=null),this.handleNetworkError(s,n,!1,l)},m.loadtimeout=function(l,s,n){n===void 0&&(n=null),this.handleNetworkError(s,n,!0)},m.handleMasterPlaylist=function(l,s,n,g){var h=this.hls,r=l.data,u=_(l,n),p=k.default.parseMasterPlaylist(r,u),i=p.levels,a=p.sessionData,t=p.sessionKeys;if(!i.length){this.handleManifestParsingError(l,n,"no level found in manifest",g);return}var f=i.map(function(R){return{id:R.attrs.AUDIO,audioCodec:R.audioCodec}}),e=i.map(function(R){return{id:R.attrs.SUBTITLES,textCodec:R.textCodec}}),d=k.default.parseMasterPlaylistMedia(r,u,"AUDIO",f),E=k.default.parseMasterPlaylistMedia(r,u,"SUBTITLES",e),v=k.default.parseMasterPlaylistMedia(r,u,"CLOSED-CAPTIONS");if(d.length){var I=d.some(function(R){return!R.url});!I&&i[0].audioCodec&&!i[0].attrs.AUDIO&&(P.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),d.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new L.AttrList({}),bitrate:0,url:""}))}h.trigger(D.Events.MANIFEST_LOADED,{levels:i,audioTracks:d,subtitles:E,captions:v,url:u,stats:s,networkDetails:g,sessionData:a,sessionKeys:t})},m.handleTrackOrLevelPlaylist=function(l,s,n,g){var h=this.hls,r=n.id,u=n.level,p=n.type,i=_(l,n),a=(0,F.isFiniteNumber)(r)?r:0,t=(0,F.isFiniteNumber)(u)?u:a,f=x(n),e=k.default.parseLevelPlaylist(l.data,i,t,f,a);if(!e.fragments.length){h.trigger(D.Events.ERROR,{type:b.ErrorTypes.NETWORK_ERROR,details:b.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:i,reason:"no fragments found in level",level:typeof n.level=="number"?n.level:void 0});return}if(p===A.PlaylistContextType.MANIFEST){var d={attrs:new L.AttrList({}),bitrate:0,details:e,name:"",url:i};h.trigger(D.Events.MANIFEST_LOADED,{levels:[d],audioTracks:[],url:i,stats:s,networkDetails:g,sessionData:null,sessionKeys:null})}s.parsing.end=performance.now(),n.levelDetails=e,this.handlePlaylistLoaded(l,s,n,g)},m.handleManifestParsingError=function(l,s,n,g){this.hls.trigger(D.Events.ERROR,{type:b.ErrorTypes.NETWORK_ERROR,details:b.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:s.type===A.PlaylistContextType.MANIFEST,url:l.url,reason:n,response:l,context:s,networkDetails:g})},m.handleNetworkError=function(l,s,n,g){n===void 0&&(n=!1),P.logger.warn("[playlist-loader]: A network "+(n?"timeout":"error")+" occurred while loading "+l.type+" level: "+l.level+" id: "+l.id+' group-id: "'+l.groupId+'"');var h=b.ErrorDetails.UNKNOWN,r=!1,u=this.getInternalLoader(l);switch(l.type){case A.PlaylistContextType.MANIFEST:h=n?b.ErrorDetails.MANIFEST_LOAD_TIMEOUT:b.ErrorDetails.MANIFEST_LOAD_ERROR,r=!0;break;case A.PlaylistContextType.LEVEL:h=n?b.ErrorDetails.LEVEL_LOAD_TIMEOUT:b.ErrorDetails.LEVEL_LOAD_ERROR,r=!1;break;case A.PlaylistContextType.AUDIO_TRACK:h=n?b.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:b.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,r=!1;break;case A.PlaylistContextType.SUBTITLE_TRACK:h=n?b.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:b.ErrorDetails.SUBTITLE_LOAD_ERROR,r=!1;break}u&&this.resetInternalLoader(l.type);var p={type:b.ErrorTypes.NETWORK_ERROR,details:h,fatal:r,url:l.url,loader:u,context:l,networkDetails:s};g&&(p.response=g),this.hls.trigger(D.Events.ERROR,p)},m.handlePlaylistLoaded=function(l,s,n,g){var h=n.type,r=n.level,u=n.id,p=n.groupId,i=n.loader,a=n.levelDetails,t=n.deliveryDirectives;if(!(a!=null&&a.targetduration)){this.handleManifestParsingError(l,n,"invalid target duration",g);return}if(i)switch(a.live&&(i.getCacheAge&&(a.ageHeader=i.getCacheAge()||0),(!i.getCacheAge||isNaN(a.ageHeader))&&(a.ageHeader=0)),h){case A.PlaylistContextType.MANIFEST:case A.PlaylistContextType.LEVEL:this.hls.trigger(D.Events.LEVEL_LOADED,{details:a,level:r||0,id:u||0,stats:s,networkDetails:g,deliveryDirectives:t});break;case A.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(D.Events.AUDIO_TRACK_LOADED,{details:a,id:u||0,groupId:p||"",stats:s,networkDetails:g,deliveryDirectives:t});break;case A.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(D.Events.SUBTITLE_TRACK_LOADED,{details:a,id:u||0,groupId:p||"",stats:s,networkDetails:g,deliveryDirectives:t});break}},y}();const c=T},"./src/polyfills/number.ts":(V,U,S)=>{S.r(U),S.d(U,{MAX_SAFE_INTEGER:()=>D,isFiniteNumber:()=>F});var F=Number.isFinite||function(b){return typeof b=="number"&&isFinite(b)},D=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>D});var F=function(){function b(){}return b.getSilentFrame=function(k,A){switch(k){case"mp4a.40.2":if(A===1)return new Uint8Array([0,200,0,128,35,128]);if(A===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(A===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(A===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(A===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(A===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(A===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(A===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(A===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},b}();const D=F},"./src/remux/mp4-generator.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>b});var F=Math.pow(2,32)-1,D=function(){function P(){}return P.init=function(){P.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var A;for(A in P.types)P.types.hasOwnProperty(A)&&(P.types[A]=[A.charCodeAt(0),A.charCodeAt(1),A.charCodeAt(2),A.charCodeAt(3)]);var L=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),x=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);P.HDLR_TYPES={video:L,audio:x};var _=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),T=new Uint8Array([0,0,0,0,0,0,0,0]);P.STTS=P.STSC=P.STCO=T,P.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),P.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),P.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),P.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var c=new Uint8Array([105,115,111,109]),y=new Uint8Array([97,118,99,49]),m=new Uint8Array([0,0,0,1]);P.FTYP=P.box(P.types.ftyp,c,m,c,y),P.DINF=P.box(P.types.dinf,P.box(P.types.dref,_))},P.box=function(A){for(var L=8,x=arguments.length,_=new Array(x>1?x-1:0),T=1;T<x;T++)_[T-1]=arguments[T];for(var c=_.length,y=c;c--;)L+=_[c].byteLength;var m=new Uint8Array(L);for(m[0]=L>>24&255,m[1]=L>>16&255,m[2]=L>>8&255,m[3]=L&255,m.set(A,4),c=0,L=8;c<y;c++)m.set(_[c],L),L+=_[c].byteLength;return m},P.hdlr=function(A){return P.box(P.types.hdlr,P.HDLR_TYPES[A])},P.mdat=function(A){return P.box(P.types.mdat,A)},P.mdhd=function(A,L){L*=A;var x=Math.floor(L/(F+1)),_=Math.floor(L%(F+1));return P.box(P.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,A>>24&255,A>>16&255,A>>8&255,A&255,x>>24,x>>16&255,x>>8&255,x&255,_>>24,_>>16&255,_>>8&255,_&255,85,196,0,0]))},P.mdia=function(A){return P.box(P.types.mdia,P.mdhd(A.timescale,A.duration),P.hdlr(A.type),P.minf(A))},P.mfhd=function(A){return P.box(P.types.mfhd,new Uint8Array([0,0,0,0,A>>24,A>>16&255,A>>8&255,A&255]))},P.minf=function(A){return A.type==="audio"?P.box(P.types.minf,P.box(P.types.smhd,P.SMHD),P.DINF,P.stbl(A)):P.box(P.types.minf,P.box(P.types.vmhd,P.VMHD),P.DINF,P.stbl(A))},P.moof=function(A,L,x){return P.box(P.types.moof,P.mfhd(A),P.traf(x,L))},P.moov=function(A){for(var L=A.length,x=[];L--;)x[L]=P.trak(A[L]);return P.box.apply(null,[P.types.moov,P.mvhd(A[0].timescale,A[0].duration)].concat(x).concat(P.mvex(A)))},P.mvex=function(A){for(var L=A.length,x=[];L--;)x[L]=P.trex(A[L]);return P.box.apply(null,[P.types.mvex].concat(x))},P.mvhd=function(A,L){L*=A;var x=Math.floor(L/(F+1)),_=Math.floor(L%(F+1)),T=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,A>>24&255,A>>16&255,A>>8&255,A&255,x>>24,x>>16&255,x>>8&255,x&255,_>>24,_>>16&255,_>>8&255,_&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return P.box(P.types.mvhd,T)},P.sdtp=function(A){var L=A.samples||[],x=new Uint8Array(4+L.length),_,T;for(_=0;_<L.length;_++)T=L[_].flags,x[_+4]=T.dependsOn<<4|T.isDependedOn<<2|T.hasRedundancy;return P.box(P.types.sdtp,x)},P.stbl=function(A){return P.box(P.types.stbl,P.stsd(A),P.box(P.types.stts,P.STTS),P.box(P.types.stsc,P.STSC),P.box(P.types.stsz,P.STSZ),P.box(P.types.stco,P.STCO))},P.avc1=function(A){var L=[],x=[],_,T,c;for(_=0;_<A.sps.length;_++)T=A.sps[_],c=T.byteLength,L.push(c>>>8&255),L.push(c&255),L=L.concat(Array.prototype.slice.call(T));for(_=0;_<A.pps.length;_++)T=A.pps[_],c=T.byteLength,x.push(c>>>8&255),x.push(c&255),x=x.concat(Array.prototype.slice.call(T));var y=P.box(P.types.avcC,new Uint8Array([1,L[3],L[4],L[5],255,224|A.sps.length].concat(L).concat([A.pps.length]).concat(x))),m=A.width,o=A.height,l=A.pixelRatio[0],s=A.pixelRatio[1];return P.box(P.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,m>>8&255,m&255,o>>8&255,o&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),y,P.box(P.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),P.box(P.types.pasp,new Uint8Array([l>>24,l>>16&255,l>>8&255,l&255,s>>24,s>>16&255,s>>8&255,s&255])))},P.esds=function(A){var L=A.config.length;return new Uint8Array([0,0,0,0,3,23+L,0,1,0,4,15+L,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([L]).concat(A.config).concat([6,1,2]))},P.mp4a=function(A){var L=A.samplerate;return P.box(P.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,A.channelCount,0,16,0,0,0,0,L>>8&255,L&255,0,0]),P.box(P.types.esds,P.esds(A)))},P.mp3=function(A){var L=A.samplerate;return P.box(P.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,A.channelCount,0,16,0,0,0,0,L>>8&255,L&255,0,0]))},P.stsd=function(A){return A.type==="audio"?A.segmentCodec==="mp3"&&A.codec==="mp3"?P.box(P.types.stsd,P.STSD,P.mp3(A)):P.box(P.types.stsd,P.STSD,P.mp4a(A)):P.box(P.types.stsd,P.STSD,P.avc1(A))},P.tkhd=function(A){var L=A.id,x=A.duration*A.timescale,_=A.width,T=A.height,c=Math.floor(x/(F+1)),y=Math.floor(x%(F+1));return P.box(P.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,L>>24&255,L>>16&255,L>>8&255,L&255,0,0,0,0,c>>24,c>>16&255,c>>8&255,c&255,y>>24,y>>16&255,y>>8&255,y&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,_>>8&255,_&255,0,0,T>>8&255,T&255,0,0]))},P.traf=function(A,L){var x=P.sdtp(A),_=A.id,T=Math.floor(L/(F+1)),c=Math.floor(L%(F+1));return P.box(P.types.traf,P.box(P.types.tfhd,new Uint8Array([0,0,0,0,_>>24,_>>16&255,_>>8&255,_&255])),P.box(P.types.tfdt,new Uint8Array([1,0,0,0,T>>24,T>>16&255,T>>8&255,T&255,c>>24,c>>16&255,c>>8&255,c&255])),P.trun(A,x.length+16+20+8+16+8+8),x)},P.trak=function(A){return A.duration=A.duration||4294967295,P.box(P.types.trak,P.tkhd(A),P.mdia(A))},P.trex=function(A){var L=A.id;return P.box(P.types.trex,new Uint8Array([0,0,0,0,L>>24,L>>16&255,L>>8&255,L&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},P.trun=function(A,L){var x=A.samples||[],_=x.length,T=12+16*_,c=new Uint8Array(T),y,m,o,l,s,n;for(L+=8+T,c.set([A.type==="video"?1:0,0,15,1,_>>>24&255,_>>>16&255,_>>>8&255,_&255,L>>>24&255,L>>>16&255,L>>>8&255,L&255],0),y=0;y<_;y++)m=x[y],o=m.duration,l=m.size,s=m.flags,n=m.cts,c.set([o>>>24&255,o>>>16&255,o>>>8&255,o&255,l>>>24&255,l>>>16&255,l>>>8&255,l&255,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,s.degradPrio&240<<8,s.degradPrio&15,n>>>24&255,n>>>16&255,n>>>8&255,n&255],12+16*y);return P.box(P.types.trun,c)},P.initSegment=function(A){P.types||P.init();var L=P.moov(A),x=new Uint8Array(P.FTYP.byteLength+L.byteLength);return x.set(P.FTYP),x.set(L,P.FTYP.byteLength),x},P}();D.types=void 0,D.HDLR_TYPES=void 0,D.STTS=void 0,D.STSC=void 0,D.STCO=void 0,D.STSZ=void 0,D.VMHD=void 0,D.SMHD=void 0,D.STSD=void 0,D.FTYP=void 0,D.DINF=void 0;const b=D},"./src/remux/mp4-remuxer.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>l,flushTextTrackMetadataCueSamples:()=>g,flushTextTrackUserdataCueSamples:()=>h,normalizePts:()=>s});var F=S("./src/polyfills/number.ts"),D=S("./src/remux/aac-helper.ts"),b=S("./src/remux/mp4-generator.ts"),P=S("./src/events.ts"),k=S("./src/errors.ts"),A=S("./src/utils/logger.ts"),L=S("./src/types/loader.ts"),x=S("./src/utils/timescale-conversion.ts");function _(){return _=Object.assign?Object.assign.bind():function(p){for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(p[t]=a[t])}return p},_.apply(this,arguments)}var T=10*1e3,c=1024,y=1152,m=null,o=null,l=function(){function p(a,t,f,e){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=a,this.config=t,this.typeSupported=f,this.ISGenerated=!1,m===null){var d=navigator.userAgent||"",E=d.match(/Chrome\/(\d+)/i);m=E?parseInt(E[1]):0}if(o===null){var v=navigator.userAgent.match(/Safari\/(\d+)/i);o=v?parseInt(v[1]):0}}var i=p.prototype;return i.destroy=function(){},i.resetTimeStamp=function(t){A.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=t},i.resetNextTimestamp=function(){A.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},i.resetInitSegment=function(){A.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},i.getVideoStartPts=function(t){var f=!1,e=t.reduce(function(d,E){var v=E.pts-d;return v<-4294967296?(f=!0,s(d,E.pts)):v>0?d:E.pts},t[0].pts);return f&&A.logger.debug("PTS rollover detected"),e},i.remux=function(t,f,e,d,E,v,I,R){var O,C,M,B,w,N,W=E,G=E,H=t.pid>-1,$=f.pid>-1,Y=f.samples.length,z=t.samples.length>0,J=I&&Y>0||Y>1,te=(!H||z)&&(!$||J)||this.ISGenerated||I;if(te){this.ISGenerated||(M=this.generateIS(t,f,E));var q=this.isVideoContiguous,Q=-1,re;if(J&&(Q=n(f.samples),!q&&this.config.forceKeyFrameOnDiscontinuity))if(N=!0,Q>0){A.logger.warn("[mp4-remuxer]: Dropped "+Q+" out of "+Y+" video samples due to a missing keyframe");var ae=this.getVideoStartPts(f.samples);f.samples=f.samples.slice(Q),f.dropped+=Q,G+=(f.samples[0].pts-ae)/f.inputTimeScale,re=G}else Q===-1&&(A.logger.warn("[mp4-remuxer]: No keyframe found out of "+Y+" video samples"),N=!1);if(this.ISGenerated){if(z&&J){var se=this.getVideoStartPts(f.samples),he=s(t.samples[0].pts,se)-se,ue=he/f.inputTimeScale;W+=Math.max(0,ue),G+=Math.max(0,-ue)}if(z){if(t.samplerate||(A.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),M=this.generateIS(t,f,E)),C=this.remuxAudio(t,W,this.isAudioContiguous,v,$||J||R===L.PlaylistLevelType.AUDIO?G:void 0),J){var ce=C?C.endPTS-C.startPTS:0;f.inputTimeScale||(A.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),M=this.generateIS(t,f,E)),O=this.remuxVideo(f,G,q,ce)}}else J&&(O=this.remuxVideo(f,G,q,0));O&&(O.firstKeyFrame=Q,O.independent=Q!==-1,O.firstKeyFramePTS=re)}}return this.ISGenerated&&(e.samples.length&&(w=g(e,E,this._initPTS,this._initDTS)),d.samples.length&&(B=h(d,E,this._initPTS))),{audio:C,video:O,initSegment:M,independent:N,text:B,id3:w}},i.generateIS=function(t,f,e){var d=t.samples,E=f.samples,v=this.typeSupported,I={},R=!(0,F.isFiniteNumber)(this._initPTS),O="audio/mp4",C,M,B;if(R&&(C=M=1/0),t.config&&d.length){switch(t.timescale=t.samplerate,t.segmentCodec){case"mp3":v.mpeg?(O="audio/mpeg",t.codec=""):v.mp3&&(t.codec="mp3");break}I.audio={id:"audio",container:O,codec:t.codec,initSegment:t.segmentCodec==="mp3"&&v.mpeg?new Uint8Array(0):b.default.initSegment([t]),metadata:{channelCount:t.channelCount}},R&&(B=t.inputTimeScale,C=M=d[0].pts-Math.round(B*e))}if(f.sps&&f.pps&&E.length&&(f.timescale=f.inputTimeScale,I.video={id:"main",container:"video/mp4",codec:f.codec,initSegment:b.default.initSegment([f]),metadata:{width:f.width,height:f.height}},R)){B=f.inputTimeScale;var w=this.getVideoStartPts(E),N=Math.round(B*e);M=Math.min(M,s(E[0].dts,w)-N),C=Math.min(C,w-N)}if(Object.keys(I).length)return this.ISGenerated=!0,R&&(this._initPTS=C,this._initDTS=M),{tracks:I,initPTS:C,timescale:B}},i.remuxVideo=function(t,f,e,d){var E=t.inputTimeScale,v=t.samples,I=[],R=v.length,O=this._initPTS,C=this.nextAvcDts,M=8,B=this.videoSampleDuration,w,N,W=Number.POSITIVE_INFINITY,G=Number.NEGATIVE_INFINITY,H=!1;if(!e||C===null){var $=f*E,Y=v[0].pts-s(v[0].dts,v[0].pts);C=$-Y}for(var z=0;z<R;z++){var J=v[z];J.pts=s(J.pts-O,C),J.dts=s(J.dts-O,C),J.dts<v[z>0?z-1:z].dts&&(H=!0)}H&&v.sort(function(Ze,dt){var Xt=Ze.dts-dt.dts,zt=Ze.pts-dt.pts;return Xt||zt}),w=v[0].dts,N=v[v.length-1].dts;var te=N-w,q=te?Math.round(te/(R-1)):B||t.inputTimeScale/30;if(e){var Q=w-C,re=Q>q,ae=Q<-1;if((re||ae)&&(re?A.logger.warn("AVC: "+(0,x.toMsFromMpegTsClock)(Q,!0)+" ms ("+Q+"dts) hole between fragments detected, filling it"):A.logger.warn("AVC: "+(0,x.toMsFromMpegTsClock)(-Q,!0)+" ms ("+Q+"dts) overlapping between fragments detected"),!ae||C>v[0].pts)){w=C;var se=v[0].pts-Q;v[0].dts=w,v[0].pts=se,A.logger.log("Video: First PTS/DTS adjusted: "+(0,x.toMsFromMpegTsClock)(se,!0)+"/"+(0,x.toMsFromMpegTsClock)(w,!0)+", delta: "+(0,x.toMsFromMpegTsClock)(Q,!0)+" ms")}}w=Math.max(0,w);for(var he=0,ue=0,ce=0;ce<R;ce++){for(var le=v[ce],fe=le.units,de=fe.length,ve=0,pe=0;pe<de;pe++)ve+=fe[pe].data.length;ue+=ve,he+=de,le.length=ve,le.dts=Math.max(le.dts,w),W=Math.min(le.pts,W),G=Math.max(le.pts,G)}N=v[R-1].dts;var ge=ue+4*he+8,Ee;try{Ee=new Uint8Array(ge)}catch{this.observer.emit(P.Events.ERROR,P.Events.ERROR,{type:k.ErrorTypes.MUX_ERROR,details:k.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ge,reason:"fail allocating video mdat "+ge});return}var Ce=new DataView(Ee.buffer);Ce.setUint32(0,ge),Ee.set(b.default.types.mdat,4);for(var Se=!1,be=Number.POSITIVE_INFINITY,Ie=Number.POSITIVE_INFINITY,Le=Number.NEGATIVE_INFINITY,De=Number.NEGATIVE_INFINITY,Te=0;Te<R;Te++){for(var ye=v[Te],Ae=ye.units,Pe=0,me=0,Me=Ae.length;me<Me;me++){var Re=Ae[me],je=Re.data,we=Re.data.byteLength;Ce.setUint32(M,we),M+=4,Ee.set(je,M),M+=we,Pe+=4+we}var Ke=void 0;if(Te<R-1)B=v[Te+1].dts-ye.dts,Ke=v[Te+1].pts-ye.pts;else{var ot=this.config,Ve=Te>0?ye.dts-v[Te-1].dts:q;if(Ke=Te>0?ye.pts-v[Te-1].pts:q,ot.stretchShortVideoTrack&&this.nextAudioPts!==null){var Kt=Math.floor(ot.maxBufferHole*E),$e=(d?W+d*E:this.nextAudioPts)-ye.pts;$e>Kt?(B=$e-Ve,B<0?B=Ve:Se=!0,A.logger.log("[mp4-remuxer]: It is approximately "+$e/90+" ms to the next segment; using duration "+B/90+" ms for the last video frame.")):B=Ve}else B=Ve}var Wt=Math.round(ye.pts-ye.dts);be=Math.min(be,B),Le=Math.max(Le,B),Ie=Math.min(Ie,Ke),De=Math.max(De,Ke),I.push(new r(ye.key,B,Pe,Wt))}if(I.length){if(m){if(m<70){var lt=I[0].flags;lt.dependsOn=2,lt.isNonSync=0}}else if(o&&De-Ie<Le-be&&q/Le<.025&&I[0].cts===0){A.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var Qe=w,Oe=0,ut=I.length;Oe<ut;Oe++){var ft=Qe+I[Oe].duration,Gt=Qe+I[Oe].cts;if(Oe<ut-1){var Ht=ft+I[Oe+1].cts;I[Oe].duration=Ht-Gt}else I[Oe].duration=Oe?I[Oe-1].duration:q;I[Oe].cts=0,Qe=ft}}}console.assert(B!==null,"mp4SampleDuration must be computed"),B=Se||!B?q:B,this.nextAvcDts=C=N+B,this.videoSampleDuration=B,this.isVideoContiguous=!0;var jt=b.default.moof(t.sequenceNumber++,w,_({},t,{samples:I})),Vt="video",Yt={data1:jt,data2:Ee,startPTS:W/E,endPTS:(G+B)/E,startDTS:w/E,endDTS:C/E,type:Vt,hasAudio:!1,hasVideo:!0,nb:I.length,dropped:t.dropped};return t.samples=[],t.dropped=0,console.assert(Ee.length,"MDAT length must not be zero"),Yt},i.remuxAudio=function(t,f,e,d,E){var v=t.inputTimeScale,I=t.samplerate?t.samplerate:v,R=v/I,O=t.segmentCodec==="aac"?c:y,C=O*R,M=this._initPTS,B=t.segmentCodec==="mp3"&&this.typeSupported.mpeg,w=[],N=E!==void 0,W=t.samples,G=B?0:8,H=this.nextAudioPts||-1,$=f*v;if(this.isAudioContiguous=e=e||W.length&&H>0&&(d&&Math.abs($-H)<9e3||Math.abs(s(W[0].pts-M,$)-H)<20*C),W.forEach(function(Re){Re.pts=s(Re.pts-M,$)}),!e||H<0){if(W=W.filter(function(Re){return Re.pts>=0}),!W.length)return;E===0?H=0:d&&!N?H=Math.max(0,$):H=W[0].pts}if(t.segmentCodec==="aac")for(var Y=this.config.maxAudioFramesDrift,z=0,J=H;z<W.length;z++){var te=W[z],q=te.pts,Q=q-J,re=Math.abs(1e3*Q/v);if(Q<=-Y*C&&N)z===0&&(A.logger.warn("Audio frame @ "+(q/v).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*Q/v)+" ms."),this.nextAudioPts=H=J=q);else if(Q>=Y*C&&re<T&&N){var ae=Math.round(Q/C);J=q-ae*C,J<0&&(ae--,J+=C),z===0&&(this.nextAudioPts=H=J),A.logger.warn("[mp4-remuxer]: Injecting "+ae+" audio frame @ "+(J/v).toFixed(3)+"s due to "+Math.round(1e3*Q/v)+" ms gap.");for(var se=0;se<ae;se++){var he=Math.max(J,0),ue=D.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);ue||(A.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ue=te.unit.subarray()),W.splice(z,0,{unit:ue,pts:he}),J+=C,z++}}te.pts=J,J+=C}for(var ce=null,le=null,fe,de=0,ve=W.length;ve--;)de+=W[ve].unit.byteLength;for(var pe=0,ge=W.length;pe<ge;pe++){var Ee=W[pe],Ce=Ee.unit,Se=Ee.pts;if(le!==null){var be=w[pe-1];be.duration=Math.round((Se-le)/R)}else if(e&&t.segmentCodec==="aac"&&(Se=H),ce=Se,de>0){de+=G;try{fe=new Uint8Array(de)}catch{this.observer.emit(P.Events.ERROR,P.Events.ERROR,{type:k.ErrorTypes.MUX_ERROR,details:k.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:de,reason:"fail allocating audio mdat "+de});return}if(!B){var Ie=new DataView(fe.buffer);Ie.setUint32(0,de),fe.set(b.default.types.mdat,4)}}else return;fe.set(Ce,G);var Le=Ce.byteLength;G+=Le,w.push(new r(!0,O,Le,0)),le=Se}var De=w.length;if(De){var Te=w[w.length-1];this.nextAudioPts=H=le+R*Te.duration;var ye=B?new Uint8Array(0):b.default.moof(t.sequenceNumber++,ce/R,_({},t,{samples:w}));t.samples=[];var Ae=ce/v,Pe=H/v,me="audio",Me={data1:ye,data2:fe,startPTS:Ae,endPTS:Pe,startDTS:Ae,endDTS:Pe,type:me,hasAudio:!0,hasVideo:!1,nb:De};return this.isAudioContiguous=!0,console.assert(fe.length,"MDAT length must not be zero"),Me}},i.remuxEmptyAudio=function(t,f,e,d){var E=t.inputTimeScale,v=t.samplerate?t.samplerate:E,I=E/v,R=this.nextAudioPts,O=(R!==null?R:d.startDTS*E)+this._initDTS,C=d.endDTS*E+this._initDTS,M=I*c,B=Math.ceil((C-O)/M),w=D.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(A.logger.warn("[mp4-remuxer]: remux empty Audio"),!w){A.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var N=[],W=0;W<B;W++){var G=O+W*M;N.push({unit:w,pts:G,dts:G})}return t.samples=N,this.remuxAudio(t,f,e,!1)},p}();function s(p,i){var a;if(i===null)return p;for(i<p?a=-8589934592:a=8589934592;Math.abs(p-i)>4294967296;)p+=a;return p}function n(p){for(var i=0;i<p.length;i++)if(p[i].key)return i;return-1}function g(p,i,a,t){var f=p.samples.length;if(f){for(var e=p.inputTimeScale,d=0;d<f;d++){var E=p.samples[d];E.pts=s(E.pts-a,i*e)/e,E.dts=s(E.dts-t,i*e)/e}var v=p.samples;return p.samples=[],{samples:v}}}function h(p,i,a){var t=p.samples.length;if(t){for(var f=p.inputTimeScale,e=0;e<t;e++){var d=p.samples[e];d.pts=s(d.pts-a,i*f)/f}p.samples.sort(function(v,I){return v.pts-I.pts});var E=p.samples;return p.samples=[],{samples:E}}}var r=function(i,a,t,f){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=a,this.size=t,this.cts=f,this.flags=new u(i)},u=function(i){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=i?2:1,this.isNonSync=i?0:1}},"./src/remux/passthrough-remuxer.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>x});var F=S("./src/polyfills/number.ts"),D=S("./src/remux/mp4-remuxer.ts"),b=S("./src/utils/mp4-tools.ts"),P=S("./src/loader/fragment.ts"),k=S("./src/utils/logger.ts"),A=function(){function _(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var T=_.prototype;return T.destroy=function(){},T.resetTimeStamp=function(y){this.initPTS=y,this.lastEndTime=null},T.resetNextTimestamp=function(){this.lastEndTime=null},T.resetInitSegment=function(y,m,o,l){this.audioCodec=m,this.videoCodec=o,this.generateInitSegment((0,b.patchEncyptionData)(y,l)),this.emitInitSegment=!0},T.generateInitSegment=function(y){var m=this.audioCodec,o=this.videoCodec;if(!y||!y.byteLength){this.initTracks=void 0,this.initData=void 0;return}var l=this.initData=(0,b.parseInitSegment)(y);m||(m=L(l.audio,P.ElementaryStreamTypes.AUDIO)),o||(o=L(l.video,P.ElementaryStreamTypes.VIDEO));var s={};l.audio&&l.video?s.audiovideo={container:"video/mp4",codec:m+","+o,initSegment:y,id:"main"}:l.audio?s.audio={container:"audio/mp4",codec:m,initSegment:y,id:"audio"}:l.video?s.video={container:"video/mp4",codec:o,initSegment:y,id:"main"}:k.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s},T.remux=function(y,m,o,l,s){var n,g=this.initPTS,h=this.lastEndTime,r={audio:void 0,video:void 0,text:l,id3:o,initSegment:void 0};(0,F.isFiniteNumber)(h)||(h=this.lastEndTime=s||0);var u=m.samples;if(!u||!u.length)return r;var p={initPTS:void 0,timescale:1},i=this.initData;if((!i||!i.length)&&(this.generateInitSegment(u),i=this.initData),!i||!i.length)return k.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),r;this.emitInitSegment&&(p.tracks=this.initTracks,this.emitInitSegment=!1);var a=(0,b.getStartDTS)(i,u);(0,F.isFiniteNumber)(g)||(this.initPTS=p.initPTS=g=a-s);var t=(0,b.getDuration)(u,i),f=y?a-g:h,e=f+t;(0,b.offsetStartDTS)(i,u,g),t>0?this.lastEndTime=e:(k.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var d=!!i.audio,E=!!i.video,v="";d&&(v+="audio"),E&&(v+="video");var I={data1:u,startPTS:f,startDTS:f,endPTS:e,endDTS:e,type:v,hasAudio:d,hasVideo:E,nb:1,dropped:0};r.audio=I.type==="audio"?I:void 0,r.video=I.type!=="audio"?I:void 0,r.initSegment=p;var R=(n=this.initPTS)!=null?n:0;return r.id3=(0,D.flushTextTrackMetadataCueSamples)(o,s,R,R),l.samples.length&&(r.text=(0,D.flushTextTrackUserdataCueSamples)(l,s,R)),r},_}();function L(_,T){var c=_==null?void 0:_.codec;return c&&c.length>4?c:c==="hvc1"||c==="hev1"?"hvc1.1.c.L120.90":c==="av01"?"av01.0.04M.08":c==="avc1"||T===P.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const x=A},"./src/task-loop.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>F});var F=function(){function D(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var b=D.prototype;return b.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},b.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},b.onHandlerDestroyed=function(){},b.hasInterval=function(){return!!this._tickInterval},b.hasNextTick=function(){return!!this._tickTimer},b.setInterval=function(k){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,k),!0)},b.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},b.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},b.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},b.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},b.doTick=function(){},D}()},"./src/types/cmcd.ts":(V,U,S)=>{S.r(U),S.d(U,{CMCDObjectType:()=>D,CMCDStreamType:()=>P,CMCDStreamingFormat:()=>b,CMCDVersion:()=>F});var F=1,D;(function(k){k.MANIFEST="m",k.AUDIO="a",k.VIDEO="v",k.MUXED="av",k.INIT="i",k.CAPTION="c",k.TIMED_TEXT="tt",k.KEY="k",k.OTHER="o"})(D||(D={}));var b;(function(k){k.DASH="d",k.HLS="h",k.SMOOTH="s",k.OTHER="o"})(b||(b={}));var P;(function(k){k.VOD="v",k.LIVE="l"})(P||(P={}))},"./src/types/demuxer.ts":(V,U,S)=>{S.r(U),S.d(U,{MetadataSchema:()=>F});var F;(function(D){D.audioId3="org.id3",D.dateRange="com.apple.quicktime.HLS",D.emsg="https://aomedia.org/emsg/ID3"})(F||(F={}))},"./src/types/level.ts":(V,U,S)=>{S.r(U),S.d(U,{HdcpLevels:()=>k,HlsSkip:()=>A,HlsUrlParameters:()=>x,Level:()=>_,getSkipValue:()=>L});function F(T,c){for(var y=0;y<c.length;y++){var m=c[y];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(T,b(m.key),m)}}function D(T,c,y){return c&&F(T.prototype,c),y&&F(T,y),Object.defineProperty(T,"prototype",{writable:!1}),T}function b(T){var c=P(T,"string");return typeof c=="symbol"?c:String(c)}function P(T,c){if(typeof T!="object"||T===null)return T;var y=T[Symbol.toPrimitive];if(y!==void 0){var m=y.call(T,c||"default");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return(c==="string"?String:Number)(T)}var k=["NONE","TYPE-0","TYPE-1","TYPE-2",null],A;(function(T){T.No="",T.Yes="YES",T.v2="v2"})(A||(A={}));function L(T,c){var y=T.canSkipUntil,m=T.canSkipDateRanges,o=T.endSN,l=c!==void 0?c-o:0;return y&&l<y?m?A.v2:A.Yes:A.No}var x=function(){function T(y,m,o){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=y,this.part=m,this.skip=o}var c=T.prototype;return c.addDirectives=function(m){var o=new self.URL(m);return this.msn!==void 0&&o.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&o.searchParams.set("_HLS_part",this.part.toString()),this.skip&&o.searchParams.set("_HLS_skip",this.skip),o.href},T}(),_=function(){function T(c){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[c.url],this.attrs=c.attrs,this.bitrate=c.bitrate,c.details&&(this.details=c.details),this.id=c.id||0,this.name=c.name,this.width=c.width||0,this.height=c.height||0,this.audioCodec=c.audioCodec,this.videoCodec=c.videoCodec,this.unknownCodecs=c.unknownCodecs,this.codecSet=[c.videoCodec,c.audioCodec].filter(function(y){return y}).join(",").replace(/\.[^.,]+/g,"")}return D(T,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(y){var m=y%this.url.length;this._urlId!==m&&(this.details=void 0,this._urlId=m)}}]),T}()},"./src/types/loader.ts":(V,U,S)=>{S.r(U),S.d(U,{PlaylistContextType:()=>F,PlaylistLevelType:()=>D});var F;(function(b){b.MANIFEST="manifest",b.LEVEL="level",b.AUDIO_TRACK="audioTrack",b.SUBTITLE_TRACK="subtitleTrack"})(F||(F={}));var D;(function(b){b.MAIN="main",b.AUDIO="audio",b.SUBTITLE="subtitle"})(D||(D={}))},"./src/types/transmuxer.ts":(V,U,S)=>{S.r(U),S.d(U,{ChunkMetadata:()=>F});var F=function(P,k,A,L,x,_){L===void 0&&(L=0),x===void 0&&(x=-1),_===void 0&&(_=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=D(),this.buffering={audio:D(),video:D(),audiovideo:D()},this.level=P,this.sn=k,this.id=A,this.size=L,this.part=x,this.partial=_};function D(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":(V,U,S)=>{S.r(U),S.d(U,{AttrList:()=>b});var F=/^(\d+)x(\d+)$/,D=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,b=function(){function P(A){typeof A=="string"&&(A=P.parseAttrList(A));for(var L in A)A.hasOwnProperty(L)&&(this[L]=A[L])}var k=P.prototype;return k.decimalInteger=function(L){var x=parseInt(this[L],10);return x>Number.MAX_SAFE_INTEGER?1/0:x},k.hexadecimalInteger=function(L){if(this[L]){var x=(this[L]||"0x").slice(2);x=(x.length&1?"0":"")+x;for(var _=new Uint8Array(x.length/2),T=0;T<x.length/2;T++)_[T]=parseInt(x.slice(T*2,T*2+2),16);return _}else return null},k.hexadecimalIntegerAsNumber=function(L){var x=parseInt(this[L],16);return x>Number.MAX_SAFE_INTEGER?1/0:x},k.decimalFloatingPoint=function(L){return parseFloat(this[L])},k.optionalFloat=function(L,x){var _=this[L];return _?parseFloat(_):x},k.enumeratedString=function(L){return this[L]},k.bool=function(L){return this[L]==="YES"},k.decimalResolution=function(L){var x=F.exec(this[L]);if(x!==null)return{width:parseInt(x[1],10),height:parseInt(x[2],10)}},P.parseAttrList=function(L){var x,_={},T='"';for(D.lastIndex=0;(x=D.exec(L))!==null;){var c=x[2];c.indexOf(T)===0&&c.lastIndexOf(T)===c.length-1&&(c=c.slice(1,-1)),_[x[1]]=c}return _},P}()},"./src/utils/binary-search.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>D});var F={search:function(P,k){for(var A=0,L=P.length-1,x=null,_=null;A<=L;){x=(A+L)/2|0,_=P[x];var T=k(_);if(T>0)A=x+1;else if(T<0)L=x-1;else return _}return null}};const D=F},"./src/utils/buffer-helper.ts":(V,U,S)=>{S.r(U),S.d(U,{BufferHelper:()=>b});var F=S("./src/utils/logger.ts"),D={length:0,start:function(){return 0},end:function(){return 0}},b=function(){function P(){}return P.isBuffered=function(A,L){try{if(A){for(var x=P.getBuffered(A),_=0;_<x.length;_++)if(L>=x.start(_)&&L<=x.end(_))return!0}}catch{}return!1},P.bufferInfo=function(A,L,x){try{if(A){var _=P.getBuffered(A),T=[],c;for(c=0;c<_.length;c++)T.push({start:_.start(c),end:_.end(c)});return this.bufferedInfo(T,L,x)}}catch{}return{len:0,start:L,end:L,nextStart:void 0}},P.bufferedInfo=function(A,L,x){L=Math.max(0,L),A.sort(function(r,u){var p=r.start-u.start;return p||u.end-r.end});var _=[];if(x)for(var T=0;T<A.length;T++){var c=_.length;if(c){var y=_[c-1].end;A[T].start-y<x?A[T].end>y&&(_[c-1].end=A[T].end):_.push(A[T])}else _.push(A[T])}else _=A;for(var m=0,o,l=L,s=L,n=0;n<_.length;n++){var g=_[n].start,h=_[n].end;if(L+x>=g&&L<h)l=g,s=h,m=s-L;else if(L+x<g){o=g;break}}return{len:m,start:l||0,end:s||0,nextStart:o}},P.getBuffered=function(A){try{return A.buffered}catch(L){return F.logger.log("failed to get media.buffered",L),D}},P}()},"./src/utils/cea-608-parser.ts":(V,U,S)=>{S.r(U),S.d(U,{CaptionScreen:()=>n,Row:()=>s,default:()=>i});var F=S("./src/utils/logger.ts"),D={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},b=function(t){var f=t;return D.hasOwnProperty(t)&&(f=D[t]),String.fromCharCode(f)},P=15,k=100,A={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},L={17:2,18:4,21:6,22:8,23:10,19:13,20:15},x={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},_={25:2,26:4,29:6,30:8,31:10,27:13,28:15},T=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],c;(function(a){a[a.ERROR=0]="ERROR",a[a.TEXT=1]="TEXT",a[a.WARNING=2]="WARNING",a[a.INFO=2]="INFO",a[a.DEBUG=3]="DEBUG",a[a.DATA=3]="DATA"})(c||(c={}));var y=function(){function a(){this.time=null,this.verboseLevel=c.ERROR}var t=a.prototype;return t.log=function(e,d){if(this.verboseLevel>=e){var E=typeof d=="function"?d():d;F.logger.log(this.time+" ["+e+"] "+E)}},a}(),m=function(t){for(var f=[],e=0;e<t.length;e++)f.push(t[e].toString(16));return f},o=function(){function a(f,e,d,E,v){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=f||"white",this.underline=e||!1,this.italics=d||!1,this.background=E||"black",this.flash=v||!1}var t=a.prototype;return t.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},t.setStyles=function(e){for(var d=["foreground","underline","italics","background","flash"],E=0;E<d.length;E++){var v=d[E];e.hasOwnProperty(v)&&(this[v]=e[v])}},t.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},t.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},t.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},t.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},a}(),l=function(){function a(f,e,d,E,v,I){this.uchar=void 0,this.penState=void 0,this.uchar=f||" ",this.penState=new o(e,d,E,v,I)}var t=a.prototype;return t.reset=function(){this.uchar=" ",this.penState.reset()},t.setChar=function(e,d){this.uchar=e,this.penState.copy(d)},t.setPenState=function(e){this.penState.copy(e)},t.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},t.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},t.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},a}(),s=function(){function a(f){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var e=0;e<k;e++)this.chars.push(new l);this.logger=f,this.pos=0,this.currPenState=new o}var t=a.prototype;return t.equals=function(e){for(var d=!0,E=0;E<k;E++)if(!this.chars[E].equals(e.chars[E])){d=!1;break}return d},t.copy=function(e){for(var d=0;d<k;d++)this.chars[d].copy(e.chars[d])},t.isEmpty=function(){for(var e=!0,d=0;d<k;d++)if(!this.chars[d].isEmpty()){e=!1;break}return e},t.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(c.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>k&&(this.logger.log(c.DEBUG,"Too large cursor position "+this.pos),this.pos=k)},t.moveCursor=function(e){var d=this.pos+e;if(e>1)for(var E=this.pos+1;E<d+1;E++)this.chars[E].setPenState(this.currPenState);this.setCursor(d)},t.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.insertChar=function(e){var d=this;e>=144&&this.backSpace();var E=b(e);if(this.pos>=k){this.logger.log(c.ERROR,function(){return"Cannot insert "+e.toString(16)+" ("+E+") at position "+d.pos+". Skipping it!"});return}this.chars[this.pos].setChar(E,this.currPenState),this.moveCursor(1)},t.clearFromPos=function(e){var d;for(d=e;d<k;d++)this.chars[d].reset()},t.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.clearToEndOfRow=function(){this.clearFromPos(this.pos)},t.getTextString=function(){for(var e=[],d=!0,E=0;E<k;E++){var v=this.chars[E].uchar;v!==" "&&(d=!1),e.push(v)}return d?"":e.join("")},t.setPenStyles=function(e){this.currPenState.setStyles(e);var d=this.chars[this.pos];d.setPenState(this.currPenState)},a}(),n=function(){function a(f){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var e=0;e<P;e++)this.rows.push(new s(f));this.logger=f,this.currRow=P-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var t=a.prototype;return t.reset=function(){for(var e=0;e<P;e++)this.rows[e].clear();this.currRow=P-1},t.equals=function(e){for(var d=!0,E=0;E<P;E++)if(!this.rows[E].equals(e.rows[E])){d=!1;break}return d},t.copy=function(e){for(var d=0;d<P;d++)this.rows[d].copy(e.rows[d])},t.isEmpty=function(){for(var e=!0,d=0;d<P;d++)if(!this.rows[d].isEmpty()){e=!1;break}return e},t.backSpace=function(){var e=this.rows[this.currRow];e.backSpace()},t.clearToEndOfRow=function(){var e=this.rows[this.currRow];e.clearToEndOfRow()},t.insertChar=function(e){var d=this.rows[this.currRow];d.insertChar(e)},t.setPen=function(e){var d=this.rows[this.currRow];d.setPenStyles(e)},t.moveCursor=function(e){var d=this.rows[this.currRow];d.moveCursor(e)},t.setCursor=function(e){this.logger.log(c.INFO,"setCursor: "+e);var d=this.rows[this.currRow];d.setCursor(e)},t.setPAC=function(e){this.logger.log(c.INFO,function(){return"pacData = "+JSON.stringify(e)});var d=e.row-1;if(this.nrRollUpRows&&d<this.nrRollUpRows-1&&(d=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==d){for(var E=0;E<P;E++)this.rows[E].clear();var v=this.currRow+1-this.nrRollUpRows,I=this.lastOutputScreen;if(I){var R=I.rows[v].cueStartTime,O=this.logger.time;if(R&&O!==null&&R<O)for(var C=0;C<this.nrRollUpRows;C++)this.rows[d-this.nrRollUpRows+C+1].copy(I.rows[v+C])}}this.currRow=d;var M=this.rows[this.currRow];if(e.indent!==null){var B=e.indent,w=Math.max(B-1,0);M.setCursor(e.indent),e.color=M.chars[w].penState.foreground}var N={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(N)},t.setBkgData=function(e){this.logger.log(c.INFO,function(){return"bkgData = "+JSON.stringify(e)}),this.backSpace(),this.setPen(e),this.insertChar(32)},t.setRollUpRows=function(e){this.nrRollUpRows=e},t.rollUp=function(){var e=this;if(this.nrRollUpRows===null){this.logger.log(c.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(c.TEXT,function(){return e.getDisplayText()});var d=this.currRow+1-this.nrRollUpRows,E=this.rows.splice(d,1)[0];E.clear(),this.rows.splice(this.currRow,0,E),this.logger.log(c.INFO,"Rolling up")},t.getDisplayText=function(e){e=e||!1;for(var d=[],E="",v=-1,I=0;I<P;I++){var R=this.rows[I].getTextString();R&&(v=I+1,e?d.push("Row "+v+": '"+R+"'"):d.push(R.trim()))}return d.length>0&&(e?E="["+d.join(" | ")+"]":E=d.join(`
`)),E},t.getTextAndFormat=function(){return this.rows},a}(),g=function(){function a(f,e,d){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=f,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new n(d),this.nonDisplayedMemory=new n(d),this.lastOutputScreen=new n(d),this.currRollUpRow=this.displayedMemory.rows[P-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=d}var t=a.prototype;return t.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[P-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},t.getHandler=function(){return this.outputFilter},t.setHandler=function(e){this.outputFilter=e},t.setPAC=function(e){this.writeScreen.setPAC(e)},t.setBkgData=function(e){this.writeScreen.setBkgData(e)},t.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(c.INFO,function(){return"MODE="+e}),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},t.insertChars=function(e){for(var d=this,E=0;E<e.length;E++)this.writeScreen.insertChar(e[E]);var v=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(c.INFO,function(){return v+": "+d.writeScreen.getDisplayText(!0)}),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(c.TEXT,function(){return"DISPLAYED: "+d.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())},t.ccRCL=function(){this.logger.log(c.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.ccBS=function(){this.logger.log(c.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.ccAOF=function(){},t.ccAON=function(){},t.ccDER=function(){this.logger.log(c.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.ccRU=function(e){this.logger.log(c.INFO,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},t.ccFON=function(){this.logger.log(c.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.ccRDC=function(){this.logger.log(c.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.ccTR=function(){this.logger.log(c.INFO,"TR"),this.setMode("MODE_TEXT")},t.ccRTD=function(){this.logger.log(c.INFO,"RTD"),this.setMode("MODE_TEXT")},t.ccEDM=function(){this.logger.log(c.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.ccCR=function(){this.logger.log(c.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.ccENM=function(){this.logger.log(c.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.ccEOC=function(){var e=this;if(this.logger.log(c.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var d=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=d,this.writeScreen=this.nonDisplayedMemory,this.logger.log(c.TEXT,function(){return"DISP: "+e.displayedMemory.getDisplayText()})}this.outputDataUpdate(!0)},t.ccTO=function(e){this.logger.log(c.INFO,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},t.ccMIDROW=function(e){var d={flash:!1};if(d.underline=e%2===1,d.italics=e>=46,d.italics)d.foreground="white";else{var E=Math.floor(e/2)-16,v=["white","green","blue","cyan","red","yellow","magenta"];d.foreground=v[E]}this.logger.log(c.INFO,"MIDROW: "+JSON.stringify(d)),this.writeScreen.setPen(d)},t.outputDataUpdate=function(e){e===void 0&&(e=!1);var d=this.logger.time;d!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=d:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,d,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:d),this.lastOutputScreen.copy(this.displayedMemory))},t.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},a}(),h=function(){function a(f,e,d){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var E=new y;this.channels=[null,new g(f,e,E),new g(f+1,d,E)],this.cmdHistory=p(),this.logger=E}var t=a.prototype;return t.getHandler=function(e){return this.channels[e].getHandler()},t.setHandler=function(e,d){this.channels[e].setHandler(d)},t.addData=function(e,d){var E,v,I,R=!1;this.logger.time=e;for(var O=0;O<d.length;O+=2)if(v=d[O]&127,I=d[O+1]&127,!(v===0&&I===0)){if(this.logger.log(c.DATA,"["+m([d[O],d[O+1]])+"] -> ("+m([v,I])+")"),E=this.parseCmd(v,I),E||(E=this.parseMidrow(v,I)),E||(E=this.parsePAC(v,I)),E||(E=this.parseBackgroundAttributes(v,I)),!E&&(R=this.parseChars(v,I),R)){var C=this.currentChannel;if(C&&C>0){var M=this.channels[C];M.insertChars(R)}else this.logger.log(c.WARNING,"No channel found yet. TEXT-MODE?")}!E&&!R&&this.logger.log(c.WARNING,"Couldn't parse cleaned data "+m([v,I])+" orig: "+m([d[O],d[O+1]]))}},t.parseCmd=function(e,d){var E=this.cmdHistory,v=(e===20||e===28||e===21||e===29)&&d>=32&&d<=47,I=(e===23||e===31)&&d>=33&&d<=35;if(!(v||I))return!1;if(u(e,d,E))return r(null,null,E),this.logger.log(c.DEBUG,"Repeated command ("+m([e,d])+") is dropped"),!0;var R=e===20||e===21||e===23?1:2,O=this.channels[R];return e===20||e===21||e===28||e===29?d===32?O.ccRCL():d===33?O.ccBS():d===34?O.ccAOF():d===35?O.ccAON():d===36?O.ccDER():d===37?O.ccRU(2):d===38?O.ccRU(3):d===39?O.ccRU(4):d===40?O.ccFON():d===41?O.ccRDC():d===42?O.ccTR():d===43?O.ccRTD():d===44?O.ccEDM():d===45?O.ccCR():d===46?O.ccENM():d===47&&O.ccEOC():O.ccTO(d-32),r(e,d,E),this.currentChannel=R,!0},t.parseMidrow=function(e,d){var E=0;if((e===17||e===25)&&d>=32&&d<=47){if(e===17?E=1:E=2,E!==this.currentChannel)return this.logger.log(c.ERROR,"Mismatch channel in midrow parsing"),!1;var v=this.channels[E];return v?(v.ccMIDROW(d),this.logger.log(c.DEBUG,"MIDROW ("+m([e,d])+")"),!0):!1}return!1},t.parsePAC=function(e,d){var E,v=this.cmdHistory,I=(e>=17&&e<=23||e>=25&&e<=31)&&d>=64&&d<=127,R=(e===16||e===24)&&d>=64&&d<=95;if(!(I||R))return!1;if(u(e,d,v))return r(null,null,v),!0;var O=e<=23?1:2;d>=64&&d<=95?E=O===1?A[e]:x[e]:E=O===1?L[e]:_[e];var C=this.channels[O];return C?(C.setPAC(this.interpretPAC(E,d)),r(e,d,v),this.currentChannel=O,!0):!1},t.interpretPAC=function(e,d){var E,v={color:null,italics:!1,indent:null,underline:!1,row:e};return d>95?E=d-96:E=d-64,v.underline=(E&1)===1,E<=13?v.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(E/2)]:E<=15?(v.italics=!0,v.color="white"):v.indent=Math.floor((E-16)/2)*4,v},t.parseChars=function(e,d){var E,v=null,I=null;if(e>=25?(E=2,I=e-8):(E=1,I=e),I>=17&&I<=19){var R;I===17?R=d+80:I===18?R=d+112:R=d+144,this.logger.log(c.INFO,"Special char '"+b(R)+"' in channel "+E),v=[R]}else e>=32&&e<=127&&(v=d===0?[e]:[e,d]);if(v){var O=m(v);this.logger.log(c.DEBUG,"Char codes =  "+O.join(",")),r(e,d,this.cmdHistory)}return v},t.parseBackgroundAttributes=function(e,d){var E=(e===16||e===24)&&d>=32&&d<=47,v=(e===23||e===31)&&d>=45&&d<=47;if(!(E||v))return!1;var I,R={};e===16||e===24?(I=Math.floor((d-32)/2),R.background=T[I],d%2===1&&(R.background=R.background+"_semi")):d===45?R.background="transparent":(R.foreground="black",d===47&&(R.underline=!0));var O=e<=23?1:2,C=this.channels[O];return C.setBkgData(R),r(e,d,this.cmdHistory),!0},t.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var d=this.channels[e];d&&d.reset()}this.cmdHistory=p()},t.cueSplitAtTime=function(e){for(var d=0;d<this.channels.length;d++){var E=this.channels[d];E&&E.cueSplitAtTime(e)}},a}();function r(a,t,f){f.a=a,f.b=t}function u(a,t,f){return f.a===a&&f.b===t}function p(){return{a:null,b:null}}const i=h},"./src/utils/codecs.ts":(V,U,S)=>{S.r(U),S.d(U,{isCodecSupportedInMp4:()=>b,isCodecType:()=>D});var F={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function D(P,k){var A=F[k];return!!A&&A[P.slice(0,4)]===!0}function b(P,k){return MediaSource.isTypeSupported((k||"video")+'/mp4;codecs="'+P+'"')}},"./src/utils/cues.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>A});var F=S("./src/utils/vttparser.ts"),D=S("./src/utils/webvtt-parser.ts"),b=S("./src/utils/texttrack-utils.ts"),P=/\s/,k={newCue:function(x,_,T,c){for(var y=[],m,o,l,s,n,g=self.VTTCue||self.TextTrackCue,h=0;h<c.rows.length;h++)if(m=c.rows[h],l=!0,s=0,n="",!m.isEmpty()){for(var r=0;r<m.chars.length;r++)P.test(m.chars[r].uchar)&&l?s++:(n+=m.chars[r].uchar,l=!1);m.cueStartTime=_,_===T&&(T+=1e-4),s>=16?s--:s++;var u=(0,F.fixLineBreaks)(n.trim()),p=(0,D.generateCueId)(_,T,u);(!x||!x.cues||!x.cues.getCueById(p))&&(o=new g(_,T,u),o.id=p,o.line=h+1,o.align="left",o.position=10+Math.min(80,Math.floor(s*8/32)*10),y.push(o))}return x&&y.length&&(y.sort(function(i,a){return i.line==="auto"||a.line==="auto"?0:i.line>8&&a.line>8?a.line-i.line:i.line-a.line}),y.forEach(function(i){return(0,b.addCueToTrack)(x,i)})),y}};const A=k},"./src/utils/discontinuities.ts":(V,U,S)=>{S.r(U),S.d(U,{adjustSlidingStart:()=>x,alignMediaPlaylistByPDT:()=>y,alignPDT:()=>c,alignStream:()=>_,findDiscontinuousReferenceFrag:()=>A,findFirstFragWithCC:()=>P,shouldAlignOnDiscontinuities:()=>k});var F=S("./src/polyfills/number.ts"),D=S("./src/utils/logger.ts"),b=S("./src/controller/level-helper.ts");function P(m,o){for(var l=null,s=0,n=m.length;s<n;s++){var g=m[s];if(g&&g.cc===o){l=g;break}}return l}function k(m,o,l){return!!(o.details&&(l.endCC>l.startCC||m&&m.cc<l.startCC))}function A(m,o,l){var s=m.fragments,n=o.fragments;if(!n.length||!s.length){D.logger.log("No fragments to align");return}var g=P(s,n[0].cc);if(!g||g&&!g.startPTS){D.logger.log("No frag in previous level to align on");return}return g}function L(m,o){if(m){var l=m.start+o;m.start=m.startPTS=l,m.endPTS=l+m.duration}}function x(m,o){for(var l=o.fragments,s=0,n=l.length;s<n;s++)L(l[s],m);o.fragmentHint&&L(o.fragmentHint,m),o.alignedSliding=!0}function _(m,o,l){o&&(T(m,l,o),!l.alignedSliding&&o.details&&c(l,o.details),!l.alignedSliding&&o.details&&!l.skippedSegments&&(0,b.adjustSliding)(o.details,l))}function T(m,o,l){if(k(m,l,o)){var s=A(l.details,o);s&&(0,F.isFiniteNumber)(s.start)&&(D.logger.log("Adjusting PTS using last level due to CC increase within current level "+o.url),x(s.start,o))}}function c(m,o){if(!(!o.fragments.length||!m.hasProgramDateTime||!o.hasProgramDateTime)){var l=o.fragments[0].programDateTime,s=m.fragments[0].programDateTime,n=(s-l)/1e3+o.fragments[0].start;n&&(0,F.isFiniteNumber)(n)&&(D.logger.log("Adjusting PTS using programDateTime delta "+(s-l)+"ms, sliding:"+n.toFixed(3)+" "+m.url+" "),x(n,m))}}function y(m,o){if(!(!m.hasProgramDateTime||!o.hasProgramDateTime)){var l=m.fragments,s=o.fragments;if(!(!l.length||!s.length)){var n=Math.round(s.length/2)-1,g=s[n],h=P(l,g.cc)||l[Math.round(l.length/2)-1],r=g.programDateTime,u=h.programDateTime;if(!(r===null||u===null)){var p=(u-r)/1e3-(h.start-g.start);x(p,m)}}}}},"./src/utils/ewma-bandwidth-estimator.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>b});var F=S("./src/utils/ewma.ts"),D=function(){function P(A,L,x){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=x,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new F.default(A),this.fast_=new F.default(L)}var k=P.prototype;return k.update=function(L,x){var _=this.slow_,T=this.fast_;this.slow_.halfLife!==L&&(this.slow_=new F.default(L,_.getEstimate(),_.getTotalWeight())),this.fast_.halfLife!==x&&(this.fast_=new F.default(x,T.getEstimate(),T.getTotalWeight()))},k.sample=function(L,x){L=Math.max(L,this.minDelayMs_);var _=8*x,T=L/1e3,c=_/T;this.fast_.sample(T,c),this.slow_.sample(T,c)},k.canEstimate=function(){var L=this.fast_;return L&&L.getTotalWeight()>=this.minWeight_},k.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},k.destroy=function(){},P}();const b=D},"./src/utils/ewma.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>D});var F=function(){function b(k,A,L){A===void 0&&(A=0),L===void 0&&(L=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=k,this.alpha_=k?Math.exp(Math.log(.5)/k):0,this.estimate_=A,this.totalWeight_=L}var P=b.prototype;return P.sample=function(A,L){var x=Math.pow(this.alpha_,A);this.estimate_=L*(1-x)+x*this.estimate_,this.totalWeight_+=A},P.getTotalWeight=function(){return this.totalWeight_},P.getEstimate=function(){if(this.alpha_){var A=1-Math.pow(this.alpha_,this.totalWeight_);if(A)return this.estimate_/A}return this.estimate_},b}();const D=F},"./src/utils/fetch-loader.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>n,fetchSupported:()=>y});var F=S("./src/polyfills/number.ts"),D=S("./src/loader/load-stats.ts"),b=S("./src/demux/chunk-cache.ts");function P(g,h){g.prototype=Object.create(h.prototype),g.prototype.constructor=g,_(g,h)}function k(g){var h=typeof Map=="function"?new Map:void 0;return k=function(u){if(u===null||!x(u))return u;if(typeof u!="function")throw new TypeError("Super expression must either be null or a function");if(typeof h<"u"){if(h.has(u))return h.get(u);h.set(u,p)}function p(){return A(u,arguments,T(this).constructor)}return p.prototype=Object.create(u.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}}),_(p,u)},k(g)}function A(g,h,r){return L()?A=Reflect.construct.bind():A=function(p,i,a){var t=[null];t.push.apply(t,i);var f=Function.bind.apply(p,t),e=new f;return a&&_(e,a.prototype),e},A.apply(null,arguments)}function L(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function x(g){return Function.toString.call(g).indexOf("[native code]")!==-1}function _(g,h){return _=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,p){return u.__proto__=p,u},_(g,h)}function T(g){return T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},T(g)}function c(){return c=Object.assign?Object.assign.bind():function(g){for(var h=1;h<arguments.length;h++){var r=arguments[h];for(var u in r)Object.prototype.hasOwnProperty.call(r,u)&&(g[u]=r[u])}return g},c.apply(this,arguments)}function y(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var m=function(){function g(r){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=r.fetchSetup||l,this.controller=new self.AbortController,this.stats=new D.LoadStats}var h=g.prototype;return h.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},h.abortInternal=function(){var u=this.response;(!u||!u.ok)&&(this.stats.aborted=!0,this.controller.abort())},h.abort=function(){var u;this.abortInternal(),(u=this.callbacks)!==null&&u!==void 0&&u.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},h.load=function(u,p,i){var a=this,t=this.stats;if(t.loading.start)throw new Error("Loader can only be used once.");t.loading.start=self.performance.now();var f=o(u,this.controller.signal),e=i.onProgress,d=u.responseType==="arraybuffer",E=d?"byteLength":"length";this.context=u,this.config=p,this.callbacks=i,this.request=this.fetchSetup(u,f),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){a.abortInternal(),i.onTimeout(t,u,a.response)},p.timeout),self.fetch(this.request).then(function(v){if(a.response=a.loader=v,!v.ok){var I=v.status,R=v.statusText;throw new s(R||"fetch, bad network response",I,v)}return t.loading.first=Math.max(self.performance.now(),t.loading.start),t.total=parseInt(v.headers.get("Content-Length")||"0"),e&&(0,F.isFiniteNumber)(p.highWaterMark)?a.loadProgressively(v,t,u,p.highWaterMark,e):d?v.arrayBuffer():v.text()}).then(function(v){var I=a.response;self.clearTimeout(a.requestTimeout),t.loading.end=Math.max(self.performance.now(),t.loading.first);var R=v[E];R&&(t.loaded=t.total=R);var O={url:I.url,data:v};e&&!(0,F.isFiniteNumber)(p.highWaterMark)&&e(t,u,v,I),i.onSuccess(O,t,u,I)}).catch(function(v){if(self.clearTimeout(a.requestTimeout),!t.aborted){var I=v&&v.code||0,R=v?v.message:null;i.onError({code:I,text:R},u,v?v.details:null)}})},h.getCacheAge=function(){var u=null;if(this.response){var p=this.response.headers.get("age");u=p?parseFloat(p):null}return u},h.loadProgressively=function(u,p,i,a,t){a===void 0&&(a=0);var f=new b.default,e=u.body.getReader(),d=function E(){return e.read().then(function(v){if(v.done)return f.dataLength&&t(p,i,f.flush(),u),Promise.resolve(new ArrayBuffer(0));var I=v.value,R=I.length;return p.loaded+=R,R<a||f.dataLength?(f.push(I),f.dataLength>=a&&t(p,i,f.flush(),u)):t(p,i,I,u),E()}).catch(function(){return Promise.reject()})};return d()},g}();function o(g,h){var r={method:"GET",mode:"cors",credentials:"same-origin",signal:h,headers:new self.Headers(c({},g.headers))};return g.rangeEnd&&r.headers.set("Range","bytes="+g.rangeStart+"-"+String(g.rangeEnd-1)),r}function l(g,h){return new self.Request(g.url,h)}var s=function(g){P(h,g);function h(r,u,p){var i;return i=g.call(this,r)||this,i.code=void 0,i.details=void 0,i.code=u,i.details=p,i}return h}(k(Error));const n=m},"./src/utils/hex.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>D});var F={hexDump:function(P){for(var k="",A=0;A<P.length;A++){var L=P[A].toString(16);L.length<2&&(L="0"+L),k+=L}return k}};const D=F},"./src/utils/imsc1-ttml-parser.ts":(V,U,S)=>{S.r(U),S.d(U,{IMSC1_CODEC:()=>x,parseIMSC1:()=>y});var F=S("./src/utils/mp4-tools.ts"),D=S("./src/utils/vttparser.ts"),b=S("./src/utils/vttcue.ts"),P=S("./src/demux/id3.ts"),k=S("./src/utils/timescale-conversion.ts"),A=S("./src/utils/webvtt-parser.ts");function L(){return L=Object.assign?Object.assign.bind():function(i){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var f in t)Object.prototype.hasOwnProperty.call(t,f)&&(i[f]=t[f])}return i},L.apply(this,arguments)}var x="stpp.ttml.im1t",_=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,T=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,c={left:"start",center:"center",right:"end",start:"start",end:"end"};function y(i,a,t,f,e){var d=(0,F.findBox)(new Uint8Array(i),["mdat"]);if(d.length===0){e(new Error("Could not parse IMSC1 mdat"));return}var E=d.map(function(I){return(0,P.utf8ArrayToStr)(I)}),v=(0,k.toTimescaleFromScale)(a,1,t);try{E.forEach(function(I){return f(m(I,v))})}catch(I){e(I)}}function m(i,a){var t=new DOMParser,f=t.parseFromString(i,"text/xml"),e=f.getElementsByTagName("tt")[0];if(!e)throw new Error("Invalid ttml");var d={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},E=Object.keys(d).reduce(function(C,M){return C[M]=e.getAttribute("ttp:"+M)||d[M],C},{}),v=e.getAttribute("xml:space")!=="preserve",I=l(o(e,"styling","style")),R=l(o(e,"layout","region")),O=o(e,"body","[begin]");return[].map.call(O,function(C){var M=s(C,v);if(!M||!C.hasAttribute("begin"))return null;var B=r(C.getAttribute("begin"),E),w=r(C.getAttribute("dur"),E),N=r(C.getAttribute("end"),E);if(B===null)throw h(C);if(N===null){if(w===null)throw h(C);N=B+w}var W=new b.default(B-a,N-a,M);W.id=(0,A.generateCueId)(W.startTime,W.endTime,W.text);var G=R[C.getAttribute("region")],H=I[C.getAttribute("style")],$=n(G,H,I),Y=$.textAlign;if(Y){var z=c[Y];z&&(W.lineAlign=z),W.align=Y}return L(W,$),W}).filter(function(C){return C!==null})}function o(i,a,t){var f=i.getElementsByTagName(a)[0];return f?[].slice.call(f.querySelectorAll(t)):[]}function l(i){return i.reduce(function(a,t){var f=t.getAttribute("xml:id");return f&&(a[f]=t),a},{})}function s(i,a){return[].slice.call(i.childNodes).reduce(function(t,f,e){var d;return f.nodeName==="br"&&e?t+`
`:(d=f.childNodes)!==null&&d!==void 0&&d.length?s(f,a):a?t+f.textContent.trim().replace(/\s+/g," "):t+f.textContent},"")}function n(i,a,t){var f="http://www.w3.org/ns/ttml#styling",e=null,d=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],E=i!=null&&i.hasAttribute("style")?i.getAttribute("style"):null;return E&&t.hasOwnProperty(E)&&(e=t[E]),d.reduce(function(v,I){var R=g(a,f,I)||g(i,f,I)||g(e,f,I);return R&&(v[I]=R),v},{})}function g(i,a,t){return i&&i.hasAttributeNS(a,t)?i.getAttributeNS(a,t):null}function h(i){return new Error("Could not parse ttml timestamp "+i)}function r(i,a){if(!i)return null;var t=(0,D.parseTimeStamp)(i);return t===null&&(_.test(i)?t=u(i,a):T.test(i)&&(t=p(i,a))),t}function u(i,a){var t=_.exec(i),f=(t[4]|0)+(t[5]|0)/a.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+f/a.frameRate}function p(i,a){var t=T.exec(i),f=Number(t[1]),e=t[2];switch(e){case"h":return f*3600;case"m":return f*60;case"ms":return f*1e3;case"f":return f/a.frameRate;case"t":return f/a.tickRate}return f}},"./src/utils/keysystem-util.ts":(V,U,S)=>{S.r(U),S.d(U,{changeEndianness:()=>b,convertDataUriToArrayBytes:()=>P,strToUtf8array:()=>k});var F=S("./src/utils/numeric-encoding-utils.ts");function D(A){var L=k(A).subarray(0,16),x=new Uint8Array(16);return x.set(L,16-L.length),x}function b(A){var L=function(_,T,c){var y=_[T];_[T]=_[c],_[c]=y};L(A,0,3),L(A,1,2),L(A,4,5),L(A,6,7)}function P(A){var L=A.split(":"),x=null;if(L[0]==="data"&&L.length===2){var _=L[1].split(";"),T=_[_.length-1].split(",");if(T.length===2){var c=T[0]==="base64",y=T[1];c?(_.splice(-1,1),x=(0,F.base64Decode)(y)):x=D(y)}}return x}function k(A){return Uint8Array.from(unescape(encodeURIComponent(A)),function(L){return L.charCodeAt(0)})}},"./src/utils/logger.ts":(V,U,S)=>{S.r(U),S.d(U,{enableLogs:()=>A,logger:()=>L});var F=function(){},D={trace:F,debug:F,log:F,warn:F,info:F,error:F},b=D;function P(x){var _=self.console[x];return _?_.bind(self.console,"["+x+"] >"):F}function k(x){for(var _=arguments.length,T=new Array(_>1?_-1:0),c=1;c<_;c++)T[c-1]=arguments[c];T.forEach(function(y){b[y]=x[y]?x[y].bind(x):P(y)})}function A(x,_){if(self.console&&x===!0||typeof x=="object"){k(x,"debug","log","info","warn","error");try{b.log('Debug logs enabled for "'+_+'"')}catch{b=D}}else b=D}var L=b},"./src/utils/mediakeys-helper.ts":(V,U,S)=>{S.r(U),S.d(U,{KeySystemFormats:()=>D,KeySystemIds:()=>P,KeySystems:()=>F,getKeySystemsForConfig:()=>L,getSupportedMediaKeySystemConfigurations:()=>_,keySystemDomainToKeySystemFormat:()=>A,keySystemFormatToKeySystemDomain:()=>b,keySystemIdToKeySystemDomain:()=>k,requestMediaKeySystemAccess:()=>x});var F;(function(c){c.CLEARKEY="org.w3.clearkey",c.FAIRPLAY="com.apple.fps",c.PLAYREADY="com.microsoft.playready",c.WIDEVINE="com.widevine.alpha"})(F||(F={}));var D;(function(c){c.CLEARKEY="org.w3.clearkey",c.FAIRPLAY="com.apple.streamingkeydelivery",c.PLAYREADY="com.microsoft.playready",c.WIDEVINE="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"})(D||(D={}));function b(c){switch(c){case D.FAIRPLAY:return F.FAIRPLAY;case D.PLAYREADY:return F.PLAYREADY;case D.WIDEVINE:return F.WIDEVINE;case D.CLEARKEY:return F.CLEARKEY}}var P;(function(c){c.WIDEVINE="edef8ba979d64acea3c827dcd51d21ed"})(P||(P={}));function k(c){if(c===P.WIDEVINE)return F.WIDEVINE}function A(c){switch(c){case F.FAIRPLAY:return D.FAIRPLAY;case F.PLAYREADY:return D.PLAYREADY;case F.WIDEVINE:return D.WIDEVINE;case F.CLEARKEY:return D.CLEARKEY}}function L(c){var y=c.drmSystems,m=c.widevineLicenseUrl,o=y?[F.FAIRPLAY,F.WIDEVINE,F.PLAYREADY,F.CLEARKEY].filter(function(l){return!!y[l]}):[];return!o[F.WIDEVINE]&&m&&o.push(F.WIDEVINE),o}var x=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function _(c,y,m,o){var l;switch(c){case F.FAIRPLAY:l=["cenc","sinf"];break;case F.WIDEVINE:case F.PLAYREADY:l=["cenc"];break;case F.CLEARKEY:l=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+c)}return T(l,y,m,o)}function T(c,y,m,o){var l={initDataTypes:c,persistentState:o.persistentState||"not-allowed",distinctiveIdentifier:o.distinctiveIdentifier||"not-allowed",sessionTypes:o.sessionTypes||[o.sessionType||"temporary"],audioCapabilities:y.map(function(s){return{contentType:'audio/mp4; codecs="'+s+'"',robustness:o.audioRobustness||"",encryptionScheme:o.audioEncryptionScheme||null}}),videoCapabilities:m.map(function(s){return{contentType:'video/mp4; codecs="'+s+'"',robustness:o.videoRobustness||"",encryptionScheme:o.videoEncryptionScheme||null}})};return[l]}},"./src/utils/mediasource-helper.ts":(V,U,S)=>{S.r(U),S.d(U,{getMediaSource:()=>F});function F(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":(V,U,S)=>{S.r(U),S.d(U,{RemuxerTrackIdConfig:()=>x,appendUint8Array:()=>a,bin2str:()=>_,computeRawDurationFromSamples:()=>u,discardEPB:()=>E,findBox:()=>o,getDuration:()=>r,getStartDTS:()=>h,mp4Box:()=>I,mp4pssh:()=>R,offsetStartDTS:()=>p,parseEmsg:()=>v,parseInitSegment:()=>s,parsePssh:()=>O,parseSEIMessageFromNALu:()=>d,parseSamples:()=>t,parseSegmentIndex:()=>l,parseSinf:()=>g,patchEncyptionData:()=>n,readSint32:()=>y,readUint16:()=>T,readUint32:()=>c,segmentValidRange:()=>i,writeUint32:()=>m});var F=S("./src/loader/fragment.ts"),D=S("./src/utils/typed-array.ts"),b=S("./src/demux/id3.ts"),P=S("./src/utils/logger.ts"),k=S("./src/utils/hex.ts"),A=Math.pow(2,32)-1,L=[].push,x={video:1,audio:2,id3:3,text:4};function _(C){return String.fromCharCode.apply(null,C)}function T(C,M){var B=C[M]<<8|C[M+1];return B<0?65536+B:B}function c(C,M){var B=y(C,M);return B<0?4294967296+B:B}function y(C,M){return C[M]<<24|C[M+1]<<16|C[M+2]<<8|C[M+3]}function m(C,M,B){C[M]=B>>24,C[M+1]=B>>16&255,C[M+2]=B>>8&255,C[M+3]=B&255}function o(C,M){var B=[];if(!M.length)return B;for(var w=C.byteLength,N=0;N<w;){var W=c(C,N),G=_(C.subarray(N+4,N+8)),H=W>1?N+W:w;if(G===M[0])if(M.length===1)B.push(C.subarray(N+8,H));else{var $=o(C.subarray(N+8,H),M.slice(1));$.length&&L.apply(B,$)}N=H}return B}function l(C){var M=[],B=C[0],w=8,N=c(C,w);w+=4;var W=0,G=0;B===0?w+=8:w+=16,w+=2;var H=C.length+G,$=T(C,w);w+=2;for(var Y=0;Y<$;Y++){var z=w,J=c(C,z);z+=4;var te=J&2147483647,q=(J&2147483648)>>>31;if(q===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var Q=c(C,z);z+=4,M.push({referenceSize:te,subsegmentDuration:Q,info:{duration:Q/N,start:H,end:H+te-1}}),H+=te,z+=4,w=z}return{earliestPresentationTime:W,timescale:N,version:B,referencesCount:$,references:M}}function s(C){for(var M=[],B=o(C,["moov","trak"]),w=0;w<B.length;w++){var N=B[w],W=o(N,["tkhd"])[0];if(W){var G=W[0],H=G===0?12:20,$=c(W,H),Y=o(N,["mdia","mdhd"])[0];if(Y){G=Y[0],H=G===0?12:20;var z=c(Y,H),J=o(N,["mdia","hdlr"])[0];if(J){var te=_(J.subarray(8,12)),q={soun:F.ElementaryStreamTypes.AUDIO,vide:F.ElementaryStreamTypes.VIDEO}[te];if(q){var Q=o(N,["mdia","minf","stbl","stsd"])[0],re=void 0;Q&&(re=_(Q.subarray(12,16))),M[$]={timescale:z,type:q},M[q]={timescale:z,id:$,codec:re}}}}}}var ae=o(C,["moov","mvex","trex"]);return ae.forEach(function(se){var he=c(se,4),ue=M[he];ue&&(ue.default={duration:c(se,12),flags:c(se,20)})}),M}function n(C,M){if(!C||!M)return C;var B=M.keyId;if(B&&M.isCommonEncryption){var w=o(C,["moov","trak"]);w.forEach(function(N){var W=o(N,["mdia","minf","stbl","stsd"])[0],G=W.subarray(8),H=o(G,["enca"]),$=H.length>0;$||(H=o(G,["encv"])),H.forEach(function(Y){var z=$?Y.subarray(28):Y.subarray(78),J=o(z,["sinf"]);J.forEach(function(te){var q=g(te);if(q){var Q=q.subarray(8,24);Q.some(function(re){return re!==0})||(P.logger.log("[eme] Patching keyId in 'enc"+($?"a":"v")+">sinf>>tenc' box: "+k.default.hexDump(Q)+" -> "+k.default.hexDump(B)),q.set(B,8))}})})})}return C}function g(C){var M=o(C,["schm"])[0];if(M){var B=_(M.subarray(4,8));if(B==="cbcs"||B==="cenc")return o(C,["schi","tenc"])[0]}return P.logger.error("[eme] missing 'schm' box"),null}function h(C,M){return o(M,["moof","traf"]).reduce(function(B,w){var N=o(w,["tfdt"])[0],W=N[0],G=o(w,["tfhd"]).reduce(function(H,$){var Y=c($,4),z=C[Y];if(z){var J=c(N,4);W===1&&(J*=Math.pow(2,32),J+=c(N,8));var te=z.timescale||9e4,q=J/te;if(isFinite(q)&&(H===null||q<H))return q}return H},null);return G!==null&&isFinite(G)&&(B===null||G<B)?G:B},null)||0}function r(C,M){for(var B=0,w=0,N=0,W=o(C,["moof","traf"]),G=0;G<W.length;G++){var H=W[G],$=o(H,["tfhd"])[0],Y=c($,4),z=M[Y];if(z){var J=z.default,te=c($,0)|(J==null?void 0:J.flags),q=J==null?void 0:J.duration;te&8&&(te&2?q=c($,12):q=c($,8));for(var Q=z.timescale||9e4,re=o(H,["trun"]),ae=0;ae<re.length;ae++){if(B=u(re[ae]),!B&&q){var se=c(re[ae],4);B=q*se}z.type===F.ElementaryStreamTypes.VIDEO?w+=B/Q:z.type===F.ElementaryStreamTypes.AUDIO&&(N+=B/Q)}}}if(w===0&&N===0){for(var he=0,ue=o(C,["sidx"]),ce=0;ce<ue.length;ce++){var le=l(ue[ce]);le!=null&&le.references&&(he+=le.references.reduce(function(fe,de){return fe+de.info.duration||0},0))}return he}return w||N}function u(C){var M=c(C,0),B=8;M&1&&(B+=4),M&4&&(B+=4);for(var w=0,N=c(C,4),W=0;W<N;W++){if(M&256){var G=c(C,B);w+=G,B+=4}M&512&&(B+=4),M&1024&&(B+=4),M&2048&&(B+=4)}return w}function p(C,M,B){o(M,["moof","traf"]).forEach(function(w){o(w,["tfhd"]).forEach(function(N){var W=c(N,4),G=C[W];if(G){var H=G.timescale||9e4;o(w,["tfdt"]).forEach(function($){var Y=$[0],z=c($,4);if(Y===0)z-=B*H,z=Math.max(z,0),m($,4,z);else{z*=Math.pow(2,32),z+=c($,8),z-=B*H,z=Math.max(z,0);var J=Math.floor(z/(A+1)),te=Math.floor(z%(A+1));m($,4,J),m($,8,te)}})}})})}function i(C){var M={valid:null,remainder:null},B=o(C,["moof"]);if(B){if(B.length<2)return M.remainder=C,M}else return M;var w=B[B.length-1];return M.valid=(0,D.sliceUint8)(C,0,w.byteOffset-8),M.remainder=(0,D.sliceUint8)(C,w.byteOffset-8),M}function a(C,M){var B=new Uint8Array(C.length+M.length);return B.set(C),B.set(M,C.length),B}function t(C,M){var B=[],w=M.samples,N=M.timescale,W=M.id,G=!1,H=o(w,["moof"]);return H.map(function($){var Y=$.byteOffset-8,z=o($,["traf"]);z.map(function(J){var te=o(J,["tfdt"]).map(function(q){var Q=q[0],re=c(q,4);return Q===1&&(re*=Math.pow(2,32),re+=c(q,8)),re/N})[0];return te!==void 0&&(C=te),o(J,["tfhd"]).map(function(q){var Q=c(q,4),re=c(q,0)&16777215,ae=(re&1)!==0,se=(re&2)!==0,he=(re&8)!==0,ue=0,ce=(re&16)!==0,le=0,fe=(re&32)!==0,de=8;Q===W&&(ae&&(de+=8),se&&(de+=4),he&&(ue=c(q,de),de+=4),ce&&(le=c(q,de),de+=4),fe&&(de+=4),M.type==="video"&&(G=f(M.codec)),o(J,["trun"]).map(function(ve){var pe=ve[0],ge=c(ve,0)&16777215,Ee=(ge&1)!==0,Ce=0,Se=(ge&4)!==0,be=(ge&256)!==0,Ie=0,Le=(ge&512)!==0,De=0,Te=(ge&1024)!==0,ye=(ge&2048)!==0,Ae=0,Pe=c(ve,4),me=8;Ee&&(Ce=c(ve,me),me+=4),Se&&(me+=4);for(var Me=Ce+Y,Re=0;Re<Pe;Re++){if(be?(Ie=c(ve,me),me+=4):Ie=ue,Le?(De=c(ve,me),me+=4):De=le,Te&&(me+=4),ye&&(pe===0?Ae=c(ve,me):Ae=y(ve,me),me+=4),M.type===F.ElementaryStreamTypes.VIDEO)for(var je=0;je<De;){var we=c(w,Me);if(Me+=4,e(G,w[Me])){var Ke=w.subarray(Me,Me+we);d(Ke,G?2:1,C+Ae/N,B)}Me+=we,je+=we+4}C+=Ie/N}}))})})}),B}function f(C){if(!C)return!1;var M=C.indexOf("."),B=M<0?C:C.substring(0,M);return B==="hvc1"||B==="hev1"||B==="dvh1"||B==="dvhe"}function e(C,M){if(C){var B=M>>1&63;return B===39||B===40}else{var w=M&31;return w===6}}function d(C,M,B,w){var N=E(C),W=0;W+=M;for(var G=0,H=0,$=!1,Y=0;W<N.length;){G=0;do{if(W>=N.length)break;Y=N[W++],G+=Y}while(Y===255);H=0;do{if(W>=N.length)break;Y=N[W++],H+=Y}while(Y===255);var z=N.length-W;if(!$&&G===4&&W<N.length){$=!0;var J=N[W++];if(J===181){var te=T(N,W);if(W+=2,te===49){var q=c(N,W);if(W+=4,q===1195456820){var Q=N[W++];if(Q===3){var re=N[W++],ae=31&re,se=64&re,he=se?2+ae*3:0,ue=new Uint8Array(he);if(se){ue[0]=re;for(var ce=1;ce<he;ce++)ue[ce]=N[W++]}w.push({type:Q,payloadType:G,pts:B,bytes:ue})}}}}}else if(G===5&&H<z){if($=!0,H>16){for(var le=[],fe=0;fe<16;fe++){var de=N[W++].toString(16);le.push(de.length==1?"0"+de:de),(fe===3||fe===5||fe===7||fe===9)&&le.push("-")}for(var ve=H-16,pe=new Uint8Array(ve),ge=0;ge<ve;ge++)pe[ge]=N[W++];w.push({payloadType:G,pts:B,uuid:le.join(""),userData:(0,b.utf8ArrayToStr)(pe),userDataBytes:pe})}}else if(H<z)W+=H;else if(H>z)break}}function E(C){for(var M=C.byteLength,B=[],w=1;w<M-2;)C[w]===0&&C[w+1]===0&&C[w+2]===3?(B.push(w+2),w+=2):w++;if(B.length===0)return C;var N=M-B.length,W=new Uint8Array(N),G=0;for(w=0;w<N;G++,w++)G===B[0]&&(G++,B.shift()),W[w]=C[G];return W}function v(C){var M=C[0],B="",w="",N=0,W=0,G=0,H=0,$=0,Y=0;if(M===0){for(;_(C.subarray(Y,Y+1))!=="\0";)B+=_(C.subarray(Y,Y+1)),Y+=1;for(B+=_(C.subarray(Y,Y+1)),Y+=1;_(C.subarray(Y,Y+1))!=="\0";)w+=_(C.subarray(Y,Y+1)),Y+=1;w+=_(C.subarray(Y,Y+1)),Y+=1,N=c(C,12),W=c(C,16),H=c(C,20),$=c(C,24),Y=28}else if(M===1){Y+=4,N=c(C,Y),Y+=4;var z=c(C,Y);Y+=4;var J=c(C,Y);for(Y+=4,G=Math.pow(2,32)*z+J,Number.isSafeInteger(G)||(G=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),H=c(C,Y),Y+=4,$=c(C,Y),Y+=4;_(C.subarray(Y,Y+1))!=="\0";)B+=_(C.subarray(Y,Y+1)),Y+=1;for(B+=_(C.subarray(Y,Y+1)),Y+=1;_(C.subarray(Y,Y+1))!=="\0";)w+=_(C.subarray(Y,Y+1)),Y+=1;w+=_(C.subarray(Y,Y+1)),Y+=1}var te=C.subarray(Y,C.byteLength);return{schemeIdUri:B,value:w,timeScale:N,presentationTime:G,presentationTimeDelta:W,eventDuration:H,id:$,payload:te}}function I(C){for(var M=arguments.length,B=new Array(M>1?M-1:0),w=1;w<M;w++)B[w-1]=arguments[w];for(var N=B.length,W=8,G=N;G--;)W+=B[G].byteLength;var H=new Uint8Array(W);for(H[0]=W>>24&255,H[1]=W>>16&255,H[2]=W>>8&255,H[3]=W&255,H.set(C,4),G=0,W=8;G<N;G++)H.set(B[G],W),W+=B[G].byteLength;return H}function R(C,M,B){if(C.byteLength!==16)throw new RangeError("Invalid system id");var w,N;if(M){w=1,N=new Uint8Array(M.length*16);for(var W=0;W<M.length;W++){var G=M[W];if(G.byteLength!==16)throw new RangeError("Invalid key");N.set(G,W*16)}}else w=0,N=new Uint8Array;var H;w>0?(H=new Uint8Array(4),M.length>0&&new DataView(H.buffer).setUint32(0,M.length,!1)):H=new Uint8Array;var $=new Uint8Array(4);return B&&B.byteLength>0&&new DataView($.buffer).setUint32(0,B.byteLength,!1),I([112,115,115,104],new Uint8Array([w,0,0,0]),C,H,N,$,B||new Uint8Array)}function O(C){if(!(C instanceof ArrayBuffer)||C.byteLength<32)return null;var M={version:0,systemId:"",kids:null,data:null},B=new DataView(C),w=B.getUint32(0);if(C.byteLength!==w&&w>44)return null;var N=B.getUint32(4);if(N!==1886614376||(M.version=B.getUint32(8)>>>24,M.version>1))return null;M.systemId=k.default.hexDump(new Uint8Array(C,12,16));var W=B.getUint32(28);if(M.version===0){if(w-32<W)return null;M.data=new Uint8Array(C,32,W)}else if(M.version===1){M.kids=[];for(var G=0;G<W;G++)M.kids.push(new Uint8Array(C,32+G*16,16))}return M}},"./src/utils/numeric-encoding-utils.ts":(V,U,S)=>{S.r(U),S.d(U,{base64Decode:()=>A,base64DecodeToStr:()=>b,base64Encode:()=>P,base64ToBase64Url:()=>F,base64UrlEncode:()=>k,strToBase64Encode:()=>D});function F(L){return L.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function D(L){return btoa(L)}function b(L){return atob(L)}function P(L){return btoa(String.fromCharCode.apply(String,L))}function k(L){return F(P(L))}function A(L){return Uint8Array.from(atob(L),function(x){return x.charCodeAt(0)})}},"./src/utils/output-filter.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>F});var F=function(){function D(P,k){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=P,this.trackName=k}var b=D.prototype;return b.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},b.newCue=function(k,A,L){(this.startTime===null||this.startTime>k)&&(this.startTime=k),this.endTime=A,this.screen=L,this.timelineController.createCaptionsTrack(this.trackName)},b.reset=function(){this.cueRanges=[],this.startTime=null},D}()},"./src/utils/texttrack-utils.ts":(V,U,S)=>{S.r(U),S.d(U,{addCueToTrack:()=>b,clearCurrentCues:()=>P,getCuesInRange:()=>L,removeCuesInRange:()=>k,sendAddTrackEvent:()=>D});var F=S("./src/utils/logger.ts");function D(x,_){var T;try{T=new Event("addtrack")}catch{T=document.createEvent("Event"),T.initEvent("addtrack",!1,!1)}T.track=x,_.dispatchEvent(T)}function b(x,_){var T=x.mode;if(T==="disabled"&&(x.mode="hidden"),x.cues&&!x.cues.getCueById(_.id))try{if(x.addCue(_),!x.cues.getCueById(_.id))throw new Error("addCue is failed for: "+_)}catch(y){F.logger.debug("[texttrack-utils]: "+y);var c=new self.TextTrackCue(_.startTime,_.endTime,_.text);c.id=_.id,x.addCue(c)}T==="disabled"&&(x.mode=T)}function P(x){var _=x.mode;if(_==="disabled"&&(x.mode="hidden"),x.cues)for(var T=x.cues.length;T--;)x.removeCue(x.cues[T]);_==="disabled"&&(x.mode=_)}function k(x,_,T,c){var y=x.mode;if(y==="disabled"&&(x.mode="hidden"),x.cues&&x.cues.length>0)for(var m=L(x.cues,_,T),o=0;o<m.length;o++)(!c||c(m[o]))&&x.removeCue(m[o]);y==="disabled"&&(x.mode=y)}function A(x,_){if(_<x[0].startTime)return 0;var T=x.length-1;if(_>x[T].endTime)return-1;for(var c=0,y=T;c<=y;){var m=Math.floor((y+c)/2);if(_<x[m].startTime)y=m-1;else if(_>x[m].startTime&&c<T)c=m+1;else return m}return x[c].startTime-_<_-x[y].startTime?c:y}function L(x,_,T){var c=[],y=A(x,_);if(y>-1)for(var m=y,o=x.length;m<o;m++){var l=x[m];if(l.startTime>=_&&l.endTime<=T)c.push(l);else if(l.startTime>T)return c}return c}},"./src/utils/time-ranges.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>D});var F={toString:function(P){for(var k="",A=P.length,L=0;L<A;L++)k+="["+P.start(L).toFixed(3)+"-"+P.end(L).toFixed(3)+"]";return k}};const D=F},"./src/utils/timescale-conversion.ts":(V,U,S)=>{S.r(U),S.d(U,{toMpegTsClockFromTimescale:()=>k,toMsFromMpegTsClock:()=>P,toTimescaleFromBase:()=>D,toTimescaleFromScale:()=>b});var F=9e4;function D(A,L,x,_){x===void 0&&(x=1),_===void 0&&(_=!1);var T=A*L*x;return _?Math.round(T):T}function b(A,L,x,_){return x===void 0&&(x=1),_===void 0&&(_=!1),D(A,L,1/x,_)}function P(A,L){return L===void 0&&(L=!1),D(A,1e3,1/F,L)}function k(A,L){return L===void 0&&(L=1),D(A,F,1/L)}},"./src/utils/typed-array.ts":(V,U,S)=>{S.r(U),S.d(U,{sliceUint8:()=>F});function F(D,b,P){return Uint8Array.prototype.slice?D.slice(b,P):new Uint8Array(Array.prototype.slice.call(D,b,P))}},"./src/utils/vttcue.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>F});const F=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var D=["","lr","rl"],b=["start","middle","end","left","right"];function P(_,T){if(typeof T!="string"||!Array.isArray(_))return!1;var c=T.toLowerCase();return~_.indexOf(c)?c:!1}function k(_){return P(D,_)}function A(_){return P(b,_)}function L(_){for(var T=arguments.length,c=new Array(T>1?T-1:0),y=1;y<T;y++)c[y-1]=arguments[y];for(var m=1;m<arguments.length;m++){var o=arguments[m];for(var l in o)_[l]=o[l]}return _}function x(_,T,c){var y=this,m={enumerable:!0};y.hasBeenReset=!1;var o="",l=!1,s=_,n=T,g=c,h=null,r="",u=!0,p="auto",i="start",a=50,t="middle",f=50,e="middle";Object.defineProperty(y,"id",L({},m,{get:function(){return o},set:function(E){o=""+E}})),Object.defineProperty(y,"pauseOnExit",L({},m,{get:function(){return l},set:function(E){l=!!E}})),Object.defineProperty(y,"startTime",L({},m,{get:function(){return s},set:function(E){if(typeof E!="number")throw new TypeError("Start time must be set to a number.");s=E,this.hasBeenReset=!0}})),Object.defineProperty(y,"endTime",L({},m,{get:function(){return n},set:function(E){if(typeof E!="number")throw new TypeError("End time must be set to a number.");n=E,this.hasBeenReset=!0}})),Object.defineProperty(y,"text",L({},m,{get:function(){return g},set:function(E){g=""+E,this.hasBeenReset=!0}})),Object.defineProperty(y,"region",L({},m,{get:function(){return h},set:function(E){h=E,this.hasBeenReset=!0}})),Object.defineProperty(y,"vertical",L({},m,{get:function(){return r},set:function(E){var v=k(E);if(v===!1)throw new SyntaxError("An invalid or illegal string was specified.");r=v,this.hasBeenReset=!0}})),Object.defineProperty(y,"snapToLines",L({},m,{get:function(){return u},set:function(E){u=!!E,this.hasBeenReset=!0}})),Object.defineProperty(y,"line",L({},m,{get:function(){return p},set:function(E){if(typeof E!="number"&&E!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");p=E,this.hasBeenReset=!0}})),Object.defineProperty(y,"lineAlign",L({},m,{get:function(){return i},set:function(E){var v=A(E);if(!v)throw new SyntaxError("An invalid or illegal string was specified.");i=v,this.hasBeenReset=!0}})),Object.defineProperty(y,"position",L({},m,{get:function(){return a},set:function(E){if(E<0||E>100)throw new Error("Position must be between 0 and 100.");a=E,this.hasBeenReset=!0}})),Object.defineProperty(y,"positionAlign",L({},m,{get:function(){return t},set:function(E){var v=A(E);if(!v)throw new SyntaxError("An invalid or illegal string was specified.");t=v,this.hasBeenReset=!0}})),Object.defineProperty(y,"size",L({},m,{get:function(){return f},set:function(E){if(E<0||E>100)throw new Error("Size must be between 0 and 100.");f=E,this.hasBeenReset=!0}})),Object.defineProperty(y,"align",L({},m,{get:function(){return e},set:function(E){var v=A(E);if(!v)throw new SyntaxError("An invalid or illegal string was specified.");e=v,this.hasBeenReset=!0}})),y.displayState=void 0}return x.prototype.getCueAsHTML=function(){var _=self.WebVTT;return _.convertCueToDOMTree(self,this.text)},x}()},"./src/utils/vttparser.ts":(V,U,S)=>{S.r(U),S.d(U,{VTTParser:()=>T,fixLineBreaks:()=>_,parseTimeStamp:()=>b});var F=S("./src/utils/vttcue.ts"),D=function(){function c(){}var y=c.prototype;return y.decode=function(o,l){if(!o)return"";if(typeof o!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(o))},c}();function b(c){function y(o,l,s,n){return(o|0)*3600+(l|0)*60+(s|0)+parseFloat(n||0)}var m=c.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return m?parseFloat(m[2])>59?y(m[2],m[3],0,m[4]):y(m[1],m[2],m[3],m[4]):null}var P=function(){function c(){this.values=Object.create(null)}var y=c.prototype;return y.set=function(o,l){!this.get(o)&&l!==""&&(this.values[o]=l)},y.get=function(o,l,s){return s?this.has(o)?this.values[o]:l[s]:this.has(o)?this.values[o]:l},y.has=function(o){return o in this.values},y.alt=function(o,l,s){for(var n=0;n<s.length;++n)if(l===s[n]){this.set(o,l);break}},y.integer=function(o,l){/^-?\d+$/.test(l)&&this.set(o,parseInt(l,10))},y.percent=function(o,l){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(l)){var s=parseFloat(l);if(s>=0&&s<=100)return this.set(o,s),!0}return!1},c}();function k(c,y,m,o){var l=o?c.split(o):[c];for(var s in l)if(typeof l[s]=="string"){var n=l[s].split(m);if(n.length===2){var g=n[0],h=n[1];y(g,h)}}}var A=new F.default(0,0,""),L=A.align==="middle"?"middle":"center";function x(c,y,m){var o=c;function l(){var g=b(c);if(g===null)throw new Error("Malformed timestamp: "+o);return c=c.replace(/^[^\sa-zA-Z-]+/,""),g}function s(g,h){var r=new P;k(g,function(i,a){var t;switch(i){case"region":for(var f=m.length-1;f>=0;f--)if(m[f].id===a){r.set(i,m[f].region);break}break;case"vertical":r.alt(i,a,["rl","lr"]);break;case"line":t=a.split(","),r.integer(i,t[0]),r.percent(i,t[0])&&r.set("snapToLines",!1),r.alt(i,t[0],["auto"]),t.length===2&&r.alt("lineAlign",t[1],["start",L,"end"]);break;case"position":t=a.split(","),r.percent(i,t[0]),t.length===2&&r.alt("positionAlign",t[1],["start",L,"end","line-left","line-right","auto"]);break;case"size":r.percent(i,a);break;case"align":r.alt(i,a,["start",L,"end","left","right"]);break}},/:/,/\s/),h.region=r.get("region",null),h.vertical=r.get("vertical","");var u=r.get("line","auto");u==="auto"&&A.line===-1&&(u=-1),h.line=u,h.lineAlign=r.get("lineAlign","start"),h.snapToLines=r.get("snapToLines",!0),h.size=r.get("size",100),h.align=r.get("align",L);var p=r.get("position","auto");p==="auto"&&A.position===50&&(p=h.align==="start"||h.align==="left"?0:h.align==="end"||h.align==="right"?100:50),h.position=p}function n(){c=c.replace(/^\s+/,"")}if(n(),y.startTime=l(),n(),c.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+o);c=c.slice(3),n(),y.endTime=l(),n(),s(c,y)}function _(c){return c.replace(/<br(?: \/)?>/gi,`
`)}var T=function(){function c(){this.state="INITIAL",this.buffer="",this.decoder=new D,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var y=c.prototype;return y.parse=function(o){var l=this;o&&(l.buffer+=l.decoder.decode(o,{stream:!0}));function s(){var p=l.buffer,i=0;for(p=_(p);i<p.length&&p[i]!=="\r"&&p[i]!==`
`;)++i;var a=p.slice(0,i);return p[i]==="\r"&&++i,p[i]===`
`&&++i,l.buffer=p.slice(i),a}function n(p){k(p,function(i,a){},/:/)}try{var g="";if(l.state==="INITIAL"){if(!/\r\n|\n/.test(l.buffer))return this;g=s();var h=g.match(/^()?WEBVTT([ \t].*)?$/);if(!h||!h[0])throw new Error("Malformed WebVTT signature.");l.state="HEADER"}for(var r=!1;l.buffer;){if(!/\r\n|\n/.test(l.buffer))return this;switch(r?r=!1:g=s(),l.state){case"HEADER":/:/.test(g)?n(g):g||(l.state="ID");continue;case"NOTE":g||(l.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(g)){l.state="NOTE";break}if(!g)continue;if(l.cue=new F.default(0,0,""),l.state="CUE",g.indexOf("-->")===-1){l.cue.id=g;continue}case"CUE":if(!l.cue){l.state="BADCUE";continue}try{x(g,l.cue,l.regionList)}catch{l.cue=null,l.state="BADCUE";continue}l.state="CUETEXT";continue;case"CUETEXT":{var u=g.indexOf("-->")!==-1;if(!g||u&&(r=!0)){l.oncue&&l.cue&&l.oncue(l.cue),l.cue=null,l.state="ID";continue}if(l.cue===null)continue;l.cue.text&&(l.cue.text+=`
`),l.cue.text+=g}continue;case"BADCUE":g||(l.state="ID")}}}catch{l.state==="CUETEXT"&&l.cue&&l.oncue&&l.oncue(l.cue),l.cue=null,l.state=l.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},y.flush=function(){var o=this;try{if((o.cue||o.state==="HEADER")&&(o.buffer+=`

`,o.parse()),o.state==="INITIAL"||o.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(l){o.onparsingerror&&o.onparsingerror(l)}return o.onflush&&o.onflush(),this},c}()},"./src/utils/webvtt-parser.ts":(V,U,S)=>{S.r(U),S.d(U,{generateCueId:()=>T,parseWebVTT:()=>y});var F=S("./src/polyfills/number.ts"),D=S("./src/utils/vttparser.ts"),b=S("./src/demux/id3.ts"),P=S("./src/utils/timescale-conversion.ts"),k=S("./src/remux/mp4-remuxer.ts"),A=/\r\n|\n\r|\n|\r/g,L=function(o,l,s){return s===void 0&&(s=0),o.slice(s,s+l.length)===l},x=function(o){var l=parseInt(o.slice(-3)),s=parseInt(o.slice(-6,-4)),n=parseInt(o.slice(-9,-7)),g=o.length>9?parseInt(o.substring(0,o.indexOf(":"))):0;if(!(0,F.isFiniteNumber)(l)||!(0,F.isFiniteNumber)(s)||!(0,F.isFiniteNumber)(n)||!(0,F.isFiniteNumber)(g))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+o);return l+=1e3*s,l+=60*1e3*n,l+=60*60*1e3*g,l},_=function(o){for(var l=5381,s=o.length;s;)l=l*33^o.charCodeAt(--s);return(l>>>0).toString()};function T(m,o,l){return _(m.toString())+_(o.toString())+_(l)}var c=function(o,l,s){var n=o[l],g=o[n.prevCC];if(!g||!g.new&&n.new){o.ccOffset=o.presentationOffset=n.start,n.new=!1;return}for(;(h=g)!==null&&h!==void 0&&h.new;){var h;o.ccOffset+=n.start-g.start,n.new=!1,n=g,g=o[n.prevCC]}o.presentationOffset=s};function y(m,o,l,s,n,g,h,r){var u=new D.VTTParser,p=(0,b.utf8ArrayToStr)(new Uint8Array(m)).trim().replace(A,`
`).split(`
`),i=[],a=(0,P.toMpegTsClockFromTimescale)(o,l),t="00:00.000",f=0,e=0,d,E=!0;u.oncue=function(v){var I=s[n],R=s.ccOffset,O=(f-a)/9e4;I!=null&&I.new&&(e!==void 0?R=s.ccOffset=I.start:c(s,n,O)),O&&(R=O-s.presentationOffset);var C=v.endTime-v.startTime,M=(0,k.normalizePts)((v.startTime+R-e)*9e4,g*9e4)/9e4;v.startTime=Math.max(M,0),v.endTime=Math.max(M+C,0);var B=v.text.trim();v.text=decodeURIComponent(encodeURIComponent(B)),v.id||(v.id=T(v.startTime,v.endTime,B)),v.endTime>0&&i.push(v)},u.onparsingerror=function(v){d=v},u.onflush=function(){if(d){r(d);return}h(i)},p.forEach(function(v){if(E)if(L(v,"X-TIMESTAMP-MAP=")){E=!1,v.slice(16).split(",").forEach(function(I){L(I,"LOCAL:")?t=I.slice(6):L(I,"MPEGTS:")&&(f=parseInt(I.slice(7)))});try{e=x(t)/1e3}catch(I){d=I}return}else v===""&&(E=!1);u.parse(v+`
`)}),u.flush()}},"./src/utils/xhr-loader.ts":(V,U,S)=>{S.r(U),S.d(U,{default:()=>k});var F=S("./src/utils/logger.ts"),D=S("./src/loader/load-stats.ts"),b=/^age:\s*[\d.]+\s*$/m,P=function(){function A(x){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=x?x.xhrSetup:null,this.stats=new D.LoadStats,this.retryDelay=0}var L=A.prototype;return L.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},L.abortInternal=function(){var _=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),_&&(_.onreadystatechange=null,_.onprogress=null,_.readyState!==4&&(this.stats.aborted=!0,_.abort()))},L.abort=function(){var _;this.abortInternal(),(_=this.callbacks)!==null&&_!==void 0&&_.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},L.load=function(_,T,c){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=_,this.config=T,this.callbacks=c,this.retryDelay=T.retryDelay,this.loadInternal()},L.loadInternal=function(){var _=this.config,T=this.context;if(_){var c=this.loader=new self.XMLHttpRequest,y=this.stats;y.loading.first=0,y.loaded=0;var m=this.xhrSetup;try{if(m)try{m(c,T.url)}catch{c.open("GET",T.url,!0),m(c,T.url)}c.readyState||c.open("GET",T.url,!0);var o=this.context.headers;if(o)for(var l in o)c.setRequestHeader(l,o[l])}catch(s){this.callbacks.onError({code:c.status,text:s.message},T,c);return}T.rangeEnd&&c.setRequestHeader("Range","bytes="+T.rangeStart+"-"+(T.rangeEnd-1)),c.onreadystatechange=this.readystatechange.bind(this),c.onprogress=this.loadprogress.bind(this),c.responseType=T.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),_.timeout),c.send()}},L.readystatechange=function(){var _=this.context,T=this.loader,c=this.stats;if(!(!_||!T)){var y=T.readyState,m=this.config;if(!c.aborted&&y>=2)if(self.clearTimeout(this.requestTimeout),c.loading.first===0&&(c.loading.first=Math.max(self.performance.now(),c.loading.start)),y===4){T.onreadystatechange=null,T.onprogress=null;var o=T.status,l=T.responseType==="arraybuffer";if(o>=200&&o<300&&(l&&T.response||T.responseText!==null)){c.loading.end=Math.max(self.performance.now(),c.loading.first);var s,n;if(l?(s=T.response,n=s.byteLength):(s=T.responseText,n=s.length),c.loaded=c.total=n,!this.callbacks)return;var g=this.callbacks.onProgress;if(g&&g(c,_,s,T),!this.callbacks)return;var h={url:T.responseURL,data:s};this.callbacks.onSuccess(h,c,_,T)}else c.retry>=m.maxRetry||o>=400&&o<499?(F.logger.error(o+" while loading "+_.url),this.callbacks.onError({code:o,text:T.statusText},_,T)):(F.logger.warn(o+" while loading "+_.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,m.maxRetryDelay),c.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),m.timeout)}},L.loadtimeout=function(){F.logger.warn("timeout while loading "+this.context.url);var _=this.callbacks;_&&(this.abortInternal(),_.onTimeout(this.stats,this.context,this.loader))},L.loadprogress=function(_){var T=this.stats;T.loaded=_.loaded,_.lengthComputable&&(T.total=_.total)},L.getCacheAge=function(){var _=null;if(this.loader&&b.test(this.loader.getAllResponseHeaders())){var T=this.loader.getResponseHeader("age");_=T?parseFloat(T):null}return _},A}();const k=P},"./node_modules/eventemitter3/index.js":V=>{var U=Object.prototype.hasOwnProperty,S="~";function F(){}Object.create&&(F.prototype=Object.create(null),new F().__proto__||(S=!1));function D(A,L,x){this.fn=A,this.context=L,this.once=x||!1}function b(A,L,x,_,T){if(typeof x!="function")throw new TypeError("The listener must be a function");var c=new D(x,_||A,T),y=S?S+L:L;return A._events[y]?A._events[y].fn?A._events[y]=[A._events[y],c]:A._events[y].push(c):(A._events[y]=c,A._eventsCount++),A}function P(A,L){--A._eventsCount===0?A._events=new F:delete A._events[L]}function k(){this._events=new F,this._eventsCount=0}k.prototype.eventNames=function(){var L=[],x,_;if(this._eventsCount===0)return L;for(_ in x=this._events)U.call(x,_)&&L.push(S?_.slice(1):_);return Object.getOwnPropertySymbols?L.concat(Object.getOwnPropertySymbols(x)):L},k.prototype.listeners=function(L){var x=S?S+L:L,_=this._events[x];if(!_)return[];if(_.fn)return[_.fn];for(var T=0,c=_.length,y=new Array(c);T<c;T++)y[T]=_[T].fn;return y},k.prototype.listenerCount=function(L){var x=S?S+L:L,_=this._events[x];return _?_.fn?1:_.length:0},k.prototype.emit=function(L,x,_,T,c,y){var m=S?S+L:L;if(!this._events[m])return!1;var o=this._events[m],l=arguments.length,s,n;if(o.fn){switch(o.once&&this.removeListener(L,o.fn,void 0,!0),l){case 1:return o.fn.call(o.context),!0;case 2:return o.fn.call(o.context,x),!0;case 3:return o.fn.call(o.context,x,_),!0;case 4:return o.fn.call(o.context,x,_,T),!0;case 5:return o.fn.call(o.context,x,_,T,c),!0;case 6:return o.fn.call(o.context,x,_,T,c,y),!0}for(n=1,s=new Array(l-1);n<l;n++)s[n-1]=arguments[n];o.fn.apply(o.context,s)}else{var g=o.length,h;for(n=0;n<g;n++)switch(o[n].once&&this.removeListener(L,o[n].fn,void 0,!0),l){case 1:o[n].fn.call(o[n].context);break;case 2:o[n].fn.call(o[n].context,x);break;case 3:o[n].fn.call(o[n].context,x,_);break;case 4:o[n].fn.call(o[n].context,x,_,T);break;default:if(!s)for(h=1,s=new Array(l-1);h<l;h++)s[h-1]=arguments[h];o[n].fn.apply(o[n].context,s)}}return!0},k.prototype.on=function(L,x,_){return b(this,L,x,_,!1)},k.prototype.once=function(L,x,_){return b(this,L,x,_,!0)},k.prototype.removeListener=function(L,x,_,T){var c=S?S+L:L;if(!this._events[c])return this;if(!x)return P(this,c),this;var y=this._events[c];if(y.fn)y.fn===x&&(!T||y.once)&&(!_||y.context===_)&&P(this,c);else{for(var m=0,o=[],l=y.length;m<l;m++)(y[m].fn!==x||T&&!y[m].once||_&&y[m].context!==_)&&o.push(y[m]);o.length?this._events[c]=o.length===1?o[0]:o:P(this,c)}return this},k.prototype.removeAllListeners=function(L){var x;return L?(x=S?S+L:L,this._events[x]&&P(this,x)):(this._events=new F,this._eventsCount=0),this},k.prototype.off=k.prototype.removeListener,k.prototype.addListener=k.prototype.on,k.prefixed=S,k.EventEmitter=k,V.exports=k},"./node_modules/url-toolkit/src/url-toolkit.js":function(V){(function(U){var S=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,F=/^(?=([^\/?#]*))\1([^]*)$/,D=/(?:\/|^)\.(?=\/)/g,b=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,P={buildAbsoluteURL:function(k,A,L){if(L=L||{},k=k.trim(),A=A.trim(),!A){if(!L.alwaysNormalize)return k;var x=P.parseURL(k);if(!x)throw new Error("Error trying to parse base URL.");return x.path=P.normalizePath(x.path),P.buildURLFromParts(x)}var _=P.parseURL(A);if(!_)throw new Error("Error trying to parse relative URL.");if(_.scheme)return L.alwaysNormalize?(_.path=P.normalizePath(_.path),P.buildURLFromParts(_)):A;var T=P.parseURL(k);if(!T)throw new Error("Error trying to parse base URL.");if(!T.netLoc&&T.path&&T.path[0]!=="/"){var c=F.exec(T.path);T.netLoc=c[1],T.path=c[2]}T.netLoc&&!T.path&&(T.path="/");var y={scheme:T.scheme,netLoc:_.netLoc,path:null,params:_.params,query:_.query,fragment:_.fragment};if(!_.netLoc&&(y.netLoc=T.netLoc,_.path[0]!=="/"))if(!_.path)y.path=T.path,_.params||(y.params=T.params,_.query||(y.query=T.query));else{var m=T.path,o=m.substring(0,m.lastIndexOf("/")+1)+_.path;y.path=P.normalizePath(o)}return y.path===null&&(y.path=L.alwaysNormalize?P.normalizePath(_.path):_.path),P.buildURLFromParts(y)},parseURL:function(k){var A=S.exec(k);return A?{scheme:A[1]||"",netLoc:A[2]||"",path:A[3]||"",params:A[4]||"",query:A[5]||"",fragment:A[6]||""}:null},normalizePath:function(k){for(k=k.split("").reverse().join("").replace(D,"");k.length!==(k=k.replace(b,"")).length;);return k.split("").reverse().join("")},buildURLFromParts:function(k){return k.scheme+k.netLoc+k.path+k.params+k.query+k.fragment}};V.exports=P})()}},Z={};function ee(V){var U=Z[V];if(U!==void 0)return U.exports;var S=Z[V]={exports:{}};return X[V].call(S.exports,S,S.exports,ee),S.exports}ee.m=X,ee.n=V=>{var U=V&&V.__esModule?()=>V.default:()=>V;return ee.d(U,{a:U}),U},ee.d=(V,U)=>{for(var S in U)ee.o(U,S)&&!ee.o(V,S)&&Object.defineProperty(V,S,{enumerable:!0,get:U[S]})},ee.o=(V,U)=>Object.prototype.hasOwnProperty.call(V,U),ee.r=V=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(V,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(V,"__esModule",{value:!0})};var ie=ee("./src/hls.ts");return ie=ie.default,ie})())})(Fi);const Be=rr(at),ki=oe.memo(({src:K,poster:j,controls:X,objectFit:Z="cover",borderRadius:ee="lg",...ie})=>{const{isOpen:V,onOpen:U,onClose:S}=yr(),F=oe.useRef(null);return oe.useEffect(()=>{let D;return Be.isSupported()&&F.current&&K&&(D=new Be,D.loadSource(K),D.attachMedia(F.current),D.on(Be.Events.MEDIA_ATTACHED,U),D.on(Be.Events.MANIFEST_PARSED,S),D.on(Be.Events.ERROR,S)),()=>{D&&(D.off(Be.Events.MEDIA_ATTACHED,U),D.off(Be.Events.MANIFEST_PARSED,S),D.off(Be.Events.ERROR,S),D.destroy())}},[K,U,S]),Ge(ir,{bg:"black",position:"relative",borderRadius:ee,sx:{video:{h:"100%",w:"100%",objectFit:Z,borderRadius:ee}},...ie,children:[V&&ne(nr,{position:"absolute",top:0,left:0,w:"100%",h:"100%",bg:"rgba(0, 0, 0, 0.5)",children:ne(Tt,{color:"white"})}),ne("video",{controls:X,autoPlay:!0,ref:F,poster:j})]})});ki.displayName="VideoPlayer";const zi=()=>{const{colorMode:K}=Lt();return K==="dark"},$i=({children:K})=>{const{colorMode:j,setColorMode:X}=Lt(),Z=j==="dark";return Ge(bt,{px:4,w:"100%",top:0,left:0,zIndex:"modal",h:ar,position:"fixed",borderTop:"1px",borderBottom:"1px",alignItems:"center",justifyContent:"space-between",bg:Z?"gray.700":"white",borderColor:Z?"gray.600":"gray.300",children:[K||ne("span",{}),ne(Pt,{"aria-label":"Change theme",onClick:()=>X(Z?"light":"dark"),fontSize:"25px",children:Z?ne(Mi,{}):ne(bi,{})})]})},Bi=()=>Dt.get("/core/preview-courses").then(K=>K.data),Ui=K=>Dt.get(`/core/preview-courses/${K}`).then(j=>j.data),Qi=()=>At({queryKey:["courses"],queryFn:Bi}),Zi=K=>At({queryKey:["courses",K],queryFn:()=>Ui(K)});export{Hi as A,It as B,Ki as C,bt as F,ke as G,Sr as H,Yi as R,Mt as S,Or as T,ki as V,yr as a,Ot as b,Gi as c,rt as d,Vi as e,zi as f,Xi as g,Wi as h,Pr as i,Qi as j,$i as k,Ye as l,ur as m,Zr as n,Nr as o,Xe as p,ci as q,Ai as r,mi as s,ji as t,gr as u,Zi as v};
